/*! For license information please see bundle.4fe682c332f56cecf25a.js.LICENSE.txt */
(()=>{var t,e,n={481:function(t,e){!function(t){"use strict";function e(t){var e,n,i,r;for(n=1,i=arguments.length;n<i;n++)for(e in r=arguments[n])t[e]=r[e];return t}var n=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();function i(t,e){var n=Array.prototype.slice;if(t.bind)return t.bind.apply(t,n.call(arguments,1));var i=n.call(arguments,2);return function(){return t.apply(e,i.length?i.concat(n.call(arguments)):arguments)}}var r=0;function o(t){return"_leaflet_id"in t||(t._leaflet_id=++r),t._leaflet_id}function s(t,e,n){var i,r,o,s;return s=function(){i=!1,r&&(o.apply(n,r),r=!1)},o=function(){i?r=arguments:(t.apply(n,arguments),setTimeout(s,e),i=!0)},o}function a(t,e,n){var i=e[1],r=e[0],o=i-r;return t===i&&n?t:((t-r)%o+o)%o+r}function c(){return!1}function u(t,e){if(!1===e)return t;var n=Math.pow(10,void 0===e?6:e);return Math.round(t*n)/n}function l(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function h(t){return l(t).split(/\s+/)}function d(t,e){for(var i in Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?n(t.options):{}),e)t.options[i]=e[i];return t.options}function f(t,e,n){var i=[];for(var r in t)i.push(encodeURIComponent(n?r.toUpperCase():r)+"="+encodeURIComponent(t[r]));return(e&&-1!==e.indexOf("?")?"&":"?")+i.join("&")}var p=/\{ *([\w_ -]+) *\}/g;function m(t,e){return t.replace(p,function(t,n){var i=e[n];if(void 0===i)throw new Error("No value provided for variable "+t);return"function"==typeof i&&(i=i(e)),i})}var g=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function y(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1}var v="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function _(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var w=0;function b(t){var e=+new Date,n=Math.max(0,16-(e-w));return w=e+n,window.setTimeout(t,n)}var T=window.requestAnimationFrame||_("RequestAnimationFrame")||b,E=window.cancelAnimationFrame||_("CancelAnimationFrame")||_("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function S(t,e,n){if(!n||T!==b)return T.call(window,i(t,e));t.call(e)}function I(t){t&&E.call(window,t)}var k={__proto__:null,extend:e,create:n,bind:i,get lastId(){return r},stamp:o,throttle:s,wrapNum:a,falseFn:c,formatNum:u,trim:l,splitWords:h,setOptions:d,getParamString:f,template:m,isArray:g,indexOf:y,emptyImageUrl:v,requestFn:T,cancelFn:E,requestAnimFrame:S,cancelAnimFrame:I};function C(){}C.extend=function(t){var i=function(){d(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},r=i.__super__=this.prototype,o=n(r);for(var s in o.constructor=i,i.prototype=o,this)Object.prototype.hasOwnProperty.call(this,s)&&"prototype"!==s&&"__super__"!==s&&(i[s]=this[s]);return t.statics&&e(i,t.statics),t.includes&&(function(t){if("undefined"!=typeof L&&L&&L.Mixin){t=g(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}(t.includes),e.apply(null,[o].concat(t.includes))),e(o,t),delete o.statics,delete o.includes,o.options&&(o.options=r.options?n(r.options):{},e(o.options,t.options)),o._initHooks=[],o.callInitHooks=function(){if(!this._initHooksCalled){r.callInitHooks&&r.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=o._initHooks.length;t<e;t++)o._initHooks[t].call(this)}},i},C.include=function(t){var n=this.prototype.options;return e(this.prototype,t),t.options&&(this.prototype.options=n,this.mergeOptions(t.options)),this},C.mergeOptions=function(t){return e(this.prototype.options,t),this},C.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),n="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n),this};var P={on:function(t,e,n){if("object"==typeof t)for(var i in t)this._on(i,t[i],e);else for(var r=0,o=(t=h(t)).length;r<o;r++)this._on(t[r],e,n);return this},off:function(t,e,n){if(arguments.length)if("object"==typeof t)for(var i in t)this._off(i,t[i],e);else{t=h(t);for(var r=1===arguments.length,o=0,s=t.length;o<s;o++)r?this._off(t[o]):this._off(t[o],e,n)}else delete this._events;return this},_on:function(t,e,n,i){if("function"==typeof e){if(!1===this._listens(t,e,n)){n===this&&(n=void 0);var r={fn:e,ctx:n};i&&(r.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(r)}}else console.warn("wrong listener type: "+typeof e)},_off:function(t,e,n){var i,r,o;if(this._events&&(i=this._events[t]))if(1!==arguments.length)if("function"==typeof e){var s=this._listens(t,e,n);if(!1!==s){var a=i[s];this._firingCount&&(a.fn=c,this._events[t]=i=i.slice()),i.splice(s,1)}}else console.warn("wrong listener type: "+typeof e);else{if(this._firingCount)for(r=0,o=i.length;r<o;r++)i[r].fn=c;delete this._events[t]}},fire:function(t,n,i){if(!this.listens(t,i))return this;var r=e({},n,{type:t,target:this,sourceTarget:n&&n.sourceTarget||this});if(this._events){var o=this._events[t];if(o){this._firingCount=this._firingCount+1||1;for(var s=0,a=o.length;s<a;s++){var c=o[s],u=c.fn;c.once&&this.off(t,u,c.ctx),u.call(c.ctx||this,r)}this._firingCount--}}return i&&this._propagateEvent(r),this},listens:function(t,e,n,i){"string"!=typeof t&&console.warn('"string" type argument expected');var r=e;"function"!=typeof e&&(i=!!e,r=void 0,n=void 0);var o=this._events&&this._events[t];if(o&&o.length&&!1!==this._listens(t,r,n))return!0;if(i)for(var s in this._eventParents)if(this._eventParents[s].listens(t,e,n,i))return!0;return!1},_listens:function(t,e,n){if(!this._events)return!1;var i=this._events[t]||[];if(!e)return!!i.length;n===this&&(n=void 0);for(var r=0,o=i.length;r<o;r++)if(i[r].fn===e&&i[r].ctx===n)return r;return!1},once:function(t,e,n){if("object"==typeof t)for(var i in t)this._on(i,t[i],e,!0);else for(var r=0,o=(t=h(t)).length;r<o;r++)this._on(t[r],e,n,!0);return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[o(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[o(t)],this},_propagateEvent:function(t){for(var n in this._eventParents)this._eventParents[n].fire(t.type,e({layer:t.target,propagatedFrom:t.target},t),!0)}};P.addEventListener=P.on,P.removeEventListener=P.clearAllEventListeners=P.off,P.addOneTimeEventListener=P.once,P.fireEvent=P.fire,P.hasEventListeners=P.listens;var x=C.extend(P);function A(t,e,n){this.x=n?Math.round(t):t,this.y=n?Math.round(e):e}var O=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};function M(t,e,n){return t instanceof A?t:g(t)?new A(t[0],t[1]):null==t?t:"object"==typeof t&&"x"in t&&"y"in t?new A(t.x,t.y):new A(t,e,n)}function N(t,e){if(t)for(var n=e?[t,e]:t,i=0,r=n.length;i<r;i++)this.extend(n[i])}function R(t,e){return!t||t instanceof N?t:new N(t,e)}function D(t,e){if(t)for(var n=e?[t,e]:t,i=0,r=n.length;i<r;i++)this.extend(n[i])}function j(t,e){return t instanceof D?t:new D(t,e)}function F(t,e,n){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==n&&(this.alt=+n)}function U(t,e,n){return t instanceof F?t:g(t)&&"object"!=typeof t[0]?3===t.length?new F(t[0],t[1],t[2]):2===t.length?new F(t[0],t[1]):null:null==t?t:"object"==typeof t&&"lat"in t?new F(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===e?null:new F(t,e,n)}A.prototype={clone:function(){return new A(this.x,this.y)},add:function(t){return this.clone()._add(M(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(M(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new A(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new A(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=O(this.x),this.y=O(this.y),this},distanceTo:function(t){var e=(t=M(t)).x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)},equals:function(t){return(t=M(t)).x===this.x&&t.y===this.y},contains:function(t){return t=M(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+u(this.x)+", "+u(this.y)+")"}},N.prototype={extend:function(t){var e,n;if(!t)return this;if(t instanceof A||"number"==typeof t[0]||"x"in t)e=n=M(t);else if(e=(t=R(t)).min,n=t.max,!e||!n)return this;return this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(n.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(n.y,this.max.y)):(this.min=e.clone(),this.max=n.clone()),this},getCenter:function(t){return M((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return M(this.min.x,this.max.y)},getTopRight:function(){return M(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,n;return(t="number"==typeof t[0]||t instanceof A?M(t):R(t))instanceof N?(e=t.min,n=t.max):e=n=t,e.x>=this.min.x&&n.x<=this.max.x&&e.y>=this.min.y&&n.y<=this.max.y},intersects:function(t){t=R(t);var e=this.min,n=this.max,i=t.min,r=t.max,o=r.x>=e.x&&i.x<=n.x,s=r.y>=e.y&&i.y<=n.y;return o&&s},overlaps:function(t){t=R(t);var e=this.min,n=this.max,i=t.min,r=t.max,o=r.x>e.x&&i.x<n.x,s=r.y>e.y&&i.y<n.y;return o&&s},isValid:function(){return!(!this.min||!this.max)},pad:function(t){var e=this.min,n=this.max,i=Math.abs(e.x-n.x)*t,r=Math.abs(e.y-n.y)*t;return R(M(e.x-i,e.y-r),M(n.x+i,n.y+r))},equals:function(t){return!!t&&(t=R(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight()))}},D.prototype={extend:function(t){var e,n,i=this._southWest,r=this._northEast;if(t instanceof F)e=t,n=t;else{if(!(t instanceof D))return t?this.extend(U(t)||j(t)):this;if(e=t._southWest,n=t._northEast,!e||!n)return this}return i||r?(i.lat=Math.min(e.lat,i.lat),i.lng=Math.min(e.lng,i.lng),r.lat=Math.max(n.lat,r.lat),r.lng=Math.max(n.lng,r.lng)):(this._southWest=new F(e.lat,e.lng),this._northEast=new F(n.lat,n.lng)),this},pad:function(t){var e=this._southWest,n=this._northEast,i=Math.abs(e.lat-n.lat)*t,r=Math.abs(e.lng-n.lng)*t;return new D(new F(e.lat-i,e.lng-r),new F(n.lat+i,n.lng+r))},getCenter:function(){return new F((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new F(this.getNorth(),this.getWest())},getSouthEast:function(){return new F(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof F||"lat"in t?U(t):j(t);var e,n,i=this._southWest,r=this._northEast;return t instanceof D?(e=t.getSouthWest(),n=t.getNorthEast()):e=n=t,e.lat>=i.lat&&n.lat<=r.lat&&e.lng>=i.lng&&n.lng<=r.lng},intersects:function(t){t=j(t);var e=this._southWest,n=this._northEast,i=t.getSouthWest(),r=t.getNorthEast(),o=r.lat>=e.lat&&i.lat<=n.lat,s=r.lng>=e.lng&&i.lng<=n.lng;return o&&s},overlaps:function(t){t=j(t);var e=this._southWest,n=this._northEast,i=t.getSouthWest(),r=t.getNorthEast(),o=r.lat>e.lat&&i.lat<n.lat,s=r.lng>e.lng&&i.lng<n.lng;return o&&s},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=j(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}},F.prototype={equals:function(t,e){return!!t&&(t=U(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+u(this.lat,t)+", "+u(this.lng,t)+")"},distanceTo:function(t){return z.distance(this,U(t))},wrap:function(){return z.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return j([this.lat-e,this.lng-n],[this.lat+e,this.lng+n])},clone:function(){return new F(this.lat,this.lng,this.alt)}};var V,B={latLngToPoint:function(t,e){var n=this.projection.project(t),i=this.scale(e);return this.transformation._transform(n,i)},pointToLatLng:function(t,e){var n=this.scale(e),i=this.transformation.untransform(t,n);return this.projection.unproject(i)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,n=this.scale(t);return new N(this.transformation.transform(e.min,n),this.transformation.transform(e.max,n))},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?a(t.lng,this.wrapLng,!0):t.lng;return new F(this.wrapLat?a(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),n=this.wrapLatLng(e),i=e.lat-n.lat,r=e.lng-n.lng;if(0===i&&0===r)return t;var o=t.getSouthWest(),s=t.getNorthEast();return new D(new F(o.lat-i,o.lng-r),new F(s.lat-i,s.lng-r))}},z=e({},B,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var n=Math.PI/180,i=t.lat*n,r=e.lat*n,o=Math.sin((e.lat-t.lat)*n/2),s=Math.sin((e.lng-t.lng)*n/2),a=o*o+Math.cos(i)*Math.cos(r)*s*s,c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return this.R*c}}),G=6378137,q={R:G,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,n=this.MAX_LATITUDE,i=Math.max(Math.min(n,t.lat),-n),r=Math.sin(i*e);return new A(this.R*t.lng*e,this.R*Math.log((1+r)/(1-r))/2)},unproject:function(t){var e=180/Math.PI;return new F((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:(V=G*Math.PI,new N([-V,-V],[V,V]))};function H(t,e,n,i){if(g(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=n,this._d=i}function Z(t,e,n,i){return new H(t,e,n,i)}H.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new A((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var W=e({},z,{code:"EPSG:3857",projection:q,transformation:function(){var t=.5/(Math.PI*q.R);return Z(t,.5,-t,.5)}()}),$=e({},W,{code:"EPSG:900913"});function K(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Q(t,e){var n,i,r,o,s,a,c="";for(n=0,r=t.length;n<r;n++){for(i=0,o=(s=t[n]).length;i<o;i++)c+=(i?"L":"M")+(a=s[i]).x+" "+a.y;c+=e?Nt.svg?"z":"x":""}return c||"M0 0"}var Y,X=document.documentElement.style,J="ActiveXObject"in window,tt=J&&!document.addEventListener,et="msLaunchUri"in navigator&&!("documentMode"in document),nt=Mt("webkit"),it=Mt("android"),rt=Mt("android 2")||Mt("android 3"),ot=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),st=it&&Mt("Google")&&ot<537&&!("AudioNode"in window),at=!!window.opera,ct=!et&&Mt("chrome"),ut=Mt("gecko")&&!nt&&!at&&!J,lt=!ct&&Mt("safari"),ht=Mt("phantom"),dt="OTransition"in X,ft=0===navigator.platform.indexOf("Win"),pt=J&&"transition"in X,mt="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!rt,gt="MozPerspective"in X,yt=!window.L_DISABLE_3D&&(pt||mt||gt)&&!dt&&!ht,vt="undefined"!=typeof orientation||Mt("mobile"),_t=vt&&nt,wt=vt&&mt,bt=!window.PointerEvent&&window.MSPointerEvent,Tt=!(!window.PointerEvent&&!bt),Et="ontouchstart"in window||!!window.TouchEvent,St=!window.L_NO_TOUCH&&(Et||Tt),It=vt&&at,kt=vt&&ut,Ct=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Pt=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",c,e),window.removeEventListener("testPassiveEventSupport",c,e)}catch(t){}return t}(),xt=!!document.createElement("canvas").getContext,At=!(!document.createElementNS||!K("svg").createSVGRect),Lt=!!At&&((Y=document.createElement("div")).innerHTML="<svg/>","http://www.w3.org/2000/svg"===(Y.firstChild&&Y.firstChild.namespaceURI)),Ot=!At&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(t){return!1}}();function Mt(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var Nt={ie:J,ielt9:tt,edge:et,webkit:nt,android:it,android23:rt,androidStock:st,opera:at,chrome:ct,gecko:ut,safari:lt,phantom:ht,opera12:dt,win:ft,ie3d:pt,webkit3d:mt,gecko3d:gt,any3d:yt,mobile:vt,mobileWebkit:_t,mobileWebkit3d:wt,msPointer:bt,pointer:Tt,touch:St,touchNative:Et,mobileOpera:It,mobileGecko:kt,retina:Ct,passiveEvents:Pt,canvas:xt,svg:At,vml:Ot,inlineSvg:Lt,mac:0===navigator.platform.indexOf("Mac"),linux:0===navigator.platform.indexOf("Linux")},Rt=Nt.msPointer?"MSPointerDown":"pointerdown",Dt=Nt.msPointer?"MSPointerMove":"pointermove",jt=Nt.msPointer?"MSPointerUp":"pointerup",Ft=Nt.msPointer?"MSPointerCancel":"pointercancel",Ut={touchstart:Rt,touchmove:Dt,touchend:jt,touchcancel:Ft},Vt={touchstart:function(t,e){e.MSPOINTER_TYPE_TOUCH&&e.pointerType===e.MSPOINTER_TYPE_TOUCH&&je(e),Wt(t,e)},touchmove:Wt,touchend:Wt,touchcancel:Wt},Bt={},zt=!1;function Gt(t,e,n){return"touchstart"===e&&(zt||(document.addEventListener(Rt,qt,!0),document.addEventListener(Dt,Ht,!0),document.addEventListener(jt,Zt,!0),document.addEventListener(Ft,Zt,!0),zt=!0)),Vt[e]?(n=Vt[e].bind(this,n),t.addEventListener(Ut[e],n,!1),n):(console.warn("wrong event specified:",e),c)}function qt(t){Bt[t.pointerId]=t}function Ht(t){Bt[t.pointerId]&&(Bt[t.pointerId]=t)}function Zt(t){delete Bt[t.pointerId]}function Wt(t,e){if(e.pointerType!==(e.MSPOINTER_TYPE_MOUSE||"mouse")){for(var n in e.touches=[],Bt)e.touches.push(Bt[n]);e.changedTouches=[e],t(e)}}var $t,Kt,Qt,Yt,Xt,Jt=me(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),te=me(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ee="webkitTransition"===te||"OTransition"===te?te+"End":"transitionend";function ne(t){return"string"==typeof t?document.getElementById(t):t}function ie(t,e){var n=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!n||"auto"===n)&&document.defaultView){var i=document.defaultView.getComputedStyle(t,null);n=i?i[e]:null}return"auto"===n?null:n}function re(t,e,n){var i=document.createElement(t);return i.className=e||"",n&&n.appendChild(i),i}function oe(t){var e=t.parentNode;e&&e.removeChild(t)}function se(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function ae(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function ce(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function ue(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=fe(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function le(t,e){if(void 0!==t.classList)for(var n=h(e),i=0,r=n.length;i<r;i++)t.classList.add(n[i]);else if(!ue(t,e)){var o=fe(t);de(t,(o?o+" ":"")+e)}}function he(t,e){void 0!==t.classList?t.classList.remove(e):de(t,l((" "+fe(t)+" ").replace(" "+e+" "," ")))}function de(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function fe(t){return t.correspondingElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function pe(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&function(t,e){var n=!1,i="DXImageTransform.Microsoft.Alpha";try{n=t.filters.item(i)}catch(t){if(1===e)return}e=Math.round(100*e),n?(n.Enabled=100!==e,n.Opacity=e):t.style.filter+=" progid:"+i+"(opacity="+e+")"}(t,e)}function me(t){for(var e=document.documentElement.style,n=0;n<t.length;n++)if(t[n]in e)return t[n];return!1}function ge(t,e,n){var i=e||new A(0,0);t.style[Jt]=(Nt.ie3d?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(n?" scale("+n+")":"")}function ye(t,e){t._leaflet_pos=e,Nt.any3d?ge(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function ve(t){return t._leaflet_pos||new A(0,0)}if("onselectstart"in document)$t=function(){Ce(window,"selectstart",je)},Kt=function(){xe(window,"selectstart",je)};else{var _e=me(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);$t=function(){if(_e){var t=document.documentElement.style;Qt=t[_e],t[_e]="none"}},Kt=function(){_e&&(document.documentElement.style[_e]=Qt,Qt=void 0)}}function we(){Ce(window,"dragstart",je)}function be(){xe(window,"dragstart",je)}function Te(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(Ee(),Yt=t,Xt=t.style.outlineStyle,t.style.outlineStyle="none",Ce(window,"keydown",Ee))}function Ee(){Yt&&(Yt.style.outlineStyle=Xt,Yt=void 0,Xt=void 0,xe(window,"keydown",Ee))}function Se(t){do{t=t.parentNode}while(!(t.offsetWidth&&t.offsetHeight||t===document.body));return t}function Ie(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}var ke={__proto__:null,TRANSFORM:Jt,TRANSITION:te,TRANSITION_END:ee,get:ne,getStyle:ie,create:re,remove:oe,empty:se,toFront:ae,toBack:ce,hasClass:ue,addClass:le,removeClass:he,setClass:de,getClass:fe,setOpacity:pe,testProp:me,setTransform:ge,setPosition:ye,getPosition:ve,get disableTextSelection(){return $t},get enableTextSelection(){return Kt},disableImageDrag:we,enableImageDrag:be,preventOutline:Te,restoreOutline:Ee,getSizedParentNode:Se,getScale:Ie};function Ce(t,e,n,i){if(e&&"object"==typeof e)for(var r in e)Oe(t,r,e[r],n);else for(var o=0,s=(e=h(e)).length;o<s;o++)Oe(t,e[o],n,i);return this}var Pe="_leaflet_events";function xe(t,e,n,i){if(1===arguments.length)Ae(t),delete t[Pe];else if(e&&"object"==typeof e)for(var r in e)Me(t,r,e[r],n);else if(e=h(e),2===arguments.length)Ae(t,function(t){return-1!==y(e,t)});else for(var o=0,s=e.length;o<s;o++)Me(t,e[o],n,i);return this}function Ae(t,e){for(var n in t[Pe]){var i=n.split(/\d/)[0];e&&!e(i)||Me(t,i,null,null,n)}}var Le={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Oe(t,e,n,i){var r=e+o(n)+(i?"_"+o(i):"");if(t[Pe]&&t[Pe][r])return this;var s=function(e){return n.call(i||t,e||window.event)},a=s;!Nt.touchNative&&Nt.pointer&&0===e.indexOf("touch")?s=Gt(t,e,s):Nt.touch&&"dblclick"===e?s=function(t,e){t.addEventListener("dblclick",e);var n,i=0;function r(t){if(1===t.detail){if("mouse"!==t.pointerType&&(!t.sourceCapabilities||t.sourceCapabilities.firesTouchEvents)){var r=Ue(t);if(!r.some(function(t){return t instanceof HTMLLabelElement&&t.attributes.for})||r.some(function(t){return t instanceof HTMLInputElement||t instanceof HTMLSelectElement})){var o=Date.now();o-i<=200?2===++n&&e(function(t){var e,n,i={};for(n in t)e=t[n],i[n]=e&&e.bind?e.bind(t):e;return t=i,i.type="dblclick",i.detail=2,i.isTrusted=!1,i._simulated=!0,i}(t)):n=1,i=o}}}else n=t.detail}return t.addEventListener("click",r),{dblclick:e,simDblclick:r}}(t,s):"addEventListener"in t?"touchstart"===e||"touchmove"===e||"wheel"===e||"mousewheel"===e?t.addEventListener(Le[e]||e,s,!!Nt.passiveEvents&&{passive:!1}):"mouseenter"===e||"mouseleave"===e?(s=function(e){e=e||window.event,Ge(t,e)&&a(e)},t.addEventListener(Le[e],s,!1)):t.addEventListener(e,a,!1):t.attachEvent("on"+e,s),t[Pe]=t[Pe]||{},t[Pe][r]=s}function Me(t,e,n,i,r){r=r||e+o(n)+(i?"_"+o(i):"");var s=t[Pe]&&t[Pe][r];if(!s)return this;!Nt.touchNative&&Nt.pointer&&0===e.indexOf("touch")?function(t,e,n){Ut[e]?t.removeEventListener(Ut[e],n,!1):console.warn("wrong event specified:",e)}(t,e,s):Nt.touch&&"dblclick"===e?function(t,e){t.removeEventListener("dblclick",e.dblclick),t.removeEventListener("click",e.simDblclick)}(t,s):"removeEventListener"in t?t.removeEventListener(Le[e]||e,s,!1):t.detachEvent("on"+e,s),t[Pe][r]=null}function Ne(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function Re(t){return Oe(t,"wheel",Ne),this}function De(t){return Ce(t,"mousedown touchstart dblclick contextmenu",Ne),t._leaflet_disable_click=!0,this}function je(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Fe(t){return je(t),Ne(t),this}function Ue(t){if(t.composedPath)return t.composedPath();for(var e=[],n=t.target;n;)e.push(n),n=n.parentNode;return e}function Ve(t,e){if(!e)return new A(t.clientX,t.clientY);var n=Ie(e),i=n.boundingClientRect;return new A((t.clientX-i.left)/n.x-e.clientLeft,(t.clientY-i.top)/n.y-e.clientTop)}var Be=Nt.linux&&Nt.chrome?window.devicePixelRatio:Nt.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function ze(t){return Nt.edge?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/Be:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}function Ge(t,e){var n=e.relatedTarget;if(!n)return!0;try{for(;n&&n!==t;)n=n.parentNode}catch(t){return!1}return n!==t}var qe={__proto__:null,on:Ce,off:xe,stopPropagation:Ne,disableScrollPropagation:Re,disableClickPropagation:De,preventDefault:je,stop:Fe,getPropagationPath:Ue,getMousePosition:Ve,getWheelDelta:ze,isExternalTarget:Ge,addListener:Ce,removeListener:xe},He=x.extend({run:function(t,e,n,i){this.stop(),this._el=t,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(i||.5,.2),this._startPos=ve(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=S(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,n=1e3*this._duration;e<n?this._runFrame(this._easeOut(e/n),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var n=this._startPos.add(this._offset.multiplyBy(t));e&&n._round(),ye(this._el,n),this.fire("step")},_complete:function(){I(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),Ze=x.extend({options:{crs:W,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=d(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=i(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(U(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=te&&Nt.any3d&&!Nt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Ce(this._proxy,ee,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,n,i){return n=void 0===n?this._zoom:this._limitZoom(n),t=this._limitCenter(U(t),n,this.options.maxBounds),i=i||{},this._stop(),this._loaded&&!i.reset&&!0!==i&&(void 0!==i.animate&&(i.zoom=e({animate:i.animate},i.zoom),i.pan=e({animate:i.animate,duration:i.duration},i.pan)),this._zoom!==n?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,n,i.zoom):this._tryAnimatedPan(t,i.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(t,n,i.pan&&i.pan.noMoveStart),this)},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(Nt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(Nt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,n){var i=this.getZoomScale(e),r=this.getSize().divideBy(2),o=(t instanceof A?t:this.latLngToContainerPoint(t)).subtract(r).multiplyBy(1-1/i),s=this.containerPointToLatLng(r.add(o));return this.setView(s,e,{zoom:n})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():j(t);var n=M(e.paddingTopLeft||e.padding||[0,0]),i=M(e.paddingBottomRight||e.padding||[0,0]),r=this.getBoundsZoom(t,!1,n.add(i));if((r="number"==typeof e.maxZoom?Math.min(e.maxZoom,r):r)===1/0)return{center:t.getCenter(),zoom:r};var o=i.subtract(n).divideBy(2),s=this.project(t.getSouthWest(),r),a=this.project(t.getNorthEast(),r);return{center:this.unproject(s.add(a).divideBy(2).add(o),r),zoom:r}},fitBounds:function(t,e){if(!(t=j(t)).isValid())throw new Error("Bounds are not valid.");var n=this._getBoundsCenterZoom(t,e);return this.setView(n.center,n.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(e=e||{},!(t=M(t).round()).x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new He,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){le(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,n,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,n){if(!1===(n=n||{}).animate||!Nt.any3d)return this.setView(t,e,n);this._stop();var i=this.project(this.getCenter()),r=this.project(t),o=this.getSize(),s=this._zoom;t=U(t),e=void 0===e?s:e;var a=Math.max(o.x,o.y),c=a*this.getZoomScale(s,e),u=r.distanceTo(i)||1,l=1.42,h=2.0164;function d(t){var e=(c*c-a*a+(t?-1:1)*h*h*u*u)/(2*(t?c:a)*h*u),n=Math.sqrt(e*e+1)-e;return n<1e-9?-18:Math.log(n)}function f(t){return(Math.exp(t)-Math.exp(-t))/2}function p(t){return(Math.exp(t)+Math.exp(-t))/2}var m=d(0);function g(t){return a*(p(m)*(f(e=m+l*t)/p(e))-f(m))/h;var e}var y=Date.now(),v=(d(1)-m)/l,_=n.duration?1e3*n.duration:1e3*v*.8;return this._moveStart(!0,n.noMoveStart),function n(){var o=(Date.now()-y)/_,c=function(t){return 1-Math.pow(1-t,1.5)}(o)*v;o<=1?(this._flyToFrame=S(n,this),this._move(this.unproject(i.add(r.subtract(i).multiplyBy(g(c)/u)),s),this.getScaleZoom(a/function(t){return a*(p(m)/p(m+l*t))}(c),s),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}.call(this),this},flyToBounds:function(t,e){var n=this._getBoundsCenterZoom(t,e);return this.flyTo(n.center,n.zoom,e)},setMaxBounds:function(t){return t=j(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var n=this.getCenter(),i=this._limitCenter(n,this._zoom,j(t));return n.equals(i)||this.panTo(i,e),this._enforcingBounds=!1,this},panInside:function(t,e){var n=M((e=e||{}).paddingTopLeft||e.padding||[0,0]),i=M(e.paddingBottomRight||e.padding||[0,0]),r=this.project(this.getCenter()),o=this.project(t),s=this.getPixelBounds(),a=R([s.min.add(n),s.max.subtract(i)]),c=a.getSize();if(!a.contains(o)){this._enforcingBounds=!0;var u=o.subtract(a.getCenter()),l=a.extend(o).getSize().subtract(c);r.x+=u.x<0?-l.x:l.x,r.y+=u.y<0?-l.y:l.y,this.panTo(this.unproject(r),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=e({animate:!1,pan:!0},!0===t?{animate:!0}:t);var n=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var r=this.getSize(),o=n.divideBy(2).round(),s=r.divideBy(2).round(),a=o.subtract(s);return a.x||a.y?(t.animate&&t.pan?this.panBy(a):(t.pan&&this._rawPanBy(a),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(i(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:n,newSize:r})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=e({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var n=i(this._handleGeolocationResponse,this),r=i(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(n,r,t):navigator.geolocation.getCurrentPosition(n,r,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var e=t.code,n=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+n+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var e=new F(t.coords.latitude,t.coords.longitude),n=e.toBounds(2*t.coords.accuracy),i=this._locateOptions;if(i.setView){var r=this.getBoundsZoom(n);this.setView(e,i.maxZoom?Math.min(r,i.maxZoom):r)}var o={latlng:e,bounds:n,timestamp:t.timestamp};for(var s in t.coords)"number"==typeof t.coords[s]&&(o[s]=t.coords[s]);this.fire("locationfound",o)}},addHandler:function(t,e){if(!e)return this;var n=this[t]=new e(this);return this._handlers.push(n),this.options[t]&&n.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var t;for(t in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),oe(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(I(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[t].remove();for(t in this._panes)oe(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var n=re("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),e||this._mapPane);return t&&(this._panes[t]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new D(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,n){t=j(t),n=M(n||[0,0]);var i=this.getZoom()||0,r=this.getMinZoom(),o=this.getMaxZoom(),s=t.getNorthWest(),a=t.getSouthEast(),c=this.getSize().subtract(n),u=R(this.project(a,i),this.project(s,i)).getSize(),l=Nt.any3d?this.options.zoomSnap:1,h=c.x/u.x,d=c.y/u.y,f=e?Math.max(h,d):Math.min(h,d);return i=this.getScaleZoom(f,i),l&&(i=Math.round(i/(l/100))*(l/100),i=e?Math.ceil(i/l)*l:Math.floor(i/l)*l),Math.max(r,Math.min(o,i))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new A(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var n=this._getTopLeftPoint(t,e);return new N(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var n=this.options.crs;return e=void 0===e?this._zoom:e,n.scale(t)/n.scale(e)},getScaleZoom:function(t,e){var n=this.options.crs;e=void 0===e?this._zoom:e;var i=n.zoom(t*n.scale(e));return isNaN(i)?1/0:i},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(U(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(M(t),e)},layerPointToLatLng:function(t){var e=M(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){return this.project(U(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(U(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(j(t))},distance:function(t,e){return this.options.crs.distance(U(t),U(e))},containerPointToLayerPoint:function(t){return M(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return M(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(M(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(U(t)))},mouseEventToContainerPoint:function(t){return Ve(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=ne(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");Ce(e,"scroll",this._onScroll,this),this._containerId=o(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&Nt.any3d,le(t,"leaflet-container"+(Nt.touch?" leaflet-touch":"")+(Nt.retina?" leaflet-retina":"")+(Nt.ielt9?" leaflet-oldie":"")+(Nt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=ie(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&"sticky"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),ye(this._mapPane,new A(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(le(t.markerPane,"leaflet-zoom-hide"),le(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e,n){ye(this._mapPane,new A(0,0));var i=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var r=this._zoom!==e;this._moveStart(r,n)._move(t,e)._moveEnd(r),this.fire("viewreset"),i&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,n,i){void 0===e&&(e=this._zoom);var r=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),i?n&&n.pinch&&this.fire("zoom",n):((r||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return I(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){ye(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[o(this._container)]=this;var e=t?xe:Ce;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),Nt.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){I(this._resizeRequest),this._resizeRequest=S(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var n,i=[],r="mouseout"===e||"mouseover"===e,s=t.target||t.srcElement,a=!1;s;){if((n=this._targets[o(s)])&&("click"===e||"preclick"===e)&&this._draggableMoved(n)){a=!0;break}if(n&&n.listens(e,!0)){if(r&&!Ge(s,t))break;if(i.push(n),r)break}if(s===this._container)break;s=s.parentNode}return i.length||a||r||!this.listens(e,!0)||(i=[this]),i},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var e=t.target||t.srcElement;if(!(!this._loaded||e._leaflet_disable_events||"click"===t.type&&this._isClickDisabled(e))){var n=t.type;"mousedown"===n&&Te(e),this._fireDOMEvent(t,n)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,n,i){if("click"===t.type){var r=e({},t);r.type="preclick",this._fireDOMEvent(r,r.type,i)}var o=this._findEventTargets(t,n);if(i){for(var s=[],a=0;a<i.length;a++)i[a].listens(n,!0)&&s.push(i[a]);o=s.concat(o)}if(o.length){"contextmenu"===n&&je(t);var c=o[0],u={originalEvent:t};if("keypress"!==t.type&&"keydown"!==t.type&&"keyup"!==t.type){var l=c.getLatLng&&(!c._radius||c._radius<=10);u.containerPoint=l?this.latLngToContainerPoint(c.getLatLng()):this.mouseEventToContainerPoint(t),u.layerPoint=this.containerPointToLayerPoint(u.containerPoint),u.latlng=l?c.getLatLng():this.layerPointToLatLng(u.layerPoint)}for(a=0;a<o.length;a++)if(o[a].fire(n,u,!0),u.originalEvent._stopped||!1===o[a].options.bubblingMouseEvents&&-1!==y(this._mouseEvents,n))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return ve(this._mapPane)||new A(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var n=this.getSize()._divideBy(2);return this.project(t,e)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,n){var i=this._getNewPixelOrigin(n,e);return this.project(t,e)._subtract(i)},_latLngBoundsToNewLayerBounds:function(t,e,n){var i=this._getNewPixelOrigin(n,e);return R([this.project(t.getSouthWest(),e)._subtract(i),this.project(t.getNorthWest(),e)._subtract(i),this.project(t.getSouthEast(),e)._subtract(i),this.project(t.getNorthEast(),e)._subtract(i)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,n){if(!n)return t;var i=this.project(t,e),r=this.getSize().divideBy(2),o=new N(i.subtract(r),i.add(r)),s=this._getBoundsOffset(o,n,e);return Math.abs(s.x)<=1&&Math.abs(s.y)<=1?t:this.unproject(i.add(s),e)},_limitOffset:function(t,e){if(!e)return t;var n=this.getPixelBounds(),i=new N(n.min.add(t),n.max.add(t));return t.add(this._getBoundsOffset(i,e))},_getBoundsOffset:function(t,e,n){var i=R(this.project(e.getNorthEast(),n),this.project(e.getSouthWest(),n)),r=i.min.subtract(t.min),o=i.max.subtract(t.max);return new A(this._rebound(r.x,-o.x),this._rebound(r.y,-o.y))},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),n=this.getMaxZoom(),i=Nt.any3d?this.options.zoomSnap:1;return i&&(t=Math.round(t/i)*i),Math.max(e,Math.min(n,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){he(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var n=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(n)||(this.panBy(n,e),0))},_createAnimProxy:function(){var t=this._proxy=re("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(t){var e=Jt,n=this._proxy.style[e];ge(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),n===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){oe(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();ge(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||!1===n.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var i=this.getZoomScale(e),r=this._getCenterOffset(t)._divideBy(1-1/i);return!(!0!==n.animate&&!this.getSize().contains(r)||(S(function(){this._moveStart(!0,n.noMoveStart||!1)._animateZoom(t,e,!0)},this),0))},_animateZoom:function(t,e,n,r){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,le(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:r}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(i(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&he(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});var We=C.extend({options:{position:"topright"},initialize:function(t){d(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),n=this.getPosition(),i=t._controlCorners[n];return le(e,"leaflet-control"),-1!==n.indexOf("bottom")?i.insertBefore(e,i.firstChild):i.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(oe(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),$e=function(t){return new We(t)};Ze.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",n=this._controlContainer=re("div",e+"control-container",this._container);function i(i,r){var o=e+i+" "+e+r;t[i+r]=re("div",o,n)}i("top","left"),i("top","right"),i("bottom","left"),i("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)oe(this._controlCorners[t]);oe(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Ke=We.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,n,i){return n<i?-1:i<n?1:0}},initialize:function(t,e,n){for(var i in d(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,t)this._addLayer(t[i],i);for(i in e)this._addLayer(e[i],i,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return We.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(o(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){le(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(le(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):he(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return he(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=re("div",t),n=this.options.collapsed;e.setAttribute("aria-haspopup",!0),De(e),Re(e);var i=this._section=re("section",t+"-list");n&&(this._map.on("click",this.collapse,this),Ce(e,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var r=this._layersLink=re("a",t+"-toggle",e);r.href="#",r.title="Layers",r.setAttribute("role","button"),Ce(r,{keydown:function(t){13===t.keyCode&&this._expandSafely()},click:function(t){je(t),this._expandSafely()}},this),n||this.expand(),this._baseLayersList=re("div",t+"-base",i),this._separator=re("div",t+"-separator",i),this._overlaysList=re("div",t+"-overlays",i),e.appendChild(i)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&o(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,n){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:n}),this.options.sortLayers&&this._layers.sort(i(function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;se(this._baseLayersList),se(this._overlaysList),this._layerControlInputs=[];var t,e,n,i,r=0;for(n=0;n<this._layers.length;n++)i=this._layers[n],this._addItem(i),e=e||i.overlay,t=t||!i.overlay,r+=i.overlay?0:1;return this.options.hideSingleBase&&(t=t&&r>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(o(t.target)),n=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;n&&this._map.fire(n,e)},_createRadioElement:function(t,e){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",i=document.createElement("div");return i.innerHTML=n,i.firstChild},_addItem:function(t){var e,n=document.createElement("label"),i=this._map.hasLayer(t.layer);t.overlay?((e=document.createElement("input")).type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=i):e=this._createRadioElement("leaflet-base-layers_"+o(this),i),this._layerControlInputs.push(e),e.layerId=o(t.layer),Ce(e,"click",this._onInputClick,this);var r=document.createElement("span");r.innerHTML=" "+t.name;var s=document.createElement("span");return n.appendChild(s),s.appendChild(e),s.appendChild(r),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){if(!this._preventClick){var t,e,n=this._layerControlInputs,i=[],r=[];this._handlingClick=!0;for(var o=n.length-1;o>=0;o--)t=n[o],e=this._getLayer(t.layerId).layer,t.checked?i.push(e):t.checked||r.push(e);for(o=0;o<r.length;o++)this._map.hasLayer(r[o])&&this._map.removeLayer(r[o]);for(o=0;o<i.length;o++)this._map.hasLayer(i[o])||this._map.addLayer(i[o]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t,e,n=this._layerControlInputs,i=this._map.getZoom(),r=n.length-1;r>=0;r--)t=n[r],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&i<e.options.minZoom||void 0!==e.options.maxZoom&&i>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,Ce(t,"click",je),this.expand();var e=this;setTimeout(function(){xe(t,"click",je),e._preventClick=!1})}}),Qe=We.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",n=re("div",e+" leaflet-bar"),i=this.options;return this._zoomInButton=this._createButton(i.zoomInText,i.zoomInTitle,e+"-in",n,this._zoomIn),this._zoomOutButton=this._createButton(i.zoomOutText,i.zoomOutTitle,e+"-out",n,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,n,i,r){var o=re("a",n,i);return o.innerHTML=t,o.href="#",o.title=e,o.setAttribute("role","button"),o.setAttribute("aria-label",e),De(o),Ce(o,"click",Fe),Ce(o,"click",r,this),Ce(o,"click",this._refocusOnMap,this),o},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";he(this._zoomInButton,e),he(this._zoomOutButton,e),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(le(this._zoomOutButton,e),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(le(this._zoomInButton,e),this._zoomInButton.setAttribute("aria-disabled","true"))}});Ze.mergeOptions({zoomControl:!0}),Ze.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Qe,this.addControl(this.zoomControl))});var Ye=We.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",n=re("div",e),i=this.options;return this._addScales(i,e+"-line",n),t.on(i.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),n},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,n){t.metric&&(this._mScale=re("div",e,n)),t.imperial&&(this._iScale=re("div",e,n))},_update:function(){var t=this._map,e=t.getSize().y/2,n=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(n)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),n=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,n,e/t)},_updateImperial:function(t){var e,n,i,r=3.2808399*t;r>5280?(e=r/5280,n=this._getRoundNum(e),this._updateScale(this._iScale,n+" mi",n/e)):(i=this._getRoundNum(r),this._updateScale(this._iScale,i+" ft",i/r))},_updateScale:function(t,e,n){t.style.width=Math.round(this.options.maxWidth*n)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return e*(n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}}),Xe=We.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Nt.inlineSvg?'<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg> ':"")+"Leaflet</a>"},initialize:function(t){d(this,t),this._attributions={}},onAdd:function(t){for(var e in t.attributionControl=this,this._container=re("div","leaflet-control-attribution"),De(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",function(){this.removeAttribution(t.layer.getAttribution())},this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var n=[];this.options.prefix&&n.push(this.options.prefix),t.length&&n.push(t.join(", ")),this._container.innerHTML=n.join(' <span aria-hidden="true">|</span> ')}}});Ze.mergeOptions({attributionControl:!0}),Ze.addInitHook(function(){this.options.attributionControl&&(new Xe).addTo(this)});We.Layers=Ke,We.Zoom=Qe,We.Scale=Ye,We.Attribution=Xe,$e.layers=function(t,e,n){return new Ke(t,e,n)},$e.zoom=function(t){return new Qe(t)},$e.scale=function(t){return new Ye(t)},$e.attribution=function(t){return new Xe(t)};var Je=C.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Je.addTo=function(t,e){return t.addHandler(e,this),this};var tn={Events:P},en=Nt.touch?"touchstart mousedown":"mousedown",nn=x.extend({options:{clickTolerance:3},initialize:function(t,e,n,i){d(this,i),this._element=t,this._dragStartTarget=e||t,this._preventOutline=n},enable:function(){this._enabled||(Ce(this._dragStartTarget,en,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(nn._dragging===this&&this.finishDrag(!0),xe(this._dragStartTarget,en,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!ue(this._element,"leaflet-zoom-anim")))if(t.touches&&1!==t.touches.length)nn._dragging===this&&this.finishDrag();else if(!(nn._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(nn._dragging=this,this._preventOutline&&Te(this._element),we(),$t(),this._moving))){this.fire("down");var e=t.touches?t.touches[0]:t,n=Se(this._element);this._startPoint=new A(e.clientX,e.clientY),this._startPos=ve(this._element),this._parentScale=Ie(n);var i="mousedown"===t.type;Ce(document,i?"mousemove":"touchmove",this._onMove,this),Ce(document,i?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(t){if(this._enabled)if(t.touches&&t.touches.length>1)this._moved=!0;else{var e=t.touches&&1===t.touches.length?t.touches[0]:t,n=new A(e.clientX,e.clientY)._subtract(this._startPoint);(n.x||n.y)&&(Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(n.x/=this._parentScale.x,n.y/=this._parentScale.y,je(t),this._moved||(this.fire("dragstart"),this._moved=!0,le(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),le(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,this._lastEvent=t,this._updatePosition()))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),ye(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){he(document.body,"leaflet-dragging"),this._lastTarget&&(he(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),xe(document,"mousemove touchmove",this._onMove,this),xe(document,"mouseup touchend touchcancel",this._onUp,this),be(),Kt();var e=this._moved&&this._moving;this._moving=!1,nn._dragging=!1,e&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function rn(t,e,n){var i,r,o,s,a,c,u,l,h,d=[1,4,2,8];for(r=0,u=t.length;r<u;r++)t[r]._code=pn(t[r],e);for(s=0;s<4;s++){for(l=d[s],i=[],r=0,o=(u=t.length)-1;r<u;o=r++)a=t[r],c=t[o],a._code&l?c._code&l||((h=fn(c,a,l,e,n))._code=pn(h,e),i.push(h)):(c._code&l&&((h=fn(c,a,l,e,n))._code=pn(h,e),i.push(h)),i.push(a));t=i}return t}function on(t,e){var n,i,r,o,s,a,c,u,l;if(!t||0===t.length)throw new Error("latlngs not passed");yn(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var h=U([0,0]),d=j(t);d.getNorthWest().distanceTo(d.getSouthWest())*d.getNorthEast().distanceTo(d.getNorthWest())<1700&&(h=sn(t));var f=t.length,p=[];for(n=0;n<f;n++){var m=U(t[n]);p.push(e.project(U([m.lat-h.lat,m.lng-h.lng])))}for(a=c=u=0,n=0,i=f-1;n<f;i=n++)r=p[n],o=p[i],s=r.y*o.x-o.y*r.x,c+=(r.x+o.x)*s,u+=(r.y+o.y)*s,a+=3*s;l=0===a?p[0]:[c/a,u/a];var g=e.unproject(M(l));return U([g.lat+h.lat,g.lng+h.lng])}function sn(t){for(var e=0,n=0,i=0,r=0;r<t.length;r++){var o=U(t[r]);e+=o.lat,n+=o.lng,i++}return U([e/i,n/i])}var an,cn={__proto__:null,clipPolygon:rn,polygonCenter:on,centroid:sn};function un(t,e){if(!e||!t.length)return t.slice();var n=e*e;return function(t,e){var n=t.length,i=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(n);i[0]=i[n-1]=1,hn(t,i,e,0,n-1);var r,o=[];for(r=0;r<n;r++)i[r]&&o.push(t[r]);return o}(t=function(t,e){for(var n=[t[0]],i=1,r=0,o=t.length;i<o;i++)mn(t[i],t[r])>e&&(n.push(t[i]),r=i);return r<o-1&&n.push(t[o-1]),n}(t,n),n)}function ln(t,e,n){return Math.sqrt(gn(t,e,n,!0))}function hn(t,e,n,i,r){var o,s,a,c=0;for(s=i+1;s<=r-1;s++)(a=gn(t[s],t[i],t[r],!0))>c&&(o=s,c=a);c>n&&(e[o]=1,hn(t,e,n,i,o),hn(t,e,n,o,r))}function dn(t,e,n,i,r){var o,s,a,c=i?an:pn(t,n),u=pn(e,n);for(an=u;;){if(!(c|u))return[t,e];if(c&u)return!1;a=pn(s=fn(t,e,o=c||u,n,r),n),o===c?(t=s,c=a):(e=s,u=a)}}function fn(t,e,n,i,r){var o,s,a=e.x-t.x,c=e.y-t.y,u=i.min,l=i.max;return 8&n?(o=t.x+a*(l.y-t.y)/c,s=l.y):4&n?(o=t.x+a*(u.y-t.y)/c,s=u.y):2&n?(o=l.x,s=t.y+c*(l.x-t.x)/a):1&n&&(o=u.x,s=t.y+c*(u.x-t.x)/a),new A(o,s,r)}function pn(t,e){var n=0;return t.x<e.min.x?n|=1:t.x>e.max.x&&(n|=2),t.y<e.min.y?n|=4:t.y>e.max.y&&(n|=8),n}function mn(t,e){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function gn(t,e,n,i){var r,o=e.x,s=e.y,a=n.x-o,c=n.y-s,u=a*a+c*c;return u>0&&((r=((t.x-o)*a+(t.y-s)*c)/u)>1?(o=n.x,s=n.y):r>0&&(o+=a*r,s+=c*r)),a=t.x-o,c=t.y-s,i?a*a+c*c:new A(o,s)}function yn(t){return!g(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function vn(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),yn(t)}function _n(t,e){var n,i,r,o,s,a,c,u;if(!t||0===t.length)throw new Error("latlngs not passed");yn(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var l=U([0,0]),h=j(t);h.getNorthWest().distanceTo(h.getSouthWest())*h.getNorthEast().distanceTo(h.getNorthWest())<1700&&(l=sn(t));var d=t.length,f=[];for(n=0;n<d;n++){var p=U(t[n]);f.push(e.project(U([p.lat-l.lat,p.lng-l.lng])))}for(n=0,i=0;n<d-1;n++)i+=f[n].distanceTo(f[n+1])/2;if(0===i)u=f[0];else for(n=0,o=0;n<d-1;n++)if(s=f[n],a=f[n+1],(o+=r=s.distanceTo(a))>i){c=(o-i)/r,u=[a.x-c*(a.x-s.x),a.y-c*(a.y-s.y)];break}var m=e.unproject(M(u));return U([m.lat+l.lat,m.lng+l.lng])}var wn={__proto__:null,simplify:un,pointToSegmentDistance:ln,closestPointOnSegment:function(t,e,n){return gn(t,e,n)},clipSegment:dn,_getEdgeIntersection:fn,_getBitCode:pn,_sqClosestPointOnSegment:gn,isFlat:yn,_flat:vn,polylineCenter:_n},bn={project:function(t){return new A(t.lng,t.lat)},unproject:function(t){return new F(t.y,t.x)},bounds:new N([-180,-90],[180,90])},Tn={R:6378137,R_MINOR:6356752.314245179,bounds:new N([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,n=this.R,i=t.lat*e,r=this.R_MINOR/n,o=Math.sqrt(1-r*r),s=o*Math.sin(i),a=Math.tan(Math.PI/4-i/2)/Math.pow((1-s)/(1+s),o/2);return i=-n*Math.log(Math.max(a,1e-10)),new A(t.lng*e*n,i)},unproject:function(t){for(var e,n=180/Math.PI,i=this.R,r=this.R_MINOR/i,o=Math.sqrt(1-r*r),s=Math.exp(-t.y/i),a=Math.PI/2-2*Math.atan(s),c=0,u=.1;c<15&&Math.abs(u)>1e-7;c++)e=o*Math.sin(a),e=Math.pow((1-e)/(1+e),o/2),a+=u=Math.PI/2-2*Math.atan(s*e)-a;return new F(a*n,t.x*n/i)}},En={__proto__:null,LonLat:bn,Mercator:Tn,SphericalMercator:q},Sn=e({},z,{code:"EPSG:3395",projection:Tn,transformation:function(){var t=.5/(Math.PI*Tn.R);return Z(t,.5,-t,.5)}()}),In=e({},z,{code:"EPSG:4326",projection:bn,transformation:Z(1/180,1,-1/180,.5)}),kn=e({},B,{projection:bn,transformation:Z(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var n=e.lng-t.lng,i=e.lat-t.lat;return Math.sqrt(n*n+i*i)},infinite:!0});B.Earth=z,B.EPSG3395=Sn,B.EPSG3857=W,B.EPSG900913=$,B.EPSG4326=In,B.Simple=kn;var Cn=x.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[o(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[o(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var n=this.getEvents();e.on(n,this),this.once("remove",function(){e.off(n,this)},this)}this.onAdd(e),this.fire("add"),e.fire("layeradd",{layer:this})}}});Ze.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=o(t);return this._layers[e]||(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer:function(t){var e=o(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return o(t)in this._layers},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},_addLayers:function(t){for(var e=0,n=(t=t?g(t)?t:[t]:[]).length;e<n;e++)this.addLayer(t[e])},_addZoomLimit:function(t){isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[o(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=o(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,n=this._getZoomSpan();for(var i in this._zoomBoundLayers){var r=this._zoomBoundLayers[i].options;t=void 0===r.minZoom?t:Math.min(t,r.minZoom),e=void 0===r.maxZoom?e:Math.max(e,r.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Pn=Cn.extend({initialize:function(t,e){var n,i;if(d(this,e),this._layers={},t)for(n=0,i=t.length;n<i;n++)this.addLayer(t[n])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return("number"==typeof t?t:this.getLayerId(t))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,n,i=Array.prototype.slice.call(arguments,1);for(e in this._layers)(n=this._layers[e])[t]&&n[t].apply(n,i);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return o(t)}}),xn=Pn.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),Pn.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),Pn.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new D;for(var e in this._layers){var n=this._layers[e];t.extend(n.getBounds?n.getBounds():n.getLatLng())}return t}}),An=C.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){d(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var n=this._getIconUrl(t);if(!n){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var i=this._createImg(n,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(i,t),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),i},_setIconStyles:function(t,e){var n=this.options,i=n[e+"Size"];"number"==typeof i&&(i=[i,i]);var r=M(i),o=M("shadow"===e&&n.shadowAnchor||n.iconAnchor||r&&r.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(n.className||""),o&&(t.style.marginLeft=-o.x+"px",t.style.marginTop=-o.y+"px"),r&&(t.style.width=r.x+"px",t.style.height=r.y+"px")},_createImg:function(t,e){return(e=e||document.createElement("img")).src=t,e},_getIconUrl:function(t){return Nt.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}});var Ln=An.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return"string"!=typeof Ln.imagePath&&(Ln.imagePath=this._detectIconPath()),(this.options.imagePath||Ln.imagePath)+An.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var e=function(t,e,n){var i=e.exec(t);return i&&i[n]};return(t=e(t,/^url\((['"])?(.+)\1\)$/,2))&&e(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=re("div","leaflet-default-icon-path",document.body),e=ie(t,"background-image")||ie(t,"backgroundImage");if(document.body.removeChild(t),e=this._stripUrl(e))return e;var n=document.querySelector('link[href$="leaflet.css"]');return n?n.href.substring(0,n.href.length-11-1):""}}),On=Je.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new nn(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),le(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&he(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,n=e._map,i=this._marker.options.autoPanSpeed,r=this._marker.options.autoPanPadding,o=ve(e._icon),s=n.getPixelBounds(),a=n.getPixelOrigin(),c=R(s.min._subtract(a).add(r),s.max._subtract(a).subtract(r));if(!c.contains(o)){var u=M((Math.max(c.max.x,o.x)-c.max.x)/(s.max.x-c.max.x)-(Math.min(c.min.x,o.x)-c.min.x)/(s.min.x-c.min.x),(Math.max(c.max.y,o.y)-c.max.y)/(s.max.y-c.max.y)-(Math.min(c.min.y,o.y)-c.min.y)/(s.min.y-c.min.y)).multiplyBy(i);n.panBy(u,{animate:!1}),this._draggable._newPos._add(u),this._draggable._startPos._add(u),ye(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=S(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(I(this._panRequest),this._panRequest=S(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,n=e._shadow,i=ve(e._icon),r=e._map.layerPointToLatLng(i);n&&ye(n,i),e._latlng=r,t.latlng=r,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){I(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),Mn=Cn.extend({options:{icon:new Ln,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){d(this,e),this._latlng=U(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=U(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=t.icon.createIcon(this._icon),i=!1;n!==this._icon&&(this._icon&&this._removeIcon(),i=!0,t.title&&(n.title=t.title),"IMG"===n.tagName&&(n.alt=t.alt||"")),le(n,e),t.keyboard&&(n.tabIndex="0",n.setAttribute("role","button")),this._icon=n,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ce(n,"focus",this._panOnFocus,this);var r=t.icon.createShadow(this._shadow),o=!1;r!==this._shadow&&(this._removeShadow(),o=!0),r&&(le(r,e),r.alt=""),this._shadow=r,t.opacity<1&&this._updateOpacity(),i&&this.getPane().appendChild(this._icon),this._initInteraction(),r&&o&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&xe(this._icon,"focus",this._panOnFocus,this),oe(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&oe(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&ye(this._icon,t),this._shadow&&ye(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(le(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),On)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new On(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&pe(this._icon,t),this._shadow&&pe(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var e=this.options.icon.options,n=e.iconSize?M(e.iconSize):M(0,0),i=e.iconAnchor?M(e.iconAnchor):M(0,0);t.panInside(this._latlng,{paddingTopLeft:i,paddingBottomRight:n.subtract(i)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});var Nn=Cn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return d(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Rn=Nn.extend({options:{fill:!0,radius:10},initialize:function(t,e){d(this,e),this._latlng=U(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=U(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return Nn.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,n=this._clickTolerance(),i=[t+n,e+n];this._pxBounds=new N(this._point.subtract(i),this._point.add(i))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}});var Dn=Rn.extend({initialize:function(t,n,i){if("number"==typeof n&&(n=e({},i,{radius:n})),d(this,n),this._latlng=U(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new D(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:Nn.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,n=this._map,i=n.options.crs;if(i.distance===z.distance){var r=Math.PI/180,o=this._mRadius/z.R/r,s=n.project([e+o,t]),a=n.project([e-o,t]),c=s.add(a).divideBy(2),u=n.unproject(c).lat,l=Math.acos((Math.cos(o*r)-Math.sin(e*r)*Math.sin(u*r))/(Math.cos(e*r)*Math.cos(u*r)))/r;(isNaN(l)||0===l)&&(l=o/Math.cos(Math.PI/180*e)),this._point=c.subtract(n.getPixelOrigin()),this._radius=isNaN(l)?0:c.x-n.project([u,t-l]).x,this._radiusY=c.y-s.y}else{var h=i.unproject(i.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(h).x}this._updateBounds()}});var jn=Nn.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){d(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,n,i=1/0,r=null,o=gn,s=0,a=this._parts.length;s<a;s++)for(var c=this._parts[s],u=1,l=c.length;u<l;u++){var h=o(t,e=c[u-1],n=c[u],!0);h<i&&(i=h,r=o(t,e,n))}return r&&(r.distance=Math.sqrt(i)),r},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return _n(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=U(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new D,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return yn(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],n=yn(t),i=0,r=t.length;i<r;i++)n?(e[i]=U(t[i]),this._bounds.extend(e[i])):e[i]=this._convertLatLngs(t[i]);return e},_project:function(){var t=new N;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new A(t,t);this._rawPxBounds&&(this._pxBounds=new N([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)]))},_projectLatlngs:function(t,e,n){var i,r,o=t[0]instanceof F,s=t.length;if(o){for(r=[],i=0;i<s;i++)r[i]=this._map.latLngToLayerPoint(t[i]),n.extend(r[i]);e.push(r)}else for(i=0;i<s;i++)this._projectLatlngs(t[i],e,n)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else{var e,n,i,r,o,s,a,c=this._parts;for(e=0,i=0,r=this._rings.length;e<r;e++)for(n=0,o=(a=this._rings[e]).length;n<o-1;n++)(s=dn(a[n],a[n+1],t,n,!0))&&(c[i]=c[i]||[],c[i].push(s[0]),s[1]===a[n+1]&&n!==o-2||(c[i].push(s[1]),i++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,n=0,i=t.length;n<i;n++)t[n]=un(t[n],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var n,i,r,o,s,a,c=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(n=0,o=this._parts.length;n<o;n++)for(i=0,r=(s=(a=this._parts[n]).length)-1;i<s;r=i++)if((e||0!==i)&&ln(t,a[r],a[i])<=c)return!0;return!1}});jn._flat=vn;var Fn=jn.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return on(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var e=jn.prototype._convertLatLngs.call(this,t),n=e.length;return n>=2&&e[0]instanceof F&&e[0].equals(e[n-1])&&e.pop(),e},_setLatLngs:function(t){jn.prototype._setLatLngs.call(this,t),yn(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return yn(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,n=new A(e,e);if(t=new N(t.min.subtract(n),t.max.add(n)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var i,r=0,o=this._rings.length;r<o;r++)(i=rn(this._rings[r],t,!0)).length&&this._parts.push(i)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,n,i,r,o,s,a,c,u=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(r=0,a=this._parts.length;r<a;r++)for(o=0,s=(c=(e=this._parts[r]).length)-1;o<c;s=o++)n=e[o],i=e[s],n.y>t.y!=i.y>t.y&&t.x<(i.x-n.x)*(t.y-n.y)/(i.y-n.y)+n.x&&(u=!u);return u||jn.prototype._containsPoint.call(this,t,!0)}});var Un=xn.extend({initialize:function(t,e){d(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,n,i,r=g(t)?t:t.features;if(r){for(e=0,n=r.length;e<n;e++)((i=r[e]).geometries||i.geometry||i.features||i.coordinates)&&this.addData(i);return this}var o=this.options;if(o.filter&&!o.filter(t))return this;var s=Vn(t,o);return s?(s.feature=Wn(t),s.defaultOptions=s.options,this.resetStyle(s),o.onEachFeature&&o.onEachFeature(t,s),this.addLayer(s)):this},resetStyle:function(t){return void 0===t?this.eachLayer(this.resetStyle,this):(t.options=e({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){t.setStyle&&("function"==typeof e&&(e=e(t.feature)),t.setStyle(e))}});function Vn(t,e){var n,i,r,o,s="Feature"===t.type?t.geometry:t,a=s?s.coordinates:null,c=[],u=e&&e.pointToLayer,l=e&&e.coordsToLatLng||zn;if(!a&&!s)return null;switch(s.type){case"Point":return Bn(u,t,n=l(a),e);case"MultiPoint":for(r=0,o=a.length;r<o;r++)n=l(a[r]),c.push(Bn(u,t,n,e));return new xn(c);case"LineString":case"MultiLineString":return i=Gn(a,"LineString"===s.type?0:1,l),new jn(i,e);case"Polygon":case"MultiPolygon":return i=Gn(a,"Polygon"===s.type?1:2,l),new Fn(i,e);case"GeometryCollection":for(r=0,o=s.geometries.length;r<o;r++){var h=Vn({geometry:s.geometries[r],type:"Feature",properties:t.properties},e);h&&c.push(h)}return new xn(c);case"FeatureCollection":for(r=0,o=s.features.length;r<o;r++){var d=Vn(s.features[r],e);d&&c.push(d)}return new xn(c);default:throw new Error("Invalid GeoJSON object.")}}function Bn(t,e,n,i){return t?t(e,n):new Mn(n,i&&i.markersInheritOptions&&i)}function zn(t){return new F(t[1],t[0],t[2])}function Gn(t,e,n){for(var i,r=[],o=0,s=t.length;o<s;o++)i=e?Gn(t[o],e-1,n):(n||zn)(t[o]),r.push(i);return r}function qn(t,e){return void 0!==(t=U(t)).alt?[u(t.lng,e),u(t.lat,e),u(t.alt,e)]:[u(t.lng,e),u(t.lat,e)]}function Hn(t,e,n,i){for(var r=[],o=0,s=t.length;o<s;o++)r.push(e?Hn(t[o],yn(t[o])?0:e-1,n,i):qn(t[o],i));return!e&&n&&r.length>0&&r.push(r[0].slice()),r}function Zn(t,n){return t.feature?e({},t.feature,{geometry:n}):Wn(n)}function Wn(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}var $n={toGeoJSON:function(t){return Zn(this,{type:"Point",coordinates:qn(this.getLatLng(),t)})}};function Kn(t,e){return new Un(t,e)}Mn.include($n),Dn.include($n),Rn.include($n),jn.include({toGeoJSON:function(t){var e=!yn(this._latlngs);return Zn(this,{type:(e?"Multi":"")+"LineString",coordinates:Hn(this._latlngs,e?1:0,!1,t)})}}),Fn.include({toGeoJSON:function(t){var e=!yn(this._latlngs),n=e&&!yn(this._latlngs[0]),i=Hn(this._latlngs,n?2:e?1:0,!0,t);return e||(i=[i]),Zn(this,{type:(n?"Multi":"")+"Polygon",coordinates:i})}}),Pn.include({toMultiPoint:function(t){var e=[];return this.eachLayer(function(n){e.push(n.toGeoJSON(t).geometry.coordinates)}),Zn(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===e)return this.toMultiPoint(t);var n="GeometryCollection"===e,i=[];return this.eachLayer(function(e){if(e.toGeoJSON){var r=e.toGeoJSON(t);if(n)i.push(r.geometry);else{var o=Wn(r);"FeatureCollection"===o.type?i.push.apply(i,o.features):i.push(o)}}}),n?Zn(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}});var Qn=Kn,Yn=Cn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,n){this._url=t,this._bounds=j(e),d(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(le(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){oe(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&ae(this._image),this},bringToBack:function(){return this._map&&ce(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=j(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:re("img");le(e,"leaflet-image-layer"),this._zoomAnimated&&le(e,"leaflet-zoom-animated"),this.options.className&&le(e,this.options.className),e.onselectstart=c,e.onmousemove=c,e.onload=i(this.fire,this,"load"),e.onerror=i(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=e.src:(e.src=this._url,e.alt=this.options.alt)},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;ge(this._image,n,e)},_reset:function(){var t=this._image,e=new N(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=e.getSize();ye(t,e.min),t.style.width=n.x+"px",t.style.height=n.y+"px"},_updateOpacity:function(){pe(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}}),Xn=Yn.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:re("video");if(le(e,"leaflet-image-layer"),this._zoomAnimated&&le(e,"leaflet-zoom-animated"),this.options.className&&le(e,this.options.className),e.onselectstart=c,e.onmousemove=c,e.onloadeddata=i(this.fire,this,"load"),t){for(var n=e.getElementsByTagName("source"),r=[],o=0;o<n.length;o++)r.push(n[o].src);this._url=n.length>0?r:[e.src]}else{g(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted,e.playsInline=!!this.options.playsInline;for(var s=0;s<this._url.length;s++){var a=re("source");a.src=this._url[s],e.appendChild(a)}}}});var Jn=Yn.extend({_initImage:function(){var t=this._image=this._url;le(t,"leaflet-image-layer"),this._zoomAnimated&&le(t,"leaflet-zoom-animated"),this.options.className&&le(t,this.options.className),t.onselectstart=c,t.onmousemove=c}});var ti=Cn.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,e){t&&(t instanceof F||g(t))?(this._latlng=U(t),d(this,e)):(d(this,t),this._source=e),this.options.content&&(this._content=this.options.content)},openOn:function(t){return(t=arguments.length?t:this._source._map).hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&pe(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&pe(this._container,1),this.bringToFront(),this.options.interactive&&(le(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(pe(this._container,0),this._removeTimeout=setTimeout(i(oe,void 0,this._container),200)):oe(this._container),this.options.interactive&&(he(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=U(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&ae(this._container),this},bringToBack:function(){return this._map&&ce(this._container),this},_prepareOpen:function(t){var e=this._source;if(!e._map)return!1;if(e instanceof xn){e=null;var n=this._source._layers;for(var i in n)if(n[i]._map){e=n[i];break}if(!e)return!1;this._source=e}if(!t)if(e.getCenter)t=e.getCenter();else if(e.getLatLng)t=e.getLatLng();else{if(!e.getBounds)throw new Error("Unable to get source layer LatLng.");t=e.getBounds().getCenter()}return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=M(this.options.offset),n=this._getAnchor();this._zoomAnimated?ye(this._container,t.add(n)):e=e.add(t).add(n);var i=this._containerBottom=-e.y,r=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=i+"px",this._container.style.left=r+"px"}},_getAnchor:function(){return[0,0]}});Ze.include({_initOverlay:function(t,e,n,i){var r=e;return r instanceof t||(r=new t(i).setContent(e)),n&&r.setLatLng(n),r}}),Cn.include({_initOverlay:function(t,e,n,i){var r=n;return r instanceof t?(d(r,i),r._source=this):(r=e&&!i?e:new t(i,this)).setContent(n),r}});var ei=ti.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return!(t=arguments.length?t:this._source._map).hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,ti.prototype.openOn.call(this,t)},onAdd:function(t){ti.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Nn||this._source.on("preclick",Ne))},onRemove:function(t){ti.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Nn||this._source.off("preclick",Ne))},getEvents:function(){var t=ti.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",e=this._container=re("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),n=this._wrapper=re("div",t+"-content-wrapper",e);if(this._contentNode=re("div",t+"-content",n),De(e),Re(this._contentNode),Ce(e,"contextmenu",Ne),this._tipContainer=re("div",t+"-tip-container",e),this._tip=re("div",t+"-tip",this._tipContainer),this.options.closeButton){var i=this._closeButton=re("a",t+"-close-button",e);i.setAttribute("role","button"),i.setAttribute("aria-label","Close popup"),i.href="#close",i.innerHTML='<span aria-hidden="true">&#215;</span>',Ce(i,"click",function(t){je(t),this.close()},this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var n=t.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),e.width=n+1+"px",e.whiteSpace="",e.height="";var i=t.offsetHeight,r=this.options.maxHeight,o="leaflet-popup-scrolled";r&&i>r?(e.height=r+"px",le(t,o)):he(t,o),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),n=this._getAnchor();ye(this._container,e.add(n))},_adjustPan:function(){if(this.options.autoPan)if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)this._autopanning=!1;else{var t=this._map,e=parseInt(ie(this._container,"marginBottom"),10)||0,n=this._container.offsetHeight+e,i=this._containerWidth,r=new A(this._containerLeft,-n-this._containerBottom);r._add(ve(this._container));var o=t.layerPointToContainerPoint(r),s=M(this.options.autoPanPadding),a=M(this.options.autoPanPaddingTopLeft||s),c=M(this.options.autoPanPaddingBottomRight||s),u=t.getSize(),l=0,h=0;o.x+i+c.x>u.x&&(l=o.x+i-u.x+c.x),o.x-l-a.x<0&&(l=o.x-a.x),o.y+n+c.y>u.y&&(h=o.y+n-u.y+c.y),o.y-h-a.y<0&&(h=o.y-a.y),(l||h)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([l,h]))}},_getAnchor:function(){return M(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});Ze.mergeOptions({closePopupOnClick:!0}),Ze.include({openPopup:function(t,e,n){return this._initOverlay(ei,t,e,n).openOn(this),this},closePopup:function(t){return(t=arguments.length?t:this._popup)&&t.close(),this}}),Cn.include({bindPopup:function(t,e){return this._popup=this._initOverlay(ei,this._popup,t,e),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof xn||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(this._popup&&this._map){Fe(t);var e=t.layer||t.target;this._popup._source!==e||e instanceof Nn?(this._popup._source=e,this.openPopup(t.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var ni=ti.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){ti.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){ti.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=ti.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=re("div",t),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+o(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,n,i=this._map,r=this._container,o=i.latLngToContainerPoint(i.getCenter()),s=i.layerPointToContainerPoint(t),a=this.options.direction,c=r.offsetWidth,u=r.offsetHeight,l=M(this.options.offset),h=this._getAnchor();"top"===a?(e=c/2,n=u):"bottom"===a?(e=c/2,n=0):"center"===a?(e=c/2,n=u/2):"right"===a?(e=0,n=u/2):"left"===a?(e=c,n=u/2):s.x<o.x?(a="right",e=0,n=u/2):(a="left",e=c+2*(l.x+h.x),n=u/2),t=t.subtract(M(e,n,!0)).add(l).add(h),he(r,"leaflet-tooltip-right"),he(r,"leaflet-tooltip-left"),he(r,"leaflet-tooltip-top"),he(r,"leaflet-tooltip-bottom"),le(r,"leaflet-tooltip-"+a),ye(r,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&pe(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return M(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});Ze.include({openTooltip:function(t,e,n){return this._initOverlay(ni,t,e,n).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),Cn.include({bindTooltip:function(t,e){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(ni,this._tooltip,t,e),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",n={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?n.add=this._openTooltip:(n.mouseover=this._openTooltip,n.mouseout=this.closeTooltip,n.click=this._openTooltip,this._map?this._addFocusListeners():n.add=this._addFocusListeners),this._tooltip.options.sticky&&(n.mousemove=this._moveTooltip),this[e](n),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof xn||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var e="function"==typeof t.getElement&&t.getElement();e&&(Ce(e,"focus",function(){this._tooltip._source=t,this.openTooltip()},this),Ce(e,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var e="function"==typeof t.getElement&&t.getElement();e&&e.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(this._tooltip&&this._map)if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var e=this;this._map.once("moveend",function(){e._openOnceFlag=!1,e._openTooltip(t)})}else this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var e,n,i=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),n=this._map.containerPointToLayerPoint(e),i=this._map.layerPointToLatLng(n)),this._tooltip.setLatLng(i)}});var ii=An.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),n=this.options;if(n.html instanceof Element?(se(e),e.appendChild(n.html)):e.innerHTML=!1!==n.html?n.html:"",n.bgPos){var i=M(n.bgPos);e.style.backgroundPosition=-i.x+"px "+-i.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});An.Default=Ln;var ri=Cn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Nt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){d(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),oe(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(ae(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(ce(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=s(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof A?t:new A(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,n=this.getPane().children,i=-t(-1/0,1/0),r=0,o=n.length;r<o;r++)e=n[r].style.zIndex,n[r]!==this._container&&e&&(i=t(i,+e));isFinite(i)&&(this.options.zIndex=i+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Nt.ielt9){pe(this._container,this.options.opacity);var t=+new Date,e=!1,n=!1;for(var i in this._tiles){var r=this._tiles[i];if(r.current&&r.loaded){var o=Math.min(1,(t-r.loaded)/200);pe(r.el,o),o<1?e=!0:(r.active?n=!0:this._onOpaqueTile(r),r.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),e&&(I(this._fadeFrame),this._fadeFrame=S(this._updateOpacity,this))}},_onOpaqueTile:c,_initContainer:function(){this._container||(this._container=re("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var n in this._levels)n=Number(n),this._levels[n].el.children.length||n===t?(this._levels[n].el.style.zIndex=e-Math.abs(t-n),this._onUpdateLevel(n)):(oe(this._levels[n].el),this._removeTilesAtZoom(n),this._onRemoveLevel(n),delete this._levels[n]);var i=this._levels[t],r=this._map;return i||((i=this._levels[t]={}).el=re("div","leaflet-tile-container leaflet-zoom-animated",this._container),i.el.style.zIndex=e,i.origin=r.project(r.unproject(r.getPixelOrigin()),t).round(),i.zoom=t,this._setZoomTransform(i,r.getCenter(),r.getZoom()),i.el.offsetWidth,this._onCreateLevel(i)),this._level=i,i}},_onUpdateLevel:c,_onRemoveLevel:c,_onCreateLevel:c,_pruneTiles:function(){if(this._map){var t,e,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(e=this._tiles[t]).retain=e.current;for(t in this._tiles)if((e=this._tiles[t]).current&&!e.active){var i=e.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)oe(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,n,i){var r=Math.floor(t/2),o=Math.floor(e/2),s=n-1,a=new A(+r,+o);a.z=+s;var c=this._tileCoordsToKey(a),u=this._tiles[c];return u&&u.active?(u.retain=!0,!0):(u&&u.loaded&&(u.retain=!0),s>i&&this._retainParent(r,o,s,i))},_retainChildren:function(t,e,n,i){for(var r=2*t;r<2*t+2;r++)for(var o=2*e;o<2*e+2;o++){var s=new A(r,o);s.z=n+1;var a=this._tileCoordsToKey(s),c=this._tiles[a];c&&c.active?c.retain=!0:(c&&c.loaded&&(c.retain=!0),n+1<i&&this._retainChildren(r,o,n+1,i))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,n,i){var r=Math.round(e);r=void 0!==this.options.maxZoom&&r>this.options.maxZoom||void 0!==this.options.minZoom&&r<this.options.minZoom?void 0:this._clampZoom(r);var o=this.options.updateWhenZooming&&r!==this._tileZoom;i&&!o||(this._tileZoom=r,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==r&&this._update(t),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var n in this._levels)this._setZoomTransform(this._levels[n],t,e)},_setZoomTransform:function(t,e,n){var i=this._map.getZoomScale(n,t.zoom),r=t.origin.multiplyBy(i).subtract(this._map._getNewPixelOrigin(e,n)).round();Nt.any3d?ge(t.el,r,i):ye(t.el,r)},_resetGrid:function(){var t=this._map,e=t.options.crs,n=this._tileSize=this.getTileSize(),i=this._tileZoom,r=this._map.getPixelWorldBounds(this._tileZoom);r&&(this._globalTileRange=this._pxBoundsToTileRange(r)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],i).x/n.x),Math.ceil(t.project([0,e.wrapLng[1]],i).x/n.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],i).y/n.x),Math.ceil(t.project([e.wrapLat[1],0],i).y/n.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,n=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),i=e.getZoomScale(n,this._tileZoom),r=e.project(t,this._tileZoom).floor(),o=e.getSize().divideBy(2*i);return new N(r.subtract(o),r.add(o))},_update:function(t){var e=this._map;if(e){var n=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var i=this._getTiledPixelBounds(t),r=this._pxBoundsToTileRange(i),o=r.getCenter(),s=[],a=this.options.keepBuffer,c=new N(r.getBottomLeft().subtract([a,-a]),r.getTopRight().add([a,-a]));if(!(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.max.x)&&isFinite(r.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var u in this._tiles){var l=this._tiles[u].coords;l.z===this._tileZoom&&c.contains(new A(l.x,l.y))||(this._tiles[u].current=!1)}if(Math.abs(n-this._tileZoom)>1)this._setView(t,n);else{for(var h=r.min.y;h<=r.max.y;h++)for(var d=r.min.x;d<=r.max.x;d++){var f=new A(d,h);if(f.z=this._tileZoom,this._isValidTile(f)){var p=this._tiles[this._tileCoordsToKey(f)];p?p.current=!0:s.push(f)}}if(s.sort(function(t,e){return t.distanceTo(o)-e.distanceTo(o)}),0!==s.length){this._loading||(this._loading=!0,this.fire("loading"));var m=document.createDocumentFragment();for(d=0;d<s.length;d++)this._addTile(s[d],m);this._level.el.appendChild(m)}}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var n=this._globalTileRange;if(!e.wrapLng&&(t.x<n.min.x||t.x>n.max.x)||!e.wrapLat&&(t.y<n.min.y||t.y>n.max.y))return!1}if(!this.options.bounds)return!0;var i=this._tileCoordsToBounds(t);return j(this.options.bounds).overlaps(i)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,n=this.getTileSize(),i=t.scaleBy(n),r=i.add(n);return[e.unproject(i,t.z),e.unproject(r,t.z)]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),n=new D(e[0],e[1]);return this.options.noWrap||(n=this._map.wrapLatLngBounds(n)),n},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),n=new A(+e[0],+e[1]);return n.z=+e[2],n},_removeTile:function(t){var e=this._tiles[t];e&&(oe(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){le(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=c,t.onmousemove=c,Nt.ielt9&&this.options.opacity<1&&pe(t,this.options.opacity)},_addTile:function(t,e){var n=this._getTilePos(t),r=this._tileCoordsToKey(t),o=this.createTile(this._wrapCoords(t),i(this._tileReady,this,t));this._initTile(o),this.createTile.length<2&&S(i(this._tileReady,this,t,null,o)),ye(o,n),this._tiles[r]={el:o,coords:t,current:!0},e.appendChild(o),this.fire("tileloadstart",{tile:o,coords:t})},_tileReady:function(t,e,n){e&&this.fire("tileerror",{error:e,tile:n,coords:t});var r=this._tileCoordsToKey(t);(n=this._tiles[r])&&(n.loaded=+new Date,this._map._fadeAnimated?(pe(n.el,0),I(this._fadeFrame),this._fadeFrame=S(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),e||(le(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Nt.ielt9||!this._map._fadeAnimated?S(this._pruneTiles,this):setTimeout(i(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new A(this._wrapX?a(t.x,this._wrapX):t.x,this._wrapY?a(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new N(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});var oi=ri.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,e){this._url=t,(e=d(this,e)).detectRetina&&Nt.retina&&e.maxZoom>0?(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom=Math.min(e.maxZoom,e.minZoom+1)):(e.zoomOffset++,e.maxZoom=Math.max(e.minZoom,e.maxZoom-1)),e.minZoom=Math.max(0,e.minZoom)):e.zoomReverse?e.minZoom=Math.min(e.maxZoom,e.minZoom):e.maxZoom=Math.max(e.minZoom,e.maxZoom),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var n=document.createElement("img");return Ce(n,"load",i(this._tileOnLoad,this,e,n)),Ce(n,"error",i(this._tileOnError,this,e,n)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(n.referrerPolicy=this.options.referrerPolicy),n.alt="",n.src=this.getTileUrl(t),n},getTileUrl:function(t){var n={r:Nt.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-t.y;this.options.tms&&(n.y=i),n["-y"]=i}return m(this._url,e(n,this.options))},_tileOnLoad:function(t,e){Nt.ielt9?setTimeout(i(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,n){var i=this.options.errorTileUrl;i&&e.getAttribute("src")!==i&&(e.src=i),t(n,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom;return this.options.zoomReverse&&(t=e-t),t+this.options.zoomOffset},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&((e=this._tiles[t].el).onload=c,e.onerror=c,!e.complete)){e.src=v;var n=this._tiles[t].coords;oe(e),delete this._tiles[t],this.fire("tileabort",{tile:e,coords:n})}},_removeTile:function(t){var e=this._tiles[t];if(e)return e.el.setAttribute("src",v),ri.prototype._removeTile.call(this,t)},_tileReady:function(t,e,n){if(this._map&&(!n||n.getAttribute("src")!==v))return ri.prototype._tileReady.call(this,t,e,n)}});function si(t,e){return new oi(t,e)}var ai=oi.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,n){this._url=t;var i=e({},this.defaultWmsParams);for(var r in n)r in this.options||(i[r]=n[r]);var o=(n=d(this,n)).detectRetina&&Nt.retina?2:1,s=this.getTileSize();i.width=s.x*o,i.height=s.y*o,this.wmsParams=i},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,oi.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),n=this._crs,i=R(n.project(e[0]),n.project(e[1])),r=i.min,o=i.max,s=(this._wmsVersion>=1.3&&this._crs===In?[r.y,r.x,o.y,o.x]:[r.x,r.y,o.x,o.y]).join(","),a=oi.prototype.getTileUrl.call(this,t);return a+f(this.wmsParams,a,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+s},setParams:function(t,n){return e(this.wmsParams,t),n||this.redraw(),this}});oi.WMS=ai,si.wms=function(t,e){return new ai(t,e)};var ci=Cn.extend({options:{padding:.1},initialize:function(t){d(this,t),o(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),le(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var n=this._map.getZoomScale(e,this._zoom),i=this._map.getSize().multiplyBy(.5+this.options.padding),r=this._map.project(this._center,e),o=i.multiplyBy(-n).add(r).subtract(this._map._getNewPixelOrigin(t,e));Nt.any3d?ge(this._container,o,n):ye(this._container,o)},_reset:function(){for(var t in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),n=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new N(n,n.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),ui=ci.extend({options:{tolerance:0},getEvents:function(){var t=ci.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){ci.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");Ce(t,"mousemove",this._onMouseMove,this),Ce(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Ce(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){I(this._redrawRequest),delete this._ctx,oe(this._container),xe(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var t in this._redrawBounds=null,this._layers)this._layers[t]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){ci.prototype._update.call(this);var t=this._bounds,e=this._container,n=t.getSize(),i=Nt.retina?2:1;ye(e,t.min),e.width=i*n.x,e.height=i*n.y,e.style.width=n.x+"px",e.style.height=n.y+"px",Nt.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){ci.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[o(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,n=e.next,i=e.prev;n?n.prev=i:this._drawLast=i,i?i.next=n:this._drawFirst=n,delete t._order,delete this._layers[o(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,n,i=t.options.dashArray.split(/[, ]+/),r=[];for(n=0;n<i.length;n++){if(e=Number(i[n]),isNaN(e))return;r.push(e)}t.options._dashArray=r}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||S(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new N,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var n=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var i=this._drawFirst;i;i=i.next)t=i.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var n,i,r,o,s=t._parts,a=s.length,c=this._ctx;if(a){for(c.beginPath(),n=0;n<a;n++){for(i=0,r=s[n].length;i<r;i++)o=s[n][i],c[i?"lineTo":"moveTo"](o.x,o.y);e&&c.closePath()}this._fillStroke(c,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,n=this._ctx,i=Math.max(Math.round(t._radius),1),r=(Math.max(Math.round(t._radiusY),1)||i)/i;1!==r&&(n.save(),n.scale(1,r)),n.beginPath(),n.arc(e.x,e.y/r,i,0,2*Math.PI,!1),1!==r&&n.restore(),this._fillStroke(n,t)}},_fillStroke:function(t,e){var n=e.options;n.fill&&(t.globalAlpha=n.fillOpacity,t.fillStyle=n.fillColor||n.color,t.fill(n.fillRule||"evenodd")),n.stroke&&0!==n.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=n.opacity,t.lineWidth=n.weight,t.strokeStyle=n.color,t.lineCap=n.lineCap,t.lineJoin=n.lineJoin,t.stroke())},_onClick:function(t){for(var e,n,i=this._map.mouseEventToLayerPoint(t),r=this._drawFirst;r;r=r.next)(e=r.layer).options.interactive&&e._containsPoint(i)&&("click"!==t.type&&"preclick"!==t.type||!this._map._draggableMoved(e))&&(n=e);this._fireEvent(!!n&&[n],t)},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(he(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var n,r,o=this._drawFirst;o;o=o.next)(n=o.layer).options.interactive&&n._containsPoint(e)&&(r=n);r!==this._hoveredLayer&&(this._handleMouseOut(t),r&&(le(this._container,"leaflet-interactive"),this._fireEvent([r],t,"mouseover"),this._hoveredLayer=r)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],t),this._mouseHoverThrottled=!0,setTimeout(i(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(t,e,n){this._map._fireDOMEvent(e,n||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var n=e.next,i=e.prev;n&&(n.prev=i,i?i.next=n:n&&(this._drawFirst=n),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))}},_bringToBack:function(t){var e=t._order;if(e){var n=e.next,i=e.prev;i&&(i.next=n,n?n.prev=i:i&&(this._drawLast=i),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}});function li(t){return Nt.canvas?new ui(t):null}var hi=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),di={_initContainer:function(){this._container=re("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(ci.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=hi("shape");le(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=hi("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[o(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;oe(e),t.removeInteractiveTarget(e),delete this._layers[o(t)]},_updateStyle:function(t){var e=t._stroke,n=t._fill,i=t.options,r=t._container;r.stroked=!!i.stroke,r.filled=!!i.fill,i.stroke?(e||(e=t._stroke=hi("stroke")),r.appendChild(e),e.weight=i.weight+"px",e.color=i.color,e.opacity=i.opacity,i.dashArray?e.dashStyle=g(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=i.lineCap.replace("butt","flat"),e.joinstyle=i.lineJoin):e&&(r.removeChild(e),t._stroke=null),i.fill?(n||(n=t._fill=hi("fill")),r.appendChild(n),n.color=i.fillColor||i.color,n.opacity=i.fillOpacity):n&&(r.removeChild(n),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),n=Math.round(t._radius),i=Math.round(t._radiusY||n);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+n+","+i+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){ae(t._container)},_bringToBack:function(t){ce(t._container)}},fi=Nt.vml?hi:K,pi=ci.extend({_initContainer:function(){this._container=fi("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=fi("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){oe(this._container),xe(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){ci.prototype._update.call(this);var t=this._bounds,e=t.getSize(),n=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,n.setAttribute("width",e.x),n.setAttribute("height",e.y)),ye(n,t.min),n.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=fi("path");t.options.className&&le(e,t.options.className),t.options.interactive&&le(e,"leaflet-interactive"),this._updateStyle(t),this._layers[o(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){oe(t._path),t.removeInteractiveTarget(t._path),delete this._layers[o(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,n=t.options;e&&(n.stroke?(e.setAttribute("stroke",n.color),e.setAttribute("stroke-opacity",n.opacity),e.setAttribute("stroke-width",n.weight),e.setAttribute("stroke-linecap",n.lineCap),e.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?e.setAttribute("stroke-dasharray",n.dashArray):e.removeAttribute("stroke-dasharray"),n.dashOffset?e.setAttribute("stroke-dashoffset",n.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),n.fill?(e.setAttribute("fill",n.fillColor||n.color),e.setAttribute("fill-opacity",n.fillOpacity),e.setAttribute("fill-rule",n.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,Q(t._parts,e))},_updateCircle:function(t){var e=t._point,n=Math.max(Math.round(t._radius),1),i="a"+n+","+(Math.max(Math.round(t._radiusY),1)||n)+" 0 1,0 ",r=t._empty()?"M0 0":"M"+(e.x-n)+","+e.y+i+2*n+",0 "+i+2*-n+",0 ";this._setPath(t,r)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){ae(t._path)},_bringToBack:function(t){ce(t._path)}});function mi(t){return Nt.svg||Nt.vml?new pi(t):null}Nt.vml&&pi.include(di),Ze.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&li(t)||mi(t)}});var gi=Fn.extend({initialize:function(t,e){Fn.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return[(t=j(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});pi.create=fi,pi.pointsToPath=Q,Un.geometryToLayer=Vn,Un.coordsToLatLng=zn,Un.coordsToLatLngs=Gn,Un.latLngToCoords=qn,Un.latLngsToCoords=Hn,Un.getFeature=Zn,Un.asFeature=Wn,Ze.mergeOptions({boxZoom:!0});var yi=Je.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){Ce(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){xe(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){oe(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),$t(),we(),this._startPoint=this._map.mouseEventToContainerPoint(t),Ce(document,{contextmenu:Fe,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=re("div","leaflet-zoom-box",this._container),le(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new N(this._point,this._startPoint),n=e.getSize();ye(this._box,e.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(oe(this._box),he(this._container,"leaflet-crosshair")),Kt(),be(),xe(document,{contextmenu:Fe,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(i(this._resetState,this),0);var e=new D(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Ze.addInitHook("addHandler","boxZoom",yi),Ze.mergeOptions({doubleClickZoom:!0});var vi=Je.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,n=e.getZoom(),i=e.options.zoomDelta,r=t.originalEvent.shiftKey?n-i:n+i;"center"===e.options.doubleClickZoom?e.setZoom(r):e.setZoomAround(t.containerPoint,r)}});Ze.addInitHook("addHandler","doubleClickZoom",vi),Ze.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var _i=Je.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new nn(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}le(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){he(this._map._container,"leaflet-grab"),he(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=j(this._map.options.maxBounds);this._offsetLimit=R(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,n=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(n),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),n=this._initialWorldOffset,i=this._draggable._newPos.x,r=(i-e+n)%t+e-n,o=(i+e+n)%t-e-n,s=Math.abs(r+n)<Math.abs(o+n)?r:o;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=s},_onDragEnd:function(t){var e=this._map,n=e.options,i=!n.inertia||t.noInertia||this._times.length<2;if(e.fire("dragend",t),i)e.fire("moveend");else{this._prunePositions(+new Date);var r=this._lastPos.subtract(this._positions[0]),o=(this._lastTime-this._times[0])/1e3,s=n.easeLinearity,a=r.multiplyBy(s/o),c=a.distanceTo([0,0]),u=Math.min(n.inertiaMaxSpeed,c),l=a.multiplyBy(u/c),h=u/(n.inertiaDeceleration*s),d=l.multiplyBy(-h/2).round();d.x||d.y?(d=e._limitOffset(d,e.options.maxBounds),S(function(){e.panBy(d,{duration:h,easeLinearity:s,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}});Ze.addInitHook("addHandler","dragging",_i),Ze.mergeOptions({keyboard:!0,keyboardPanDelta:80});var wi=Je.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),Ce(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),xe(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,n=t.scrollTop||e.scrollTop,i=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(i,n)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,n,i=this._panKeys={},r=this.keyCodes;for(e=0,n=r.left.length;e<n;e++)i[r.left[e]]=[-1*t,0];for(e=0,n=r.right.length;e<n;e++)i[r.right[e]]=[t,0];for(e=0,n=r.down.length;e<n;e++)i[r.down[e]]=[0,t];for(e=0,n=r.up.length;e<n;e++)i[r.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,n,i=this._zoomKeys={},r=this.keyCodes;for(e=0,n=r.zoomIn.length;e<n;e++)i[r.zoomIn[e]]=t;for(e=0,n=r.zoomOut.length;e<n;e++)i[r.zoomOut[e]]=-t},_addHooks:function(){Ce(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){xe(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,n=t.keyCode,i=this._map;if(n in this._panKeys){if(!i._panAnim||!i._panAnim._inProgress)if(e=this._panKeys[n],t.shiftKey&&(e=M(e).multiplyBy(3)),i.options.maxBounds&&(e=i._limitOffset(M(e),i.options.maxBounds)),i.options.worldCopyJump){var r=i.wrapLatLng(i.unproject(i.project(i.getCenter()).add(e)));i.panTo(r)}else i.panBy(e)}else if(n in this._zoomKeys)i.setZoom(i.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[n]);else{if(27!==n||!i._popup||!i._popup.options.closeOnEscapeKey)return;i.closePopup()}Fe(t)}}});Ze.addInitHook("addHandler","keyboard",wi),Ze.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var bi=Je.extend({addHooks:function(){Ce(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){xe(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=ze(t),n=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var r=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(i(this._performZoom,this),r),Fe(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),n=this._map.options.zoomSnap||0;t._stop();var i=this._delta/(4*this._map.options.wheelPxPerZoomLevel),r=4*Math.log(2/(1+Math.exp(-Math.abs(i))))/Math.LN2,o=n?Math.ceil(r/n)*n:r,s=t._limitZoom(e+(this._delta>0?o:-o))-e;this._delta=0,this._startTime=null,s&&("center"===t.options.scrollWheelZoom?t.setZoom(e+s):t.setZoomAround(this._lastMousePos,e+s))}});Ze.addInitHook("addHandler","scrollWheelZoom",bi);Ze.mergeOptions({tapHold:Nt.touchNative&&Nt.safari&&Nt.mobile,tapTolerance:15});var Ti=Je.extend({addHooks:function(){Ce(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){xe(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),1===t.touches.length){var e=t.touches[0];this._startPos=this._newPos=new A(e.clientX,e.clientY),this._holdTimeout=setTimeout(i(function(){this._cancel(),this._isTapValid()&&(Ce(document,"touchend",je),Ce(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",e))},this),600),Ce(document,"touchend touchcancel contextmenu",this._cancel,this),Ce(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){xe(document,"touchend",je),xe(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),xe(document,"touchend touchcancel contextmenu",this._cancel,this),xe(document,"touchmove",this._onMove,this)},_onMove:function(t){var e=t.touches[0];this._newPos=new A(e.clientX,e.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,e){var n=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});n._simulated=!0,e.target.dispatchEvent(n)}});Ze.addInitHook("addHandler","tapHold",Ti),Ze.mergeOptions({touchZoom:Nt.touch,bounceAtZoomLimits:!0});var Ei=Je.extend({addHooks:function(){le(this._map._container,"leaflet-touch-zoom"),Ce(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){he(this._map._container,"leaflet-touch-zoom"),xe(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var n=e.mouseEventToContainerPoint(t.touches[0]),i=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(n.add(i)._divideBy(2))),this._startDist=n.distanceTo(i),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),Ce(document,"touchmove",this._onTouchMove,this),Ce(document,"touchend touchcancel",this._onTouchEnd,this),je(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,n=e.mouseEventToContainerPoint(t.touches[0]),r=e.mouseEventToContainerPoint(t.touches[1]),o=n.distanceTo(r)/this._startDist;if(this._zoom=e.getScaleZoom(o,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&o<1||this._zoom>e.getMaxZoom()&&o>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===o)return}else{var s=n._add(r)._divideBy(2)._subtract(this._centerPoint);if(1===o&&0===s.x&&0===s.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(s),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),I(this._animRequest);var a=i(e._move,e,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=S(a,this,!0),je(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,I(this._animRequest),xe(document,"touchmove",this._onTouchMove,this),xe(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});Ze.addInitHook("addHandler","touchZoom",Ei),Ze.BoxZoom=yi,Ze.DoubleClickZoom=vi,Ze.Drag=_i,Ze.Keyboard=wi,Ze.ScrollWheelZoom=bi,Ze.TapHold=Ti,Ze.TouchZoom=Ei,t.Bounds=N,t.Browser=Nt,t.CRS=B,t.Canvas=ui,t.Circle=Dn,t.CircleMarker=Rn,t.Class=C,t.Control=We,t.DivIcon=ii,t.DivOverlay=ti,t.DomEvent=qe,t.DomUtil=ke,t.Draggable=nn,t.Evented=x,t.FeatureGroup=xn,t.GeoJSON=Un,t.GridLayer=ri,t.Handler=Je,t.Icon=An,t.ImageOverlay=Yn,t.LatLng=F,t.LatLngBounds=D,t.Layer=Cn,t.LayerGroup=Pn,t.LineUtil=wn,t.Map=Ze,t.Marker=Mn,t.Mixin=tn,t.Path=Nn,t.Point=A,t.PolyUtil=cn,t.Polygon=Fn,t.Polyline=jn,t.Popup=ei,t.PosAnimation=He,t.Projection=En,t.Rectangle=gi,t.Renderer=ci,t.SVG=pi,t.SVGOverlay=Jn,t.TileLayer=oi,t.Tooltip=ni,t.Transformation=H,t.Util=k,t.VideoOverlay=Xn,t.bind=i,t.bounds=R,t.canvas=li,t.circle=function(t,e,n){return new Dn(t,e,n)},t.circleMarker=function(t,e){return new Rn(t,e)},t.control=$e,t.divIcon=function(t){return new ii(t)},t.extend=e,t.featureGroup=function(t,e){return new xn(t,e)},t.geoJSON=Kn,t.geoJson=Qn,t.gridLayer=function(t){return new ri(t)},t.icon=function(t){return new An(t)},t.imageOverlay=function(t,e,n){return new Yn(t,e,n)},t.latLng=U,t.latLngBounds=j,t.layerGroup=function(t,e){return new Pn(t,e)},t.map=function(t,e){return new Ze(t,e)},t.marker=function(t,e){return new Mn(t,e)},t.point=M,t.polygon=function(t,e){return new Fn(t,e)},t.polyline=function(t,e){return new jn(t,e)},t.popup=function(t,e){return new ei(t,e)},t.rectangle=function(t,e){return new gi(t,e)},t.setOptions=d,t.stamp=o,t.svg=mi,t.svgOverlay=function(t,e,n){return new Jn(t,e,n)},t.tileLayer=si,t.tooltip=function(t,e){return new ni(t,e)},t.transformation=Z,t.version="1.9.4",t.videoOverlay=function(t,e,n){return new Xn(t,e,n)};var Si=window.L;t.noConflict=function(){return window.L=Si,this},window.L=t}(e)}},i={};function r(t){var e=i[t];if(void 0!==e)return e.exports;var o=i[t]={exports:{}};return n[t].call(o.exports,o,o.exports,r),o.exports}r.m=n,r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.f={},r.e=t=>Promise.all(Object.keys(r.f).reduce((e,n)=>(r.f[n](t,e),e),[])),r.u=t=>"bundle.046722e2f0902ef6647b.js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="geogame:",r.l=(n,i,o,s)=>{if(t[n])t[n].push(i);else{var a,c;if(void 0!==o)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var h=u[l];if(h.getAttribute("src")==n||h.getAttribute("data-webpack")==e+o){a=h;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",r.nc&&a.setAttribute("nonce",r.nc),a.setAttribute("data-webpack",e+o),a.src=n),t[n]=[i];var d=(e,i)=>{a.onerror=a.onload=null,clearTimeout(f);var r=t[n];if(delete t[n],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach(t=>t(i)),e)return e(i)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),c&&document.head.appendChild(a)}},r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!t||!/^http(s?):/.test(t));)t=n[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t})(),(()=>{var t={792:0};r.f.j=(e,n)=>{var i=r.o(t,e)?t[e]:void 0;if(0!==i)if(i)n.push(i[2]);else{var o=new Promise((n,r)=>i=t[e]=[n,r]);n.push(i[2]=o);var s=r.p+r.u(e),a=new Error;r.l(s,n=>{if(r.o(t,e)&&(0!==(i=t[e])&&(t[e]=void 0),i)){var o=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;a.message="Loading chunk "+e+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,i[1](a)}},"chunk-"+e,e)}};var e=(e,n)=>{var i,o,[s,a,c]=n,u=0;if(s.some(e=>0!==t[e])){for(i in a)r.o(a,i)&&(r.m[i]=a[i]);c&&c(r)}for(e&&e(n);u<s.length;u++)o=s[u],r.o(t,o)&&t[o]&&t[o][0](),t[o]=0},n=self.webpackChunkgeogame=self.webpackChunkgeogame||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,n(r.key),r)}}function n(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}var i=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e,this.email=n,this.username=i,this.following=new Set(r)}return n=t,r=[{key:"fromFirebaseUser",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?(console.log(e),new t(e.uid,e.email,e.displayName,n.following||[])):null}},{key:"fromFirebaseDb",value:function(e){if(!e.exists())return null;var n=e.data();return new t(e.id,n.email,n.username,n.following||[])}}],(i=[{key:"getId",value:function(){return this.id}},{key:"getEmail",value:function(){return this.email}},{key:"getUsername",value:function(){return this.username}},{key:"getFollowing",value:function(){return this.following}},{key:"follow",value:function(t){this.following.add(t)}},{key:"unfollow",value:function(t){this.following.delete(t)}},{key:"isFollowing",value:function(t){return this.following.has(t)}},{key:"toJSON",value:function(){return{id:this.id,email:this.email,username:this.username,following:Array.from(this.following)}}}])&&e(n.prototype,i),r&&e(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,i,r}();function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,c(i.key),i)}}function a(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function c(t){var e=function(t){if("object"!=o(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==o(e)?e:e+""}var u=a(function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.roundNumber=e,this.truth=n,this.guess=null,this.distanceKm=null,this.score=null});function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function h(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,d(i.key),i)}}function d(t){var e=function(t){if("object"!=l(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==l(e)?e:e+""}var f=new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.user=null,this.isAuthenticated=!1,this.authReady=!1,this.listeners=[],this.resetGame()},e=[{key:"setUser",value:function(t){this.user=t,this.isAuthenticated=!0,this.authReady=!0,this.notify()}},{key:"clearUser",value:function(){this.user=null,this.isAuthenticated=!1,this.authReady=!0,this.notify()}},{key:"setAuthReady",value:function(){this.authReady=!0,this.notify()}},{key:"getUser",value:function(){return this.user}},{key:"notify",value:function(){var t=this;this.listeners.forEach(function(e){return e(t)})}},{key:"subscribe",value:function(t){this.listeners.push(t)}},{key:"resetGame",value:function(){this.currentRound=0,this.totalRounds=5,this.rounds=[]}},{key:"startNewGame",value:function(t){this.resetGame(),this.rounds=(t||[]).map(function(t,e){return new u(e+1,t)}),this.totalRounds=Math.max(this.rounds.length,this.totalRounds),this.currentRound=this.rounds.length>0?1:0}},{key:"recordGuess",value:function(t){var e=this.currentRound-1;e>=0&&e<this.rounds.length&&(this.rounds[e].guess=t)}},{key:"recordScore",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.currentRound-1;n>=0&&n<this.rounds.length&&(this.rounds[n].score=t,null!==e&&(this.rounds[n].distanceKm=e))}},{key:"nextRound",value:function(){return this.currentRound<this.totalRounds?(this.currentRound++,!0):(this.currentRound++,!1)}},{key:"isGameOver",value:function(){return this.currentRound>this.totalRounds}},{key:"getCurrentPhoto",value:function(){var t=this.currentRound-1;return t>=0&&t<this.rounds.length&&this.rounds[t].truth?this.rounds[t].truth:null}},{key:"getCurrentRoundNumber",value:function(){return this.currentRound}},{key:"getCurrentRoundEntity",value:function(){var t=this.currentRound-1;return t>=0&&t<this.rounds.length?this.rounds[t]:null}},{key:"getRound",value:function(t){var e=t-1;return e>=0&&e<this.rounds.length?this.rounds[e]:null}},{key:"getRounds",value:function(){return this.rounds.slice()}},{key:"getTotalScore",value:function(){return this.rounds.reduce(function(t,e){return t+(e.score||0)},0)}},{key:"resetAll",value:function(){this.clearUser(),this.resetGame()}}],e&&h(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}());const p=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++i)),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128)}return e},m={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let e=0;e<t.length;e+=3){const r=t[e],o=e+1<t.length,s=o?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=r>>2,l=(3&r)<<4|s>>4;let h=(15&s)<<2|c>>6,d=63&c;a||(d=64,o||(h=64)),i.push(n[u],n[l],n[h],n[d])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(p(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,i=0;for(;n<t.length;){const r=t[n++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const o=t[n++];e[i++]=String.fromCharCode((31&r)<<6|63&o)}else if(r>239&&r<365){const o=((7&r)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(o>>10)),e[i++]=String.fromCharCode(56320+(1023&o))}else{const o=t[n++],s=t[n++];e[i++]=String.fromCharCode((15&r)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let e=0;e<t.length;){const r=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const s=e<t.length?n[t.charAt(e)]:64;++e;const a=e<t.length?n[t.charAt(e)]:64;if(++e,null==r||null==o||null==s||null==a)throw new g;const c=r<<2|o>>4;if(i.push(c),64!==s){const t=o<<4&240|s>>2;if(i.push(t),64!==a){const t=s<<6&192|a;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class g extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const y=function(t){return function(t){const e=p(t);return m.encodeByteArray(e,!0)}(t).replace(/\./g,"")},v=function(t){try{return m.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};const _=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&v(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},w=t=>_()?.emulatorHosts?.[t],b=()=>_()?.config,T=t=>_()?.[`_${t}`];class E{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch(()=>{}),1===t.length?t(e):t(e,n))}}}function S(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function I(t){return(await fetch(t,{credentials:"include"})).ok}const k={};let C=!1;function P(t,e){if("undefined"==typeof window||"undefined"==typeof document||!S(window.location.host)||k[t]===e||k[t]||C)return;function n(t){return`__firebase__banner__${t}`}k[t]=e;const i="__firebase__banner",r=function(){const t={prod:[],emulator:[]};for(const e of Object.keys(k))k[e]?t.emulator.push(e):t.prod.push(e);return t}().prod.length>0;function o(){const t=function(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}(i),e=n("text"),o=document.getElementById(e)||document.createElement("span"),s=n("learnmore"),a=document.getElementById(s)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.created){const e=t.element;!function(t){t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center"}(e),function(t,e){t.setAttribute("id",e),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline"}(a,s);const n=function(){const t=document.createElement("span");return t.style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{C=!0,function(){const t=document.getElementById(i);t&&t.remove()}()},t}();!function(t,e){t.setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px"}(u,c),e.append(u,o,a,n),document.body.appendChild(e)}r?(o.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",e)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}function x(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function A(){return!function(){const t=_()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(r.g.process)}catch(t){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class O extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,O.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,M.prototype.create)}}class M{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,r=this.errors[t],o=r?function(t,e){return t.replace(N,(t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`})}(r,n):"Error",s=`${this.serviceName}: ${o} (${i}).`;return new O(i,s,n)}}const N=/\{\$([^}]+)}/g;function R(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const r of n){if(!i.includes(r))return!1;const n=t[r],o=e[r];if(D(n)&&D(o)){if(!R(n,o))return!1}else if(n!==o)return!1}for(const t of i)if(!n.includes(t))return!1;return!0}function D(t){return null!==t&&"object"==typeof t}function j(t){const e=[];for(const[n,i]of Object.entries(t))Array.isArray(i)?i.forEach(t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function F(t){const e={};return t.replace(/^\?/,"").split("&").forEach(t=>{if(t){const[n,i]=t.split("=");e[decodeURIComponent(n)]=decodeURIComponent(i)}}),e}function U(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}class V{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(t=>{this.error(t)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,n){let i;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");i=function(t){if("object"!=typeof t||null===t)return!1;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(t)?t:{next:t,error:e,complete:n},void 0===i.next&&(i.next=B),void 0===i.error&&(i.error=B),void 0===i.complete&&(i.complete=B);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(t){}}),this.observers.push(i),r}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function B(){}function z(t){return t&&t._delegate?t._delegate:t}class G{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const q="[DEFAULT]";class H{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new E;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),n=t?.optional??!1;if(!this.isInitialized(e)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:e})}catch(t){if(n)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:q})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=q){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...t.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return null!=this.component}isInitialized(t=q){return this.instances.has(t)}getOptions(t=q){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(i);return i}onInit(t,e){const n=this.normalizeInstanceIdentifier(e),i=this.onInitCallbacks.get(n)??new Set;i.add(t),this.onInitCallbacks.set(n,i);const r=this.instances.get(n);return r&&t(r,n),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===q?void 0:i),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}var i;return n||null}normalizeInstanceIdentifier(t=q){return this.component?this.component.multipleInstances?t:q:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Z{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new H(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const W=[];var $;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}($||($={}));const K={debug:$.DEBUG,verbose:$.VERBOSE,info:$.INFO,warn:$.WARN,error:$.ERROR,silent:$.SILENT},Q=$.INFO,Y={[$.DEBUG]:"log",[$.VERBOSE]:"log",[$.INFO]:"info",[$.WARN]:"warn",[$.ERROR]:"error"},X=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),r=Y[e];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[r](`[${i}]  ${t.name}:`,...n)};class J{constructor(t){this.name=t,this._logLevel=Q,this._logHandler=X,this._userLogHandler=null,W.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in $))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?K[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,$.DEBUG,...t),this._logHandler(this,$.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,$.VERBOSE,...t),this._logHandler(this,$.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,$.INFO,...t),this._logHandler(this,$.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,$.WARN,...t),this._logHandler(this,$.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,$.ERROR,...t),this._logHandler(this,$.ERROR,...t)}}let tt,et;const nt=new WeakMap,it=new WeakMap,rt=new WeakMap,ot=new WeakMap,st=new WeakMap;let at={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return it.get(t);if("objectStoreNames"===e)return t.objectStoreNames||rt.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ut(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function ct(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(et||(et=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(lt(this),t),ut(nt.get(this))}:function(...t){return ut(e.apply(lt(this),t))}:function(t,...n){const i=e.call(lt(this),t,...n);return rt.set(i,t.sort?t.sort():[t]),ut(i)}:(t instanceof IDBTransaction&&function(t){if(it.has(t))return;const e=new Promise((e,n)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",o),t.removeEventListener("abort",o)},r=()=>{e(),i()},o=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",o),t.addEventListener("abort",o)});it.set(t,e)}(t),n=t,(tt||(tt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>n instanceof t)?new Proxy(t,at):t);var e,n}function ut(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,n)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",o)},r=()=>{e(ut(t.result)),i()},o=()=>{n(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",o)});return e.then(e=>{e instanceof IDBCursor&&nt.set(e,t)}).catch(()=>{}),st.set(e,t),e}(t);if(ot.has(t))return ot.get(t);const e=ct(t);return e!==t&&(ot.set(t,e),st.set(e,t)),e}const lt=t=>st.get(t),ht=["get","getKey","getAll","getAllKeys","count"],dt=["put","add","delete","clear"],ft=new Map;function pt(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(ft.get(e))return ft.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=dt.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!ht.includes(n))return;const o=async function(t,...e){const o=this.transaction(t,r?"readwrite":"readonly");let s=o.store;return i&&(s=s.index(e.shift())),(await Promise.all([s[n](...e),r&&o.done]))[0]};return ft.set(e,o),o}var mt;mt=at,at={...mt,get:(t,e,n)=>pt(t,e)||mt.get(t,e,n),has:(t,e)=>!!pt(t,e)||mt.has(t,e)};class gt{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function(t){const e=t.getComponent();return"VERSION"===e?.type}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null}).filter(t=>t).join(" ")}}const yt="@firebase/app",vt="0.14.4",_t=new J("@firebase/app"),wt="@firebase/app-compat",bt="@firebase/analytics-compat",Tt="@firebase/analytics",Et="@firebase/app-check-compat",St="@firebase/app-check",It="@firebase/auth",kt="@firebase/auth-compat",Ct="@firebase/database",Pt="@firebase/data-connect",xt="@firebase/database-compat",At="@firebase/functions",Lt="@firebase/functions-compat",Ot="@firebase/installations",Mt="@firebase/installations-compat",Nt="@firebase/messaging",Rt="@firebase/messaging-compat",Dt="@firebase/performance",jt="@firebase/performance-compat",Ft="@firebase/remote-config",Ut="@firebase/remote-config-compat",Vt="@firebase/storage",Bt="@firebase/storage-compat",zt="@firebase/firestore",Gt="@firebase/ai",qt="@firebase/firestore-compat",Ht="firebase",Zt="[DEFAULT]",Wt={[yt]:"fire-core",[wt]:"fire-core-compat",[Tt]:"fire-analytics",[bt]:"fire-analytics-compat",[St]:"fire-app-check",[Et]:"fire-app-check-compat",[It]:"fire-auth",[kt]:"fire-auth-compat",[Ct]:"fire-rtdb",[Pt]:"fire-data-connect",[xt]:"fire-rtdb-compat",[At]:"fire-fn",[Lt]:"fire-fn-compat",[Ot]:"fire-iid",[Mt]:"fire-iid-compat",[Nt]:"fire-fcm",[Rt]:"fire-fcm-compat",[Dt]:"fire-perf",[jt]:"fire-perf-compat",[Ft]:"fire-rc",[Ut]:"fire-rc-compat",[Vt]:"fire-gcs",[Bt]:"fire-gcs-compat",[zt]:"fire-fst",[qt]:"fire-fst-compat",[Gt]:"fire-vertex","fire-js":"fire-js",[Ht]:"fire-js-all"},$t=new Map,Kt=new Map,Qt=new Map;function Yt(t,e){try{t.container.addComponent(e)}catch(n){_t.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Xt(t){const e=t.name;if(Qt.has(e))return _t.debug(`There were multiple attempts to register component ${e}.`),!1;Qt.set(e,t);for(const e of $t.values())Yt(e,t);for(const e of Kt.values())Yt(e,t);return!0}function Jt(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function te(t){return null!=t&&void 0!==t.settings}const ee=new M("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ne{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new G("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ee.create("app-deleted",{appName:this._name})}}const ie="12.4.0";function re(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const i={name:Zt,automaticDataCollectionEnabled:!0,...e},r=i.name;if("string"!=typeof r||!r)throw ee.create("bad-app-name",{appName:String(r)});if(n||(n=b()),!n)throw ee.create("no-options");const o=$t.get(r);if(o){if(R(n,o.options)&&R(i,o.config))return o;throw ee.create("duplicate-app",{appName:r})}const s=new Z(r);for(const t of Qt.values())s.addComponent(t);const a=new ne(n,i,s);return $t.set(r,a),a}function oe(t=Zt){const e=$t.get(t);if(!e&&t===Zt&&b())return re();if(!e)throw ee.create("no-app",{appName:t});return e}function se(t,e,n){let i=Wt[t]??t;n&&(i+=`-${n}`);const r=i.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${i}" with version "${e}":`];return r&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void _t.warn(t.join(" "))}Xt(new G(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}const ae="firebase-heartbeat-store";let ce=null;function ue(){return ce||(ce=function(t,e,{blocked:n,upgrade:i,blocking:r,terminated:o}={}){const s=indexedDB.open(t,e),a=ut(s);return i&&s.addEventListener("upgradeneeded",t=>{i(ut(s.result),t.oldVersion,t.newVersion,ut(s.transaction),t)}),n&&s.addEventListener("blocked",t=>n(t.oldVersion,t.newVersion,t)),a.then(t=>{o&&t.addEventListener("close",()=>o()),r&&t.addEventListener("versionchange",t=>r(t.oldVersion,t.newVersion,t))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(ae)}catch(t){console.warn(t)}}}).catch(t=>{throw ee.create("idb-open",{originalErrorMessage:t.message})})),ce}async function le(t,e){try{const n=(await ue()).transaction(ae,"readwrite"),i=n.objectStore(ae);await i.put(e,he(t)),await n.done}catch(t){if(t instanceof O)_t.warn(t.message);else{const e=ee.create("idb-set",{originalErrorMessage:t?.message});_t.warn(e.message)}}}function he(t){return`${t.name}!${t.options.appId}`}class de{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new pe(e),this._heartbeatsCachePromise=this._storage.read().then(t=>(this._heartbeatsCache=t,t))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=fe();if(null==this._heartbeatsCache?.heartbeats&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===e||this._heartbeatsCache.heartbeats.some(t=>t.date===e))return;if(this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats.length>30){const t=function(t){if(0===t.length)return-1;let e=0,n=t[0].date;for(let i=1;i<t.length;i++)t[i].date<n&&(n=t[i].date,e=i);return e}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){_t.warn(t)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats||0===this._heartbeatsCache.heartbeats.length)return"";const t=fe(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let i=t.slice();for(const r of t){const t=n.find(t=>t.agent===r.agent);if(t){if(t.dates.push(r.date),me(n)>e){t.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),me(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=y(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return _t.warn(t),""}}}function fe(){return(new Date).toISOString().substring(0,10)}class pe{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(t){return!1}}()&&new Promise((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await ue()).transaction(ae),n=await e.objectStore(ae).get(he(t));return await e.done,n}catch(t){if(t instanceof O)_t.warn(t.message);else{const e=ee.create("idb-get",{originalErrorMessage:t?.message});_t.warn(e.message)}}}(this.app);return t?.heartbeats?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const e=await this.read();return le(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??e.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){if(await this._canUseIndexedDBPromise){const e=await this.read();return le(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??e.lastSentHeartbeatDate,heartbeats:[...e.heartbeats,...t.heartbeats]})}}}function me(t){return y(JSON.stringify({version:2,heartbeats:t})).length}Xt(new G("platform-logger",t=>new gt(t),"PRIVATE")),Xt(new G("heartbeat",t=>new de(t),"PRIVATE")),se(yt,vt,""),se(yt,vt,"esm2020"),se("fire-js","");const ge=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},ye=new M("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),ve=new J("@firebase/auth");function _e(t,...e){ve.logLevel<=$.ERROR&&ve.error(`Auth (${ie}): ${t}`,...e)}function we(t,...e){throw Se(t,...e)}function be(t,...e){return Se(t,...e)}function Te(t,e,n){const i={...ge(),[e]:n};return new M("auth","Firebase",i).create(e,{appName:t.name})}function Ee(t){return Te(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Se(t,...e){if("string"!=typeof t){const n=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=t.name),t._errorFactory.create(n,...i)}return ye.create(t,...e)}function Ie(t,e,...n){if(!t)throw Se(e,...n)}function ke(t){const e="INTERNAL ASSERTION FAILED: "+t;throw _e(e),new Error(e)}function Ce(t,e){t||ke(e)}function Pe(){return"undefined"!=typeof self&&self.location?.href||""}function xe(){return"undefined"!=typeof self&&self.location?.protocol||null}function Ae(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===xe()||"https:"===xe()||function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()||"connection"in navigator))||navigator.onLine}class Le{constructor(t,e){this.shortDelay=t,this.longDelay=e,Ce(e>t,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(x())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return Ae()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Oe(t,e){Ce(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class Me{static initialize(t,e,n){this.fetchImpl=t,e&&(this.headersImpl=e),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void ke("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void ke("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void ke("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Ne={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Re=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],De=new Le(3e4,6e4);function je(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Fe(t,e,n,i,r={}){return Ue(t,r,async()=>{let r={},o={};i&&("GET"===e?o=i:r={body:JSON.stringify(i)});const s=j({key:t.config.apiKey,...o}).slice(1),a=await t._getAdditionalHeaders();a["Content-Type"]="application/json",t.languageCode&&(a["X-Firebase-Locale"]=t.languageCode);const c={method:e,headers:a,...r};return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),t.emulatorConfig&&S(t.emulatorConfig.host)&&(c.credentials="include"),Me.fetch()(await Be(t,t.config.apiHost,n,s),c)})}async function Ue(t,e,n){t._canInitEmulator=!1;const i={...Ne,...e};try{const e=new Ge(t),r=await Promise.race([n(),e.promise]);e.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw qe(t,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const e=r.ok?o.errorMessage:o.error.message,[n,s]=e.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw qe(t,"credential-already-in-use",o);if("EMAIL_EXISTS"===n)throw qe(t,"email-already-in-use",o);if("USER_DISABLED"===n)throw qe(t,"user-disabled",o);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(s)throw Te(t,a,s);we(t,a)}}catch(e){if(e instanceof O)throw e;we(t,"network-request-failed",{message:String(e)})}}async function Ve(t,e,n,i,r={}){const o=await Fe(t,e,n,i,r);return"mfaPendingCredential"in o&&we(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function Be(t,e,n,i){const r=`${e}${n}?${i}`,o=t,s=o.config.emulator?Oe(t.config,r):`${t.config.apiScheme}://${r}`;return Re.includes(n)&&(await o._persistenceManagerAvailable,"COOKIE"===o._getPersistenceType())?o._getPersistence()._getFinalTarget(s).toString():s}function ze(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Ge{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((t,e)=>{this.timer=setTimeout(()=>e(be(this.auth,"network-request-failed")),De.get())})}}function qe(t,e,n){const i={appName:t.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const r=be(t,e,i);return r.customData._tokenResponse=n,r}function He(t){return void 0!==t&&void 0!==t.enterprise}class Ze{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===t.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const e of this.recaptchaEnforcementState)if(e.provider&&e.provider===t)return ze(e.enforcementState);return null}isProviderEnabled(t){return"ENFORCE"===this.getProviderEnforcementState(t)||"AUDIT"===this.getProviderEnforcementState(t)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function We(t,e){return Fe(t,"GET","/v2/recaptchaConfig",je(t,e))}async function $e(t,e){return Fe(t,"POST","/v1/accounts:lookup",e)}function Ke(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch(t){}}function Qe(t){return 1e3*Number(t)}function Ye(t){const[e,n,i]=t.split(".");if(void 0===e||void 0===n||void 0===i)return _e("JWT malformed, contained fewer than 3 sections"),null;try{const t=v(n);return t?JSON.parse(t):(_e("Failed to decode base64 JWT payload"),null)}catch(t){return _e("Caught error parsing JWT payload as JSON",t?.toString()),null}}function Xe(t){const e=Ye(t);return Ie(e,"internal-error"),Ie(void 0!==e.exp,"internal-error"),Ie(void 0!==e.iat,"internal-error"),Number(e.exp)-Number(e.iat)}async function Je(t,e,n=!1){if(n)return e;try{return await e}catch(e){throw e instanceof O&&function({code:t}){return"auth/user-disabled"===t||"auth/user-token-expired"===t}(e)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class tn{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(t){if(t){const t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}{this.errorBackoff=3e4;const t=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,t)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===t?.code&&this.schedule(!0))}this.schedule()}}class en{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ke(this.lastLoginAt),this.creationTime=Ke(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function nn(t){const e=t.auth,n=await t.getIdToken(),i=await Je(t,$e(e,{idToken:n}));Ie(i?.users.length,e,"internal-error");const r=i.users[0];t._notifyReloadListener(r);const o=r.providerUserInfo?.length?rn(r.providerUserInfo):[],s=(a=t.providerData,c=o,[...a.filter(t=>!c.some(e=>e.providerId===t.providerId)),...c]);var a,c;const u=t.isAnonymous,l=!(t.email&&r.passwordHash||s?.length),h=!!u&&l,d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new en(r.createdAt,r.lastLoginAt),isAnonymous:h};Object.assign(t,d)}function rn(t){return t.map(({providerId:t,...e})=>({providerId:t,uid:e.rawId||"",displayName:e.displayName||null,email:e.email||null,phoneNumber:e.phoneNumber||null,photoURL:e.photoUrl||null}))}class on{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Ie(t.idToken,"internal-error"),Ie(void 0!==t.idToken,"internal-error"),Ie(void 0!==t.refreshToken,"internal-error");const e="expiresIn"in t&&void 0!==t.expiresIn?Number(t.expiresIn):Xe(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){Ie(0!==t.length,"internal-error");const e=Xe(t);this.updateTokensAndExpiration(t,null,e)}async getToken(t,e=!1){return e||!this.accessToken||this.isExpired?(Ie(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:n,refreshToken:i,expiresIn:r}=await async function(t,e){const n=await Ue(t,{},async()=>{const n=j({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:r}=t.config,o=await Be(t,i,"/v1/token",`key=${r}`),s=await t._getAdditionalHeaders();s["Content-Type"]="application/x-www-form-urlencoded";const a={method:"POST",headers:s,body:n};return t.emulatorConfig&&S(t.emulatorConfig.host)&&(a.credentials="include"),Me.fetch()(o,a)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(t,e);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(t,e,n){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(t,e){const{refreshToken:n,accessToken:i,expirationTime:r}=e,o=new on;return n&&(Ie("string"==typeof n,"internal-error",{appName:t}),o.refreshToken=n),i&&(Ie("string"==typeof i,"internal-error",{appName:t}),o.accessToken=i),r&&(Ie("number"==typeof r,"internal-error",{appName:t}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new on,this.toJSON())}_performRefresh(){return ke("not implemented")}}function sn(t,e){Ie("string"==typeof t||void 0===t,"internal-error",{appName:e})}class an{constructor({uid:t,auth:e,stsTokenManager:n,...i}){this.providerId="firebase",this.proactiveRefresh=new tn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=e,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new en(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(t){const e=await Je(this,this.stsTokenManager.getToken(this.auth,t));return Ie(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return async function(t,e=!1){const n=z(t),i=await n.getIdToken(e),r=Ye(i);Ie(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const o="object"==typeof r.firebase?r.firebase:void 0,s=o?.sign_in_provider;return{claims:r,token:i,authTime:Ke(Qe(r.auth_time)),issuedAtTime:Ke(Qe(r.iat)),expirationTime:Ke(Qe(r.exp)),signInProvider:s||null,signInSecondFactor:o?.sign_in_second_factor||null}}(this,t)}reload(){return async function(t){const e=z(t);await nn(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}(this)}_assign(t){this!==t&&(Ie(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(t=>({...t})),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new an({...this,auth:t,stsTokenManager:this.stsTokenManager._clone()});return e.metadata._copy(this.metadata),e}_onReload(t){Ie(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),e&&await nn(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(te(this.auth.app))return Promise.reject(Ee(this.auth));const t=await this.getIdToken();return await Je(this,async function(t,e){return Fe(t,"POST","/v1/accounts:delete",e)}(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>({...t})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){const n=e.displayName??void 0,i=e.email??void 0,r=e.phoneNumber??void 0,o=e.photoURL??void 0,s=e.tenantId??void 0,a=e._redirectEventId??void 0,c=e.createdAt??void 0,u=e.lastLoginAt??void 0,{uid:l,emailVerified:h,isAnonymous:d,providerData:f,stsTokenManager:p}=e;Ie(l&&p,t,"internal-error");const m=on.fromJSON(this.name,p);Ie("string"==typeof l,t,"internal-error"),sn(n,t.name),sn(i,t.name),Ie("boolean"==typeof h,t,"internal-error"),Ie("boolean"==typeof d,t,"internal-error"),sn(r,t.name),sn(o,t.name),sn(s,t.name),sn(a,t.name),sn(c,t.name),sn(u,t.name);const g=new an({uid:l,auth:t,email:i,emailVerified:h,displayName:n,isAnonymous:d,photoURL:o,phoneNumber:r,tenantId:s,stsTokenManager:m,createdAt:c,lastLoginAt:u});return f&&Array.isArray(f)&&(g.providerData=f.map(t=>({...t}))),a&&(g._redirectEventId=a),g}static async _fromIdTokenResponse(t,e,n=!1){const i=new on;i.updateFromServerResponse(e);const r=new an({uid:e.localId,auth:t,stsTokenManager:i,isAnonymous:n});return await nn(r),r}static async _fromGetAccountInfoResponse(t,e,n){const i=e.users[0];Ie(void 0!==i.localId,"internal-error");const r=void 0!==i.providerUserInfo?rn(i.providerUserInfo):[],o=!(i.email&&i.passwordHash||r?.length),s=new on;s.updateFromIdToken(n);const a=new an({uid:i.localId,auth:t,stsTokenManager:s,isAnonymous:o}),c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new en(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash||r?.length)};return Object.assign(a,c),a}}const cn=new Map;function un(t){Ce(t instanceof Function,"Expected a class definition");let e=cn.get(t);return e?(Ce(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,cn.set(t,e),e)}class ln{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return void 0===e?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}ln.type="NONE";const hn=ln;function dn(t,e,n){return`firebase:${t}:${e}:${n}`}class fn{constructor(t,e,n){this.persistence=t,this.auth=e,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=dn(this.userKey,i.apiKey,r),this.fullPersistenceKey=dn("persistence",i.apiKey,r),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);if(!t)return null;if("string"==typeof t){const e=await $e(this.auth,{idToken:t}).catch(()=>{});return e?an._fromGetAccountInfoResponse(this.auth,e,t):null}return an._fromJSON(this.auth,t)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=t,e?this.setCurrentUser(e):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,n="authUser"){if(!e.length)return new fn(un(hn),t,n);const i=(await Promise.all(e.map(async t=>{if(await t._isAvailable())return t}))).filter(t=>t);let r=i[0]||un(hn);const o=dn(n,t.config.apiKey,t.name);let s=null;for(const n of e)try{const e=await n._get(o);if(e){let i;if("string"==typeof e){const n=await $e(t,{idToken:e}).catch(()=>{});if(!n)break;i=await an._fromGetAccountInfoResponse(t,n,e)}else i=an._fromJSON(t,e);n!==r&&(s=i),r=n;break}}catch{}const a=i.filter(t=>t._shouldAllowMigration);return r._shouldAllowMigration&&a.length?(r=a[0],s&&await r._set(o,s.toJSON()),await Promise.all(e.map(async t=>{if(t!==r)try{await t._remove(o)}catch{}})),new fn(r,t,n)):new fn(r,t,n)}}function pn(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(vn(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(mn(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(wn(e))return"Blackberry";if(bn(e))return"Webos";if(gn(e))return"Safari";if((e.includes("chrome/")||yn(e))&&!e.includes("edge/"))return"Chrome";if(_n(e))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(e);if(2===n?.length)return n[1]}return"Other"}function mn(t=x()){return/firefox\//i.test(t)}function gn(t=x()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function yn(t=x()){return/crios\//i.test(t)}function vn(t=x()){return/iemobile/i.test(t)}function _n(t=x()){return/android/i.test(t)}function wn(t=x()){return/blackberry/i.test(t)}function bn(t=x()){return/webos/i.test(t)}function Tn(t=x()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function En(t=x()){return Tn(t)||_n(t)||bn(t)||wn(t)||/windows phone/i.test(t)||vn(t)}function Sn(t,e=[]){let n;switch(t){case"Browser":n=pn(x());break;case"Worker":n=`${pn(x())}-${t}`;break;default:n=t}const i=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${ie}/${i}`}class In{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const n=e=>new Promise((n,i)=>{try{n(t(e))}catch(t){i(t)}});n.onAbort=e,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const n of this.queue)await n(t),n.onAbort&&e.push(n.onAbort)}catch(t){e.reverse();for(const t of e)try{t()}catch(t){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:t?.message})}}}class kn{constructor(t){const e=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=e.minPasswordLength??6,e.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=e.maxPasswordLength),void 0!==e.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=e.containsLowercaseCharacter),void 0!==e.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=e.containsUppercaseCharacter),void 0!==e.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=e.containsNumericCharacter),void 0!==e.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=e.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=t.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=t.forceUpgradeOnSignin??!1,this.schemaVersion=t.schemaVersion}validatePassword(t){const e={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,e),this.validatePasswordCharacterOptions(t,e),e.isValid&&(e.isValid=e.meetsMinPasswordLength??!0),e.isValid&&(e.isValid=e.meetsMaxPasswordLength??!0),e.isValid&&(e.isValid=e.containsLowercaseLetter??!0),e.isValid&&(e.isValid=e.containsUppercaseLetter??!0),e.isValid&&(e.isValid=e.containsNumericCharacter??!0),e.isValid&&(e.isValid=e.containsNonAlphanumericCharacter??!0),e}validatePasswordLengthOptions(t,e){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(e.meetsMinPasswordLength=t.length>=n),i&&(e.meetsMaxPasswordLength=t.length<=i)}validatePasswordCharacterOptions(t,e){let n;this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);for(let i=0;i<t.length;i++)n=t.charAt(i),this.updatePasswordCharacterOptionsStatuses(e,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(t,e,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=r))}}class Cn{constructor(t,e,n,i){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new xn(this),this.idTokenSubscription=new xn(this),this.beforeStateQueue=new In(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ye,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(t=>this._resolvePersistenceManagerAvailable=t)}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=un(e)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await fn.create(this,t),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(t){}await this.initializeCurrentUser(e),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();return this.currentUser||t?this.currentUser&&t&&this.currentUser.uid===t.uid?(this._currentUser._assign(t),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(t,!0):void 0}async initializeCurrentUserFromIdToken(t){try{const e=await $e(this,{idToken:t}),n=await an._fromGetAccountInfoResponse(this,e,t);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){if(te(this.app)){const t=this.app.settings.authIdToken;return t?new Promise(e=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(t).then(e,e))}):this.directlySetCurrentUser(null)}const e=await this.assertedPersistence.getCurrentUser();let n=e,i=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const e=this.redirectUser?._redirectEventId,r=n?._redirectEventId,o=await this.tryRedirectSignIn(t);e&&e!==r||!o?.user||(n=o.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(t){n=e,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(t))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return Ie(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch(t){await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await nn(t)}catch(t){if("auth/network-request-failed"!==t?.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(te(this.app))return Promise.reject(Ee(this));const e=t?z(t):null;return e&&Ie(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&Ie(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return te(this.app)?Promise.reject(Ee(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return te(this.app)?Promise.reject(Ee(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(un(t))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await async function(t,e={}){return Fe(t,"GET","/v2/passwordPolicy",je(t,e))}(this),e=new kn(t);null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new M("auth","Firebase",t())}onAuthStateChanged(t,e,n){return this.registerStateListener(this.authStateSubscription,t,e,n)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,n){return this.registerStateListener(this.idTokenSubscription,t,e,n)}authStateReady(){return new Promise((t,e)=>{if(this.currentUser)t();else{const n=this.onAuthStateChanged(()=>{n(),t()},e)}})}async revokeAccessToken(t){if(this.currentUser){const e={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(e.tenantId=this.tenantId),await async function(t,e){return Fe(t,"POST","/v2/accounts:revokeToken",je(t,e))}(this,e)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(t,e){const n=await this.getOrInitRedirectPersistenceManager(e);return null===t?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&un(t)||this._popupRedirectResolver;Ie(e,this,"argument-error"),this.redirectPersistenceManager=await fn.create(this,[un(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===t?this._currentUser:this.redirectUser?._redirectEventId===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const t=this.currentUser?.uid??null;this.lastNotifiedUid!==t&&(this.lastNotifiedUid=t,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,n,i){if(this._deleted)return()=>{};const r="function"==typeof e?e:e.next.bind(e);let o=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ie(s,this,"internal-error"),s.then(()=>{o||r(this.currentUser)}),"function"==typeof e){const r=t.addObserver(e,n,i);return()=>{o=!0,r()}}{const n=t.addObserver(e);return()=>{o=!0,n()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Ie(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){t&&!this.frameworks.includes(t)&&(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=Sn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const e=await(this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader());e&&(t["X-Firebase-Client"]=e);const n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){if(te(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken());return t?.error&&function(t,...e){ve.logLevel<=$.WARN&&ve.warn(`Auth (${ie}): ${t}`,...e)}(`Error while retrieving App Check token: ${t.error}`),t?.token}}function Pn(t){return z(t)}class xn{constructor(t){this.auth=t,this.observer=null,this.addObserver=function(t){const e=new V(t,void 0);return e.subscribe.bind(e)}(t=>this.observer=t)}get next(){return Ie(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let An={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ln(t){return An.loadJS(t)}function On(t){return`__${t}${Math.floor(1e6*Math.random())}`}class Mn{constructor(){this.enterprise=new Nn}ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}class Nn{ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}const Rn="NO_RECAPTCHA";class Dn{constructor(t){this.type="recaptcha-enterprise",this.auth=Pn(t)}async verify(t="verify",e=!1){function n(e,n,i){const r=window.grecaptcha;He(r)?r.enterprise.ready(()=>{r.enterprise.execute(e,{action:t}).then(t=>{n(t)}).catch(()=>{n(Rn)})}):i(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new Mn).execute("siteKey",{action:"verify"}):new Promise((t,i)=>{(async function(t){if(!e){if(null==t.tenantId&&null!=t._agentRecaptchaConfig)return t._agentRecaptchaConfig.siteKey;if(null!=t.tenantId&&void 0!==t._tenantRecaptchaConfigs[t.tenantId])return t._tenantRecaptchaConfigs[t.tenantId].siteKey}return new Promise(async(e,n)=>{We(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0!==i.recaptchaKey){const n=new Ze(i);return null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,e(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(t=>{n(t)})})})(this.auth).then(r=>{if(!e&&He(window.grecaptcha))n(r,t,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));let e=An.recaptchaEnterpriseScript;0!==e.length&&(e+=r),Ln(e).then(()=>{n(r,t,i)}).catch(t=>{i(t)})}}).catch(t=>{i(t)})})}}async function jn(t,e,n,i=!1,r=!1){const o=new Dn(t);let s;if(r)s=Rn;else try{s=await o.verify(n)}catch(t){s=await o.verify(n,!0)}const a={...e};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const t=a.phoneEnrollmentInfo.phoneNumber,e=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:t,recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const t=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return i?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Fn(t,e,n,i,r){if("EMAIL_PASSWORD_PROVIDER"===r){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await jn(t,e,n,"getOobCode"===n);return i(t,r)}return i(t,e).catch(async r=>{if("auth/missing-recaptcha-token"===r.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const r=await jn(t,e,n,"getOobCode"===n);return i(t,r)}return Promise.reject(r)})}if("PHONE_PROVIDER"===r){if(t._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){const r=await jn(t,e,n);return i(t,r).catch(async r=>{if("AUDIT"===t._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")&&("auth/missing-recaptcha-token"===r.code||"auth/invalid-app-credential"===r.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const r=await jn(t,e,n,!1,!0);return i(t,r)}return Promise.reject(r)})}{const r=await jn(t,e,n,!1,!0);return i(t,r)}}return Promise.reject(r+" provider is not supported.")}function Un(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Vn(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}class Bn{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return ke("not implemented")}_getIdTokenResponse(t){return ke("not implemented")}_linkToIdToken(t,e){return ke("not implemented")}_getReauthenticationResolver(t){return ke("not implemented")}}async function zn(t,e){return Fe(t,"POST","/v1/accounts:signUp",e)}async function Gn(t,e){return Ve(t,"POST","/v1/accounts:signInWithPassword",je(t,e))}class qn extends Bn{constructor(t,e,n,i=null){super("password",n),this._email=t,this._password=e,this._tenantId=i}static _fromEmailAndPassword(t,e){return new qn(t,e,"password")}static _fromEmailAndCode(t,e,n=null){return new qn(t,e,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t;if(e?.email&&e?.password){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":return Fn(t,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Gn,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(t,e){return Ve(t,"POST","/v1/accounts:signInWithEmailLink",je(t,e))}(t,{email:this._email,oobCode:this._password});default:we(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":return Fn(t,{idToken:e,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",zn,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(t,e){return Ve(t,"POST","/v1/accounts:signInWithEmailLink",je(t,e))}(t,{idToken:e,email:this._email,oobCode:this._password});default:we(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}async function Hn(t,e){return Ve(t,"POST","/v1/accounts:signInWithIdp",je(t,e))}class Zn extends Bn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new Zn(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):we("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t,{providerId:n,signInMethod:i,...r}=e;if(!n||!i)return null;const o=new Zn(n,i);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(t){return Hn(t,this.buildRequest())}_linkToIdToken(t,e){const n=this.buildRequest();return n.idToken=e,Hn(t,n)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,Hn(t,e)}buildRequest(){const t={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=j(e)}return t}}async function Wn(t,e){return Fe(t,"POST","/v1/accounts:sendVerificationCode",je(t,e))}const $n={USER_NOT_FOUND:"user-not-found"};class Kn extends Bn{constructor(t){super("phone","phone"),this.params=t}static _fromVerification(t,e){return new Kn({verificationId:t,verificationCode:e})}static _fromTokenResponse(t,e){return new Kn({phoneNumber:t,temporaryProof:e})}_getIdTokenResponse(t){return async function(t,e){return Ve(t,"POST","/v1/accounts:signInWithPhoneNumber",je(t,e))}(t,this._makeVerificationRequest())}_linkToIdToken(t,e){return async function(t,e){const n=await Ve(t,"POST","/v1/accounts:signInWithPhoneNumber",je(t,e));if(n.temporaryProof)throw qe(t,"account-exists-with-different-credential",n);return n}(t,{idToken:e,...this._makeVerificationRequest()})}_getReauthenticationResolver(t){return async function(t,e){return Ve(t,"POST","/v1/accounts:signInWithPhoneNumber",je(t,{...e,operation:"REAUTH"}),$n)}(t,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:t,phoneNumber:e,verificationId:n,verificationCode:i}=this.params;return t&&e?{temporaryProof:t,phoneNumber:e}:{sessionInfo:n,code:i}}toJSON(){const t={providerId:this.providerId};return this.params.phoneNumber&&(t.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(t.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(t.verificationCode=this.params.verificationCode),this.params.verificationId&&(t.verificationId=this.params.verificationId),t}static fromJSON(t){"string"==typeof t&&(t=JSON.parse(t));const{verificationId:e,verificationCode:n,phoneNumber:i,temporaryProof:r}=t;return n||e||i||r?new Kn({verificationId:e,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class Qn{constructor(t){const e=F(U(t)),n=e.apiKey??null,i=e.oobCode??null,r=function(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(e.mode??null);Ie(n&&i&&r,"argument-error"),this.apiKey=n,this.operation=r,this.code=i,this.continueUrl=e.continueUrl??null,this.languageCode=e.lang??null,this.tenantId=e.tenantId??null}static parseLink(t){const e=function(t){const e=F(U(t)).link,n=e?F(U(e)).deep_link_id:null,i=F(U(t)).deep_link_id;return(i?F(U(i)).link:null)||i||n||e||t}(t);try{return new Qn(e)}catch{return null}}}class Yn{constructor(){this.providerId=Yn.PROVIDER_ID}static credential(t,e){return qn._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const n=Qn.parseLink(e);return Ie(n,"argument-error"),qn._fromEmailAndCode(t,n.code,n.tenantId)}}Yn.PROVIDER_ID="password",Yn.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Yn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Xn{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class Jn extends Xn{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class ti extends Jn{constructor(){super("facebook.com")}static credential(t){return Zn._fromParams({providerId:ti.PROVIDER_ID,signInMethod:ti.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return ti.credentialFromTaggedObject(t)}static credentialFromError(t){return ti.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return ti.credential(t.oauthAccessToken)}catch{return null}}}ti.FACEBOOK_SIGN_IN_METHOD="facebook.com",ti.PROVIDER_ID="facebook.com";class ei extends Jn{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return Zn._fromParams({providerId:ei.PROVIDER_ID,signInMethod:ei.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return ei.credentialFromTaggedObject(t)}static credentialFromError(t){return ei.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:n}=t;if(!e&&!n)return null;try{return ei.credential(e,n)}catch{return null}}}ei.GOOGLE_SIGN_IN_METHOD="google.com",ei.PROVIDER_ID="google.com";class ni extends Jn{constructor(){super("github.com")}static credential(t){return Zn._fromParams({providerId:ni.PROVIDER_ID,signInMethod:ni.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return ni.credentialFromTaggedObject(t)}static credentialFromError(t){return ni.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return ni.credential(t.oauthAccessToken)}catch{return null}}}ni.GITHUB_SIGN_IN_METHOD="github.com",ni.PROVIDER_ID="github.com";class ii extends Jn{constructor(){super("twitter.com")}static credential(t,e){return Zn._fromParams({providerId:ii.PROVIDER_ID,signInMethod:ii.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return ii.credentialFromTaggedObject(t)}static credentialFromError(t){return ii.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:n}=t;if(!e||!n)return null;try{return ii.credential(e,n)}catch{return null}}}async function ri(t,e){return Ve(t,"POST","/v1/accounts:signUp",je(t,e))}ii.TWITTER_SIGN_IN_METHOD="twitter.com",ii.PROVIDER_ID="twitter.com";class oi{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,n,i=!1){const r=await an._fromIdTokenResponse(t,n,i),o=si(n);return new oi({user:r,providerId:o,_tokenResponse:n,operationType:e})}static async _forOperation(t,e,n){await t._updateTokensIfNecessary(n,!0);const i=si(n);return new oi({user:t,providerId:i,_tokenResponse:n,operationType:e})}}function si(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class ai extends O{constructor(t,e,n,i){super(e.code,e.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,ai.prototype),this.customData={appName:t.name,tenantId:t.tenantId??void 0,_serverResponse:e.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,e,n,i){return new ai(t,e,n,i)}}function ci(t,e,n,i){return("reauthenticate"===e?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw ai._fromErrorAndOperation(t,n,e,i);throw n})}async function ui(t,e,n=!1){if(te(t.app))return Promise.reject(Ee(t));const i="signIn",r=await ci(t,i,e),o=await oi._fromIdTokenResponse(t,i,r);return n||await t._updateCurrentUser(o.user),o}async function li(t){const e=Pn(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function hi(t,e,n){if(te(t.app))return Promise.reject(Ee(t));const i=Pn(t),r=Fn(i,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ri,"EMAIL_PASSWORD_PROVIDER"),o=await r.catch(e=>{throw"auth/password-does-not-meet-requirements"===e.code&&li(t),e}),s=await oi._fromIdTokenResponse(i,"signIn",o);return await i._updateCurrentUser(s.user),s}function di(t,e,n){return te(t.app)?Promise.reject(Ee(t)):async function(t,e){return ui(Pn(t),e)}(z(t),Yn.credential(e,n)).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&li(t),e})}function fi(t,e,n,i){return z(t).onAuthStateChanged(e,n,i)}function pi(t){return z(t).signOut()}function mi(t,e){return Fe(t,"POST","/v2/accounts/mfaEnrollment:start",je(t,e))}new WeakMap;const gi="__sak";class yi{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(gi,"1"),this.storage.removeItem(gi),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}class vi extends yi{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=En(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const n=this.storage.getItem(e),i=this.localCache[e];n!==i&&t(e,i,n)}}onStorageEvent(t,e=!1){if(!t.key)return void this.forAllChangedKeys((t,e,n)=>{this.notifyListeners(t,n)});const n=t.key;e?this.detachListener():this.stopPolling();const i=()=>{const t=this.storage.getItem(n);(e||this.localCache[n]!==t)&&this.notifyListeners(n,t)},r=this.storage.getItem(n);!function(){const t=x();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}()||10!==document.documentMode||r===t.newValue||t.newValue===t.oldValue?i():setTimeout(i,10)}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e?JSON.parse(e):e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,e,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}vi.type="LOCAL";const _i=vi;class wi extends yi{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,e){}_removeListener(t,e){}}wi.type="SESSION";const bi=wi;class Ti{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find(e=>e.isListeningto(t));if(e)return e;const n=new Ti(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:n,eventType:i,data:r}=e.data,o=this.handlersMap[i];if(!o?.size)return;e.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const s=Array.from(o).map(async t=>t(e.origin,r)),a=await function(t){return Promise.all(t.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(t){return{fulfilled:!1,reason:t}}}))}(s);e.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(t,e){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),e&&0!==this.handlersMap[t].size||delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Ei(t="",e=10){let n="";for(let t=0;t<e;t++)n+=Math.floor(10*Math.random());return t+n}Ti.receivers=[];class Si{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,o;return new Promise((s,a)=>{const c=Ei("",20);i.port1.start();const u=setTimeout(()=>{a(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(t){const e=t;if(e.data.eventId===c)switch(e.data.status){case"ack":clearTimeout(u),r=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),s(e.data.response);break;default:clearTimeout(u),clearTimeout(r),a(new Error("invalid_response"))}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:t,eventId:c,data:e},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function Ii(){return window}function ki(){return void 0!==Ii().WorkerGlobalScope&&"function"==typeof Ii().importScripts}const Ci="firebaseLocalStorageDb",Pi="firebaseLocalStorage",xi="fbase_key";class Ai{constructor(t){this.request=t}toPromise(){return new Promise((t,e)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{e(this.request.error)})})}}function Li(t,e){return t.transaction([Pi],e?"readwrite":"readonly").objectStore(Pi)}function Oi(){const t=indexedDB.open(Ci,1);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const e=t.result;try{e.createObjectStore(Pi,{keyPath:xi})}catch(t){n(t)}}),t.addEventListener("success",async()=>{const n=t.result;n.objectStoreNames.contains(Pi)?e(n):(n.close(),await function(){const t=indexedDB.deleteDatabase(Ci);return new Ai(t).toPromise()}(),e(await Oi()))})})}async function Mi(t,e,n){const i=Li(t,!0).put({[xi]:e,value:n});return new Ai(i).toPromise()}function Ni(t,e){const n=Li(t,!0).delete(e);return new Ai(n).toPromise()}class Ri{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Oi()),this.db}async _withRetries(t){let e=0;for(;;)try{const e=await this._openDb();return await t(e)}catch(t){if(e++>3)throw t;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ki()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ti._getInstance(ki()?self:null),this.receiver._subscribe("keyChanged",async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)})),this.receiver._subscribe("ping",async(t,e)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await async function(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}(),!this.activeServiceWorker)return;this.sender=new Si(this.activeServiceWorker);const t=await this.sender._send("ping",{},800);t&&t[0]?.fulfilled&&t[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await Oi();return await Mi(t,gi,"1"),await Ni(t,gi),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Mi(n,t,e)),this.localCache[t]=e,this.notifyServiceWorker(t)))}async _get(t){const e=await this._withRetries(e=>async function(t,e){const n=Li(t,!1).get(e),i=await new Ai(n).toPromise();return void 0===i?null:i.value}(e,t));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>Ni(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(t=>{const e=Li(t,!1).getAll();return new Ai(e).toPromise()});if(!t)return[];if(0!==this.pendingWrites)return[];const e=[],n=new Set;if(0!==t.length)for(const{fbase_key:i,value:r}of t)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),e.push(i));for(const t of Object.keys(this.localCache))this.localCache[t]&&!n.has(t)&&(this.notifyListeners(t,null),e.push(t));return e}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Ri.type="LOCAL";const Di=Ri;function ji(t,e){return Fe(t,"POST","/v2/accounts/mfaSignIn:start",je(t,e))}On("rcb"),new Le(3e4,6e4);const Fi="recaptcha";async function Ui(t,e,n){if(!t._getRecaptchaConfig())try{await async function(t){const e=Pn(t),n=await We(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),i=new Ze(n);null==e.tenantId?e._agentRecaptchaConfig=i:e._tenantRecaptchaConfigs[e.tenantId]=i,i.isAnyProviderEnabled()&&new Dn(e).verify()}(t)}catch(t){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"==typeof e?{phoneNumber:e}:e,"session"in i){const e=i.session;if("phoneNumber"in i){Ie("enroll"===e.type,t,"internal-error");const r=Fn(t,{idToken:e.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},"mfaSmsEnrollment",async(t,e)=>e.phoneEnrollmentInfo.captchaResponse===Rn?(Ie(n?.type===Fi,t,"argument-error"),mi(t,await Vi(t,e,n))):mi(t,e),"PHONE_PROVIDER");return(await r.catch(t=>Promise.reject(t))).phoneSessionInfo.sessionInfo}{Ie("signin"===e.type,t,"internal-error");const r=i.multiFactorHint?.uid||i.multiFactorUid;Ie(r,t,"missing-multi-factor-info");const o=Fn(t,{mfaPendingCredential:e.credential,mfaEnrollmentId:r,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},"mfaSmsSignIn",async(t,e)=>e.phoneSignInInfo.captchaResponse===Rn?(Ie(n?.type===Fi,t,"argument-error"),ji(t,await Vi(t,e,n))):ji(t,e),"PHONE_PROVIDER");return(await o.catch(t=>Promise.reject(t))).phoneResponseInfo.sessionInfo}}{const e=Fn(t,{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},"sendVerificationCode",async(t,e)=>e.captchaResponse===Rn?(Ie(n?.type===Fi,t,"argument-error"),Wn(t,await Vi(t,e,n))):Wn(t,e),"PHONE_PROVIDER");return(await e.catch(t=>Promise.reject(t))).sessionInfo}}finally{n?._reset()}}async function Vi(t,e,n){Ie(n.type===Fi,t,"argument-error");const i=await n.verify();Ie("string"==typeof i,t,"argument-error");const r={...e};if("phoneEnrollmentInfo"in r){const t=r.phoneEnrollmentInfo.phoneNumber,e=r.phoneEnrollmentInfo.captchaResponse,n=r.phoneEnrollmentInfo.clientType,o=r.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(r,{phoneEnrollmentInfo:{phoneNumber:t,recaptchaToken:i,captchaResponse:e,clientType:n,recaptchaVersion:o}}),r}if("phoneSignInInfo"in r){const t=r.phoneSignInInfo.captchaResponse,e=r.phoneSignInInfo.clientType,n=r.phoneSignInInfo.recaptchaVersion;return Object.assign(r,{phoneSignInInfo:{recaptchaToken:i,captchaResponse:t,clientType:e,recaptchaVersion:n}}),r}return Object.assign(r,{recaptchaToken:i}),r}class Bi{constructor(t){this.providerId=Bi.PROVIDER_ID,this.auth=Pn(t)}verifyPhoneNumber(t,e){return Ui(this.auth,t,z(e))}static credential(t,e){return Kn._fromVerification(t,e)}static credentialFromResult(t){const e=t;return Bi.credentialFromTaggedObject(e)}static credentialFromError(t){return Bi.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{phoneNumber:e,temporaryProof:n}=t;return e&&n?Kn._fromTokenResponse(e,n):null}}Bi.PROVIDER_ID="phone",Bi.PHONE_SIGN_IN_METHOD="phone";class zi extends Bn{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return Hn(t,this._buildIdpRequest())}_linkToIdToken(t,e){return Hn(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return Hn(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function Gi(t){return ui(t.auth,new zi(t),t.bypassAuthState)}function qi(t){const{auth:e,user:n}=t;return Ie(n,e,"internal-error"),async function(t,e,n=!1){const{auth:i}=t;if(te(i.app))return Promise.reject(Ee(i));const r="reauthenticate";try{const o=await Je(t,ci(i,r,e,t),n);Ie(o.idToken,i,"internal-error");const s=Ye(o.idToken);Ie(s,i,"internal-error");const{sub:a}=s;return Ie(t.uid===a,i,"user-mismatch"),oi._forOperation(t,r,o)}catch(t){throw"auth/user-not-found"===t?.code&&we(i,"user-mismatch"),t}}(n,new zi(t),t.bypassAuthState)}async function Hi(t){const{auth:e,user:n}=t;return Ie(n,e,"internal-error"),async function(t,e,n=!1){const i=await Je(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return oi._forOperation(t,"link",i)}(n,new zi(t),t.bypassAuthState)}class Zi{constructor(t,e,n,i,r=!1){this.auth=t,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise(async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(t){this.reject(t)}})}async onAuthEvent(t){const{urlResponse:e,sessionId:n,postBody:i,tenantId:r,error:o,type:s}=t;if(o)return void this.reject(o);const a={auth:this.auth,requestUri:e,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(a))}catch(t){this.reject(t)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return Gi;case"linkViaPopup":case"linkViaRedirect":return Hi;case"reauthViaPopup":case"reauthViaRedirect":return qi;default:we(this.auth,"internal-error")}}resolve(t){Ce(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Ce(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Wi=new Le(2e3,1e4);class $i extends Zi{constructor(t,e,n,i,r){super(t,e,i,r),this.provider=n,this.authWindow=null,this.pollId=null,$i.currentPopupAction&&$i.currentPopupAction.cancel(),$i.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Ie(t,this.auth,"internal-error"),t}async onExecution(){Ce(1===this.filter.length,"Popup operations only handle one event");const t=Ei();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(be(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(be(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,$i.currentPopupAction=null}pollUserCancellation(){const t=()=>{this.authWindow?.window?.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(be(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(t,Wi.get())};t()}}$i.currentPopupAction=null;const Ki=new Map;class Qi extends Zi{constructor(t,e,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,n),this.eventId=null}async execute(){let t=Ki.get(this.auth._key());if(!t){try{const e=await async function(t,e){const n=function(t){return dn("pendingRedirect",t.config.apiKey,t.name)}(e),i=function(t){return un(t._redirectPersistence)}(t);if(!await i._isAvailable())return!1;const r="true"===await i._get(n);return await i._remove(n),r}(this.resolver,this.auth),n=e?await super.execute():null;t=()=>Promise.resolve(n)}catch(e){t=()=>Promise.reject(e)}Ki.set(this.auth._key(),t)}return this.bypassAuthState||Ki.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if("signInViaRedirect"===t.type)return super.onAuthEvent(t);if("unknown"!==t.type){if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Yi(t,e){Ki.set(t._key(),e)}async function Xi(t,e,n=!1){if(te(t.app))return Promise.reject(Ee(t));const i=Pn(t),r=function(t,e){return e?un(e):(Ie(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}(i,e),o=new Qi(i,r,n),s=await o.execute();return s&&!n&&(delete s.user._redirectEventId,await i._persistUserIfCurrent(s.user),await i._setRedirectUser(null,e)),s}class Ji{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(t,n)&&(e=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!function(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return er(t);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){if(t.error&&!er(t)){const n=t.error.code?.split("auth/")[1]||"internal-error";e.onError(be(this.auth,n))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const n=null===e.eventId||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(tr(t))}saveEventToCache(t){this.cachedEventUids.add(tr(t)),this.lastProcessedEventTime=Date.now()}}function tr(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(t=>t).join("-")}function er({type:t,error:e}){return"unknown"===t&&"auth/no-auth-event"===e?.code}const nr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ir=/^https?/;function rr(t){const e=Pe(),{protocol:n,hostname:i}=new URL(e);if(t.startsWith("chrome-extension://")){const r=new URL(t);return""===r.hostname&&""===i?"chrome-extension:"===n&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!ir.test(n))return!1;if(nr.test(t))return i===t;const r=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const or=new Le(3e4,6e4);function sr(){const t=Ii().___jsl;if(t?.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}function ar(t){return new Promise((e,n)=>{function i(){sr(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{sr(),n(be(t,"network-request-failed"))},timeout:or.get()})}if(Ii().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else{if(!Ii().gapi?.load){const e=On("iframefcb");return Ii()[e]=()=>{gapi.load?i():n(be(t,"network-request-failed"))},Ln(`${An.gapiScript}?onload=${e}`).catch(t=>n(t))}i()}}).catch(t=>{throw cr=null,t})}let cr=null;const ur=new Le(5e3,15e3),lr={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},hr=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function dr(t){const e=t.config;Ie(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Oe(e,"emulator/auth/iframe"):`https://${t.config.authDomain}/__/auth/iframe`,i={apiKey:e.apiKey,appName:t.name,v:ie},r=hr.get(t.config.apiHost);r&&(i.eid=r);const o=t._getFrameworks();return o.length&&(i.fw=o.join(",")),`${n}?${j(i).slice(1)}`}const fr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class pr{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(t){}}}const mr=encodeURIComponent("fac");async function gr(t,e,n,i,r,o){Ie(t.config.authDomain,t,"auth-domain-config-required"),Ie(t.config.apiKey,t,"invalid-api-key");const s={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:i,v:ie,eventId:r};if(e instanceof Xn){e.setDefaultLanguage(t.languageCode),s.providerId=e.providerId||"",function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(e.getCustomParameters())||(s.customParameters=JSON.stringify(e.getCustomParameters()));for(const[t,e]of Object.entries(o||{}))s[t]=e}if(e instanceof Jn){const t=e.getScopes().filter(t=>""!==t);t.length>0&&(s.scopes=t.join(","))}t.tenantId&&(s.tid=t.tenantId);const a=s;for(const t of Object.keys(a))void 0===a[t]&&delete a[t];const c=await t._getAppCheckToken(),u=c?`#${mr}=${encodeURIComponent(c)}`:"";return`${function({config:t}){return t.emulator?Oe(t,"emulator/auth/handler"):`https://${t.authDomain}/__/auth/handler`}(t)}?${j(a).slice(1)}${u}`}const yr="webStorageSupport",vr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=bi,this._completeRedirectFn=Xi,this._overrideRedirectResult=Yi}async _openPopup(t,e,n,i){return Ce(this.eventManagers[t._key()]?.manager,"_initialize() not called before _openPopup()"),function(t,e,n,i=500,r=600){const o=Math.max((window.screen.availHeight-r)/2,0).toString(),s=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c={...fr,width:i.toString(),height:r.toString(),top:o,left:s},u=x().toLowerCase();n&&(a=yn(u)?"_blank":n),mn(u)&&(e=e||"http://localhost",c.scrollbars="yes");const l=Object.entries(c).reduce((t,[e,n])=>`${t}${e}=${n},`,"");if(function(t=x()){return Tn(t)&&!!window.navigator?.standalone}(u)&&"_self"!==a)return function(t,e){const n=document.createElement("a");n.href=t,n.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(e||"",a),new pr(null);const h=window.open(e||"",a,l);Ie(h,t,"popup-blocked");try{h.focus()}catch(t){}return new pr(h)}(t,await gr(t,e,n,Pe(),i),Ei())}async _openRedirect(t,e,n,i){return await this._originValidation(t),r=await gr(t,e,n,Pe(),i),Ii().location.href=r,new Promise(()=>{});var r}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:t,promise:n}=this.eventManagers[e];return t?Promise.resolve(t):(Ce(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(t);return this.eventManagers[e]={promise:n},n.catch(()=>{delete this.eventManagers[e]}),n}async initAndGetManager(t){const e=await async function(t){const e=await function(t){return cr=cr||ar(t),cr}(t),n=Ii().gapi;return Ie(n,t,"internal-error"),e.open({where:document.body,url:dr(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:lr,dontclear:!0},e=>new Promise(async(n,i)=>{await e.restyle({setHideOnLeave:!1});const r=be(t,"network-request-failed"),o=Ii().setTimeout(()=>{i(r)},ur.get());function s(){Ii().clearTimeout(o),n(e)}e.ping(s).then(s,()=>{i(r)})}))}(t),n=new Ji(t);return e.register("authEvent",e=>(Ie(e?.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(yr,{type:yr},n=>{const i=n?.[0]?.[yr];void 0!==i&&e(!!i),we(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=async function(t){if(t.config.emulator)return;const{authorizedDomains:e}=await async function(t,e={}){return Fe(t,"GET","/v1/projects",e)}(t);for(const t of e)try{if(rr(t))return}catch{}we(t,"unauthorized-domain")}(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return En()||gn()||Tn()}};var _r="@firebase/auth",wr="1.11.0";class br{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged(e=>{t(e?.stsTokenManager.accessToken||null)});this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){Ie(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Tr=T("authIdTokenMaxAge")||300;let Er=null;var Sr;An={loadJS:t=>new Promise((e,n)=>{const i=document.createElement("script");i.setAttribute("src",t),i.onload=e,i.onerror=t=>{const e=be("internal-error");e.customData=t,n(e)},i.type="text/javascript",i.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(i)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Sr="Browser",Xt(new G("auth",(t,{options:e})=>{const n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),r=t.getProvider("app-check-internal"),{apiKey:o,authDomain:s}=n.options;Ie(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:o,authDomain:s,clientPlatform:Sr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Sn(Sr)},c=new Cn(n,i,r,a);return function(t,e){const n=e?.persistence||[],i=(Array.isArray(n)?n:[n]).map(un);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(i,e?.popupRedirectResolver)}(c,e),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,n)=>{t.getProvider("auth-internal").initialize()})),Xt(new G("auth-internal",t=>(t=>new br(t))(Pn(t.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),se(_r,wr,function(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Sr)),se(_r,wr,"esm2020"),se("firebase","12.4.0","app");var Ir,kr,Cr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Pr={};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(t,e,n){n||(n=0);const i=Array(16);if("string"==typeof e)for(var r=0;r<16;++r)i[r]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(r=0;r<16;++r)i[r]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],r=t.g[2];let o,s=t.g[3];o=e+(s^n&(r^s))+i[0]+3614090360&4294967295,o=s+(r^(e=n+(o<<7&4294967295|o>>>25))&(n^r))+i[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=r+(n^s&(e^n))+i[2]+606105819&4294967295,o=n+(e^(r=s+(o<<17&4294967295|o>>>15))&(s^e))+i[3]+3250441966&4294967295,o=e+(s^(n=r+(o<<22&4294967295|o>>>10))&(r^s))+i[4]+4118548399&4294967295,o=s+(r^(e=n+(o<<7&4294967295|o>>>25))&(n^r))+i[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=r+(n^s&(e^n))+i[6]+2821735955&4294967295,o=n+(e^(r=s+(o<<17&4294967295|o>>>15))&(s^e))+i[7]+4249261313&4294967295,o=e+(s^(n=r+(o<<22&4294967295|o>>>10))&(r^s))+i[8]+1770035416&4294967295,o=s+(r^(e=n+(o<<7&4294967295|o>>>25))&(n^r))+i[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=r+(n^s&(e^n))+i[10]+4294925233&4294967295,o=n+(e^(r=s+(o<<17&4294967295|o>>>15))&(s^e))+i[11]+2304563134&4294967295,o=e+(s^(n=r+(o<<22&4294967295|o>>>10))&(r^s))+i[12]+1804603682&4294967295,o=s+(r^(e=n+(o<<7&4294967295|o>>>25))&(n^r))+i[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=r+(n^s&(e^n))+i[14]+2792965006&4294967295,o=n+(e^(r=s+(o<<17&4294967295|o>>>15))&(s^e))+i[15]+1236535329&4294967295,o=e+(r^s&((n=r+(o<<22&4294967295|o>>>10))^r))+i[1]+4129170786&4294967295,o=s+(n^r&((e=n+(o<<5&4294967295|o>>>27))^n))+i[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(s^e))+i[11]+643717713&4294967295,o=n+(s^e&((r=s+(o<<14&4294967295|o>>>18))^s))+i[0]+3921069994&4294967295,o=e+(r^s&((n=r+(o<<20&4294967295|o>>>12))^r))+i[5]+3593408605&4294967295,o=s+(n^r&((e=n+(o<<5&4294967295|o>>>27))^n))+i[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(s^e))+i[15]+3634488961&4294967295,o=n+(s^e&((r=s+(o<<14&4294967295|o>>>18))^s))+i[4]+3889429448&4294967295,o=e+(r^s&((n=r+(o<<20&4294967295|o>>>12))^r))+i[9]+568446438&4294967295,o=s+(n^r&((e=n+(o<<5&4294967295|o>>>27))^n))+i[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(s^e))+i[3]+4107603335&4294967295,o=n+(s^e&((r=s+(o<<14&4294967295|o>>>18))^s))+i[8]+1163531501&4294967295,o=e+(r^s&((n=r+(o<<20&4294967295|o>>>12))^r))+i[13]+2850285829&4294967295,o=s+(n^r&((e=n+(o<<5&4294967295|o>>>27))^n))+i[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(s^e))+i[7]+1735328473&4294967295,o=n+(s^e&((r=s+(o<<14&4294967295|o>>>18))^s))+i[12]+2368359562&4294967295,o=e+((n=r+(o<<20&4294967295|o>>>12))^r^s)+i[5]+4294588738&4294967295,o=s+((e=n+(o<<4&4294967295|o>>>28))^n^r)+i[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=r+(s^e^n)+i[11]+1839030562&4294967295,o=n+((r=s+(o<<16&4294967295|o>>>16))^s^e)+i[14]+4259657740&4294967295,o=e+((n=r+(o<<23&4294967295|o>>>9))^r^s)+i[1]+2763975236&4294967295,o=s+((e=n+(o<<4&4294967295|o>>>28))^n^r)+i[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=r+(s^e^n)+i[7]+4139469664&4294967295,o=n+((r=s+(o<<16&4294967295|o>>>16))^s^e)+i[10]+3200236656&4294967295,o=e+((n=r+(o<<23&4294967295|o>>>9))^r^s)+i[13]+681279174&4294967295,o=s+((e=n+(o<<4&4294967295|o>>>28))^n^r)+i[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=r+(s^e^n)+i[3]+3572445317&4294967295,o=n+((r=s+(o<<16&4294967295|o>>>16))^s^e)+i[6]+76029189&4294967295,o=e+((n=r+(o<<23&4294967295|o>>>9))^r^s)+i[9]+3654602809&4294967295,o=s+((e=n+(o<<4&4294967295|o>>>28))^n^r)+i[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=r+(s^e^n)+i[15]+530742520&4294967295,o=n+((r=s+(o<<16&4294967295|o>>>16))^s^e)+i[2]+3299628645&4294967295,o=e+(r^((n=r+(o<<23&4294967295|o>>>9))|~s))+i[0]+4096336452&4294967295,o=s+(n^((e=n+(o<<6&4294967295|o>>>26))|~r))+i[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=r+(e^(s|~n))+i[14]+2878612391&4294967295,o=n+(s^((r=s+(o<<15&4294967295|o>>>17))|~e))+i[5]+4237533241&4294967295,o=e+(r^((n=r+(o<<21&4294967295|o>>>11))|~s))+i[12]+1700485571&4294967295,o=s+(n^((e=n+(o<<6&4294967295|o>>>26))|~r))+i[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=r+(e^(s|~n))+i[10]+4293915773&4294967295,o=n+(s^((r=s+(o<<15&4294967295|o>>>17))|~e))+i[1]+2240044497&4294967295,o=e+(r^((n=r+(o<<21&4294967295|o>>>11))|~s))+i[8]+1873313359&4294967295,o=s+(n^((e=n+(o<<6&4294967295|o>>>26))|~r))+i[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=r+(e^(s|~n))+i[6]+2734768916&4294967295,o=n+(s^((r=s+(o<<15&4294967295|o>>>17))|~e))+i[13]+1309151649&4294967295,o=e+(r^((n=r+(o<<21&4294967295|o>>>11))|~s))+i[4]+4149444226&4294967295,o=s+(n^((e=n+(o<<6&4294967295|o>>>26))|~r))+i[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=r+(e^(s|~n))+i[2]+718787259&4294967295,o=n+(s^((r=s+(o<<15&4294967295|o>>>17))|~e))+i[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+r&4294967295,t.g[3]=t.g[3]+s&4294967295}function i(t,e){this.h=e;const n=[];let i=!0;for(let r=t.length-1;r>=0;r--){const o=0|t[r];i&&o==e||(n[r]=o,i=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.F=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.D=function(t,n,i){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return e.prototype[n].apply(t,r)}}(e,function(){this.blockSize=-1}),e.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.v=function(t,e){void 0===e&&(e=t.length);const i=e-this.blockSize,r=this.C;let o=this.h,s=0;for(;s<e;){if(0==o)for(;s<=i;)n(this,t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(r[o++]=t.charCodeAt(s++),o==this.blockSize){n(this,r),o=0;break}}else for(;s<e;)if(r[o++]=t[s++],o==this.blockSize){n(this,r),o=0;break}}this.h=o,this.o+=e},e.prototype.A=function(){var t=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;e=8*this.o;for(var n=t.length-8;n<t.length;++n)t[n]=255&e,e/=256;for(this.v(t),t=Array(16),e=0,n=0;n<4;++n)for(let i=0;i<32;i+=8)t[e++]=this.g[n]>>>i&255;return t};var r={};function o(t){return-128<=t&&t<128?function(t){var e=r;return Object.prototype.hasOwnProperty.call(e,t)?e[t]:e[t]=function(t){return new i([0|t],t<0?-1:0)}(t)}(t):new i([0|t],t<0?-1:0)}function s(t){if(isNaN(t)||!isFinite(t))return a;if(t<0)return d(s(-t));const e=[];let n=1;for(let i=0;t>=n;i++)e[i]=t/n|0,n*=4294967296;return new i(e,0)}var a=o(0),c=o(1),u=o(16777216);function l(t){if(0!=t.h)return!1;for(let e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function h(t){return-1==t.h}function d(t){const e=t.g.length,n=[];for(let i=0;i<e;i++)n[i]=~t.g[i];return new i(n,~t.h).add(c)}function f(t,e){return t.add(d(e))}function p(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function m(t,e){this.g=t,this.h=e}function g(t,e){if(l(e))throw Error("division by zero");if(l(t))return new m(a,a);if(h(t))return e=g(d(t),e),new m(d(e.g),d(e.h));if(h(e))return e=g(t,d(e)),new m(d(e.g),e.h);if(t.g.length>30){if(h(t)||h(e))throw Error("slowDivide_ only works with positive integers.");for(var n=c,i=e;i.l(t)<=0;)n=y(n),i=y(i);var r=v(n,1),o=v(i,1);for(i=v(i,2),n=v(n,2);!l(i);){var u=o.add(i);u.l(t)<=0&&(r=r.add(n),o=u),i=v(i,1),n=v(n,1)}return e=f(t,r.j(e)),new m(r,e)}for(r=a;t.l(e)>=0;){for(n=Math.max(1,Math.floor(t.m()/e.m())),i=(i=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,i-48),u=(o=s(n)).j(e);h(u)||u.l(t)>0;)u=(o=s(n-=i)).j(e);l(o)&&(o=c),r=r.add(o),t=f(t,u)}return new m(r,t)}function y(t){const e=t.g.length+1,n=[];for(let i=0;i<e;i++)n[i]=t.i(i)<<1|t.i(i-1)>>>31;return new i(n,t.h)}function v(t,e){const n=e>>5;e%=32;const r=t.g.length-n,o=[];for(let i=0;i<r;i++)o[i]=e>0?t.i(i+n)>>>e|t.i(i+n+1)<<32-e:t.i(i+n);return new i(o,t.h)}(t=i.prototype).m=function(){if(h(this))return-d(this).m();let t=0,e=1;for(let n=0;n<this.g.length;n++){const i=this.i(n);t+=(i>=0?i:4294967296+i)*e,e*=4294967296}return t},t.toString=function(t){if((t=t||10)<2||36<t)throw Error("radix out of range: "+t);if(l(this))return"0";if(h(this))return"-"+d(this).toString(t);const e=s(Math.pow(t,6));var n=this;let i="";for(;;){const r=g(n,e).g;let o=(((n=f(n,r.j(e))).g.length>0?n.g[0]:n.h)>>>0).toString(t);if(l(n=r))return o+i;for(;o.length<6;)o="0"+o;i=o+i}},t.i=function(t){return t<0?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return h(t=f(this,t))?-1:l(t)?0:1},t.abs=function(){return h(this)?d(this):this},t.add=function(t){const e=Math.max(this.g.length,t.g.length),n=[];let r=0;for(let i=0;i<=e;i++){let e=r+(65535&this.i(i))+(65535&t.i(i)),o=(e>>>16)+(this.i(i)>>>16)+(t.i(i)>>>16);r=o>>>16,e&=65535,o&=65535,n[i]=o<<16|e}return new i(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(l(this)||l(t))return a;if(h(this))return h(t)?d(this).j(d(t)):d(d(this).j(t));if(h(t))return d(this.j(d(t)));if(this.l(u)<0&&t.l(u)<0)return s(this.m()*t.m());const e=this.g.length+t.g.length,n=[];for(var r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let e=0;e<t.g.length;e++){const i=this.i(r)>>>16,o=65535&this.i(r),s=t.i(e)>>>16,a=65535&t.i(e);n[2*r+2*e]+=o*a,p(n,2*r+2*e),n[2*r+2*e+1]+=i*a,p(n,2*r+2*e+1),n[2*r+2*e+1]+=o*s,p(n,2*r+2*e+1),n[2*r+2*e+2]+=i*s,p(n,2*r+2*e+2)}for(t=0;t<e;t++)n[t]=n[2*t+1]<<16|n[2*t];for(t=e;t<2*e;t++)n[t]=0;return new i(n,0)},t.B=function(t){return g(this,t).h},t.and=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let i=0;i<e;i++)n[i]=this.i(i)&t.i(i);return new i(n,this.h&t.h)},t.or=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let i=0;i<e;i++)n[i]=this.i(i)|t.i(i);return new i(n,this.h|t.h)},t.xor=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let i=0;i<e;i++)n[i]=this.i(i)^t.i(i);return new i(n,this.h^t.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,kr=Pr.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=s,i.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return d(t(e.substring(1),n));if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character');const i=s(Math.pow(n,8));let r=a;for(let t=0;t<e.length;t+=8){var o=Math.min(8,e.length-t);const a=parseInt(e.substring(t,t+o),n);o<8?(o=s(Math.pow(n,o)),r=r.j(o).add(s(a))):(r=r.j(i),r=r.add(s(a)))}return r},Ir=Pr.Integer=i}).apply(void 0!==Cr?Cr:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var xr,Ar,Lr,Or,Mr,Nr,Rr,Dr,jr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Fr={};(function(){var t,e=Object.defineProperty,n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof jr&&jr];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function i(t,i){if(i)t:{var r=n;t=t.split(".");for(var o=0;o<t.length-1;o++){var s=t[o];if(!(s in r))break t;r=r[s]}(i=i(o=r[t=t[t.length-1]]))!=o&&null!=i&&e(r,t,{configurable:!0,writable:!0,value:i})}}i("Symbol.dispose",function(t){return t||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(t){return t||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(t){return t||function(t){var e,n=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.push([e,t[e]]);return n}});var r=r||{},o=this||self;function s(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function c(t,e,n){return(c=a).apply(null,arguments)}function u(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function l(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Ob=function(t,n,i){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return e.prototype[n].apply(t,r)}}var h="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?t=>t&&AsyncContext.Snapshot.wrap(t):t=>t;function d(t){const e=t.length;if(e>0){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function f(t,e){for(let e=1;e<arguments.length;e++){const i=arguments[e];var n=typeof i;if("array"==(n="object"!=n?n:i?Array.isArray(i)?"array":n:"null")||"object"==n&&"number"==typeof i.length){n=t.length||0;const e=i.length||0;t.length=n+e;for(let r=0;r<e;r++)t[n+r]=i[r]}else t.push(i)}}function p(t){o.setTimeout(()=>{throw t},0)}function m(){var t=w;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var g=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return this.h>0?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new y,t=>t.reset());class y{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let v,_=!1,w=new class{constructor(){this.h=this.g=null}add(t,e){const n=g.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},b=()=>{const t=Promise.resolve(void 0);v=()=>{t.then(T)}};function T(){for(var t;t=m();){try{t.h.call(t.g)}catch(t){p(t)}var e=g;e.j(t),e.h<100&&(e.h++,t.next=e.g,e.g=t)}_=!1}function E(){this.u=this.u,this.C=this.C}function S(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}E.prototype.u=!1,E.prototype.dispose=function(){this.u||(this.u=!0,this.N())},E.prototype[Symbol.dispose]=function(){this.dispose()},E.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},S.prototype.h=function(){this.defaultPrevented=!0};var I=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};o.addEventListener("test",t,e),o.removeEventListener("test",t,e)}catch(t){}return t}();function k(t){return/^[\s\xa0]*$/.test(t)}function C(t,e){S.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t&&this.init(t,e)}l(C,S),C.prototype.init=function(t,e){const n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;this.target=t.target||t.srcElement,this.g=e,(e=t.relatedTarget)||("mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement)),this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=t.pointerType,this.state=t.state,this.i=t,t.defaultPrevented&&C.Z.h.call(this)},C.prototype.h=function(){C.Z.h.call(this);const t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var P="closure_listenable_"+(1e6*Math.random()|0),x=0;function A(t,e,n,i,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.ha=r,this.key=++x,this.da=this.fa=!1}function L(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function O(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function M(t){const e={};for(const n in t)e[n]=t[n];return e}const N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function R(t,e){let n,i;for(let e=1;e<arguments.length;e++){for(n in i=arguments[e],i)t[n]=i[n];for(let e=0;e<N.length;e++)n=N[e],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function D(t){this.src=t,this.g={},this.h=0}function j(t,e){const n=e.type;if(n in t.g){var i,r=t.g[n],o=Array.prototype.indexOf.call(r,e,void 0);(i=o>=0)&&Array.prototype.splice.call(r,o,1),i&&(L(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function F(t,e,n,i){for(let r=0;r<t.length;++r){const o=t[r];if(!o.da&&o.listener==e&&o.capture==!!n&&o.ha==i)return r}return-1}D.prototype.add=function(t,e,n,i,r){const o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);const s=F(t,e,i,r);return s>-1?(e=t[s],n||(e.fa=!1)):((e=new A(e,this.src,o,!!i,r)).fa=n,t.push(e)),e};var U="closure_lm_"+(1e6*Math.random()|0),V={};function B(t,e,n,i,r){if(i&&i.once)return G(t,e,n,i,r);if(Array.isArray(e)){for(let o=0;o<e.length;o++)B(t,e[o],n,i,r);return null}return n=Q(n),t&&t[P]?t.J(e,n,s(i)?!!i.capture:!!i,r):z(t,e,n,!1,i,r)}function z(t,e,n,i,r,o){if(!e)throw Error("Invalid event type");const a=s(r)?!!r.capture:!!r;let c=$(t);if(c||(t[U]=c=new D(t)),(n=c.add(e,n,i,a,o)).proxy)return n;if(i=function(){const t=W;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)I||(r=a),void 0===r&&(r=!1),t.addEventListener(e.toString(),i,r);else if(t.attachEvent)t.attachEvent(Z(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function G(t,e,n,i,r){if(Array.isArray(e)){for(let o=0;o<e.length;o++)G(t,e[o],n,i,r);return null}return n=Q(n),t&&t[P]?t.K(e,n,s(i)?!!i.capture:!!i,r):z(t,e,n,!0,i,r)}function q(t,e,n,i,r){if(Array.isArray(e))for(var o=0;o<e.length;o++)q(t,e[o],n,i,r);else i=s(i)?!!i.capture:!!i,n=Q(n),t&&t[P]?(t=t.i,(o=String(e).toString())in t.g&&(n=F(e=t.g[o],n,i,r))>-1&&(L(e[n]),Array.prototype.splice.call(e,n,1),0==e.length&&(delete t.g[o],t.h--))):t&&(t=$(t))&&(e=t.g[e.toString()],t=-1,e&&(t=F(e,n,i,r)),(n=t>-1?e[t]:null)&&H(n))}function H(t){if("number"!=typeof t&&t&&!t.da){var e=t.src;if(e&&e[P])j(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(Z(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=$(e))?(j(n,t),0==n.h&&(n.src=null,e[U]=null)):L(t)}}}function Z(t){return t in V?V[t]:V[t]="on"+t}function W(t,e){if(t.da)t=!0;else{e=new C(e,this);const n=t.listener,i=t.ha||t.src;t.fa&&H(t),t=n.call(i,e)}return t}function $(t){return(t=t[U])instanceof D?t:null}var K="__closure_events_fn_"+(1e9*Math.random()>>>0);function Q(t){return"function"==typeof t?t:(t[K]||(t[K]=function(e){return t.handleEvent(e)}),t[K])}function Y(){E.call(this),this.i=new D(this),this.M=this,this.G=null}function X(t,e){var n,i=t.G;if(i)for(n=[];i;i=i.G)n.push(i);if(t=t.M,i=e.type||e,"string"==typeof e)e=new S(e,t);else if(e instanceof S)e.target=e.target||t;else{var r=e;R(e=new S(i,t),r)}let o,s;if(r=!0,n)for(s=n.length-1;s>=0;s--)o=e.g=n[s],r=J(o,i,!0,e)&&r;if(o=e.g=t,r=J(o,i,!0,e)&&r,r=J(o,i,!1,e)&&r,n)for(s=0;s<n.length;s++)o=e.g=n[s],r=J(o,i,!1,e)&&r}function J(t,e,n,i){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();let r=!0;for(let o=0;o<e.length;++o){const s=e[o];if(s&&!s.da&&s.capture==n){const e=s.listener,n=s.ha||s.src;s.fa&&j(t.i,s),r=!1!==e.call(n,i)&&r}}return r&&!i.defaultPrevented}function tt(t){t.g=function(t,e){if("function"!=typeof t){if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=c(t.handleEvent,t)}return Number(e)>2147483647?-1:o.setTimeout(t,e||0)}(()=>{t.g=null,t.i&&(t.i=!1,tt(t))},t.l);const e=t.h;t.h=null,t.m.apply(null,e)}l(Y,E),Y.prototype[P]=!0,Y.prototype.removeEventListener=function(t,e,n,i){q(this,t,e,n,i)},Y.prototype.N=function(){if(Y.Z.N.call(this),this.i){var t=this.i;for(const e in t.g){const n=t.g[e];for(let t=0;t<n.length;t++)L(n[t]);delete t.g[e],t.h--}}this.G=null},Y.prototype.J=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)},Y.prototype.K=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};class et extends E{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:tt(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function nt(t){E.call(this),this.h=t,this.g={}}l(nt,E);var it=[];function rt(t){O(t.g,function(t,e){this.g.hasOwnProperty(e)&&H(t)},t),t.g={}}nt.prototype.N=function(){nt.Z.N.call(this),rt(this)},nt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ot=o.JSON.stringify,st=o.JSON.parse,at=class{stringify(t){return o.JSON.stringify(t,void 0)}parse(t){return o.JSON.parse(t,void 0)}};function ct(){}function ut(){}var lt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ht(){S.call(this,"d")}function dt(){S.call(this,"c")}l(ht,S),l(dt,S);var ft={},pt=null;function mt(){return pt=pt||new Y}function gt(t){S.call(this,ft.Ia,t)}function yt(t){const e=mt();X(e,new gt(e))}function vt(t,e){S.call(this,ft.STAT_EVENT,t),this.stat=e}function _t(t){const e=mt();X(e,new vt(e,t))}function wt(t,e){S.call(this,ft.Ja,t),this.size=e}function bt(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){t()},e)}function Tt(){this.g=!0}function Et(t,e,n,i){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{const o=JSON.parse(e);if(o)for(t=0;t<o.length;t++)if(Array.isArray(o[t])){var n=o[t];if(!(n.length<2)){var i=n[1];if(Array.isArray(i)&&!(i.length<1)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(let t=1;t<i.length;t++)i[t]=""}}}return ot(o)}catch(t){return e}}(t,n)+(i?" "+i:"")})}ft.Ia="serverreachability",l(gt,S),ft.STAT_EVENT="statevent",l(vt,S),ft.Ja="timingevent",l(wt,S),Tt.prototype.ua=function(){this.g=!1},Tt.prototype.info=function(){};var St,It={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},kt={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Ct(){}function Pt(t){return encodeURIComponent(String(t))}function xt(t){var e=1;t=t.split(":");const n=[];for(;e>0&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function At(t,e,n,i){this.j=t,this.i=e,this.l=n,this.S=i||1,this.V=new nt(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Lt}function Lt(){this.i=null,this.g="",this.h=!1}l(Ct,ct),Ct.prototype.g=function(){return new XMLHttpRequest},St=new Ct;var Ot={},Mt={};function Nt(t,e,n){t.M=1,t.A=oe(te(e)),t.u=n,t.R=!0,Rt(t,null)}function Rt(t,e){t.F=Date.now(),Ft(t),t.B=te(t.A);var n=t.B,i=t.S;Array.isArray(i)||(i=[String(i)]),_e(n.i,"t",i),t.C=0,n=t.j.L,t.h=new Lt,t.g=sn(t.j,n?e:null,!t.u),t.P>0&&(t.O=new et(c(t.Y,t,t.g),t.P)),e=t.V,n=t.g,i=t.ba;var r="readystatechange";Array.isArray(r)||(r&&(it[0]=r.toString()),r=it);for(let t=0;t<r.length;t++){const o=B(n,r[t],i||e.handleEvent,!1,e.h||e);if(!o)break;e.g[o.key]=o}e=t.J?M(t.J):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.B,t.v,t.u,e)):(t.v="GET",t.g.ea(t.B,t.v,null,e)),yt(),function(t,e,n,i,r,o){t.info(function(){if(t.g)if(o){var s="",a=o.split("&");for(let t=0;t<a.length;t++){var c=a[t].split("=");if(c.length>1){const t=c[0];c=c[1];const e=t.split("_");s=e.length>=2&&"type"==e[1]?s+(t+"=")+c+"&":s+(t+"=redacted&")}}}else s=null;else s=o;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+e+"\n"+n+"\n"+s})}(t.i,t.v,t.B,t.l,t.S,t.u)}function Dt(t){return!!t.g&&"GET"==t.v&&2!=t.M&&t.j.Aa}function jt(t,e){var n=t.C,i=e.indexOf("\n",n);return-1==i?Mt:(n=Number(e.substring(n,i)),isNaN(n)?Ot:(i+=1)+n>e.length?Mt:(e=e.slice(i,i+n),t.C=i+n,e))}function Ft(t){t.T=Date.now()+t.H,Ut(t,t.H)}function Ut(t,e){if(null!=t.D)throw Error("WatchDog timer not null");t.D=bt(c(t.aa,t),e)}function Vt(t){t.D&&(o.clearTimeout(t.D),t.D=null)}function Bt(t){0==t.j.I||t.K||tn(t.j,t)}function zt(t){Vt(t);var e=t.O;e&&"function"==typeof e.dispose&&e.dispose(),t.O=null,rt(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.dispose())}function Gt(t,e){try{var n=t.j;if(0!=n.I&&(n.g==t||$t(n.h,t)))if(!t.L&&$t(n.h,t)&&3==n.I){try{var i=n.Ba.g.parse(e)}catch(t){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){t:if(!n.v){if(n.g){if(!(n.g.F+3e3<t.F))break t;Je(n),Ge(n)}Qe(n),_t(18)}}else n.xa=r[1],0<n.xa-n.K&&r[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=bt(c(n.Va,n),6e3));Wt(n.h)<=1&&n.ta&&(n.ta=void 0)}else nn(n,11)}else if((t.L||n.g==t)&&Je(n),!k(e))for(r=n.Ba.g.parse(e),e=0;e<r.length;e++){let c=r[e];const l=c[0];if(!(l<=n.K))if(n.K=l,c=c[1],2==n.I)if("c"==c[0]){n.M=c[1],n.ba=c[2];const e=c[3];null!=e&&(n.ka=e,n.j.info("VER="+n.ka));const r=c[4];null!=r&&(n.za=r,n.j.info("SVER="+n.za));const l=c[5];null!=l&&"number"==typeof l&&l>0&&(i=1.5*l,n.O=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var o=i.h;o.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(o.j=o.l,o.g=new Set,o.h&&(Kt(o,o.h),o.h=null))}if(i.G){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(i.wa=t,re(i.J,i.G,t))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-t.F,n.j.info("Handshake RTT: "+n.T+"ms"));var s=t;if((i=n).na=on(i,i.L?i.ba:null,i.W),s.L){Qt(i.h,s);var a=s,u=i.O;u&&(a.H=u),a.D&&(Vt(a),Ft(a)),i.g=s}else Ke(i);n.i.length>0&&He(n)}else"stop"!=c[0]&&"close"!=c[0]||nn(n,7);else 3==n.I&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?nn(n,7):ze(n):"noop"!=c[0]&&n.l&&n.l.qa(c),n.A=0)}yt()}catch(t){}}At.prototype.ba=function(t){t=t.target;const e=this.O;e&&3==Fe(t)?e.j():this.Y(t)},At.prototype.Y=function(t){try{if(t==this.g)t:{const c=Fe(this.g),u=this.g.ya();if(this.g.ca(),!(c<3)&&(3!=c||this.g&&(this.h.h||this.g.la()||Ue(this.g)))){this.K||4!=c||7==u||yt(),Vt(this);var e=this.g.ca();this.X=e;var n=function(t){if(!Dt(t))return t.g.la();const e=Ue(t.g);if(""===e)return"";let n="";const i=e.length,r=4==Fe(t.g);if(!t.h.i){if("undefined"==typeof TextDecoder)return zt(t),Bt(t),"";t.h.i=new o.TextDecoder}for(let o=0;o<i;o++)t.h.h=!0,n+=t.h.i.decode(e[o],{stream:!(r&&o==i-1)});return e.length=0,t.h.g+=n,t.C=0,t.h.g}(this);if(this.o=200==e,function(t,e,n,i,r,o,s){t.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.i,this.v,this.B,this.l,this.S,c,e),this.o){if(this.U&&!this.L){e:{if(this.g){var i,r=this.g;if((i=r.g?r.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(i)){var s=i;break e}}s=null}if(!(t=s)){this.o=!1,this.m=3,_t(12),zt(this),Bt(this);break t}Et(this.i,this.l,t,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Gt(this,t)}if(this.R){let e;for(t=!0;!this.K&&this.C<n.length;){if(e=jt(this,n),e==Mt){4==c&&(this.m=4,_t(14),t=!1),Et(this.i,this.l,null,"[Incomplete Response]");break}if(e==Ot){this.m=4,_t(15),Et(this.i,this.l,n,"[Invalid Chunk]"),t=!1;break}Et(this.i,this.l,e,null),Gt(this,e)}if(Dt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=n.length||this.h.h||(this.m=1,_t(16),t=!1),this.o=this.o&&t,t){if(n.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Ye(a),a.P=!0,_t(11))}}else Et(this.i,this.l,n,"[Invalid Chunked Response]"),zt(this),Bt(this)}else Et(this.i,this.l,n,null),Gt(this,n);4==c&&zt(this),this.o&&!this.K&&(4==c?tn(this.j,this):(this.o=!1,Ft(this)))}else(function(t){const e={};t=(t.g&&Fe(t)>=2&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<t.length;i++){if(k(t[i]))continue;var n=xt(t[i]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const o=e[r]||[];e[r]=o,o.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,function(t){return t.join(", ")})})(this.g),400==e&&n.indexOf("Unknown SID")>0?(this.m=3,_t(12)):(this.m=0,_t(13)),zt(this),Bt(this)}}}catch(t){}},At.prototype.cancel=function(){this.K=!0,zt(this)},At.prototype.aa=function(){this.D=null;const t=Date.now();t-this.T>=0?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.i,this.B),2!=this.M&&(yt(),_t(17)),zt(this),this.m=2,Bt(this)):Ut(this,this.T-t)};var qt=class{constructor(t,e){this.g=t,this.map=e}};function Ht(t){this.l=t||10,t=o.PerformanceNavigationTiming?(t=o.performance.getEntriesByType("navigation")).length>0&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Zt(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Wt(t){return t.h?1:t.g?t.g.size:0}function $t(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Kt(t,e){t.g?t.g.add(e):t.h=e}function Qt(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Yt(t){if(null!=t.h)return t.i.concat(t.h.G);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.G);return e}return d(t.i)}Ht.prototype.cancel=function(){if(this.i=Yt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var Xt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Jt(t){let e;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,t instanceof Jt?(this.l=t.l,ee(this,t.j),this.o=t.o,this.g=t.g,ne(this,t.u),this.h=t.h,ie(this,we(t.i)),this.m=t.m):t&&(e=String(t).match(Xt))?(this.l=!1,ee(this,e[1]||"",!0),this.o=se(e[2]||""),this.g=se(e[3]||"",!0),ne(this,e[4]),this.h=se(e[5]||"",!0),ie(this,e[6]||"",!0),this.m=se(e[7]||"")):(this.l=!1,this.i=new pe(null,this.l))}function te(t){return new Jt(t)}function ee(t,e,n){t.j=n?se(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ne(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.u=e}else t.u=null}function ie(t,e,n){e instanceof pe?(t.i=e,function(t,e){e&&!t.j&&(me(t),t.i=null,t.g.forEach(function(t,e){const n=e.toLowerCase();e!=n&&(ge(this,e),_e(this,n,t))},t)),t.j=e}(t.i,t.l)):(n||(e=ae(e,de)),t.i=new pe(e,t.l))}function re(t,e,n){t.i.set(e,n)}function oe(t){return re(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function se(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ae(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,ce),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ce(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Jt.prototype.toString=function(){const t=[];var e=this.j;e&&t.push(ae(e,ue,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(ae(e,ue,!0),"@"),t.push(Pt(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&t.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(ae(n,"/"==n.charAt(0)?he:le,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",ae(n,fe)),t.join("")},Jt.prototype.resolve=function(t){const e=te(this);let n=!!t.j;n?ee(e,t.j):n=!!t.o,n?e.o=t.o:n=!!t.g,n?e.g=t.g:n=null!=t.u;var i=t.h;if(n)ne(e,t.u);else if(n=!!t.h){if("/"!=i.charAt(0))if(this.g&&!this.h)i="/"+i;else{var r=e.h.lastIndexOf("/");-1!=r&&(i=e.h.slice(0,r+1)+i)}if(".."==(r=i)||"."==r)i="";else if(-1!=r.indexOf("./")||-1!=r.indexOf("/.")){i=0==r.lastIndexOf("/",0),r=r.split("/");const t=[];for(let e=0;e<r.length;){const n=r[e++];"."==n?i&&e==r.length&&t.push(""):".."==n?((t.length>1||1==t.length&&""!=t[0])&&t.pop(),i&&e==r.length&&t.push("")):(t.push(n),i=!0)}i=t.join("/")}else i=r}return n?e.h=i:n=""!==t.i.toString(),n?ie(e,we(t.i)):n=!!t.m,n&&(e.m=t.m),e};var ue=/[#\/\?@]/g,le=/[#\?:]/g,he=/[#\?]/g,de=/[#\?@]/g,fe=/#/g;function pe(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function me(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(let n=0;n<t.length;n++){const i=t[n].indexOf("=");let r,o=null;i>=0?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function ge(t,e){me(t),e=be(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function ye(t,e){return me(t),e=be(t,e),t.g.has(e)}function ve(t,e){me(t);let n=[];if("string"==typeof e)ye(t,e)&&(n=n.concat(t.g.get(be(t,e))));else for(t=Array.from(t.g.values()),e=0;e<t.length;e++)n=n.concat(t[e]);return n}function _e(t,e,n){ge(t,e),n.length>0&&(t.i=null,t.g.set(be(t,e),d(n)),t.h+=n.length)}function we(t){const e=new pe;return e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),e}function be(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Te(t,e,n,i,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),i(n)}catch(t){}}function Ee(){this.g=new at}function Se(t){this.i=t.Sb||null,this.h=t.ab||!1}function Ie(t,e){Y.call(this),this.H=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function ke(t){t.j.read().then(t.Ma.bind(t)).catch(t.ga.bind(t))}function Ce(t){t.readyState=4,t.l=null,t.j=null,t.B=null,Pe(t)}function Pe(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function xe(t){let e="";return O(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}function Ae(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}i||(n=xe(n),"string"==typeof t?null!=n&&Pt(n):re(t,e,n))}function Le(t){Y.call(this),this.headers=new Map,this.L=t||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=pe.prototype).add=function(t,e){me(this),this.i=null,t=be(this,t);let n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){me(this),this.g.forEach(function(n,i){n.forEach(function(n){t.call(e,n,i,this)},this)},this)},t.set=function(t,e){return me(this),this.i=null,ye(this,t=be(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&(t=ve(this,t)).length>0?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(let i=0;i<e.length;i++){var n=e[i];const r=Pt(n);n=ve(this,n);for(let e=0;e<n.length;e++){let i=r;""!==n[e]&&(i+="="+Pt(n[e])),t.push(i)}}return this.i=t.join("&")},l(Se,ct),Se.prototype.g=function(){return new Ie(this.i,this.h)},l(Ie,Y),(t=Ie.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=t,this.D=e,this.readyState=1,Pe(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const e={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};t&&(e.body=t),(this.H||o).fetch(new Request(this.D,e)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,Ce(this)),this.readyState=0},t.Pa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Pe(this)),this.g&&(this.readyState=3,Pe(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==o.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;ke(this)}else t.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.B.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Ce(this):Pe(this),3==this.readyState&&ke(this)}},t.Oa=function(t){this.g&&(this.response=this.responseText=t,Ce(this))},t.Na=function(t){this.g&&(this.response=t,Ce(this))},t.ga=function(){this.g&&Ce(this)},t.setRequestHeader=function(t,e){this.A.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Ie.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),l(Le,Y);var Oe=/^https?$/i,Me=["POST","PUT"];function Ne(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.o=5,Re(t),je(t)}function Re(t){t.A||(t.A=!0,X(t,"complete"),X(t,"error"))}function De(t){if(t.h&&void 0!==r)if(t.v&&4==Fe(t))setTimeout(t.Ca.bind(t),0);else if(X(t,"readystatechange"),4==Fe(t)){t.h=!1;try{const r=t.ca();t:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===r){let e=String(t.D).match(Xt)[1]||null;!e&&o.self&&o.self.location&&(e=o.self.location.protocol.slice(0,-1)),i=!Oe.test(e?e.toLowerCase():"")}n=i}if(n)X(t,"complete"),X(t,"success");else{t.o=6;try{var s=Fe(t)>2?t.g.statusText:""}catch(t){s=""}t.l=s+" ["+t.ca()+"]",Re(t)}}finally{je(t)}}}function je(t,e){if(t.g){t.m&&(clearTimeout(t.m),t.m=null);const n=t.g;t.g=null,e||X(t,"ready");try{n.onreadystatechange=null}catch(t){}}}function Fe(t){return t.g?t.g.readyState:0}function Ue(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.F){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ve(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Be(t){this.za=0,this.i=[],this.j=new Tt,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ve("failFast",!1,t),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ve("baseRetryDelayMs",5e3,t),this.Za=Ve("retryDelaySeedMs",1e4,t),this.Ta=Ve("forwardChannelMaxRetries",2,t),this.va=Ve("forwardChannelRequestTimeoutMs",2e4,t),this.ma=t&&t.xmlHttpFactory||void 0,this.Ua=t&&t.Rb||void 0,this.Aa=t&&t.useFetchStreams||!1,this.O=void 0,this.L=t&&t.supportsCrossDomainXhr||!1,this.M="",this.h=new Ht(t&&t.concurrentRequestLimit),this.Ba=new Ee,this.S=t&&t.fastHandshake||!1,this.R=t&&t.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=t&&t.Pb||!1,t&&t.ua&&this.j.ua(),t&&t.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&t&&t.detectBufferingProxy||!1,this.ia=void 0,t&&t.longPollingTimeout&&t.longPollingTimeout>0&&(this.ia=t.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function ze(t){if(qe(t),3==t.I){var e=t.V++,n=te(t.J);if(re(n,"SID",t.M),re(n,"RID",e),re(n,"TYPE","terminate"),We(t,n),(e=new At(t,t.j,e)).M=2,e.A=oe(te(n)),n=!1,o.navigator&&o.navigator.sendBeacon)try{n=o.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!n&&o.Image&&((new Image).src=e.A,n=!0),n||(e.g=sn(e.j,null),e.g.ea(e.A)),e.F=Date.now(),Ft(e)}rn(t)}function Ge(t){t.g&&(Ye(t),t.g.cancel(),t.g=null)}function qe(t){Ge(t),t.v&&(o.clearTimeout(t.v),t.v=null),Je(t),t.h.cancel(),t.m&&("number"==typeof t.m&&o.clearTimeout(t.m),t.m=null)}function He(t){if(!Zt(t.h)&&!t.m){t.m=!0;var e=t.Ea;v||b(),_||(v(),_=!0),w.add(e,t),t.D=0}}function Ze(t,e){var n;n=e?e.l:t.V++;const i=te(t.J);re(i,"SID",t.M),re(i,"RID",n),re(i,"AID",t.K),We(t,i),t.u&&t.o&&Ae(i,t.u,t.o),n=new At(t,t.j,n,t.D+1),null===t.u&&(n.J=t.o),e&&(t.i=e.G.concat(t.i)),e=$e(t,n,1e3),n.H=Math.round(.5*t.va)+Math.round(.5*t.va*Math.random()),Kt(t.h,n),Nt(n,i,e)}function We(t,e){t.H&&O(t.H,function(t,n){re(e,n,t)}),t.l&&O({},function(t,n){re(e,n,t)})}function $e(t,e,n){n=Math.min(t.i.length,n);const i=t.l?c(t.l.Ka,t.l,t):null;t:{var r=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?n>0?(e=r[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let c=!0;for(let u=0;u<n;u++){var o=r[u].g;const n=r[u].map;if((o-=e)<0)e=Math.max(0,r[u].g-100),c=!1;else try{o="req"+o+"_"||0;try{var a=n instanceof Map?n:Object.entries(n);for(const[e,n]of a){let i=n;s(n)&&(i=ot(n)),t.push(o+e+"="+encodeURIComponent(i))}}catch(e){throw t.push(o+"type="+encodeURIComponent("_badmap")),e}}catch(t){i&&i(n)}}if(c){a=t.join("&");break t}}a=void 0}return t=t.i.splice(0,n),e.G=t,a}function Ke(t){if(!t.g&&!t.v){t.Y=1;var e=t.Da;v||b(),_||(v(),_=!0),w.add(e,t),t.A=0}}function Qe(t){return!(t.g||t.v||t.A>=3||(t.Y++,t.v=bt(c(t.Da,t),en(t,t.A)),t.A++,0))}function Ye(t){null!=t.B&&(o.clearTimeout(t.B),t.B=null)}function Xe(t){t.g=new At(t,t.j,"rpc",t.Y),null===t.u&&(t.g.J=t.o),t.g.P=0;var e=te(t.na);re(e,"RID","rpc"),re(e,"SID",t.M),re(e,"AID",t.K),re(e,"CI",t.F?"0":"1"),!t.F&&t.ia&&re(e,"TO",t.ia),re(e,"TYPE","xmlhttp"),We(t,e),t.u&&t.o&&Ae(e,t.u,t.o),t.O&&(t.g.H=t.O);var n=t.g;t=t.ba,n.M=1,n.A=oe(te(e)),n.u=null,n.R=!0,Rt(n,t)}function Je(t){null!=t.C&&(o.clearTimeout(t.C),t.C=null)}function tn(t,e){var n=null;if(t.g==e){Je(t),Ye(t),t.g=null;var i=2}else{if(!$t(t.h,e))return;n=e.G,Qt(t.h,e),i=1}if(0!=t.I)if(e.o)if(1==i){n=e.u?e.u.length:0,e=Date.now()-e.F;var r=t.D;X(i=mt(),new wt(i,n)),He(t)}else Ke(t);else if(3==(r=e.m)||0==r&&e.X>0||!(1==i&&function(t,e){return!(Wt(t.h)>=t.h.j-(t.m?1:0)||(t.m?(t.i=e.G.concat(t.i),0):1==t.I||2==t.I||t.D>=(t.Sa?0:t.Ta)||(t.m=bt(c(t.Ea,t,e),en(t,t.D)),t.D++,0)))}(t,e)||2==i&&Qe(t)))switch(n&&n.length>0&&(e=t.h,e.i=e.i.concat(n)),r){case 1:nn(t,5);break;case 4:nn(t,10);break;case 3:nn(t,6);break;default:nn(t,2)}}function en(t,e){let n=t.Qa+Math.floor(Math.random()*t.Za);return t.isActive()||(n*=2),n*e}function nn(t,e){if(t.j.info("Error code "+e),2==e){var n=c(t.bb,t),i=t.Ua;const e=!i;i=new Jt(i||"//www.google.com/images/cleardot.gif"),o.location&&"http"==o.location.protocol||ee(i,"https"),oe(i),e?function(t,e){const n=new Tt;if(o.Image){const i=new Image;i.onload=u(Te,n,"TestLoadImage: loaded",!0,e,i),i.onerror=u(Te,n,"TestLoadImage: error",!1,e,i),i.onabort=u(Te,n,"TestLoadImage: abort",!1,e,i),i.ontimeout=u(Te,n,"TestLoadImage: timeout",!1,e,i),o.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=t}else e(!1)}(i.toString(),n):function(t,e){new Tt;const n=new AbortController,i=setTimeout(()=>{n.abort(),Te(0,0,!1,e)},1e4);fetch(t,{signal:n.signal}).then(t=>{clearTimeout(i),t.ok?Te(0,0,!0,e):Te(0,0,!1,e)}).catch(()=>{clearTimeout(i),Te(0,0,!1,e)})}(i.toString(),n)}else _t(2);t.I=0,t.l&&t.l.pa(e),rn(t),qe(t)}function rn(t){if(t.I=0,t.ja=[],t.l){const e=Yt(t.h);0==e.length&&0==t.i.length||(f(t.ja,e),f(t.ja,t.i),t.h.i.length=0,d(t.i),t.i.length=0),t.l.oa()}}function on(t,e,n){var i=n instanceof Jt?te(n):new Jt(n);if(""!=i.g)e&&(i.g=e+"."+i.g),ne(i,i.u);else{var r=o.location;i=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;const t=new Jt(null);i&&ee(t,i),e&&(t.g=e),r&&ne(t,r),n&&(t.h=n),i=t}return n=t.G,e=t.wa,n&&e&&re(i,n,e),re(i,"VER",t.ka),We(t,i),i}function sn(t,e,n){if(e&&!t.L)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Aa&&!t.ma?new Le(new Se({ab:n})):new Le(t.ma)).Fa(t.L),e}function an(){}function cn(){}function un(t,e){Y.call(this),this.g=new Be(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.sa&&(t?t["X-WebChannel-Client-Profile"]=e.sa:t={"X-WebChannel-Client-Profile":e.sa}),this.g.U=t,(t=e&&e.Qb)&&!k(t)&&(this.g.u=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!k(e)&&(this.g.G=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new dn(this)}function ln(t){ht.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function hn(){dt.call(this),this.status=1}function dn(t){this.g=t}(t=Le.prototype).Fa=function(t){this.H=t},t.ea=function(t,e,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():St.g(),this.g.onreadystatechange=h(c(this.Ca,this));try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(t){return void Ne(this,t)}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)n.set(r,i[r]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const t of i.keys())n.set(t,i.get(t))}i=Array.from(n.keys()).find(t=>"content-type"==t.toLowerCase()),r=o.FormData&&t instanceof o.FormData,!(Array.prototype.indexOf.call(Me,e,void 0)>=0)||i||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(t){Ne(this,t)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=t||7,X(this,"complete"),X(this,"abort"),je(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),je(this,!0)),Le.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?De(this):this.Xa())},t.Xa=function(){De(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return Fe(this)>2?this.g.status:-1}catch(t){return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},t.La=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),st(e)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=Be.prototype).ka=8,t.I=1,t.connect=function(t,e,n,i){_t(0),this.W=t,this.H=e||{},n&&void 0!==i&&(this.H.OSID=n,this.H.OAID=i),this.F=this.X,this.J=on(this,null,this.W),He(this)},t.Ea=function(t){if(this.m)if(this.m=null,1==this.I){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const r=new At(this,this.j,t);let o=this.o;if(this.U&&(o?(o=M(o),R(o,this.U)):o=this.U),null!==this.u||this.R||(r.J=o,o=null),this.S)t:{for(var e=0,n=0;n<this.i.length;n++){var i=this.i[n];if(void 0===(i="__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i.length:void 0))break;if((e+=i)>4096){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=$e(this,r,e),re(n=te(this.J),"RID",t),re(n,"CVER",22),this.G&&re(n,"X-HTTP-Session-Id",this.G),We(this,n),o&&(this.R?e="headers="+Pt(xe(o))+"&"+e:this.u&&Ae(n,this.u,o)),Kt(this.h,r),this.Ra&&re(n,"TYPE","init"),this.S?(re(n,"$req",e),re(n,"SID","null"),r.U=!0,Nt(r,n,null)):Nt(r,n,e),this.I=2}}else 3==this.I&&(t?Ze(this,t):0==this.i.length||Zt(this.h)||Ze(this))},t.Da=function(){if(this.v=null,Xe(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var t=4*this.T;this.j.info("BP detection timer enabled: "+t),this.B=bt(c(this.Wa,this),t)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,_t(10),Ge(this),Xe(this))},t.Va=function(){null!=this.C&&(this.C=null,Ge(this),Qe(this),_t(19))},t.bb=function(t){t?(this.j.info("Successfully pinged google.com"),_t(2)):(this.j.info("Failed to ping google.com"),_t(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=an.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},cn.prototype.g=function(t,e){return new un(t,e)},l(un,Y),un.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},un.prototype.close=function(){ze(this.g)},un.prototype.o=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=ot(t),t=n);e.i.push(new qt(e.Ya++,t)),3==e.I&&He(e)},un.prototype.N=function(){this.g.l=null,delete this.j,ze(this.g),delete this.g,un.Z.N.call(this)},l(ln,ht),l(hn,dt),l(dn,an),dn.prototype.ra=function(){X(this.g,"a")},dn.prototype.qa=function(t){X(this.g,new ln(t))},dn.prototype.pa=function(t){X(this.g,new hn)},dn.prototype.oa=function(){X(this.g,"b")},cn.prototype.createWebChannel=cn.prototype.g,un.prototype.send=un.prototype.o,un.prototype.open=un.prototype.m,un.prototype.close=un.prototype.close,Dr=Fr.createWebChannelTransport=function(){return new cn},Rr=Fr.getStatEventTarget=function(){return mt()},Nr=Fr.Event=ft,Mr=Fr.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},It.NO_ERROR=0,It.TIMEOUT=8,It.HTTP_ERROR=6,Or=Fr.ErrorCode=It,kt.COMPLETE="complete",Lr=Fr.EventType=kt,ut.EventType=lt,lt.OPEN="a",lt.CLOSE="b",lt.ERROR="c",lt.MESSAGE="d",Y.prototype.listen=Y.prototype.J,Ar=Fr.WebChannel=ut,Fr.FetchXmlHttpFactory=Se,Le.prototype.listenOnce=Le.prototype.K,Le.prototype.getLastError=Le.prototype.Ha,Le.prototype.getLastErrorCode=Le.prototype.ya,Le.prototype.getStatus=Le.prototype.ca,Le.prototype.getResponseJson=Le.prototype.La,Le.prototype.getResponseText=Le.prototype.la,Le.prototype.send=Le.prototype.ea,Le.prototype.setWithCredentials=Le.prototype.Fa,xr=Fr.XhrIo=Le}).apply(void 0!==jr?jr:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Ur="@firebase/firestore",Vr="4.9.2";class Br{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Br.UNAUTHENTICATED=new Br(null),Br.GOOGLE_CREDENTIALS=new Br("google-credentials-uid"),Br.FIRST_PARTY=new Br("first-party-uid"),Br.MOCK_USER=new Br("mock-user");let zr="12.3.0";const Gr=new J("@firebase/firestore");function qr(){return Gr.logLevel}function Hr(t,...e){if(Gr.logLevel<=$.DEBUG){const n=e.map($r);Gr.debug(`Firestore (${zr}): ${t}`,...n)}}function Zr(t,...e){if(Gr.logLevel<=$.ERROR){const n=e.map($r);Gr.error(`Firestore (${zr}): ${t}`,...n)}}function Wr(t,...e){if(Gr.logLevel<=$.WARN){const n=e.map($r);Gr.warn(`Firestore (${zr}): ${t}`,...n)}}function $r(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Kr(t,e,n){let i="Unexpected state";"string"==typeof e?i=e:n=e,Qr(t,i,n)}function Qr(t,e,n){let i=`FIRESTORE (${zr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(void 0!==n)try{i+=" CONTEXT: "+JSON.stringify(n)}catch(t){i+=" CONTEXT: "+n}throw Zr(i),new Error(i)}function Yr(t,e,n,i){let r="Unexpected state";"string"==typeof n?r=n:i=n,t||Qr(e,r,i)}function Xr(t,e){return t}const Jr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class to extends O{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class eo{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class no{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class io{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(Br.UNAUTHENTICATED))}shutdown(){}}class ro{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class oo{constructor(t){this.t=t,this.currentUser=Br.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){Yr(void 0===this.o,42304);let n=this.i;const i=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let r=new eo;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new eo,t.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const e=r;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})},s=t=>{Hr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(t=>s(t)),setTimeout(()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?s(t):(Hr("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new eo)}},0),o()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(Hr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Yr("string"==typeof e.accessToken,31837,{l:e}),new no(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return Yr(null===t||"string"==typeof t,2055,{h:t}),new Br(t)}}class so{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=Br.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class ao{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new so(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(Br.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class co{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class uo{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,te(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){Yr(void 0===this.o,3512);const n=t=>{null!=t.error&&Hr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.m;return this.m=t.token,Hr("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>n(e))};const i=t=>{Hr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(t=>i(t)),setTimeout(()=>{if(!this.appCheck){const t=this.V.getImmediate({optional:!0});t?i(t):Hr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new co(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(t=>t?(Yr("string"==typeof t.token,44558,{tokenResult:t}),this.m=t.token,new co(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function lo(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class ho{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=lo(40);for(let i=0;i<n.length;++i)e.length<20&&n[i]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return e}}function fo(t,e){return t<e?-1:t>e?1:0}function po(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=t.charAt(i),r=e.charAt(i);if(n!==r)return yo(n)===yo(r)?fo(n,r):yo(n)?1:-1}return fo(t.length,e.length)}const mo=55296,go=57343;function yo(t){const e=t.charCodeAt(0);return e>=mo&&e<=go}function vo(t,e,n){return t.length===e.length&&t.every((t,i)=>n(t,e[i]))}const _o="__name__";class wo{constructor(t,e,n){void 0===e?e=0:e>t.length&&Kr(637,{offset:e,range:t.length}),void 0===n?n=t.length-e:n>t.length-e&&Kr(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===wo.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof wo?t.forEach(t=>{e.push(t)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=wo.compareSegments(t.get(i),e.get(i));if(0!==n)return n}return fo(t.length,e.length)}static compareSegments(t,e){const n=wo.isNumericId(t),i=wo.isNumericId(e);return n&&!i?-1:!n&&i?1:n&&i?wo.extractNumericId(t).compare(wo.extractNumericId(e)):po(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Ir.fromString(t.substring(4,t.length-2))}}class bo extends wo{construct(t,e,n){return new bo(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new to(Jr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>t.length>0))}return new bo(e)}static emptyPath(){return new bo([])}}const To=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Eo extends wo{construct(t,e,n){return new Eo(t,e,n)}static isValidIdentifier(t){return To.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Eo.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===_o}static keyField(){return new Eo([_o])}static fromServerFormat(t){const e=[];let n="",i=0;const r=()=>{if(0===n.length)throw new to(Jr.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let o=!1;for(;i<t.length;){const e=t[i];if("\\"===e){if(i+1===t.length)throw new to(Jr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[i+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new to(Jr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,i+=2}else"`"===e?(o=!o,i++):"."!==e||o?(n+=e,i++):(r(),i++)}if(r(),o)throw new to(Jr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Eo(e)}static emptyPath(){return new Eo([])}}class So{constructor(t){this.path=t}static fromPath(t){return new So(bo.fromString(t))}static fromName(t){return new So(bo.fromString(t).popFirst(5))}static empty(){return new So(bo.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===bo.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return bo.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new So(new bo(t.slice()))}}function Io(t,e,n){if(!n)throw new to(Jr.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function ko(t){if(!So.isDocumentKey(t))throw new to(Jr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Co(t){if(So.isDocumentKey(t))throw new to(Jr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Po(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function xo(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Kr(12329,{type:typeof t})}function Ao(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new to(Jr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=xo(t);throw new to(Jr.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function Lo(t,e){const n={typeString:t};return e&&(n.value=e),n}function Oo(t,e){if(!Po(t))throw new to(Jr.INVALID_ARGUMENT,"JSON must be an object");let n;for(const i in e)if(e[i]){const r=e[i].typeString,o="value"in e[i]?{value:e[i].value}:void 0;if(!(i in t)){n=`JSON missing required field: '${i}'`;break}const s=t[i];if(r&&typeof s!==r){n=`JSON field '${i}' must be a ${r}.`;break}if(void 0!==o&&s!==o.value){n=`Expected '${i}' field to equal '${o.value}'`;break}}if(n)throw new to(Jr.INVALID_ARGUMENT,n);return!0}const Mo=-62135596800,No=1e6;class Ro{static now(){return Ro.fromMillis(Date.now())}static fromDate(t){return Ro.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*No);return new Ro(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new to(Jr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new to(Jr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Mo)throw new to(Jr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new to(Jr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/No}_compareTo(t){return this.seconds===t.seconds?fo(this.nanoseconds,t.nanoseconds):fo(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ro._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Oo(t,Ro._jsonSchema))return new Ro(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-Mo;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ro._jsonSchemaVersion="firestore/timestamp/1.0",Ro._jsonSchema={type:Lo("string",Ro._jsonSchemaVersion),seconds:Lo("number"),nanoseconds:Lo("number")};class Do{static fromTimestamp(t){return new Do(t)}static min(){return new Do(new Ro(0,0))}static max(){return new Do(new Ro(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function jo(t){return new Fo(t.readTime,t.key,-1)}class Fo{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Fo(Do.min(),So.empty(),-1)}static max(){return new Fo(Do.max(),So.empty(),-1)}}function Uo(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=So.comparator(t.documentKey,e.documentKey),0!==n?n:fo(t.largestBatchId,e.largestBatchId))}class Vo{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}async function Bo(t){if(t.code!==Jr.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;Hr("LocalStore","Unexpectedly lost primary lease")}class zo{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Kr(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new zo((n,i)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,i)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof zo?e:zo.resolve(e)}catch(t){return zo.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):zo.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):zo.reject(e)}static resolve(t){return new zo((e,n)=>{e(t)})}static reject(t){return new zo((e,n)=>{n(t)})}static waitFor(t){return new zo((e,n)=>{let i=0,r=0,o=!1;t.forEach(t=>{++i,t.next(()=>{++r,o&&r===i&&e()},t=>n(t))}),o=!0,r===i&&e()})}static or(t){let e=zo.resolve(!1);for(const n of t)e=e.next(t=>t?zo.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,i)=>{n.push(e.call(this,t,i))}),this.waitFor(n)}static mapArray(t,e){return new zo((n,i)=>{const r=t.length,o=new Array(r);let s=0;for(let a=0;a<r;a++){const c=a;e(t[c]).next(t=>{o[c]=t,++s,s===r&&n(o)},t=>i(t))}})}static doWhile(t,e){return new zo((n,i)=>{const r=()=>{!0===t()?e().next(()=>{r()},i):n()};r()})}}function Go(t){return"IndexedDbTransactionError"===t.name}class qo{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ae(t),this.ue=t=>e.writeSequenceNumber(t))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}qo.ce=-1;function Ho(t){return null==t}function Zo(t){return 0===t&&1/t==-1/0}function Wo(t,e){let n=e;const i=t.length;for(let e=0;e<i;e++){const i=t.charAt(e);switch(i){case"\0":n+="";break;case"":n+="";break;default:n+=i}}return n}function $o(t){return t+""}const Ko="owner",Qo="mutationQueues",Yo="mutations",Xo="documentMutations",Jo="remoteDocumentGlobal",ts="targets",es="targetDocuments",ns="targetGlobal",is="collectionParents",rs="clientMetadata",os="bundles",ss="namedQueries";function as(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function cs(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function us(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class ls{constructor(t,e){this.comparator=t,this.root=e||ds.EMPTY}insert(t,e){return new ls(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ds.BLACK,null,null))}remove(t){return new ls(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ds.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new hs(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new hs(this.root,t,this.comparator,!1)}getReverseIterator(){return new hs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new hs(this.root,t,this.comparator,!0)}}class hs{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?n(t.key,e):1,e&&i&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(0===r){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class ds{constructor(t,e,n,i,r){this.key=t,this.value=e,this.color=null!=n?n:ds.RED,this.left=null!=i?i:ds.EMPTY,this.right=null!=r?r:ds.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,r){return new ds(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const r=n(t,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return ds.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return ds.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,ds.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,ds.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Kr(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Kr(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw Kr(27949);return t+(this.isRed()?0:1)}}ds.EMPTY=null,ds.RED=!0,ds.BLACK=!1,ds.EMPTY=new class{constructor(){this.size=0}get key(){throw Kr(57766)}get value(){throw Kr(16141)}get color(){throw Kr(16727)}get left(){throw Kr(29726)}get right(){throw Kr(36894)}copy(t,e,n,i,r){return this}insert(t,e,n){return new ds(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class fs{constructor(t){this.comparator=t,this.data=new ls(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new ps(this.data.getIterator())}getIteratorFrom(t){return new ps(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof fs))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(t,i))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new fs(this.comparator);return e.data=t,e}}class ps{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ms{constructor(t){this.fields=t,t.sort(Eo.comparator)}static empty(){return new ms([])}unionWith(t){let e=new fs(Eo.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new ms(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return vo(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class gs extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ys{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new gs("Invalid base64 string: "+t):t}}(t);return new ys(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new ys(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return fo(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ys.EMPTY_BYTE_STRING=new ys("");const vs=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _s(t){if(Yr(!!t,39018),"string"==typeof t){let e=0;const n=vs.exec(t);if(Yr(!!n,46558,{timestamp:t}),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ws(t.seconds),nanos:ws(t.nanos)}}function ws(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function bs(t){return"string"==typeof t?ys.fromBase64String(t):ys.fromUint8Array(t)}const Ts="server_timestamp",Es="__type__",Ss="__previous_value__",Is="__local_write_time__";function ks(t){const e=(t?.mapValue?.fields||{})[Es]?.stringValue;return e===Ts}function Cs(t){const e=t.mapValue.fields[Ss];return ks(e)?Cs(e):e}function Ps(t){const e=_s(t.mapValue.fields[Is].timestampValue);return new Ro(e.seconds,e.nanos)}class xs{constructor(t,e,n,i,r,o,s,a,c,u){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const As="(default)";class Ls{constructor(t,e){this.projectId=t,this.database=e||As}static empty(){return new Ls("","")}get isDefaultDatabase(){return this.database===As}isEqual(t){return t instanceof Ls&&t.projectId===this.projectId&&t.database===this.database}}const Os="__type__",Ms="__max__",Ns={fields:{__type__:{stringValue:Ms}}},Rs="__vector__",Ds="value";function js(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ks(t)?4:ta(t)?9007199254740991:Xs(t)?10:11:Kr(28295,{value:t})}function Fs(t,e){if(t===e)return!0;const n=js(t);if(n!==js(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ps(t).isEqual(Ps(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=_s(t.timestampValue),i=_s(e.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return bs(t.bytesValue).isEqual(bs(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ws(t.geoPointValue.latitude)===ws(e.geoPointValue.latitude)&&ws(t.geoPointValue.longitude)===ws(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ws(t.integerValue)===ws(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=ws(t.doubleValue),i=ws(e.doubleValue);return n===i?Zo(n)===Zo(i):isNaN(n)&&isNaN(i)}return!1}(t,e);case 9:return vo(t.arrayValue.values||[],e.arrayValue.values||[],Fs);case 10:case 11:return function(t,e){const n=t.mapValue.fields||{},i=e.mapValue.fields||{};if(as(n)!==as(i))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===i[t]||!Fs(n[t],i[t])))return!1;return!0}(t,e);default:return Kr(52216,{left:t})}}function Us(t,e){return void 0!==(t.values||[]).find(t=>Fs(t,e))}function Vs(t,e){if(t===e)return 0;const n=js(t),i=js(e);if(n!==i)return fo(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return fo(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=ws(t.integerValue||t.doubleValue),i=ws(e.integerValue||e.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(t,e);case 3:return Bs(t.timestampValue,e.timestampValue);case 4:return Bs(Ps(t),Ps(e));case 5:return po(t.stringValue,e.stringValue);case 6:return function(t,e){const n=bs(t),i=bs(e);return n.compareTo(i)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),i=e.split("/");for(let t=0;t<n.length&&t<i.length;t++){const e=fo(n[t],i[t]);if(0!==e)return e}return fo(n.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=fo(ws(t.latitude),ws(e.latitude));return 0!==n?n:fo(ws(t.longitude),ws(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return zs(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},i=e.fields||{},r=n[Ds]?.arrayValue,o=i[Ds]?.arrayValue,s=fo(r?.values?.length||0,o?.values?.length||0);return 0!==s?s:zs(r,o)}(t.mapValue,e.mapValue);case 11:return function(t,e){if(t===Ns&&e===Ns)return 0;if(t===Ns)return 1;if(e===Ns)return-1;const n=t.fields||{},i=Object.keys(n),r=e.fields||{},o=Object.keys(r);i.sort(),o.sort();for(let t=0;t<i.length&&t<o.length;++t){const e=po(i[t],o[t]);if(0!==e)return e;const s=Vs(n[i[t]],r[o[t]]);if(0!==s)return s}return fo(i.length,o.length)}(t.mapValue,e.mapValue);default:throw Kr(23264,{he:n})}}function Bs(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return fo(t,e);const n=_s(t),i=_s(e),r=fo(n.seconds,i.seconds);return 0!==r?r:fo(n.nanos,i.nanos)}function zs(t,e){const n=t.values||[],i=e.values||[];for(let t=0;t<n.length&&t<i.length;++t){const e=Vs(n[t],i[t]);if(e)return e}return fo(n.length,i.length)}function Gs(t){return qs(t)}function qs(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=_s(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return bs(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return So.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const i of t.values||[])n?n=!1:e+=",",e+=qs(i);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",i=!0;for(const r of e)i?i=!1:n+=",",n+=`${r}:${qs(t.fields[r])}`;return n+"}"}(t.mapValue):Kr(61005,{value:t})}function Hs(t){switch(js(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Cs(t);return e?16+Hs(e):16;case 5:return 2*t.stringValue.length;case 6:return bs(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(t){return(t.values||[]).reduce((t,e)=>t+Hs(e),0)}(t.arrayValue);case 10:case 11:return function(t){let e=0;return cs(t.fields,(t,n)=>{e+=t.length+Hs(n)}),e}(t.mapValue);default:throw Kr(13486,{value:t})}}function Zs(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Ws(t){return!!t&&"integerValue"in t}function $s(t){return!!t&&"arrayValue"in t}function Ks(t){return!!t&&"nullValue"in t}function Qs(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ys(t){return!!t&&"mapValue"in t}function Xs(t){const e=(t?.mapValue?.fields||{})[Os]?.stringValue;return e===Rs}function Js(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return cs(t.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Js(n)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Js(t.arrayValue.values[n]);return e}return{...t}}function ta(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===Ms}class ea{constructor(t){this.value=t}static empty(){return new ea({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Ys(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Js(e)}setAll(t){let e=Eo.emptyPath(),n={},i=[];t.forEach((t,r)=>{if(!e.isImmediateParentOf(r)){const t=this.getFieldsMap(e);this.applyChanges(t,n,i),n={},i=[],e=r.popLast()}t?n[r.lastSegment()]=Js(t):i.push(r.lastSegment())});const r=this.getFieldsMap(e);this.applyChanges(r,n,i)}delete(t){const e=this.field(t.popLast());Ys(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Fs(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];Ys(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){cs(e,(e,n)=>t[e]=n);for(const e of n)delete t[e]}clone(){return new ea(Js(this.value))}}function na(t){const e=[];return cs(t.fields,(t,n)=>{const i=new Eo([t]);if(Ys(n)){const t=na(n.mapValue).fields;if(0===t.length)e.push(i);else for(const n of t)e.push(i.child(n))}else e.push(i)}),new ms(e)}class ia{constructor(t,e,n,i,r,o,s){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=r,this.data=o,this.documentState=s}static newInvalidDocument(t){return new ia(t,0,Do.min(),Do.min(),Do.min(),ea.empty(),0)}static newFoundDocument(t,e,n,i){return new ia(t,1,e,Do.min(),n,i,0)}static newNoDocument(t,e){return new ia(t,2,e,Do.min(),Do.min(),ea.empty(),0)}static newUnknownDocument(t,e){return new ia(t,3,e,Do.min(),Do.min(),ea.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Do.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ea.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ea.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Do.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof ia&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ia(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ra{constructor(t,e){this.position=t,this.inclusive=e}}function oa(t,e,n){let i=0;for(let r=0;r<t.position.length;r++){const o=e[r],s=t.position[r];if(i=o.field.isKeyField()?So.comparator(So.fromName(s.referenceValue),n.key):Vs(s,n.data.field(o.field)),"desc"===o.dir&&(i*=-1),0!==i)break}return i}function sa(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Fs(t.position[n],e.position[n]))return!1;return!0}class aa{constructor(t,e="asc"){this.field=t,this.dir=e}}function ca(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class ua{}class la extends ua{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new ya(t,e,n):"array-contains"===e?new ba(t,n):"in"===e?new Ta(t,n):"not-in"===e?new Ea(t,n):"array-contains-any"===e?new Sa(t,n):new la(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new va(t,n):new _a(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&void 0===e.nullValue&&this.matchesComparison(Vs(e,this.value)):null!==e&&js(this.value)===js(e)&&this.matchesComparison(Vs(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Kr(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ha extends ua{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new ha(t,e)}matches(t){return da(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function da(t){return"and"===t.op}function fa(t){return function(t){for(const e of t.filters)if(e instanceof ha)return!1;return!0}(t)&&da(t)}function pa(t){if(t instanceof la)return t.field.canonicalString()+t.op.toString()+Gs(t.value);if(fa(t))return t.filters.map(t=>pa(t)).join(",");{const e=t.filters.map(t=>pa(t)).join(",");return`${t.op}(${e})`}}function ma(t,e){return t instanceof la?function(t,e){return e instanceof la&&t.op===e.op&&t.field.isEqual(e.field)&&Fs(t.value,e.value)}(t,e):t instanceof ha?function(t,e){return e instanceof ha&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce((t,n,i)=>t&&ma(n,e.filters[i]),!0)}(t,e):void Kr(19439)}function ga(t){return t instanceof la?function(t){return`${t.field.canonicalString()} ${t.op} ${Gs(t.value)}`}(t):t instanceof ha?function(t){return t.op.toString()+" {"+t.getFilters().map(ga).join(" ,")+"}"}(t):"Filter"}class ya extends la{constructor(t,e,n){super(t,e,n),this.key=So.fromName(n.referenceValue)}matches(t){const e=So.comparator(t.key,this.key);return this.matchesComparison(e)}}class va extends la{constructor(t,e){super(t,"in",e),this.keys=wa(0,e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class _a extends la{constructor(t,e){super(t,"not-in",e),this.keys=wa(0,e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function wa(t,e){return(e.arrayValue?.values||[]).map(t=>So.fromName(t.referenceValue))}class ba extends la{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return $s(e)&&Us(e.arrayValue,this.value)}}class Ta extends la{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Us(this.value.arrayValue,e)}}class Ea extends la{constructor(t,e){super(t,"not-in",e)}matches(t){if(Us(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&void 0===e.nullValue&&!Us(this.value.arrayValue,e)}}class Sa extends la{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!$s(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>Us(this.value.arrayValue,t))}}class Ia{constructor(t,e=null,n=[],i=[],r=null,o=null,s=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=o,this.endAt=s,this.Te=null}}function ka(t,e=null,n=[],i=[],r=null,o=null,s=null){return new Ia(t,e,n,i,r,o,s)}function Ca(t){const e=Xr(t);if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>pa(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>function(t){return t.field.canonicalString()+t.dir}(t)).join(","),Ho(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(t=>Gs(t)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(t=>Gs(t)).join(",")),e.Te=t}return e.Te}function Pa(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!ca(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!ma(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!sa(t.startAt,e.startAt)&&sa(t.endAt,e.endAt)}function xa(t){return So.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Aa{constructor(t,e=null,n=[],i=[],r=null,o="F",s=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=o,this.startAt=s,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function La(t){return new Aa(t)}function Oa(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Ma(t){return null!==t.collectionGroup}function Na(t){const e=Xr(t);if(null===e.Ie){e.Ie=[];const t=new Set;for(const n of e.explicitOrderBy)e.Ie.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",i=function(t){let e=new fs(Eo.comparator);return t.filters.forEach(t=>{t.getFlattenedFilters().forEach(t=>{t.isInequality()&&(e=e.add(t.field))})}),e}(e);i.forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new aa(i,n))}),t.has(Eo.keyField().canonicalString())||e.Ie.push(new aa(Eo.keyField(),n))}return e.Ie}function Ra(t){const e=Xr(t);return e.Ee||(e.Ee=function(t,e){if("F"===t.limitType)return ka(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(t=>{const e="desc"===t.dir?"asc":"desc";return new aa(t.field,e)});const n=t.endAt?new ra(t.endAt.position,t.endAt.inclusive):null,i=t.startAt?new ra(t.startAt.position,t.startAt.inclusive):null;return ka(t.path,t.collectionGroup,e,t.filters,t.limit,n,i)}}(e,Na(t))),e.Ee}function Da(t,e){const n=t.filters.concat([e]);return new Aa(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function ja(t,e,n){return new Aa(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Fa(t,e){return Pa(Ra(t),Ra(e))&&t.limitType===e.limitType}function Ua(t){return`${Ca(Ra(t))}|lt:${t.limitType}`}function Va(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>ga(t)).join(", ")}]`),Ho(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t)).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(t=>Gs(t)).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(t=>Gs(t)).join(",")),`Target(${e})`}(Ra(t))}; limitType=${t.limitType})`}function Ba(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):So.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Na(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const i=oa(t,e,n);return t.inclusive?i<=0:i<0}(t.startAt,Na(t),e)||t.endAt&&!function(t,e,n){const i=oa(t,e,n);return t.inclusive?i>=0:i>0}(t.endAt,Na(t),e))}(t,e)}function za(t){return(e,n)=>{let i=!1;for(const r of Na(t)){const t=Ga(r,e,n);if(0!==t)return t;i=i||r.field.isKeyField()}return 0}}function Ga(t,e,n){const i=t.field.isKeyField()?So.comparator(e.key,n.key):function(t,e,n){const i=e.data.field(t),r=n.data.field(t);return null!==i&&null!==r?Vs(i,r):Kr(42886)}(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return Kr(19790,{direction:t.dir})}}class qa{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,i]of n)if(this.equalsFn(e,t))return i}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(void 0===i)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return void(i[n]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return 1===n.length?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){cs(this.inner,(e,n)=>{for(const[e,i]of n)t(e,i)})}isEmpty(){return us(this.inner)}size(){return this.innerSize}}const Ha=new ls(So.comparator);function Za(){return Ha}const Wa=new ls(So.comparator);function $a(...t){let e=Wa;for(const n of t)e=e.insert(n.key,n);return e}function Ka(t){let e=Wa;return t.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Qa(){return Xa()}function Ya(){return Xa()}function Xa(){return new qa(t=>t.toString(),(t,e)=>t.isEqual(e))}const Ja=new ls(So.comparator),tc=new fs(So.comparator);function ec(...t){let e=tc;for(const n of t)e=e.add(n);return e}const nc=new fs(fo);function ic(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Zo(e)?"-0":e}}function rc(t){return{integerValue:""+t}}function oc(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!Zo(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?rc(e):ic(t,e)}class sc{constructor(){this._=void 0}}function ac(t,e,n){return t instanceof lc?function(t,e){const n={fields:{[Es]:{stringValue:Ts},[Is]:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&ks(e)&&(e=Cs(e)),e&&(n.fields[Ss]=e),{mapValue:n}}(n,e):t instanceof hc?dc(t,e):t instanceof fc?pc(t,e):function(t,e){const n=uc(t,e),i=gc(n)+gc(t.Ae);return Ws(n)&&Ws(t.Ae)?rc(i):ic(t.serializer,i)}(t,e)}function cc(t,e,n){return t instanceof hc?dc(t,e):t instanceof fc?pc(t,e):n}function uc(t,e){return t instanceof mc?function(t){return Ws(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class lc extends sc{}class hc extends sc{constructor(t){super(),this.elements=t}}function dc(t,e){const n=yc(e);for(const e of t.elements)n.some(t=>Fs(t,e))||n.push(e);return{arrayValue:{values:n}}}class fc extends sc{constructor(t){super(),this.elements=t}}function pc(t,e){let n=yc(e);for(const e of t.elements)n=n.filter(t=>!Fs(t,e));return{arrayValue:{values:n}}}class mc extends sc{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function gc(t){return ws(t.integerValue||t.doubleValue)}function yc(t){return $s(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class vc{constructor(t,e){this.field=t,this.transform=e}}class _c{constructor(t,e){this.version=t,this.transformResults=e}}class wc{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new wc}static exists(t){return new wc(void 0,t)}static updateTime(t){return new wc(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function bc(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Tc{}function Ec(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Mc(t.key,wc.none()):new Pc(t.key,t.data,wc.none());{const n=t.data,i=ea.empty();let r=new fs(Eo.comparator);for(let t of e.fields)if(!r.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?i.delete(t):i.set(t,e),r=r.add(t)}return new xc(t.key,i,new ms(r.toArray()),wc.none())}}function Sc(t,e,n){t instanceof Pc?function(t,e,n){const i=t.value.clone(),r=Lc(t.fieldTransforms,e,n.transformResults);i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):t instanceof xc?function(t,e,n){if(!bc(t.precondition,e))return void e.convertToUnknownDocument(n.version);const i=Lc(t.fieldTransforms,e,n.transformResults),r=e.data;r.setAll(Ac(t)),r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Ic(t,e,n,i){return t instanceof Pc?function(t,e,n,i){if(!bc(t.precondition,e))return n;const r=t.value.clone(),o=Oc(t.fieldTransforms,i,e);return r.setAll(o),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null}(t,e,n,i):t instanceof xc?function(t,e,n,i){if(!bc(t.precondition,e))return n;const r=Oc(t.fieldTransforms,i,e),o=e.data;return o.setAll(Ac(t)),o.setAll(r),e.convertToFoundDocument(e.version,o).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map(t=>t.field))}(t,e,n,i):function(t,e,n){return bc(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function kc(t,e){let n=null;for(const i of t.fieldTransforms){const t=e.data.field(i.field),r=uc(i.transform,t||null);null!=r&&(null===n&&(n=ea.empty()),n.set(i.field,r))}return n||null}function Cc(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&vo(t,e,(t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof hc&&e instanceof hc||t instanceof fc&&e instanceof fc?vo(t.elements,e.elements,Fs):t instanceof mc&&e instanceof mc?Fs(t.Ae,e.Ae):t instanceof lc&&e instanceof lc}(t.transform,e.transform)}(t,e))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Pc extends Tc{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class xc extends Tc{constructor(t,e,n,i,r=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function Ac(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}}),e}function Lc(t,e,n){const i=new Map;Yr(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let r=0;r<n.length;r++){const o=t[r],s=o.transform,a=e.data.field(o.field);i.set(o.field,cc(s,a,n[r]))}return i}function Oc(t,e,n){const i=new Map;for(const r of t){const t=r.transform,o=n.data.field(r.field);i.set(r.field,ac(t,o,e))}return i}class Mc extends Tc{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Nc extends Tc{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Rc{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const i=this.mutations[e];i.key.isEqual(t.key)&&Sc(i,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Ic(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Ic(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Ya();return this.mutations.forEach(i=>{const r=t.get(i.key),o=r.overlayedDocument;let s=this.applyToLocalView(o,r.mutatedFields);s=e.has(i.key)?null:s;const a=Ec(o,s);null!==a&&n.set(i.key,a),o.isValidDocument()||o.convertToNoDocument(Do.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),ec())}isEqual(t){return this.batchId===t.batchId&&vo(this.mutations,t.mutations,(t,e)=>Cc(t,e))&&vo(this.baseMutations,t.baseMutations,(t,e)=>Cc(t,e))}}class Dc{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){Yr(t.mutations.length===n.length,58842,{me:t.mutations.length,fe:n.length});let i=Ja;const r=t.mutations;for(let t=0;t<r.length;t++)i=i.insert(r[t].key,n[t].version);return new Dc(t,e,n,i)}}class jc{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Fc{constructor(t,e){this.count=t,this.unchangedNames=e}}var Uc,Vc;function Bc(t){if(void 0===t)return Zr("GRPC error has no .code"),Jr.UNKNOWN;switch(t){case Uc.OK:return Jr.OK;case Uc.CANCELLED:return Jr.CANCELLED;case Uc.UNKNOWN:return Jr.UNKNOWN;case Uc.DEADLINE_EXCEEDED:return Jr.DEADLINE_EXCEEDED;case Uc.RESOURCE_EXHAUSTED:return Jr.RESOURCE_EXHAUSTED;case Uc.INTERNAL:return Jr.INTERNAL;case Uc.UNAVAILABLE:return Jr.UNAVAILABLE;case Uc.UNAUTHENTICATED:return Jr.UNAUTHENTICATED;case Uc.INVALID_ARGUMENT:return Jr.INVALID_ARGUMENT;case Uc.NOT_FOUND:return Jr.NOT_FOUND;case Uc.ALREADY_EXISTS:return Jr.ALREADY_EXISTS;case Uc.PERMISSION_DENIED:return Jr.PERMISSION_DENIED;case Uc.FAILED_PRECONDITION:return Jr.FAILED_PRECONDITION;case Uc.ABORTED:return Jr.ABORTED;case Uc.OUT_OF_RANGE:return Jr.OUT_OF_RANGE;case Uc.UNIMPLEMENTED:return Jr.UNIMPLEMENTED;case Uc.DATA_LOSS:return Jr.DATA_LOSS;default:return Kr(39323,{code:t})}}(Vc=Uc||(Uc={}))[Vc.OK=0]="OK",Vc[Vc.CANCELLED=1]="CANCELLED",Vc[Vc.UNKNOWN=2]="UNKNOWN",Vc[Vc.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Vc[Vc.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Vc[Vc.NOT_FOUND=5]="NOT_FOUND",Vc[Vc.ALREADY_EXISTS=6]="ALREADY_EXISTS",Vc[Vc.PERMISSION_DENIED=7]="PERMISSION_DENIED",Vc[Vc.UNAUTHENTICATED=16]="UNAUTHENTICATED",Vc[Vc.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Vc[Vc.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Vc[Vc.ABORTED=10]="ABORTED",Vc[Vc.OUT_OF_RANGE=11]="OUT_OF_RANGE",Vc[Vc.UNIMPLEMENTED=12]="UNIMPLEMENTED",Vc[Vc.INTERNAL=13]="INTERNAL",Vc[Vc.UNAVAILABLE=14]="UNAVAILABLE",Vc[Vc.DATA_LOSS=15]="DATA_LOSS";const zc=new Ir([4294967295,4294967295],0);function Gc(t){const e=(new TextEncoder).encode(t),n=new kr;return n.update(e),new Uint8Array(n.digest())}function qc(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Ir([n,i],0),new Ir([r,o],0)]}class Hc{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Zc(`Invalid padding: ${e}`);if(n<0)throw new Zc(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Zc(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Zc(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=Ir.fromNumber(this.ge)}ye(t,e,n){let i=t.add(e.multiply(Ir.fromNumber(n)));return 1===i.compare(zc)&&(i=new Ir([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.ge)return!1;const e=Gc(t),[n,i]=qc(e);for(let t=0;t<this.hashCount;t++){const e=this.ye(n,i,t);if(!this.we(e))return!1}return!0}static create(t,e,n){const i=t%8==0?0:8-t%8,r=new Uint8Array(Math.ceil(t/8)),o=new Hc(r,i,e);return n.forEach(t=>o.insert(t)),o}insert(t){if(0===this.ge)return;const e=Gc(t),[n,i]=qc(e);for(let t=0;t<this.hashCount;t++){const e=this.ye(n,i,t);this.Se(e)}}Se(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Zc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Wc{constructor(t,e,n,i,r){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const i=new Map;return i.set(t,$c.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Wc(Do.min(),i,new ls(fo),Za(),ec())}}class $c{constructor(t,e,n,i,r){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new $c(n,e,ec(),ec(),ec())}}class Kc{constructor(t,e,n,i){this.be=t,this.removedTargetIds=e,this.key=n,this.De=i}}class Qc{constructor(t,e){this.targetId=t,this.Ce=e}}class Yc{constructor(t,e,n=ys.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}}class Xc{constructor(){this.ve=0,this.Fe=eu(),this.Me=ys.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=ec(),e=ec(),n=ec();return this.Fe.forEach((i,r)=>{switch(r){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:Kr(38017,{changeType:r})}}),new $c(this.Me,this.xe,t,e,n)}qe(){this.Oe=!1,this.Fe=eu()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,Yr(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Jc{constructor(t){this.Ge=t,this.ze=new Map,this.je=Za(),this.Je=tu(),this.He=tu(),this.Ye=new ls(fo)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,e=>{const n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(t.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.We(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:Kr(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach((t,n)=>{this.rt(n)&&e(n)})}st(t){const e=t.targetId,n=t.Ce.count,i=this.ot(e);if(i){const r=i.target;if(xa(r))if(0===n){const t=new So(r.path);this.et(e,t,ia.newNoDocument(t,Do.min()))}else Yr(1===n,20013,{expectedCount:n});else{const i=this._t(e);if(i!==n){const n=this.ut(t),r=n?this.ct(n,t,i):1;if(0!==r){this.it(e);const t=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,t)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:r=0}=e;let o,s;try{o=bs(n).toUint8Array()}catch(t){if(t instanceof gs)return Wr("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{s=new Hc(o,i,r)}catch(t){return Wr(t instanceof Zc?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===s.ge?null:s}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){const n=this.Ge.getRemoteKeysForTarget(e);let i=0;return n.forEach(n=>{const r=this.Ge.ht(),o=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;t.mightContain(o)||(this.et(e,n,null),i++)}),i}Tt(t){const e=new Map;this.ze.forEach((n,i)=>{const r=this.ot(i);if(r){if(n.current&&xa(r.target)){const e=new So(r.target.path);this.It(e).has(i)||this.Et(i,e)||this.et(i,e,ia.newNoDocument(e,t))}n.Be&&(e.set(i,n.ke()),n.qe())}});let n=ec();this.He.forEach((t,e)=>{let i=!0;e.forEachWhile(t=>{const e=this.ot(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(i=!1,!1)}),i&&(n=n.add(t))}),this.je.forEach((e,n)=>n.setReadTime(t));const i=new Wc(t,e,this.Ye,this.je,n);return this.je=Za(),this.Je=tu(),this.He=tu(),this.Ye=new ls(fo),i}Xe(t,e){if(!this.rt(t))return;const n=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,n),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;const i=this.nt(t);this.Et(t,e)?i.Qe(e,1):i.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new Xc,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new fs(fo),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new fs(fo),this.Je=this.Je.insert(t,e)),e}rt(t){const e=null!==this.ot(t);return e||Hr("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new Xc),this.Ge.getRemoteKeysForTarget(t).forEach(e=>{this.et(t,e,null)})}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function tu(){return new ls(So.comparator)}function eu(){return new ls(So.comparator)}const nu={asc:"ASCENDING",desc:"DESCENDING"},iu={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ru={and:"AND",or:"OR"};class ou{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function su(t,e){return t.useProto3Json||Ho(e)?e:{value:e}}function au(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function cu(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function uu(t,e){return au(t,e.toTimestamp())}function lu(t){return Yr(!!t,49232),Do.fromTimestamp(function(t){const e=_s(t);return new Ro(e.seconds,e.nanos)}(t))}function hu(t,e){return du(t,e).canonicalString()}function du(t,e){const n=function(t){return new bo(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function fu(t){const e=bo.fromString(t);return Yr(Lu(e),10190,{key:e.toString()}),e}function pu(t,e){return hu(t.databaseId,e.path)}function mu(t,e){const n=fu(e);if(n.get(1)!==t.databaseId.projectId)throw new to(Jr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new to(Jr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new So(vu(n))}function gu(t,e){return hu(t.databaseId,e)}function yu(t){return new bo(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function vu(t){return Yr(t.length>4&&"documents"===t.get(4),29091,{key:t.toString()}),t.popFirst(5)}function _u(t,e,n){return{name:pu(t,e),fields:n.value.mapValue.fields}}function wu(t,e){return{documents:[gu(t,e.path)]}}function bu(t,e){const n={structuredQuery:{}},i=e.path;let r;null!==e.collectionGroup?(r=i,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=gu(t,r);const o=function(t){if(0!==t.length)return xu(ha.create(t,"and"))}(e.filters);o&&(n.structuredQuery.where=o);const s=function(t){if(0!==t.length)return t.map(t=>function(t){return{field:Cu(t.field),direction:Su(t.dir)}}(t))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const a=su(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ft:n,parent:r}}function Tu(t){let e=function(t){const e=fu(t);return 4===e.length?bo.emptyPath():vu(e)}(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let r=null;if(i>0){Yr(1===i,65062);const t=n.from[0];t.allDescendants?r=t.collectionId:e=e.child(t.collectionId)}let o=[];n.where&&(o=function(t){const e=Eu(t);return e instanceof ha&&fa(e)?e.getFilters():[e]}(n.where));let s=[];n.orderBy&&(s=function(t){return t.map(t=>function(t){return new aa(Pu(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Ho(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new ra(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new ra(n,e)}(n.endAt)),function(t,e,n,i,r,o,s,a){return new Aa(t,e,n,i,r,o,s,a)}(e,r,s,o,a,"F",c,u)}function Eu(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Pu(t.unaryFilter.field);return la.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Pu(t.unaryFilter.field);return la.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Pu(t.unaryFilter.field);return la.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Pu(t.unaryFilter.field);return la.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Kr(61313);default:return Kr(60726)}}(t):void 0!==t.fieldFilter?function(t){return la.create(Pu(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Kr(58110);default:return Kr(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return ha.create(t.compositeFilter.filters.map(t=>Eu(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Kr(1026)}}(t.compositeFilter.op))}(t):Kr(30097,{filter:t})}function Su(t){return nu[t]}function Iu(t){return iu[t]}function ku(t){return ru[t]}function Cu(t){return{fieldPath:t.canonicalString()}}function Pu(t){return Eo.fromServerFormat(t.fieldPath)}function xu(t){return t instanceof la?function(t){if("=="===t.op){if(Qs(t.value))return{unaryFilter:{field:Cu(t.field),op:"IS_NAN"}};if(Ks(t.value))return{unaryFilter:{field:Cu(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Qs(t.value))return{unaryFilter:{field:Cu(t.field),op:"IS_NOT_NAN"}};if(Ks(t.value))return{unaryFilter:{field:Cu(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Cu(t.field),op:Iu(t.op),value:t.value}}}(t):t instanceof ha?function(t){const e=t.getFilters().map(t=>xu(t));return 1===e.length?e[0]:{compositeFilter:{op:ku(t.op),filters:e}}}(t):Kr(54877,{filter:t})}function Au(t){const e=[];return t.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Lu(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Ou{constructor(t,e,n,i,r=Do.min(),o=Do.min(),s=ys.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s,this.expectedCount=a}withSequenceNumber(t){return new Ou(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Ou(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Ou(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Ou(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Mu{constructor(t){this.yt=t}}function Nu(t){const e=Tu({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?ja(e,e.limit,"L"):e}class Ru{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(ws(t.integerValue));else if("doubleValue"in t){const n=ws(t.doubleValue);isNaN(n)?this.Ft(e,13):(this.Ft(e,15),Zo(n)?e.Mt(0):e.Mt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ft(e,20),"string"==typeof n&&(n=_s(n)),e.xt(`${n.seconds||""}`),e.Mt(n.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(bs(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Ft(e,45),e.Mt(n.latitude||0),e.Mt(n.longitude||0)}else"mapValue"in t?ta(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):Xs(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):Kr(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){const n=t.fields||{};this.Ft(e,55);for(const t of Object.keys(n))this.Ot(t,e),this.Ct(n[t],e)}kt(t,e){const n=t.fields||{};this.Ft(e,53);const i=Ds,r=n[i].arrayValue?.values?.length||0;this.Ft(e,15),e.Mt(ws(r)),this.Ot(i,e),this.Ct(n[i],e)}Qt(t,e){const n=t.values||[];this.Ft(e,50);for(const t of n)this.Ct(t,e)}Lt(t,e){this.Ft(e,37),So.fromName(t).path.forEach(t=>{this.Ft(e,60),this.Ut(t,e)})}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}}Ru.Kt=new Ru;class Du{constructor(){this.Cn=new ju}addToCollectionParentIndex(t,e){return this.Cn.add(e),zo.resolve()}getCollectionParents(t,e){return zo.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return zo.resolve()}deleteFieldIndex(t,e){return zo.resolve()}deleteAllFieldIndexes(t){return zo.resolve()}createTargetIndexes(t,e){return zo.resolve()}getDocumentsMatchingTarget(t,e){return zo.resolve(null)}getIndexType(t,e){return zo.resolve(0)}getFieldIndexes(t,e){return zo.resolve([])}getNextCollectionGroupToUpdate(t){return zo.resolve(null)}getMinOffset(t,e){return zo.resolve(Fo.min())}getMinOffsetFromCollectionGroup(t,e){return zo.resolve(Fo.min())}updateCollectionGroup(t,e,n){return zo.resolve()}updateIndexEntries(t,e){return zo.resolve()}}class ju{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new fs(bo.comparator),r=!i.has(n);return this.index[e]=i.add(n),r}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new fs(bo.comparator)).toArray()}}new Uint8Array(0);const Fu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Uu=41943040;class Vu{static withCacheSize(t){return new Vu(t,Vu.DEFAULT_COLLECTION_PERCENTILE,Vu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}Vu.DEFAULT_COLLECTION_PERCENTILE=10,Vu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Vu.DEFAULT=new Vu(Uu,Vu.DEFAULT_COLLECTION_PERCENTILE,Vu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Vu.DISABLED=new Vu(-1,0,0);class Bu{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new Bu(0)}static cr(){return new Bu(-1)}}const zu="LruGarbageCollector";function Gu([t,e],[n,i]){const r=fo(t,n);return 0===r?fo(e,i):r}class qu{constructor(t){this.Ir=t,this.buffer=new fs(Gu),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Gu(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Hu{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(t){Hr(zu,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Go(t)?Hr(zu,"Ignoring IndexedDB error during garbage collection: ",t):await Bo(t)}await this.Vr(3e5)})}}class Zu{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next(t=>Math.floor(e/100*t))}nthSequenceNumber(t,e){if(0===e)return zo.resolve(qo.ce);const n=new qu(e);return this.mr.forEachTarget(t,t=>n.Ar(t.sequenceNumber)).next(()=>this.mr.pr(t,t=>n.Ar(t))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.mr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(Hr("LruGarbageCollector","Garbage collection skipped; disabled"),zo.resolve(Fu)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(Hr("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Fu):this.yr(t,e))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let n,i,r,o,s,a,c;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(e>this.params.maximumSequenceNumbersToCollect?(Hr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),i=this.params.maximumSequenceNumbersToCollect):i=e,o=Date.now(),this.nthSequenceNumber(t,i))).next(i=>(n=i,s=Date.now(),this.removeTargets(t,n,e))).next(e=>(r=e,a=Date.now(),this.removeOrphanedDocuments(t,n))).next(t=>(c=Date.now(),qr()<=$.DEBUG&&Hr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-u}ms\n\tDetermined least recently used ${i} in `+(s-o)+"ms\n"+`\tRemoved ${r} targets in `+(a-s)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),zo.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:t})))}}class Wu{constructor(){this.changes=new qa(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,ia.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?zo.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class $u{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Ku{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(n=i,this.remoteDocumentCache.getEntry(t,e))).next(t=>(null!==n&&Ic(n.mutation,t,ms.empty(),Ro.now()),t))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,ec()).next(()=>e))}getLocalViewOfDocuments(t,e,n=ec()){const i=Qa();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,n).next(t=>{let e=$a();return t.forEach((t,n)=>{e=e.insert(t,n.overlayedDocument)}),e}))}getOverlayedDocuments(t,e){const n=Qa();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,ec()))}populateOverlays(t,e,n){const i=[];return n.forEach(t=>{e.has(t)||i.push(t)}),this.documentOverlayCache.getOverlays(t,i).next(t=>{t.forEach((t,n)=>{e.set(t,n)})})}computeViews(t,e,n,i){let r=Za();const o=Xa(),s=Xa();return e.forEach((t,e)=>{const s=n.get(e.key);i.has(e.key)&&(void 0===s||s.mutation instanceof xc)?r=r.insert(e.key,e):void 0!==s?(o.set(e.key,s.mutation.getFieldMask()),Ic(s.mutation,e,s.mutation.getFieldMask(),Ro.now())):o.set(e.key,ms.empty())}),this.recalculateAndSaveOverlays(t,r).next(t=>(t.forEach((t,e)=>o.set(t,e)),e.forEach((t,e)=>s.set(t,new $u(e,o.get(t)??null))),s))}recalculateAndSaveOverlays(t,e){const n=Xa();let i=new ls((t,e)=>t-e),r=ec();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(t=>{for(const r of t)r.keys().forEach(t=>{const o=e.get(t);if(null===o)return;let s=n.get(t)||ms.empty();s=r.applyToLocalView(o,s),n.set(t,s);const a=(i.get(r.batchId)||ec()).add(t);i=i.insert(r.batchId,a)})}).next(()=>{const o=[],s=i.getReverseIterator();for(;s.hasNext();){const i=s.getNext(),a=i.key,c=i.value,u=Ya();c.forEach(t=>{if(!r.has(t)){const i=Ec(e.get(t),n.get(t));null!==i&&u.set(t,i),r=r.add(t)}}),o.push(this.documentOverlayCache.saveOverlays(t,a,u))}return zo.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(t,e,n,i){return function(t){return So.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Ma(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,i):this.getDocumentsMatchingCollectionQuery(t,e,n,i)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next(r=>{const o=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-r.size):zo.resolve(Qa());let s=-1,a=r;return o.next(e=>zo.forEach(e,(e,n)=>(s<n.largestBatchId&&(s=n.largestBatchId),r.get(e)?zo.resolve():this.remoteDocumentCache.getEntry(t,e).next(t=>{a=a.insert(e,t)}))).next(()=>this.populateOverlays(t,e,r)).next(()=>this.computeViews(t,a,e,ec())).next(t=>({batchId:s,changes:Ka(t)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new So(e)).next(t=>{let e=$a();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})}getDocumentsMatchingCollectionGroupQuery(t,e,n,i){const r=e.collectionGroup;let o=$a();return this.indexManager.getCollectionParents(t,r).next(s=>zo.forEach(s,s=>{const a=function(t,e){return new Aa(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(r));return this.getDocumentsMatchingCollectionQuery(t,a,n,i).next(t=>{t.forEach((t,e)=>{o=o.insert(t,e)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,e,n,i){let r;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(o=>(r=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,r,i))).next(t=>{r.forEach((e,n)=>{const i=n.getKey();null===t.get(i)&&(t=t.insert(i,ia.newInvalidDocument(i)))});let n=$a();return t.forEach((t,i)=>{const o=r.get(t);void 0!==o&&Ic(o.mutation,i,ms.empty(),Ro.now()),Ba(e,i)&&(n=n.insert(t,i))}),n})}}class Qu{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return zo.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:lu(t.createTime)}}(e)),zo.resolve()}getNamedQuery(t,e){return zo.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,function(t){return{name:t.name,query:Nu(t.bundledQuery),readTime:lu(t.readTime)}}(e)),zo.resolve()}}class Yu{constructor(){this.overlays=new ls(So.comparator),this.qr=new Map}getOverlay(t,e){return zo.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Qa();return zo.forEach(e,e=>this.getOverlay(t,e).next(t=>{null!==t&&n.set(e,t)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((n,i)=>{this.St(t,e,i)}),zo.resolve()}removeOverlaysForBatchId(t,e,n){const i=this.qr.get(n);return void 0!==i&&(i.forEach(t=>this.overlays=this.overlays.remove(t)),this.qr.delete(n)),zo.resolve()}getOverlaysForCollection(t,e,n){const i=Qa(),r=e.length+1,o=new So(e.child("")),s=this.overlays.getIteratorFrom(o);for(;s.hasNext();){const t=s.getNext().value,o=t.getKey();if(!e.isPrefixOf(o.path))break;o.path.length===r&&t.largestBatchId>n&&i.set(t.getKey(),t)}return zo.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let r=new ls((t,e)=>t-e);const o=this.overlays.getIterator();for(;o.hasNext();){const t=o.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=r.get(t.largestBatchId);null===e&&(e=Qa(),r=r.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const s=Qa(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((t,e)=>s.set(t,e)),!(s.size()>=i)););return zo.resolve(s)}St(t,e,n){const i=this.overlays.get(n.key);if(null!==i){const t=this.qr.get(i.largestBatchId).delete(n.key);this.qr.set(i.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new jc(e,n));let r=this.qr.get(e);void 0===r&&(r=ec(),this.qr.set(e,r)),this.qr.set(e,r.add(n.key))}}class Xu{constructor(){this.sessionToken=ys.EMPTY_BYTE_STRING}getSessionToken(t){return zo.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,zo.resolve()}}class Ju{constructor(){this.Qr=new fs(tl.$r),this.Ur=new fs(tl.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const n=new tl(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach(t=>this.addReference(t,e))}removeReference(t,e){this.Gr(new tl(t,e))}zr(t,e){t.forEach(t=>this.removeReference(t,e))}jr(t){const e=new So(new bo([])),n=new tl(e,t),i=new tl(e,t+1),r=[];return this.Ur.forEachInRange([n,i],t=>{this.Gr(t),r.push(t.key)}),r}Jr(){this.Qr.forEach(t=>this.Gr(t))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new So(new bo([])),n=new tl(e,t),i=new tl(e,t+1);let r=ec();return this.Ur.forEachInRange([n,i],t=>{r=r.add(t.key)}),r}containsKey(t){const e=new tl(t,0),n=this.Qr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class tl{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return So.comparator(t.key,e.key)||fo(t.Yr,e.Yr)}static Kr(t,e){return fo(t.Yr,e.Yr)||So.comparator(t.key,e.key)}}class el{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new fs(tl.$r)}checkEmpty(t){return zo.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,i){const r=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Rc(r,e,n,i);this.mutationQueue.push(o);for(const e of i)this.Zr=this.Zr.add(new tl(e.key,r)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return zo.resolve(o)}lookupMutationBatch(t,e){return zo.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=this.ei(n),r=i<0?0:i;return zo.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return zo.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(t){return zo.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new tl(e,0),i=new tl(e,Number.POSITIVE_INFINITY),r=[];return this.Zr.forEachInRange([n,i],t=>{const e=this.Xr(t.Yr);r.push(e)}),zo.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new fs(fo);return e.forEach(t=>{const e=new tl(t,0),i=new tl(t,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([e,i],t=>{n=n.add(t.Yr)})}),zo.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let r=n;So.isDocumentKey(r)||(r=r.child(""));const o=new tl(new So(r),0);let s=new fs(fo);return this.Zr.forEachWhile(t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===i&&(s=s.add(t.Yr)),!0)},o),zo.resolve(this.ti(s))}ti(t){const e=[];return t.forEach(t=>{const n=this.Xr(t);null!==n&&e.push(n)}),e}removeMutationBatch(t,e){Yr(0===this.ni(e.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return zo.forEach(e.mutations,i=>{const r=new tl(i.key,e.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.Zr=n})}ir(t){}containsKey(t,e){const n=new tl(e,0),i=this.Zr.firstAfterOrEqual(n);return zo.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,zo.resolve()}ni(t,e){return this.ei(t)}ei(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class nl{constructor(t){this.ri=t,this.docs=new ls(So.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,i=this.docs.get(n),r=i?i.size:0,o=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return zo.resolve(n?n.document.mutableCopy():ia.newInvalidDocument(e))}getEntries(t,e){let n=Za();return e.forEach(t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():ia.newInvalidDocument(t))}),zo.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let r=Za();const o=e.path,s=new So(o.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(s);for(;a.hasNext();){const{key:t,value:{document:s}}=a.getNext();if(!o.isPrefixOf(t.path))break;t.path.length>o.length+1||Uo(jo(s),n)<=0||(i.has(s.key)||Ba(e,s))&&(r=r.insert(s.key,s.mutableCopy()))}return zo.resolve(r)}getAllFromCollectionGroup(t,e,n,i){Kr(9500)}ii(t,e){return zo.forEach(this.docs,t=>e(t))}newChangeBuffer(t){return new il(this)}getSize(t){return zo.resolve(this.size)}}class il extends Wu{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?e.push(this.Nr.addEntry(t,i)):this.Nr.removeEntry(n)}),zo.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class rl{constructor(t){this.persistence=t,this.si=new qa(t=>Ca(t),Pa),this.lastRemoteSnapshotVersion=Do.min(),this.highestTargetId=0,this.oi=0,this._i=new Ju,this.targetCount=0,this.ai=Bu.ur()}forEachTarget(t,e){return this.si.forEach((t,n)=>e(n)),zo.resolve()}getLastRemoteSnapshotVersion(t){return zo.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return zo.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),zo.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),zo.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new Bu(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,zo.resolve()}updateTargetData(t,e){return this.Pr(e),zo.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,zo.resolve()}removeTargets(t,e,n){let i=0;const r=[];return this.si.forEach((o,s)=>{s.sequenceNumber<=e&&null===n.get(s.targetId)&&(this.si.delete(o),r.push(this.removeMatchingKeysForTargetId(t,s.targetId)),i++)}),zo.waitFor(r).next(()=>i)}getTargetCount(t){return zo.resolve(this.targetCount)}getTargetData(t,e){const n=this.si.get(e)||null;return zo.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),zo.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);const i=this.persistence.referenceDelegate,r=[];return i&&e.forEach(e=>{r.push(i.markPotentiallyOrphaned(t,e))}),zo.waitFor(r)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),zo.resolve()}getMatchingKeysForTargetId(t,e){const n=this._i.Hr(e);return zo.resolve(n)}containsKey(t,e){return zo.resolve(this._i.containsKey(e))}}class ol{constructor(t,e){this.ui={},this.overlays={},this.ci=new qo(0),this.li=!1,this.li=!0,this.hi=new Xu,this.referenceDelegate=t(this),this.Pi=new rl(this),this.indexManager=new Du,this.remoteDocumentCache=function(t){return new nl(t)}(t=>this.referenceDelegate.Ti(t)),this.serializer=new Mu(e),this.Ii=new Qu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Yu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new el(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){Hr("MemoryPersistence","Starting transaction:",t);const i=new sl(this.ci.next());return this.referenceDelegate.Ei(),n(i).next(t=>this.referenceDelegate.di(i).next(()=>t)).toPromise().then(t=>(i.raiseOnCommittedEvent(),t))}Ai(t,e){return zo.or(Object.values(this.ui).map(n=>()=>n.containsKey(t,e)))}}class sl extends Vo{constructor(t){super(),this.currentSequenceNumber=t}}class al{constructor(t){this.persistence=t,this.Ri=new Ju,this.Vi=null}static mi(t){return new al(t)}get fi(){if(this.Vi)return this.Vi;throw Kr(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),zo.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),zo.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),zo.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach(t=>this.fi.add(t.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(t=>{t.forEach(t=>this.fi.add(t.toString()))}).next(()=>n.removeTargetData(t,e))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return zo.forEach(this.fi,n=>{const i=So.fromPath(n);return this.gi(t,i).next(t=>{t||e.removeEntry(i,Do.min())})}).next(()=>(this.Vi=null,e.apply(t)))}updateLimboDocument(t,e){return this.gi(t,e).next(t=>{t?this.fi.delete(e.toString()):this.fi.add(e.toString())})}Ti(t){return 0}gi(t,e){return zo.or([()=>zo.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class cl{constructor(t,e){this.persistence=t,this.pi=new qa(t=>function(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=$o(e)),e=Wo(t.get(n),e);return $o(e)}(t.path),(t,e)=>t.isEqual(e)),this.garbageCollector=function(t,e){return new Zu(t,e)}(this,e)}static mi(t,e){return new cl(t,e)}Ei(){}di(t){return zo.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next(t=>e.next(e=>t+e))}wr(t){let e=0;return this.pr(t,t=>{e++}).next(()=>e)}pr(t,e){return zo.forEach(this.pi,(n,i)=>this.br(t,n,i).next(t=>t?zo.resolve():e(i)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const i=this.persistence.getRemoteDocumentCache(),r=i.newChangeBuffer();return i.ii(t,i=>this.br(t,i,e).next(t=>{t||(n++,r.removeEntry(i,Do.min()))})).next(()=>r.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),zo.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),zo.resolve()}removeReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),zo.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),zo.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Hs(t.data.value)),e}br(t,e,n){return zo.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const t=this.pi.get(e);return zo.resolve(void 0!==t&&t>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class ul{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=i}static As(t,e){let n=ec(),i=ec();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:i=i.add(t.doc.key)}return new ul(t,e.fromCache,n,i)}}class ll{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class hl{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=A()?8:function(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}(x())>0?6:4}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,i){const r={result:null};return this.ys(t,e).next(t=>{r.result=t}).next(()=>{if(!r.result)return this.ws(t,e,i,n).next(t=>{r.result=t})}).next(()=>{if(r.result)return;const n=new ll;return this.Ss(t,e,n).next(i=>{if(r.result=i,this.Vs)return this.bs(t,e,n,i.size)})}).next(()=>r.result)}bs(t,e,n,i){return n.documentReadCount<this.fs?(qr()<=$.DEBUG&&Hr("QueryEngine","SDK will not create cache indexes for query:",Va(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),zo.resolve()):(qr()<=$.DEBUG&&Hr("QueryEngine","Query:",Va(e),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.gs*i?(qr()<=$.DEBUG&&Hr("QueryEngine","The SDK decides to create cache indexes for query:",Va(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ra(e))):zo.resolve())}ys(t,e){if(Oa(e))return zo.resolve(null);let n=Ra(e);return this.indexManager.getIndexType(t,n).next(i=>0===i?null:(null!==e.limit&&1===i&&(e=ja(e,null,"F"),n=Ra(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(i=>{const r=ec(...i);return this.ps.getDocuments(t,r).next(i=>this.indexManager.getMinOffset(t,n).next(n=>{const o=this.Ds(e,i);return this.Cs(e,o,r,n.readTime)?this.ys(t,ja(e,null,"F")):this.vs(t,o,e,n)}))})))}ws(t,e,n,i){return Oa(e)||i.isEqual(Do.min())?zo.resolve(null):this.ps.getDocuments(t,n).next(r=>{const o=this.Ds(e,r);return this.Cs(e,o,n,i)?zo.resolve(null):(qr()<=$.DEBUG&&Hr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Va(e)),this.vs(t,o,e,function(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,r=Do.fromTimestamp(1e9===i?new Ro(n+1,0):new Ro(n,i));return new Fo(r,So.empty(),e)}(i,-1)).next(t=>t))})}Ds(t,e){let n=new fs(za(t));return e.forEach((e,i)=>{Ba(t,i)&&(n=n.add(i))}),n}Cs(t,e,n,i){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const r="F"===t.limitType?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Ss(t,e,n){return qr()<=$.DEBUG&&Hr("QueryEngine","Using full collection scan to execute query:",Va(e)),this.ps.getDocumentsMatchingQuery(t,e,Fo.min(),n)}vs(t,e,n,i){return this.ps.getDocumentsMatchingQuery(t,n,i).next(t=>(e.forEach(e=>{t=t.insert(e.key,e)}),t))}}const dl="LocalStore";class fl{constructor(t,e,n,i){this.persistence=t,this.Fs=e,this.serializer=i,this.Ms=new ls(fo),this.xs=new qa(t=>Ca(t),Pa),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Ku(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}}async function pl(t,e){const n=Xr(t);return await n.persistence.runTransaction("Handle user change","readonly",t=>{let i;return n.mutationQueue.getAllMutationBatches(t).next(r=>(i=r,n.Bs(e),n.mutationQueue.getAllMutationBatches(t))).next(e=>{const r=[],o=[];let s=ec();for(const t of i){r.push(t.batchId);for(const e of t.mutations)s=s.add(e.key)}for(const t of e){o.push(t.batchId);for(const e of t.mutations)s=s.add(e.key)}return n.localDocuments.getDocuments(t,s).next(t=>({Ls:t,removedBatchIds:r,addedBatchIds:o}))})})}function ml(t){const e=Xr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function gl(t,e){const n=Xr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)))}async function yl(t,e,n){const i=Xr(t),r=i.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",o,t=>i.persistence.referenceDelegate.removeTarget(t,r))}catch(t){if(!Go(t))throw t;Hr(dl,`Failed to update sequence numbers for target ${e}: ${t}`)}i.Ms=i.Ms.remove(e),i.xs.delete(r.target)}function vl(t,e,n){const i=Xr(t);let r=Do.min(),o=ec();return i.persistence.runTransaction("Execute query","readwrite",t=>function(t,e,n){const i=Xr(t),r=i.xs.get(n);return void 0!==r?zo.resolve(i.Ms.get(r)):i.Pi.getTargetData(e,n)}(i,t,Ra(e)).next(e=>{if(e)return r=e.lastLimboFreeSnapshotVersion,i.Pi.getMatchingKeysForTargetId(t,e.targetId).next(t=>{o=t})}).next(()=>i.Fs.getDocumentsMatchingQuery(t,e,n?r:Do.min(),n?o:ec())).next(t=>(function(t,e,n){let i=t.Os.get(e)||Do.min();n.forEach((t,e)=>{e.readTime.compareTo(i)>0&&(i=e.readTime)}),t.Os.set(e,i)}(i,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,Qs:o})))}class _l{constructor(){this.activeTargetIds=nc}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class wl{constructor(){this.Mo=new _l,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new _l,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class bl{Oo(t){}shutdown(){}}const Tl="ConnectivityMonitor";class El{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Hr(Tl,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){Hr(Tl,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Sl=null;function Il(){return null===Sl?Sl=268435456+Math.round(2147483648*Math.random()):Sl++,"0x"+Sl.toString(16)}const kl="RestConnection",Cl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Pl{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${n}/databases/${i}`,this.Wo=this.databaseId.database===As?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Go(t,e,n,i,r){const o=Il(),s=this.zo(t,e.toUriEncodedString());Hr(kl,`Sending RPC '${t}' ${o}:`,s,n);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,i,r);const{host:c}=new URL(s),u=S(c);return this.Jo(t,s,a,n,u).then(e=>(Hr(kl,`Received RPC '${t}' ${o}: `,e),e),e=>{throw Wr(kl,`RPC '${t}' ${o} failed with error: `,e,"url: ",s,"request:",n),e})}Ho(t,e,n,i,r,o){return this.Go(t,e,n,i,r)}jo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+zr,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,n)=>t[n]=e),n&&n.headers.forEach((e,n)=>t[n]=e)}zo(t,e){const n=Cl[t];return`${this.Uo}/v1/${e}:${n}`}terminate(){}}class xl{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const Al="WebChannelConnection";class Ll extends Pl{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,i,r){const o=Il();return new Promise((r,s)=>{const a=new xr;a.setWithCredentials(!0),a.listenOnce(Lr.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Or.NO_ERROR:const e=a.getResponseJson();Hr(Al,`XHR for RPC '${t}' ${o} received:`,JSON.stringify(e)),r(e);break;case Or.TIMEOUT:Hr(Al,`RPC '${t}' ${o} timed out`),s(new to(Jr.DEADLINE_EXCEEDED,"Request time out"));break;case Or.HTTP_ERROR:const n=a.getStatus();if(Hr(Al,`RPC '${t}' ${o} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=t?.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Jr).indexOf(e)>=0?e:Jr.UNKNOWN}(e.status);s(new to(t,e.message))}else s(new to(Jr.UNKNOWN,"Server responded with status "+a.getStatus()))}else s(new to(Jr.UNAVAILABLE,"Connection failed."));break;default:Kr(9055,{l_:t,streamId:o,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{Hr(Al,`RPC '${t}' ${o} completed.`)}});const c=JSON.stringify(i);Hr(Al,`RPC '${t}' ${o} sending request:`,i),a.send(e,"POST",c,n,15)})}T_(t,e,n){const i=Il(),r=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=Dr(),s=Rr(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=r.join("");Hr(Al,`Creating RPC '${t}' stream ${i}: ${u}`,a);const l=o.createWebChannel(u,a);this.I_(l);let h=!1,d=!1;const f=new xl({Yo:e=>{d?Hr(Al,`Not sending because RPC '${t}' stream ${i} is closed:`,e):(h||(Hr(Al,`Opening RPC '${t}' stream ${i} transport.`),l.open(),h=!0),Hr(Al,`RPC '${t}' stream ${i} sending:`,e),l.send(e))},Zo:()=>l.close()}),p=(t,e,n)=>{t.listen(e,t=>{try{n(t)}catch(t){setTimeout(()=>{throw t},0)}})};return p(l,Ar.EventType.OPEN,()=>{d||(Hr(Al,`RPC '${t}' stream ${i} transport opened.`),f.o_())}),p(l,Ar.EventType.CLOSE,()=>{d||(d=!0,Hr(Al,`RPC '${t}' stream ${i} transport closed`),f.a_(),this.E_(l))}),p(l,Ar.EventType.ERROR,e=>{d||(d=!0,Wr(Al,`RPC '${t}' stream ${i} transport errored. Name:`,e.name,"Message:",e.message),f.a_(new to(Jr.UNAVAILABLE,"The operation could not be completed")))}),p(l,Ar.EventType.MESSAGE,e=>{if(!d){const n=e.data[0];Yr(!!n,16349);const r=n,o=r?.error||r[0]?.error;if(o){Hr(Al,`RPC '${t}' stream ${i} received error:`,o);const e=o.status;let n=function(t){const e=Uc[t];if(void 0!==e)return Bc(e)}(e),r=o.message;void 0===n&&(n=Jr.INTERNAL,r="Unknown error status: "+e+" with message "+o.message),d=!0,f.a_(new to(n,r)),l.close()}else Hr(Al,`RPC '${t}' stream ${i} received:`,n),f.u_(n)}}),p(s,Nr.STAT_EVENT,e=>{e.stat===Mr.PROXY?Hr(Al,`RPC '${t}' stream ${i} detected buffering proxy`):e.stat===Mr.NOPROXY&&Hr(Al,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{f.__()},0),f}terminate(){this.c_.forEach(t=>t.close()),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter(e=>e===t)}}function Ol(){return"undefined"!=typeof document?document:null}function Ml(t){return new ou(t,!0)}class Nl{constructor(t,e,n=1e3,i=1.5,r=6e4){this.Mi=t,this.timerId=e,this.d_=n,this.A_=i,this.R_=r,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),i=Math.max(0,e-n);i>0&&Hr("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),t())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Rl="PersistentStream";class Dl{constructor(t,e,n,i,r,o,s,a){this.Mi=t,this.S_=n,this.b_=i,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=s,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Nl(t,e)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==t?this.M_.reset():e&&e.code===Jr.RESOURCE_EXHAUSTED?(Zr(e.toString()),Zr("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===Jr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([t,n])=>{this.D_===e&&this.G_(t,n)},e=>{t(()=>{const t=new to(Jr.UNKNOWN,"Fetching auth token failed: "+e.message);return this.z_(t)})})}G_(t,e){const n=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(t=>{n(()=>this.z_(t))}),this.stream.onMessage(t=>{n(()=>1==++this.F_?this.J_(t):this.onNext(t))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(t){return Hr(Rl,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget(()=>this.D_===t?e():(Hr(Rl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class jl extends Dl{constructor(t,e,n,i,r,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,o),this.serializer=r}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const i=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Kr(39313,{state:t})}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],o=function(t,e){return t.useProto3Json?(Yr(void 0===e||"string"==typeof e,58123),ys.fromBase64String(e||"")):(Yr(void 0===e||e instanceof Buffer||e instanceof Uint8Array,16193),ys.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=e.targetChange.cause,a=s&&function(t){const e=void 0===t.code?Jr.UNKNOWN:Bc(t.code);return new to(e,t.message||"")}(s);n=new Yc(i,r,o,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const r=mu(t,i.document.name),o=lu(i.document.updateTime),s=i.document.createTime?lu(i.document.createTime):Do.min(),a=new ea({mapValue:{fields:i.document.fields}}),c=ia.newFoundDocument(r,o,s,a),u=i.targetIds||[],l=i.removedTargetIds||[];n=new Kc(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const r=mu(t,i.document),o=i.readTime?lu(i.readTime):Do.min(),s=ia.newNoDocument(r,o),a=i.removedTargetIds||[];n=new Kc([],a,s.key,s)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const r=mu(t,i.document),o=i.removedTargetIds||[];n=new Kc([],o,r,null)}else{if(!("filter"in e))return Kr(11601,{Rt:e});{e.filter;const t=e.filter;t.targetId;const{count:i=0,unchangedNames:r}=t,o=new Fc(i,r),s=t.targetId;n=new Qc(s,o)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Do.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Do.min():e.readTime?lu(e.readTime):Do.min()}(t);return this.listener.H_(e,n)}Y_(t){const e={};e.database=yu(this.serializer),e.addTarget=function(t,e){let n;const i=e.target;if(n=xa(i)?{documents:wu(t,i)}:{query:bu(t,i).ft},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=cu(t,e.resumeToken);const i=su(t,e.expectedCount);null!==i&&(n.expectedCount=i)}else if(e.snapshotVersion.compareTo(Do.min())>0){n.readTime=au(t,e.snapshotVersion.toTimestamp());const i=su(t,e.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Kr(28987,{purpose:t})}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.q_(e)}Z_(t){const e={};e.database=yu(this.serializer),e.removeTarget=t,this.q_(e)}}class Fl extends Dl{constructor(t,e,n,i,r,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,o),this.serializer=r}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return Yr(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,Yr(!t.writeResults||0===t.writeResults.length,55816),this.listener.ta()}onNext(t){Yr(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=function(t,e){return t&&t.length>0?(Yr(void 0!==e,14353),t.map(t=>function(t,e){let n=t.updateTime?lu(t.updateTime):lu(e);return n.isEqual(Do.min())&&(n=lu(e)),new _c(n,t.transformResults||[])}(t,e))):[]}(t.writeResults,t.commitTime),n=lu(t.commitTime);return this.listener.na(n,e)}ra(){const t={};t.database=yu(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>function(t,e){let n;if(e instanceof Pc)n={update:_u(t,e.key,e.value)};else if(e instanceof Mc)n={delete:pu(t,e.key)};else if(e instanceof xc)n={update:_u(t,e.key,e.data),updateMask:Au(e.fieldMask)};else{if(!(e instanceof Nc))return Kr(16599,{Vt:e.type});n={verify:pu(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(t=>function(t,e){const n=e.transform;if(n instanceof lc)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof hc)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof fc)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof mc)return{fieldPath:e.field.canonicalString(),increment:n.Ae};throw Kr(20930,{transform:e.transform})}(0,t))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:uu(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Kr(27497)}(t,e.precondition)),n}(this.serializer,t))};this.q_(e)}}class Ul{}class Vl extends Ul{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new to(Jr.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,o])=>this.connection.Go(t,du(e,n),i,r,o)).catch(t=>{throw"FirebaseError"===t.name?(t.code===Jr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new to(Jr.UNKNOWN,t.toString())})}Ho(t,e,n,i,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,s])=>this.connection.Ho(t,du(e,n),i,o,s,r)).catch(t=>{throw"FirebaseError"===t.name?(t.code===Jr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new to(Jr.UNKNOWN,t.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Bl{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(t){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,"Online"===t&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Zr(e),this.aa=!1):Hr("OnlineStateTracker",e)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const zl="RemoteStore";class Gl{constructor(t,e,n,i,r){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=r,this.Aa.Oo(t=>{n.enqueueAndForget(async()=>{Xl(this)&&(Hr(zl,"Restarting streams for network reachability change."),await async function(t){const e=Xr(t);e.Ea.add(4),await Hl(e),e.Ra.set("Unknown"),e.Ea.delete(4),await ql(e)}(this))})}),this.Ra=new Bl(n,i)}}async function ql(t){if(Xl(t))for(const e of t.da)await e(!0)}async function Hl(t){for(const e of t.da)await e(!1)}function Zl(t,e){const n=Xr(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),Yl(n)?Ql(n):gh(n).O_()&&$l(n,e))}function Wl(t,e){const n=Xr(t),i=gh(n);n.Ia.delete(e),i.O_()&&Kl(n,e),0===n.Ia.size&&(i.O_()?i.L_():Xl(n)&&n.Ra.set("Unknown"))}function $l(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Do.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}gh(t).Y_(e)}function Kl(t,e){t.Va.Ue(e),gh(t).Z_(e)}function Ql(t){t.Va=new Jc({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),gh(t).start(),t.Ra.ua()}function Yl(t){return Xl(t)&&!gh(t).x_()&&t.Ia.size>0}function Xl(t){return 0===Xr(t).Ea.size}function Jl(t){t.Va=void 0}async function th(t){t.Ra.set("Online")}async function eh(t){t.Ia.forEach((e,n)=>{$l(t,e)})}async function nh(t,e){Jl(t),Yl(t)?(t.Ra.ha(e),Ql(t)):t.Ra.set("Unknown")}async function ih(t,e,n){if(t.Ra.set("Online"),e instanceof Yc&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const i of e.targetIds)t.Ia.has(i)&&(await t.remoteSyncer.rejectListen(i,n),t.Ia.delete(i),t.Va.removeTarget(i))}(t,e)}catch(n){Hr(zl,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await rh(t,n)}else if(e instanceof Kc?t.Va.Ze(e):e instanceof Qc?t.Va.st(e):t.Va.tt(e),!n.isEqual(Do.min()))try{const e=await ml(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Va.Tt(e);return n.targetChanges.forEach((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const r=t.Ia.get(i);r&&t.Ia.set(i,r.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach((e,n)=>{const i=t.Ia.get(e);if(!i)return;t.Ia.set(e,i.withResumeToken(ys.EMPTY_BYTE_STRING,i.snapshotVersion)),Kl(t,e);const r=new Ou(i.target,e,n,i.sequenceNumber);$l(t,r)}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Hr(zl,"Failed to raise snapshot:",e),await rh(t,e)}}async function rh(t,e,n){if(!Go(e))throw e;t.Ea.add(1),await Hl(t),t.Ra.set("Offline"),n||(n=()=>ml(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{Hr(zl,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await ql(t)})}function oh(t,e){return e().catch(n=>rh(t,n,e))}async function sh(t){const e=Xr(t),n=yh(e);let i=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;ah(e);)try{const t=await gl(e.localStore,i);if(null===t){0===e.Ta.length&&n.L_();break}i=t.batchId,ch(e,t)}catch(t){await rh(e,t)}uh(e)&&lh(e)}function ah(t){return Xl(t)&&t.Ta.length<10}function ch(t,e){t.Ta.push(e);const n=yh(t);n.O_()&&n.X_&&n.ea(e.mutations)}function uh(t){return Xl(t)&&!yh(t).x_()&&t.Ta.length>0}function lh(t){yh(t).start()}async function hh(t){yh(t).ra()}async function dh(t){const e=yh(t);for(const n of t.Ta)e.ea(n.mutations)}async function fh(t,e,n){const i=t.Ta.shift(),r=Dc.from(i,e,n);await oh(t,()=>t.remoteSyncer.applySuccessfulWrite(r)),await sh(t)}async function ph(t,e){e&&yh(t).X_&&await async function(t,e){if(function(t){return function(t){switch(t){case Jr.OK:return Kr(64938);case Jr.CANCELLED:case Jr.UNKNOWN:case Jr.DEADLINE_EXCEEDED:case Jr.RESOURCE_EXHAUSTED:case Jr.INTERNAL:case Jr.UNAVAILABLE:case Jr.UNAUTHENTICATED:return!1;case Jr.INVALID_ARGUMENT:case Jr.NOT_FOUND:case Jr.ALREADY_EXISTS:case Jr.PERMISSION_DENIED:case Jr.FAILED_PRECONDITION:case Jr.ABORTED:case Jr.OUT_OF_RANGE:case Jr.UNIMPLEMENTED:case Jr.DATA_LOSS:return!0;default:return Kr(15467,{code:t})}}(t)&&t!==Jr.ABORTED}(e.code)){const n=t.Ta.shift();yh(t).B_(),await oh(t,()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e)),await sh(t)}}(t,e),uh(t)&&lh(t)}async function mh(t,e){const n=Xr(t);n.asyncQueue.verifyOperationInProgress(),Hr(zl,"RemoteStore received new credentials");const i=Xl(n);n.Ea.add(3),await Hl(n),i&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await ql(n)}function gh(t){return t.ma||(t.ma=function(t,e,n){const i=Xr(t);return i.sa(),new jl(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(t.datastore,t.asyncQueue,{Xo:th.bind(null,t),t_:eh.bind(null,t),r_:nh.bind(null,t),H_:ih.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),Yl(t)?Ql(t):t.Ra.set("Unknown")):(await t.ma.stop(),Jl(t))})),t.ma}function yh(t){return t.fa||(t.fa=function(t,e,n){const i=Xr(t);return i.sa(),new Fl(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:hh.bind(null,t),r_:ph.bind(null,t),ta:dh.bind(null,t),na:fh.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await sh(t)):(await t.fa.stop(),t.Ta.length>0&&(Hr(zl,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}class vh{constructor(t,e,n,i,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new eo,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(t=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,i,r){const o=Date.now()+n,s=new vh(t,e,o,i,r);return s.start(n),s}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new to(Jr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function _h(t,e){if(Zr("AsyncQueue",`${e}: ${t}`),Go(t))return new to(Jr.UNAVAILABLE,`${e}: ${t}`);throw t}class wh{static emptySet(t){return new wh(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||So.comparator(e.key,n.key):(t,e)=>So.comparator(t.key,e.key),this.keyedMap=$a(),this.sortedSet=new ls(this.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof wh))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(!t.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new wh;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class bh{constructor(){this.ga=new ls(So.comparator)}track(t){const e=t.doc.key,n=this.ga.get(e);n?0!==t.type&&3===n.type?this.ga=this.ga.insert(e,t):3===t.type&&1!==n.type?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ga=this.ga.remove(e):1===t.type&&2===n.type?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):Kr(63341,{Rt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal((e,n)=>{t.push(n)}),t}}class Th{constructor(t,e,n,i,r,o,s,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,i,r){const o=[];return e.forEach(t=>{o.push({type:0,doc:t})}),new Th(t,e,wh.emptySet(e),o,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Fa(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Eh{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(t=>t.Da())}}class Sh{constructor(){this.queries=Ih(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(t,e){const n=Xr(t),i=n.queries;n.queries=Ih(),i.forEach((t,n)=>{for(const t of n.Sa)t.onError(e)})}(this,new to(Jr.ABORTED,"Firestore shutting down"))}}function Ih(){return new qa(t=>Ua(t),Fa)}async function kh(t,e){const n=Xr(t);let i=3;const r=e.query;let o=n.queries.get(r);o?!o.ba()&&e.Da()&&(i=2):(o=new Eh,i=e.Da()?0:1);try{switch(i){case 0:o.wa=await n.onListen(r,!0);break;case 1:o.wa=await n.onListen(r,!1);break;case 2:await n.onFirstRemoteStoreListen(r)}}catch(t){const n=_h(t,`Initialization of query '${Va(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&Ah(n)}async function Ch(t,e){const n=Xr(t),i=e.query;let r=3;const o=n.queries.get(i);if(o){const t=o.Sa.indexOf(e);t>=0&&(o.Sa.splice(t,1),0===o.Sa.length?r=e.Da()?0:1:!o.ba()&&e.Da()&&(r=2))}switch(r){case 0:return n.queries.delete(i),n.onUnlisten(i,!0);case 1:return n.queries.delete(i),n.onUnlisten(i,!1);case 2:return n.onLastRemoteStoreUnlisten(i);default:return}}function Ph(t,e){const n=Xr(t);let i=!1;for(const t of e){const e=t.query,r=n.queries.get(e);if(r){for(const e of r.Sa)e.Fa(t)&&(i=!0);r.wa=t}}i&&Ah(n)}function xh(t,e,n){const i=Xr(t),r=i.queries.get(e);if(r)for(const t of r.Sa)t.onError(n);i.queries.delete(e)}function Ah(t){t.Ca.forEach(t=>{t.next()})}var Lh,Oh;(Oh=Lh||(Lh={})).Ma="default",Oh.Cache="cache";class Mh{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Th(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==e;return(!this.options.qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}ka(t){t=Th.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==Lh.Cache}}class Nh{constructor(t){this.key=t}}class Rh{constructor(t){this.key=t}}class Dh{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ec(),this.mutatedKeys=ec(),this.eu=za(t),this.tu=new wh(this.eu)}get nu(){return this.Ya}ru(t,e){const n=e?e.iu:new bh,i=e?e.tu:this.tu;let r=e?e.mutatedKeys:this.mutatedKeys,o=i,s=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((t,e)=>{const u=i.get(t),l=Ba(this.query,e)?e:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.su(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.eu(l,a)>0||c&&this.eu(l,c)<0)&&(s=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(s=!0)),f&&(l?(o=o.add(l),r=d?r.add(t):r.delete(t)):(o=o.delete(t),r=r.delete(t)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const t="F"===this.query.limitType?o.last():o.first();o=o.delete(t.key),r=r.delete(t.key),n.track({type:1,doc:t})}return{tu:o,iu:n,Cs:s,mutatedKeys:r}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,i){const r=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const o=t.iu.ya();o.sort((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Kr(20277,{Rt:t})}};return n(t)-n(e)}(t.type,e.type)||this.eu(t.doc,e.doc)),this.ou(n),i=i??!1;const s=e&&!i?this._u():[],a=0===this.Xa.size&&this.current&&!i?1:0,c=a!==this.Za;return this.Za=a,0!==o.length||c?{snapshot:new Th(this.query,t.tu,r,o,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:s}:{au:s}}va(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({tu:this.tu,iu:new bh,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),t.modifiedDocuments.forEach(t=>{}),t.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=ec(),this.tu.forEach(t=>{this.uu(t.key)&&(this.Xa=this.Xa.add(t.key))});const e=[];return t.forEach(t=>{this.Xa.has(t)||e.push(new Rh(t))}),this.Xa.forEach(n=>{t.has(n)||e.push(new Nh(n))}),e}cu(t){this.Ya=t.Qs,this.Xa=ec();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return Th.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const jh="SyncEngine";class Fh{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Uh{constructor(t){this.key=t,this.hu=!1}}class Vh{constructor(t,e,n,i,r,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new qa(t=>Ua(t),Fa),this.Iu=new Map,this.Eu=new Set,this.du=new ls(So.comparator),this.Au=new Map,this.Ru=new Ju,this.Vu={},this.mu=new Map,this.fu=Bu.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function Bh(t,e,n=!0){const i=ad(t);let r;const o=i.Tu.get(e);return o?(i.sharedClientState.addLocalQueryTarget(o.targetId),r=o.view.lu()):r=await Gh(i,e,n,!0),r}async function zh(t,e){const n=ad(t);await Gh(n,e,!0,!1)}async function Gh(t,e,n,i){const r=await function(t,e){const n=Xr(t);return n.persistence.runTransaction("Allocate target","readwrite",t=>{let i;return n.Pi.getTargetData(t,e).next(r=>r?(i=r,zo.resolve(i)):n.Pi.allocateTargetId(t).next(r=>(i=new Ou(e,r,"TargetPurposeListen",t.currentSequenceNumber),n.Pi.addTargetData(t,i).next(()=>i))))}).then(t=>{const i=n.Ms.get(t.targetId);return(null===i||t.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(t.targetId,t),n.xs.set(e,t.targetId)),t})}(t.localStore,Ra(e)),o=r.targetId,s=t.sharedClientState.addLocalQueryTarget(o,n);let a;return i&&(a=await async function(t,e,n,i,r){t.pu=(e,n,i)=>async function(t,e,n,i){let r=e.view.ru(n);r.Cs&&(r=await vl(t.localStore,e.query,!1).then(({documents:t})=>e.view.ru(t,r)));const o=i&&i.targetChanges.get(e.targetId),s=i&&null!=i.targetMismatches.get(e.targetId),a=e.view.applyChanges(r,t.isPrimaryClient,o,s);return ed(t,e.targetId,a.au),a.snapshot}(t,e,n,i);const o=await vl(t.localStore,e,!0),s=new Dh(e,o.Qs),a=s.ru(o.documents),c=$c.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==t.onlineState,r),u=s.applyChanges(a,t.isPrimaryClient,c);ed(t,n,u.au);const l=new Fh(e,n,s);return t.Tu.set(e,l),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),u.snapshot}(t,e,o,"current"===s,r.resumeToken)),t.isPrimaryClient&&n&&Zl(t.remoteStore,r),a}async function qh(t,e,n){const i=Xr(t),r=i.Tu.get(e),o=i.Iu.get(r.targetId);if(o.length>1)return i.Iu.set(r.targetId,o.filter(t=>!Fa(t,e))),void i.Tu.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||await yl(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),n&&Wl(i.remoteStore,r.targetId),Jh(i,r.targetId)}).catch(Bo)):(Jh(i,r.targetId),await yl(i.localStore,r.targetId,!0))}async function Hh(t,e){const n=Xr(t),i=n.Tu.get(e),r=n.Iu.get(i.targetId);n.isPrimaryClient&&1===r.length&&(n.sharedClientState.removeLocalQueryTarget(i.targetId),Wl(n.remoteStore,i.targetId))}async function Zh(t,e){const n=Xr(t);try{const t=await function(t,e){const n=Xr(t),i=e.snapshotVersion;let r=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",t=>{const o=n.Ns.newChangeBuffer({trackRemovals:!0});r=n.Ms;const s=[];e.targetChanges.forEach((o,a)=>{const c=r.get(a);if(!c)return;s.push(n.Pi.removeMatchingKeys(t,o.removedDocuments,a).next(()=>n.Pi.addMatchingKeys(t,o.addedDocuments,a)));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(ys.EMPTY_BYTE_STRING,Do.min()).withLastLimboFreeSnapshotVersion(Do.min()):o.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(o.resumeToken,i)),r=r.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,o)&&s.push(n.Pi.updateTargetData(t,u))});let a=Za(),c=ec();if(e.documentUpdates.forEach(i=>{e.resolvedLimboDocuments.has(i)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,i))}),s.push(function(t,e,n){let i=ec(),r=ec();return n.forEach(t=>i=i.add(t)),e.getEntries(t,i).next(t=>{let i=Za();return n.forEach((n,o)=>{const s=t.get(n);o.isFoundDocument()!==s.isFoundDocument()&&(r=r.add(n)),o.isNoDocument()&&o.version.isEqual(Do.min())?(e.removeEntry(n,o.readTime),i=i.insert(n,o)):!s.isValidDocument()||o.version.compareTo(s.version)>0||0===o.version.compareTo(s.version)&&s.hasPendingWrites?(e.addEntry(o),i=i.insert(n,o)):Hr(dl,"Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",o.version)}),{ks:i,qs:r}})}(t,o,e.documentUpdates).next(t=>{a=t.ks,c=t.qs})),!i.isEqual(Do.min())){const e=n.Pi.getLastRemoteSnapshotVersion(t).next(e=>n.Pi.setTargetsMetadata(t,t.currentSequenceNumber,i));s.push(e)}return zo.waitFor(s).next(()=>o.apply(t)).next(()=>n.localDocuments.getLocalViewOfDocuments(t,a,c)).next(()=>a)}).then(t=>(n.Ms=r,t))}(n.localStore,e);e.targetChanges.forEach((t,e)=>{const i=n.Au.get(e);i&&(Yr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?i.hu=!0:t.modifiedDocuments.size>0?Yr(i.hu,14607):t.removedDocuments.size>0&&(Yr(i.hu,42227),i.hu=!1))}),await rd(n,t,e)}catch(t){await Bo(t)}}function Wh(t,e,n){const i=Xr(t);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const t=[];i.Tu.forEach((n,i)=>{const r=i.view.va(e);r.snapshot&&t.push(r.snapshot)}),function(t,e){const n=Xr(t);n.onlineState=e;let i=!1;n.queries.forEach((t,n)=>{for(const t of n.Sa)t.va(e)&&(i=!0)}),i&&Ah(n)}(i.eventManager,e),t.length&&i.Pu.H_(t),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function $h(t,e,n){const i=Xr(t);i.sharedClientState.updateQueryState(e,"rejected",n);const r=i.Au.get(e),o=r&&r.key;if(o){let t=new ls(So.comparator);t=t.insert(o,ia.newNoDocument(o,Do.min()));const n=ec().add(o),r=new Wc(Do.min(),new Map,new ls(fo),t,n);await Zh(i,r),i.du=i.du.remove(o),i.Au.delete(e),id(i)}else await yl(i.localStore,e,!1).then(()=>Jh(i,e,n)).catch(Bo)}async function Kh(t,e){const n=Xr(t),i=e.batch.batchId;try{const t=await function(t,e){const n=Xr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",t=>{const i=e.batch.keys(),r=n.Ns.newChangeBuffer({trackRemovals:!0});return function(t,e,n,i){const r=n.batch,o=r.keys();let s=zo.resolve();return o.forEach(t=>{s=s.next(()=>i.getEntry(e,t)).next(e=>{const o=n.docVersions.get(t);Yr(null!==o,48541),e.version.compareTo(o)<0&&(r.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),i.addEntry(e)))})}),s.next(()=>t.mutationQueue.removeMutationBatch(e,r))}(n,t,e,r).next(()=>r.apply(t)).next(()=>n.mutationQueue.performConsistencyCheck(t)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(t,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=ec();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e))).next(()=>n.localDocuments.getDocuments(t,i))})}(n.localStore,e);Xh(n,i,null),Yh(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await rd(n,t)}catch(t){await Bo(t)}}async function Qh(t,e,n){const i=Xr(t);try{const t=await function(t,e){const n=Xr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let i;return n.mutationQueue.lookupMutationBatch(t,e).next(e=>(Yr(null!==e,37113),i=e.keys(),n.mutationQueue.removeMutationBatch(t,e))).next(()=>n.mutationQueue.performConsistencyCheck(t)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(t,i,e)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,i)).next(()=>n.localDocuments.getDocuments(t,i))})}(i.localStore,e);Xh(i,e,n),Yh(i,e),i.sharedClientState.updateMutationState(e,"rejected",n),await rd(i,t)}catch(n){await Bo(n)}}function Yh(t,e){(t.mu.get(e)||[]).forEach(t=>{t.resolve()}),t.mu.delete(e)}function Xh(t,e,n){const i=Xr(t);let r=i.Vu[i.currentUser.toKey()];if(r){const t=r.get(e);t&&(n?t.reject(n):t.resolve(),r=r.remove(e)),i.Vu[i.currentUser.toKey()]=r}}function Jh(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const i of t.Iu.get(e))t.Tu.delete(i),n&&t.Pu.yu(i,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(e=>{t.Ru.containsKey(e)||td(t,e)})}function td(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);null!==n&&(Wl(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),id(t))}function ed(t,e,n){for(const i of n)i instanceof Nh?(t.Ru.addReference(i.key,e),nd(t,i)):i instanceof Rh?(Hr(jh,"Document no longer in limbo: "+i.key),t.Ru.removeReference(i.key,e),t.Ru.containsKey(i.key)||td(t,i.key)):Kr(19791,{wu:i})}function nd(t,e){const n=e.key,i=n.path.canonicalString();t.du.get(n)||t.Eu.has(i)||(Hr(jh,"New document in limbo: "+n),t.Eu.add(i),id(t))}function id(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new So(bo.fromString(e)),i=t.fu.next();t.Au.set(i,new Uh(n)),t.du=t.du.insert(n,i),Zl(t.remoteStore,new Ou(Ra(La(n.path)),i,"TargetPurposeLimboResolution",qo.ce))}}async function rd(t,e,n){const i=Xr(t),r=[],o=[],s=[];i.Tu.isEmpty()||(i.Tu.forEach((t,a)=>{s.push(i.pu(a,e,n).then(t=>{if((t||n)&&i.isPrimaryClient){const e=t?!t.fromCache:n?.targetChanges.get(a.targetId)?.current;i.sharedClientState.updateQueryState(a.targetId,e?"current":"not-current")}if(t){r.push(t);const e=ul.As(a.targetId,t);o.push(e)}}))}),await Promise.all(s),i.Pu.H_(r),await async function(t,e){const n=Xr(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>zo.forEach(e,e=>zo.forEach(e.Es,i=>n.persistence.referenceDelegate.addReference(t,e.targetId,i)).next(()=>zo.forEach(e.ds,i=>n.persistence.referenceDelegate.removeReference(t,e.targetId,i)))))}catch(t){if(!Go(t))throw t;Hr(dl,"Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ms.get(e),i=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(i);n.Ms=n.Ms.insert(e,r)}}}(i.localStore,o))}async function od(t,e){const n=Xr(t);if(!n.currentUser.isEqual(e)){Hr(jh,"User change. New user:",e.toKey());const t=await pl(n.localStore,e);n.currentUser=e,function(t){t.mu.forEach(t=>{t.forEach(t=>{t.reject(new to(Jr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.mu.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await rd(n,t.Ls)}}function sd(t,e){const n=Xr(t),i=n.Au.get(e);if(i&&i.hu)return ec().add(i.key);{let t=ec();const i=n.Iu.get(e);if(!i)return t;for(const e of i){const i=n.Tu.get(e);t=t.unionWith(i.view.nu)}return t}}function ad(t){const e=Xr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Zh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=sd.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=$h.bind(null,e),e.Pu.H_=Ph.bind(null,e.eventManager),e.Pu.yu=xh.bind(null,e.eventManager),e}function cd(t){const e=Xr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Kh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Qh.bind(null,e),e}class ud{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Ml(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return function(t,e,n,i){return new fl(t,e,n,i)}(this.persistence,new hl,t.initialUser,this.serializer)}Cu(t){return new ol(al.mi,this.serializer)}Du(t){return new wl}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ud.provider={build:()=>new ud};class ld extends ud{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){Yr(this.persistence.referenceDelegate instanceof cl,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Hu(n,t.asyncQueue,e)}Cu(t){const e=void 0!==this.cacheSizeBytes?Vu.withCacheSize(this.cacheSizeBytes):Vu.DEFAULT;return new ol(t=>cl.mi(t,e),this.serializer)}}class hd{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Wh(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=od.bind(null,this.syncEngine),await async function(t,e){const n=Xr(t);e?(n.Ea.delete(2),await ql(n)):e||(n.Ea.add(2),await Hl(n),n.Ra.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Sh}createDatastore(t){const e=Ml(t.databaseInfo.databaseId),n=function(t){return new Ll(t)}(t.databaseInfo);return function(t,e,n,i){return new Vl(t,e,n,i)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,i,r){return new Gl(t,e,n,i,r)}(this.localStore,this.datastore,t.asyncQueue,t=>Wh(this.syncEngine,t,0),El.v()?new El:new bl)}createSyncEngine(t,e){return function(t,e,n,i,r,o,s){const a=new Vh(t,e,n,i,r,o);return s&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await async function(t){const e=Xr(t);Hr(zl,"RemoteStore shutting down."),e.Ea.add(5),await Hl(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}hd.provider={build:()=>new hd};class dd{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Zr("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout(()=>{this.muted||t(e)},0)}}const fd="FirestoreClient";class pd{constructor(t,e,n,i,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=Br.UNAUTHENTICATED,this.clientId=ho.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,async t=>{Hr(fd,"Received user=",t.uid),await this.authCredentialListener(t),this.user=t}),this.appCheckCredentials.start(n,t=>(Hr(fd,"Received new app check token=",t),this.appCheckCredentialListener(t,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new eo;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=_h(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}}async function md(t,e){t.asyncQueue.verifyOperationInProgress(),Hr(fd,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener(async t=>{i.isEqual(t)||(await pl(e.localStore,t),i=t)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function gd(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Hr(fd,"Using user provided OfflineComponentProvider");try{await md(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===Jr.FAILED_PRECONDITION||t.code===Jr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;Wr("Error using user provided cache. Falling back to memory cache: "+n),await md(t,new ud)}}else Hr(fd,"Using default OfflineComponentProvider"),await md(t,new ld(void 0));return t._offlineComponents}(t);Hr(fd,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(t=>mh(e.remoteStore,t)),t.setAppCheckTokenChangeListener((t,n)=>mh(e.remoteStore,n)),t._onlineComponents=e}async function yd(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Hr(fd,"Using user provided OnlineComponentProvider"),await gd(t,t._uninitializedComponentsProvider._online)):(Hr(fd,"Using default OnlineComponentProvider"),await gd(t,new hd))),t._onlineComponents}async function vd(t){const e=await yd(t),n=e.eventManager;return n.onListen=Bh.bind(null,e.syncEngine),n.onUnlisten=qh.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=zh.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=Hh.bind(null,e.syncEngine),n}function _d(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const wd=new Map,bd="firestore.googleapis.com",Td=!0;class Ed{constructor(t){if(void 0===t.host){if(void 0!==t.ssl)throw new to(Jr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=bd,this.ssl=Td}else this.host=t.host,this.ssl=t.ssl??Td;if(this.isUsingEmulator=void 0!==t.emulatorOptions,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=Uu;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new to(Jr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,i){if(!0===e&&!0===i)throw new to(Jr.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=_d(t.experimentalLongPollingOptions??{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new to(Jr.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new to(Jr.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new to(Jr.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Sd{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ed({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new to(Jr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new to(Jr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ed(t),this._emulatorOptions=t.emulatorOptions||{},void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new io;switch(t.type){case"firstParty":return new ao(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new to(Jr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=wd.get(t);e&&(Hr("ComponentProvider","Removing Datastore"),wd.delete(t),e.terminate())}(this),Promise.resolve()}}class Id{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Id(this.firestore,t,this._query)}}class kd{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Cd(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new kd(this.firestore,t,this._key)}toJSON(){return{type:kd._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(Oo(e,kd._jsonSchema))return new kd(t,n||null,new So(bo.fromString(e.referencePath)))}}kd._jsonSchemaVersion="firestore/documentReference/1.0",kd._jsonSchema={type:Lo("string",kd._jsonSchemaVersion),referencePath:Lo("string")};class Cd extends Id{constructor(t,e,n){super(t,e,La(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new kd(this.firestore,null,new So(t))}withConverter(t){return new Cd(this.firestore,t,this._path)}}function Pd(t,e,...n){if(t=z(t),Io("collection","path",e),t instanceof Sd){const i=bo.fromString(e,...n);return Co(i),new Cd(t,null,i)}{if(!(t instanceof kd||t instanceof Cd))throw new to(Jr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(bo.fromString(e,...n));return Co(i),new Cd(t.firestore,null,i)}}function xd(t,e,...n){if(t=z(t),1===arguments.length&&(e=ho.newId()),Io("doc","path",e),t instanceof Sd){const i=bo.fromString(e,...n);return ko(i),new kd(t,null,new So(i))}{if(!(t instanceof kd||t instanceof Cd))throw new to(Jr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(bo.fromString(e,...n));return ko(i),new kd(t.firestore,t instanceof Cd?t.converter:null,new So(i))}}const Ad="AsyncQueue";class Ld{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Nl(this,"async_queue_retry"),this._c=()=>{const t=Ol();t&&Hr(Ad,"Visibility state changed to "+t.visibilityState),this.M_.w_()},this.ac=t;const e=Ol();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=Ol();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise(()=>{});const e=new eo;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Xu.push(t),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Go(t))throw t;Hr(Ad,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(t){const e=this.ac.then(()=>(this.rc=!0,t().catch(t=>{throw this.nc=t,this.rc=!1,Zr("INTERNAL UNHANDLED ERROR: ",Od(t)),t}).then(t=>(this.rc=!1,t))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const i=vh.createAndSchedule(this,t,e,n,t=>this.hc(t));return this.tc.push(i),i}uc(){this.nc&&Kr(47125,{Pc:Od(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do{t=this.ac,await t}while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then(()=>{this.tc.sort((t,e)=>t.targetTimeMs-e.targetTimeMs);for(const e of this.tc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Tc()})}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function Od(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}class Md extends Sd{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new Ld,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Ld(t),this._firestoreClient=void 0,await t}}}function Nd(t){if(t._terminated)throw new to(Jr.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||function(t){const e=t._freezeSettings(),n=function(t,e,n,i){return new xs(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,_d(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator)}(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new pd(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(t){const e=t?._online.build();return{_offline:t?._offline.build(e),_online:e}}(t._componentsProvider))}(t),t._firestoreClient}class Rd{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Rd(ys.fromBase64String(t))}catch(t){throw new to(Jr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Rd(ys.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Rd._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Oo(t,Rd._jsonSchema))return Rd.fromBase64String(t.bytes)}}Rd._jsonSchemaVersion="firestore/bytes/1.0",Rd._jsonSchema={type:Lo("string",Rd._jsonSchemaVersion),bytes:Lo("string")};class Dd{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new to(Jr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Eo(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class jd{constructor(t){this._methodName=t}}class Fd{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new to(Jr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new to(Jr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return fo(this._lat,t._lat)||fo(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Fd._jsonSchemaVersion}}static fromJSON(t){if(Oo(t,Fd._jsonSchema))return new Fd(t.latitude,t.longitude)}}Fd._jsonSchemaVersion="firestore/geoPoint/1.0",Fd._jsonSchema={type:Lo("string",Fd._jsonSchemaVersion),latitude:Lo("number"),longitude:Lo("number")};class Ud{constructor(t){this._values=(t||[]).map(t=>t)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this._values,t._values)}toJSON(){return{type:Ud._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Oo(t,Ud._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(t=>"number"==typeof t))return new Ud(t.vectorValues);throw new to(Jr.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ud._jsonSchemaVersion="firestore/vectorValue/1.0",Ud._jsonSchema={type:Lo("string",Ud._jsonSchemaVersion),vectorValues:Lo("object")};const Vd=/^__.*__$/;class Bd{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new xc(t,this.data,this.fieldMask,e,this.fieldTransforms):new Pc(t,this.data,e,this.fieldTransforms)}}class zd{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new xc(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Gd(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Kr(40011,{Ac:t})}}class qd{constructor(t,e,n,i,r,o){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===r&&this.Rc(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new qd({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.gc(t),n}yc(t){const e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.Rc(),n}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return af(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(0===t.length)throw this.Sc("Document fields must not be empty");if(Gd(this.Ac)&&Vd.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class Hd{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Ml(t)}Cc(t,e,n,i=!1){return new qd({Ac:t,methodName:e,Dc:n,path:Eo.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Zd(t){const e=t._freezeSettings(),n=Ml(t._databaseId);return new Hd(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Wd(t,e,n,i,r,o={}){const s=t.Cc(o.merge||o.mergeFields?2:0,e,n,r);nf("Data must be an object, but it was:",s,i);const a=tf(i,s);let c,u;if(o.merge)c=new ms(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){const t=[];for(const i of o.mergeFields){const r=rf(e,i,n);if(!s.contains(r))throw new to(Jr.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);cf(t,r)||t.push(r)}c=new ms(t),u=s.fieldTransforms.filter(t=>c.covers(t.field))}else c=null,u=s.fieldTransforms;return new Bd(new ea(a),c,u)}class $d extends jd{_toFieldTransform(t){if(2!==t.Ac)throw 1===t.Ac?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof $d}}function Kd(t,e,n){return new qd({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Qd extends jd{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){const e=Kd(this,t,!0),n=this.vc.map(t=>Jd(t,e)),i=new hc(n);return new vc(t.path,i)}isEqual(t){return t instanceof Qd&&R(this.vc,t.vc)}}class Yd extends jd{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){const e=Kd(this,t,!0),n=this.vc.map(t=>Jd(t,e)),i=new fc(n);return new vc(t.path,i)}isEqual(t){return t instanceof Yd&&R(this.vc,t.vc)}}function Xd(t,e,n,i=!1){return Jd(n,t.Cc(i?4:3,e))}function Jd(t,e){if(ef(t=z(t)))return nf("Unsupported field value:",e,t),tf(t,e);if(t instanceof jd)return function(t,e){if(!Gd(e.Ac))throw e.Sc(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Sc(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&4!==e.Ac)throw e.Sc("Nested arrays are not supported");return function(t,e){const n=[];let i=0;for(const r of t){let t=Jd(r,e.wc(i));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),i++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=z(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return oc(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Ro.fromDate(t);return{timestampValue:au(e.serializer,n)}}if(t instanceof Ro){const n=new Ro(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:au(e.serializer,n)}}if(t instanceof Fd)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Rd)return{bytesValue:cu(e.serializer,t._byteString)};if(t instanceof kd){const n=e.databaseId,i=t.firestore._databaseId;if(!i.isEqual(n))throw e.Sc(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:hu(t.firestore._databaseId||e.databaseId,t._key.path)}}if(t instanceof Ud)return function(t,e){return{mapValue:{fields:{[Os]:{stringValue:Rs},[Ds]:{arrayValue:{values:t.toArray().map(t=>{if("number"!=typeof t)throw e.Sc("VectorValues must only contain numeric values.");return ic(e.serializer,t)})}}}}}}(t,e);throw e.Sc(`Unsupported field value: ${xo(t)}`)}(t,e)}function tf(t,e){const n={};return us(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):cs(t,(t,i)=>{const r=Jd(i,e.mc(t));null!=r&&(n[t]=r)}),{mapValue:{fields:n}}}function ef(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ro||t instanceof Fd||t instanceof Rd||t instanceof kd||t instanceof jd||t instanceof Ud)}function nf(t,e,n){if(!ef(n)||!Po(n)){const i=xo(n);throw"an object"===i?e.Sc(t+" a custom object"):e.Sc(t+" "+i)}}function rf(t,e,n){if((e=z(e))instanceof Dd)return e._internalPath;if("string"==typeof e)return sf(t,e);throw af("Field path arguments must be of type string or ",t,!1,void 0,n)}const of=new RegExp("[~\\*/\\[\\]]");function sf(t,e,n){if(e.search(of)>=0)throw af(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Dd(...e.split("."))._internalPath}catch(i){throw af(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function af(t,e,n,i,r){const o=i&&!i.isEmpty(),s=void 0!==r;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(o||s)&&(c+=" (found",o&&(c+=` in field ${i}`),s&&(c+=` in document ${r}`),c+=")"),new to(Jr.INVALID_ARGUMENT,a+t+c)}function cf(t,e){return t.some(t=>t.isEqual(e))}class uf{constructor(t,e,n,i,r){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new kd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new lf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(hf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class lf extends uf{data(){return super.data()}}function hf(t,e){return"string"==typeof e?sf(t,e):e instanceof Dd?e._internalPath:e._delegate._internalPath}class df{}class ff extends df{}function pf(t,e,...n){let i=[];e instanceof df&&i.push(e),i=i.concat(n),function(t){const e=t.filter(t=>t instanceof yf).length,n=t.filter(t=>t instanceof mf).length;if(e>1||e>0&&n>0)throw new to(Jr.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const e of i)t=e._apply(t);return t}class mf extends ff{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new mf(t,e,n)}_apply(t){const e=this._parse(t);return xf(t._query,e),new Id(t.firestore,t.converter,Da(t._query,e))}_parse(t){const e=Zd(t.firestore),n=function(t,e,n,i,r,o,s){let a;if(r.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new to(Jr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${o}' queries on documentId().`);if("in"===o||"not-in"===o){Pf(s,o);const e=[];for(const n of s)e.push(Cf(i,t,n));a={arrayValue:{values:e}}}else a=Cf(i,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Pf(s,o),a=Xd(n,"where",s,"in"===o||"not-in"===o);return la.create(r,o,a)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}function gf(t,e,n){const i=e,r=hf("where",t);return mf._create(r,i,n)}class yf extends df{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new yf(t,e)}_parse(t){const e=this._queryConstraints.map(e=>e._parse(t)).filter(t=>t.getFilters().length>0);return 1===e.length?e[0]:ha.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const i=e.getFlattenedFilters();for(const t of i)xf(n,t),n=Da(n,t)}(t._query,e),new Id(t.firestore,t.converter,Da(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class vf extends ff{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new vf(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new to(Jr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new to(Jr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new aa(e,n)}(t._query,this._field,this._direction);return new Id(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new Aa(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function _f(t,e="asc"){const n=e,i=hf("orderBy",t);return vf._create(i,n)}class wf extends ff{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new wf(t,e,n)}_apply(t){return new Id(t.firestore,t.converter,ja(t._query,this._limit,this._limitType))}}function bf(t){return function(t,e){if(e<=0)throw new to(Jr.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}("limit",t),wf._create("limit",t,"F")}class Tf extends ff{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new Tf(t,e,n)}_apply(t){const e=kf(t,this.type,this._docOrFields,this._inclusive);return new Id(t.firestore,t.converter,function(t,e){return new Aa(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function Ef(...t){return Tf._create("startAt",t,!0)}class Sf extends ff{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new Sf(t,e,n)}_apply(t){const e=kf(t,this.type,this._docOrFields,this._inclusive);return new Id(t.firestore,t.converter,function(t,e){return new Aa(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function If(...t){return Sf._create("endAt",t,!0)}function kf(t,e,n,i){if(n[0]=z(n[0]),n[0]instanceof uf)return function(t,e,n,i,r){if(!i)throw new to(Jr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const o=[];for(const n of Na(t))if(n.field.isKeyField())o.push(Zs(e,i.key));else{const t=i.data.field(n.field);if(ks(t))throw new to(Jr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new to(Jr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}o.push(t)}return new ra(o,r)}(t._query,t.firestore._databaseId,e,n[0]._document,i);{const r=Zd(t.firestore);return function(t,e,n,i,r,o){const s=t.explicitOrderBy;if(r.length>s.length)throw new to(Jr.INVALID_ARGUMENT,`Too many arguments provided to ${i}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let o=0;o<r.length;o++){const c=r[o];if(s[o].field.isKeyField()){if("string"!=typeof c)throw new to(Jr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${i}(), but got a ${typeof c}`);if(!Ma(t)&&-1!==c.indexOf("/"))throw new to(Jr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${i}() must be a plain document ID, but '${c}' contains a slash.`);const n=t.path.child(bo.fromString(c));if(!So.isDocumentKey(n))throw new to(Jr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${i}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const r=new So(n);a.push(Zs(e,r))}else{const t=Xd(n,i,c);a.push(t)}}return new ra(a,o)}(t._query,t.firestore._databaseId,r,e,n,i)}}function Cf(t,e,n){if("string"==typeof(n=z(n))){if(""===n)throw new to(Jr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ma(e)&&-1!==n.indexOf("/"))throw new to(Jr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const i=e.path.child(bo.fromString(n));if(!So.isDocumentKey(i))throw new to(Jr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Zs(t,new So(i))}if(n instanceof kd)return Zs(t,n._key);throw new to(Jr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${xo(n)}.`)}function Pf(t,e){if(!Array.isArray(t)||0===t.length)throw new to(Jr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function xf(t,e){const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new to(Jr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new to(Jr.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class Af{convertValue(t,e="none"){switch(js(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ws(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(bs(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw Kr(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return cs(t,(t,i)=>{n[t]=this.convertValue(i,e)}),n}convertVectorValue(t){const e=t.fields?.[Ds].arrayValue?.values?.map(t=>ws(t.doubleValue));return new Ud(e)}convertGeoPoint(t){return new Fd(ws(t.latitude),ws(t.longitude))}convertArray(t,e){return(t.values||[]).map(t=>this.convertValue(t,e))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Cs(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ps(t));default:return null}}convertTimestamp(t){const e=_s(t);return new Ro(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=bo.fromString(t);Yr(Lu(n),9688,{name:t});const i=new Ls(n.get(1),n.get(3)),r=new So(n.popFirst(5));return i.isEqual(e)||Zr(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),r}}function Lf(t,e,n){let i;return i=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,i}class Of{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Mf extends uf{constructor(t,e,n,i,r,o){super(t,e,n,i,o),this._firestore=t,this._firestoreImpl=t,this.metadata=r}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Nf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(hf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new to(Jr.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Mf._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),t&&t.isValidDocument()&&t.isFoundDocument()?(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e):e}}Mf._jsonSchemaVersion="firestore/documentSnapshot/1.0",Mf._jsonSchema={type:Lo("string",Mf._jsonSchemaVersion),bundleSource:Lo("string","DocumentSnapshot"),bundleName:Lo("string"),bundle:Lo("string")};class Nf extends Mf{data(t={}){return super.data(t)}}class Rf{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new Of(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Nf(this._firestore,this._userDataWriter,n.key,n,new Of(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new to(Jr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map(n=>{const i=new Nf(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Of(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:e++}})}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(t=>e||3!==t.type).map(e=>{const i=new Nf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Of(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let r=-1,o=-1;return 0!==e.type&&(r=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),o=n.indexOf(e.doc.key)),{type:Df(e.type),doc:i,oldIndex:r,newIndex:o}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new to(Jr.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=Rf._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=ho.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],n=[],i=[];return this.docs.forEach(t=>{null!==t._document&&(e.push(t._document),n.push(this._userDataWriter.convertObjectMap(t._document.data.value.mapValue.fields,"previous")),i.push(t.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function Df(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Kr(61501,{type:t})}}function jf(t){t=Ao(t,kd);const e=Ao(t.firestore,Md);return function(t,e,n={}){const i=new eo;return t.asyncQueue.enqueueAndForget(async()=>function(t,e,n,i,r){const o=new dd({next:a=>{o.Nu(),e.enqueueAndForget(()=>Ch(t,s));const c=a.docs.has(n);!c&&a.fromCache?r.reject(new to(Jr.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&i&&"server"===i.source?r.reject(new to(Jr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(a)},error:t=>r.reject(t)}),s=new Mh(La(n.path),o,{includeMetadataChanges:!0,qa:!0});return kh(t,s)}(await vd(t),t.asyncQueue,e,n,i)),i.promise}(Nd(e),t._key).then(n=>function(t,e,n){const i=n.docs.get(e._key),r=new Ff(t);return new Mf(t,r,e._key,i,new Of(n.hasPendingWrites,n.fromCache),e.converter)}(e,t,n))}Rf._jsonSchemaVersion="firestore/querySnapshot/1.0",Rf._jsonSchema={type:Lo("string",Rf._jsonSchemaVersion),bundleSource:Lo("string","QuerySnapshot"),bundleName:Lo("string"),bundle:Lo("string")};class Ff extends Af{constructor(t){super(),this.firestore=t}convertBytes(t){return new Rd(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new kd(this.firestore,null,e)}}function Uf(t){t=Ao(t,Id);const e=Ao(t.firestore,Md),n=Nd(e),i=new Ff(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new to(Jr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),function(t,e,n={}){const i=new eo;return t.asyncQueue.enqueueAndForget(async()=>function(t,e,n,i,r){const o=new dd({next:n=>{o.Nu(),e.enqueueAndForget(()=>Ch(t,s)),n.fromCache&&"server"===i.source?r.reject(new to(Jr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:t=>r.reject(t)}),s=new Mh(n,o,{includeMetadataChanges:!0,qa:!0});return kh(t,s)}(await vd(t),t.asyncQueue,e,n,i)),i.promise}(n,t._query).then(n=>new Rf(e,i,t,n))}function Vf(t,e,n){t=Ao(t,kd);const i=Ao(t.firestore,Md),r=Lf(t.converter,e,n);return Gf(i,[Wd(Zd(i),"setDoc",t._key,r,null!==t.converter,n).toMutation(t._key,wc.none())])}function Bf(t,e,n,...i){t=Ao(t,kd);const r=Ao(t.firestore,Md),o=Zd(r);let s;return s="string"==typeof(e=z(e))||e instanceof Dd?function(t,e,n,i,r,o){const s=t.Cc(1,e,n),a=[rf(e,i,n)],c=[r];if(o.length%2!=0)throw new to(Jr.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<o.length;t+=2)a.push(rf(e,o[t])),c.push(o[t+1]);const u=[],l=ea.empty();for(let t=a.length-1;t>=0;--t)if(!cf(u,a[t])){const e=a[t];let n=c[t];n=z(n);const i=s.yc(e);if(n instanceof $d)u.push(e);else{const t=Jd(n,i);null!=t&&(u.push(e),l.set(e,t))}}const h=new ms(u);return new zd(l,h,s.fieldTransforms)}(o,"updateDoc",t._key,e,n,i):function(t,e,n,i){const r=t.Cc(1,e,n);nf("Data must be an object, but it was:",r,i);const o=[],s=ea.empty();cs(i,(t,i)=>{const a=sf(e,t,n);i=z(i);const c=r.yc(a);if(i instanceof $d)o.push(a);else{const t=Jd(i,c);null!=t&&(o.push(a),s.set(a,t))}});const a=new ms(o);return new zd(s,a,r.fieldTransforms)}(o,"updateDoc",t._key,e),Gf(r,[s.toMutation(t._key,wc.exists(!0))])}function zf(t,e){const n=Ao(t.firestore,Md),i=xd(t),r=Lf(t.converter,e);return Gf(n,[Wd(Zd(t.firestore),"addDoc",i._key,r,null!==t.converter,{}).toMutation(i._key,wc.exists(!1))]).then(()=>i)}function Gf(t,e){return function(t,e){const n=new eo;return t.asyncQueue.enqueueAndForget(async()=>async function(t,e,n){const i=cd(t);try{const t=await function(t,e){const n=Xr(t),i=Ro.now(),r=e.reduce((t,e)=>t.add(e.key),ec());let o,s;return n.persistence.runTransaction("Locally write mutations","readwrite",t=>{let a=Za(),c=ec();return n.Ns.getEntries(t,r).next(t=>{a=t,a.forEach((t,e)=>{e.isValidDocument()||(c=c.add(t))})}).next(()=>n.localDocuments.getOverlayedDocuments(t,a)).next(r=>{o=r;const s=[];for(const t of e){const e=kc(t,o.get(t.key).overlayedDocument);null!=e&&s.push(new xc(t.key,e,na(e.value.mapValue),wc.exists(!0)))}return n.mutationQueue.addMutationBatch(t,i,s,e)}).next(e=>{s=e;const i=e.applyToLocalDocumentSet(o,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,i)})}).then(()=>({batchId:s.batchId,changes:Ka(o)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let i=t.Vu[t.currentUser.toKey()];i||(i=new ls(fo)),i=i.insert(e,n),t.Vu[t.currentUser.toKey()]=i}(i,t.batchId,n),await rd(i,t.changes),await sh(i.remoteStore)}catch(t){const e=_h(t,"Failed to persist write");n.reject(e)}}(await function(t){return yd(t).then(t=>t.syncEngine)}(t),e,n)),n.promise}(Nd(t),e)}function qf(...t){return new Qd("arrayUnion",t)}function Hf(...t){return new Yd("arrayRemove",t)}new WeakMap,function(t,e=!0){!function(t){zr=t}(ie),Xt(new G("firestore",(t,{instanceIdentifier:n,options:i})=>{const r=t.getProvider("app").getImmediate(),o=new Md(new oo(t.getProvider("auth-internal")),new uo(r,t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new to(Jr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ls(t.options.projectId,e)}(r,n),r);return i={useFetchStreams:e,...i},o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),se(Ur,Vr,t),se(Ur,Vr,"esm2020")}();var Zf=re({apiKey:"AIzaSyBcHvgdkcJ0SS9_-t74ycPFJG5VTcSz7j8",authDomain:"guesstheplace-5ba28.firebaseapp.com",databaseURL:"https://guesstheplace-5ba28.firebaseio.com",projectId:"guesstheplace-5ba28",storageBucket:"guesstheplace-5ba28.firebasestorage.app",messagingSenderId:"583921403533",appId:"583921403533"}),Wf=function(t=oe()){const e=Jt(t,"auth");if(e.isInitialized())return e.getImmediate();const n=function(t,e){const n=Jt(t,"auth");if(n.isInitialized()){const t=n.getImmediate();if(R(n.getOptions(),e??{}))return t;we(t,"already-initialized")}return n.initialize({options:e})}(t,{popupRedirectResolver:vr,persistence:[Di,_i,bi]}),i=T("authTokenSyncURL");if(i&&"boolean"==typeof isSecureContext&&isSecureContext){const t=new URL(i,location.origin);if(location.origin===t.origin){const e=(r=t.toString(),async t=>{const e=t&&await t.getIdTokenResult(),n=e&&((new Date).getTime()-Date.parse(e.issuedAtTime))/1e3;if(n&&n>Tr)return;const i=e?.token;Er!==i&&(Er=i,await fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});!function(t,e,n){z(t).beforeAuthStateChanged(e,n)}(n,e,()=>e(n.currentUser)),function(t){z(t).onIdTokenChanged(t=>e(t),void 0,void 0)}(n)}}var r;const o=w("auth");return o&&function(t,e,n){const i=Pn(t);Ie(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const r=!!n?.disableWarnings,o=Un(e),{host:s,port:a}=function(t){const e=Un(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const t=r[1];return{host:t,port:Vn(i.substr(t.length+1))}}{const[t,e]=i.split(":");return{host:t,port:Vn(e)}}}(e),c=null===a?"":`:${a}`,u={url:`${o}//${s}${c}/`},l=Object.freeze({host:s,port:a,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator)return Ie(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),void Ie(R(u,i.config.emulator)&&R(l,i.emulatorConfig),i,"emulator-config-failed");i.config.emulator=u,i.emulatorConfig=l,i.settings.appVerificationDisabledForTesting=!0,S(s)?(I(`${o}//${s}${c}`),P("Auth",!0)):r||function(){function t(){const t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",t):t())}()}(n,`http://${o}`),n}(Zf),$f=function(t){const e="object"==typeof t?t:oe(),n="string"==typeof t?t:As,i=Jt(e,"firestore").getImmediate({identifier:n});if(!i._initialized){const t=(()=>{const t=w("firestore");if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(e+1),10);return"["===t[0]?[t.substring(1,e-1),n]:[t.substring(0,e),n]})();t&&function(t,e,n,i={}){t=Ao(t,Sd);const r=S(e),o=t._getSettings(),s={...o,emulatorOptions:t._getEmulatorOptions()},a=`${e}:${n}`;r&&(I(`https://${a}`),P("Firestore",!0)),o.host!==bd&&o.host!==a&&Wr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...o,host:a,ssl:r,emulatorOptions:i};if(!R(c,s)&&(t._setSettings(c),i.mockUserToken)){let e,n;if("string"==typeof i.mockUserToken)e=i.mockUserToken,n=Br.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",i=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...t};return[y(JSON.stringify({alg:"none",type:"JWT"})),y(JSON.stringify(o)),""].join(".")}(i.mockUserToken,t._app?.options.projectId);const r=i.mockUserToken.sub||i.mockUserToken.user_id;if(!r)throw new to(Jr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Br(r)}t._authCredentials=new ro(new no(e,n))}}(i,...t)}return i}(Zf);function Kf(t){return Kf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kf(t)}function Qf(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function Yf(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Qf(Object(n),!0).forEach(function(e){Xf(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Qf(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Xf(t,e,n){return(e=function(t){var e=function(t){if("object"!=Kf(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Kf(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Kf(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Jf(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return tp(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tp(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function tp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function ep(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return np(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(np(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,np(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,np(h,"constructor",u),np(u,"constructor",c),c.displayName="GeneratorFunction",np(u,r,"GeneratorFunction"),np(h),np(h,r,"Generator"),np(h,i,function(){return this}),np(h,"toString",function(){return"[object Generator]"}),(ep=function(){return{w:o,m:d}})()}function np(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}np=function(t,e,n,i){function o(e,n){np(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},np(t,e,n,i)}function ip(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function rp(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){ip(o,i,r,s,a,"next",t)}function a(t){ip(o,i,r,s,a,"throw",t)}s(void 0)})}}!function(t,e){z(t).setPersistence(e)}(Wf,_i);var op=Pd($f,"users"),sp={register:function(t){return rp(ep().m(function e(){var n,r,o,s,a,c;return ep().w(function(e){for(;;)switch(e.n){case 0:return n=t.email,r=t.password,o=t.username,e.n=1,hi(Wf,n,r);case 1:return s=e.v,a=s.user,c=xd($f,"users",a.uid),e.n=2,Vf(c,{email:n,username:o.toLowerCase(),following:[],createdAt:new Date});case 2:return e.a(2,new i(a.uid,n,o,[]))}},e)}))()},login:function(t){var e=this;return rp(ep().m(function n(){var i,r,o,s;return ep().w(function(n){for(;;)switch(n.n){case 0:return i=t.email,r=t.password,n.n=1,di(Wf,i,r);case 1:return o=n.v,s=e.getUserById(o.user.uid),n.a(2,s)}},n)}))()},logout:function(){return rp(ep().m(function t(){return ep().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,pi(Wf);case 1:return t.a(2)}},t)}))()},getUserById:function(t){return rp(ep().m(function e(){var n,r,o;return ep().w(function(e){for(;;)switch(e.n){case 0:return n=xd($f,"users",t),e.n=1,jf(n);case 1:if((r=e.v).exists()){e.n=2;break}return e.a(2,null);case 2:return o=r.data(),e.a(2,new i(t,o.email||null,o.username||null,o.following||[]))}},e)}))()},getUsersByIds:function(){var t=arguments;return rp(ep().m(function e(){var n,i,r,o,s,a,c,u,l;return ep().w(function(e){for(;;)switch(e.p=e.n){case 0:if((n=t.length>0&&void 0!==t[0]?t[0]:[])&&0!==n.length){e.n=1;break}return e.a(2,[]);case 1:i=[],r=Jf(n),e.p=2,r.s();case 3:if((o=r.n()).done){e.n=6;break}return s=o.value,a=xd($f,"users",s),e.n=4,jf(a);case 4:(c=e.v).exists()&&(u=c.data(),i.push(Yf({id:c.id},u)));case 5:e.n=3;break;case 6:e.n=8;break;case 7:e.p=7,l=e.v,r.e(l);case 8:return e.p=8,r.f(),e.f(8);case 9:return e.a(2,i)}},e,null,[[2,7,8,9]])}))()},getUserFromUsername:function(t){return rp(ep().m(function e(){var n,r,o;return ep().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t){e.n=1;break}return e.a(2,null);case 1:return e.p=1,n=pf(op,gf("username","==",t),_f("username")),e.n=2,Uf(n);case 2:if(!(r=e.v).empty){e.n=3;break}return e.a(2,null);case 3:return e.a(2,r.docs.map(function(t){return i.fromFirebaseUser(t)}));case 4:throw e.p=4,o=e.v,console.error("Error fetching user by username: ",o),o;case 5:return e.a(2)}},e,null,[[1,4]])}))()},findByUsernamePrefix:function(t){var e=arguments;return rp(ep().m(function n(){var r,o,s,a,c,u,l,h;return ep().w(function(n){for(;;)switch(n.p=n.n){case 0:if(r=e.length>1&&void 0!==e[1]?e[1]:10,t){n.n=1;break}return n.a(2,[]);case 1:return n.p=1,o=t.toLowerCase(),s=o,a=o+"",c=pf(op,_f("username"),Ef(s),If(a)),n.n=2,Uf(c);case 2:return u=n.v,l=u.docs.slice(0,r).map(function(t){return i.fromFirebaseDb(t)}),n.a(2,l);case 3:throw n.p=3,h=n.v,console.error("Error searching users by prefix: ",h),h;case 4:return n.a(2)}},n,null,[[1,3]])}))()},followUser:function(t,e){return rp(ep().m(function n(){var i;return ep().w(function(n){for(;;)switch(n.n){case 0:return i=xd($f,"users",t),n.n=1,Bf(i,{following:qf(e)});case 1:return n.a(2)}},n)}))()},unfollowUser:function(t,e){return rp(ep().m(function n(){var i;return ep().w(function(n){for(;;)switch(n.n){case 0:return i=xd($f,"users",t),n.n=1,Bf(i,{following:Hf(e)});case 1:return n.a(2)}},n)}))()},onAuthStateChanged:function(t){fi(Wf,function(){var e=rp(ep().m(function e(n){var r,o;return ep().w(function(e){for(;;)switch(e.n){case 0:if(n){e.n=1;break}return e.a(2,t(null));case 1:return e.n=2,jf(xd($f,"users",n.uid));case 2:(r=e.v).exists()?(o=r.data(),t(new i(o.id,o.email,o.username,o.following||[]))):t(null);case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}())}};function ap(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return cp(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(cp(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,cp(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,cp(h,"constructor",u),cp(u,"constructor",c),c.displayName="GeneratorFunction",cp(u,r,"GeneratorFunction"),cp(h),cp(h,r,"Generator"),cp(h,i,function(){return this}),cp(h,"toString",function(){return"[object Generator]"}),(ap=function(){return{w:o,m:d}})()}function cp(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}cp=function(t,e,n,i){function o(e,n){cp(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},cp(t,e,n,i)}function up(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function lp(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){up(o,i,r,s,a,"next",t)}function a(t){up(o,i,r,s,a,"throw",t)}s(void 0)})}}function hp(){return dp.apply(this,arguments)}function dp(){return dp=lp(ap().m(function t(){return ap().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Wf.authStateReady();case 1:fi(Wf,function(){var t=lp(ap().m(function t(e){var n,r;return ap().w(function(t){for(;;)switch(t.n){case 0:if(!e){t.n=2;break}return t.n=1,sp.getUserById(e.uid);case 1:n=t.v,r=null!=n?n:i.fromFirebaseUser(e),f.setUser(r),t.n=3;break;case 2:f.clearUser();case 3:f.authReady||f.setAuthReady();case 4:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 2:return t.a(2)}},t)})),dp.apply(this,arguments)}function fp(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return pp(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(pp(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,pp(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,pp(h,"constructor",u),pp(u,"constructor",c),c.displayName="GeneratorFunction",pp(u,r,"GeneratorFunction"),pp(h),pp(h,r,"Generator"),pp(h,i,function(){return this}),pp(h,"toString",function(){return"[object Generator]"}),(fp=function(){return{w:o,m:d}})()}function pp(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}pp=function(t,e,n,i){function o(e,n){pp(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},pp(t,e,n,i)}function mp(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function gp(t){return yp.apply(this,arguments)}function yp(){var t;return t=fp().m(function t(e){var n,i,r;return fp().w(function(t){for(;;)switch(t.n){case 0:if(n=e.email,i=e.password,n&&i){t.n=1;break}throw new Error("Email and password required");case 1:return t.n=2,sp.login({email:n,password:i});case 2:return r=t.v,f.setUser(r),t.a(2,r)}},t)}),yp=function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){mp(o,i,r,s,a,"next",t)}function a(t){mp(o,i,r,s,a,"throw",t)}s(void 0)})},yp.apply(this,arguments)}function vp(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return _p(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(_p(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,_p(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,_p(h,"constructor",u),_p(u,"constructor",c),c.displayName="GeneratorFunction",_p(u,r,"GeneratorFunction"),_p(h),_p(h,r,"Generator"),_p(h,i,function(){return this}),_p(h,"toString",function(){return"[object Generator]"}),(vp=function(){return{w:o,m:d}})()}function _p(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}_p=function(t,e,n,i){function o(e,n){_p(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},_p(t,e,n,i)}function wp(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function bp(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return Tp(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(Tp(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Tp(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,Tp(h,"constructor",u),Tp(u,"constructor",c),c.displayName="GeneratorFunction",Tp(u,r,"GeneratorFunction"),Tp(h),Tp(h,r,"Generator"),Tp(h,i,function(){return this}),Tp(h,"toString",function(){return"[object Generator]"}),(bp=function(){return{w:o,m:d}})()}function Tp(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Tp=function(t,e,n,i){function o(e,n){Tp(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},Tp(t,e,n,i)}function Ep(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function Sp(t){return Ip.apply(this,arguments)}function Ip(){var t;return t=bp().m(function t(e){var n,i,r,o;return bp().w(function(t){for(;;)switch(t.n){case 0:if(n=e.email,i=e.password,r=e.username,n&&i){t.n=1;break}throw new Error("Email and password required");case 1:if(!(i.length<6)){t.n=2;break}throw new Error("Password must be >= 6 chars");case 2:return t.n=3,sp.register({email:n,password:i,username:r});case 3:return o=t.v,f.setUser(o),t.a(2,o)}},t)}),Ip=function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){Ep(o,i,r,s,a,"next",t)}function a(t){Ep(o,i,r,s,a,"throw",t)}s(void 0)})},Ip.apply(this,arguments)}function kp(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return Cp(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(Cp(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Cp(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,Cp(h,"constructor",u),Cp(u,"constructor",c),c.displayName="GeneratorFunction",Cp(u,r,"GeneratorFunction"),Cp(h),Cp(h,r,"Generator"),Cp(h,i,function(){return this}),Cp(h,"toString",function(){return"[object Generator]"}),(kp=function(){return{w:o,m:d}})()}function Cp(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Cp=function(t,e,n,i){function o(e,n){Cp(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},Cp(t,e,n,i)}function Pp(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function xp(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"login",n=arguments.length>2?arguments[2]:void 0;document.body.className="login-register-body",t.innerHTML='\n    <div class="auth-center-wrapper">\n        <div class="mb-4 d-flex justify-content-center">\n            <button id="btnShowLogin" class="btn btn-primary me-2">Login</button>\n            <button id="btnShowRegister" class="btn btn-secondary">Register</button>\n        </div>\n        <div id="main"></div>\n    </div>\n    ';var i=t.querySelector("#main"),r=t.querySelector("#btnShowLogin"),o=t.querySelector("#btnShowRegister"),s=function(){i.innerHTML="",function(t){var e=document.createElement("div");e.innerHTML='\n    <div class="card p-4 shadow-sm" style="background-color: var(--card); color: var(--text); border: none;">\n        <form id="login-form">\n            <h2 class="text-center mb-4" style="\n                background: linear-gradient(180deg, #00b3a6, #feb47b);\n                background-clip: text;\n                -webkit-background-clip: text;\n                -webkit-text-fill-color: transparent;\n                font-weight: 700;\n            ">Login</h2>\n            <div class="mb-3">\n                <label for="email" class="form-label" style="color: var(--muted);">Email</label>\n                <input class="form-control" type="email" id="email" name="email" placeholder="you@example.com" required\n                       style="background-color: var(--bg); color: var(--text); border-color: rgba(255,255,255,0.12);" />\n            </div>\n            <div class="mb-3">\n                <label for="password" class="form-label" style="color: var(--muted);">Password</label>\n                <input class="form-control" type="password" id="password" name="password" placeholder="●●●●●●" required\n                       style="background-color: var(--bg); color: var(--text); border-color: rgba(255,255,255,0.12);" />\n            </div>\n            <div class="d-grid mt-4">\n                <button type="submit" class="btn btn-primary btn-lg">Login</button>\n            </div>\n        </form>\n        <div id="loginMessage" class="mt-3 text-center" style="color: var(--muted);" aria-live="polite"></div>\n    </div>\n    ';var n=e.querySelector("#login-form"),i=e.querySelector("#loginMessage");n.addEventListener("submit",function(){var t,e=(t=vp().m(function t(e){var r,o,s,a;return vp().w(function(t){for(;;)switch(t.p=t.n){case 0:return e.preventDefault(),i.textContent="Logging in...",r=new FormData(n),(o=n.querySelector('button[type="submit"]')).disabled=!0,t.p=1,t.n=2,gp({email:r.get("email"),password:r.get("password")});case 2:t.n=4;break;case 3:t.p=3,a=t.v,console.error("Login error:",a),s="Login failed. Please check your credentials.","auth/invalid-credential"===a.code||"auth/user-not-found"===a.code||"auth/wrong-password"===a.code?s="Invalid email or password.":"auth/too-many-requests"===a.code?s="Access temporarily disabled due to too many failed login attempts. Please reset your password or try again later.":"auth/network-request-failed"===a.code&&(s="Network error. Please check your connection and try again."),i.textContent="Error: ".concat(s),o.disabled=!1;case 4:return t.a(2)}},t,null,[[1,3]])}),function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){wp(o,i,r,s,a,"next",t)}function a(t){wp(o,i,r,s,a,"throw",t)}s(void 0)})});return function(t){return e.apply(this,arguments)}}()),t.appendChild(e.firstElementChild),e.firstElementChild}(i),r.classList.add("active"),o.classList.remove("active")},a=function(){i.innerHTML="",function(t){var e=document.createElement("div");e.innerHTML='\n    <div class="card p-4 shadow-sm" style="background-color: var(--card); color: var(--text); border: none;">\n        <form id="register-form">\n             <h2 class="text-center mb-4" style="\n                background: linear-gradient(180deg, #00b3a6, #feb47b);\n                background-clip: text;\n                -webkit-background-clip: text;\n                -webkit-text-fill-color: transparent;\n                font-weight: 700;\n            ">Register</h2>\n            <div class="mb-3">\n                <label for="username" class="form-label" style="color: var(--muted);">Username</label>\n                <input class="form-control" type="text" id="username" name="username" placeholder="yourname" required\n                       style="background-color: var(--bg); color: var(--text); border-color: rgba(255,255,255,0.12);" />\n            </div>\n            <div class="mb-3">\n                <label for="email" class="form-label" style="color: var(--muted);">Email</label>\n                <input class="form-control" type="email" id="email" name="email" placeholder="you@example.com" required\n                       style="background-color: var(--bg); color: var(--text); border-color: rgba(255,255,255,0.12);" />\n            </div>\n            <div class="mb-3">\n                <label for="password" class="form-label" style="color: var(--muted);">Password</label>\n                <input class="form-control" type="password" id="password" name="password" placeholder="●●●●●● (min 6 chars)" required\n                       style="background-color: var(--bg); color: var(--text); border-color: rgba(255,255,255,0.12);" />\n            </div>\n            <div class="d-grid mt-4">\n                <button type="submit" class="btn btn-primary btn-lg">Register</button>\n            </div>\n        </form>\n        <div id="registerMessage" class="mt-3 text-center" style="color: var(--muted);" aria-live="polite"></div>\n    </div>\n    ';var n=e.querySelector("#register-form"),i=e.querySelector("#registerMessage");n.addEventListener("submit",function(){var t,e=(t=kp().m(function t(e){var r,o,s,a;return kp().w(function(t){for(;;)switch(t.p=t.n){case 0:return e.preventDefault(),i.textContent="Registering...",r=new FormData(n),(o=n.querySelector('button[type="submit"]')).disabled=!0,t.p=1,t.n=2,Sp({email:r.get("email"),password:r.get("password"),username:r.get("username")});case 2:t.n=4;break;case 3:t.p=3,a=t.v,console.error("Registration error:",a),s="Registration failed. Please try again.",a.message.includes("Password")?s=a.message:"auth/email-already-in-use"===a.code?s="This email is already registered. Please login or use a different email.":"auth/invalid-email"===a.code?s="Please enter a valid email address.":"auth/operation-not-allowed"===a.code?s="Email/password accounts are not enabled.":"auth/network-request-failed"===a.code&&(s="Network error. Please check your connection."),i.textContent="Error: ".concat(s),o.disabled=!1;case 4:return t.a(2)}},t,null,[[1,3]])}),function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){Pp(o,i,r,s,a,"next",t)}function a(t){Pp(o,i,r,s,a,"throw",t)}s(void 0)})});return function(t){return e.apply(this,arguments)}}()),t.appendChild(e.firstElementChild),e.firstElementChild}(i),o.classList.add("active"),r.classList.remove("active")};r.addEventListener("click",function(t){t.preventDefault(),n?n.navigate("/login"):s()}),o.addEventListener("click",function(t){t.preventDefault(),n?n.navigate("/register"):a()}),"register"===e?a():s()}function Ap(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return Lp(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(Lp(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Lp(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,Lp(h,"constructor",u),Lp(u,"constructor",c),c.displayName="GeneratorFunction",Lp(u,r,"GeneratorFunction"),Lp(h),Lp(h,r,"Generator"),Lp(h,i,function(){return this}),Lp(h,"toString",function(){return"[object Generator]"}),(Ap=function(){return{w:o,m:d}})()}function Lp(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Lp=function(t,e,n,i){function o(e,n){Lp(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},Lp(t,e,n,i)}function Op(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function Mp(){return Np.apply(this,arguments)}function Np(){var t;return t=Ap().m(function t(){return Ap().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,sp.logout();case 1:f.clearUser();case 2:return t.a(2)}},t)}),Np=function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){Op(o,i,r,s,a,"next",t)}function a(t){Op(o,i,r,s,a,"throw",t)}s(void 0)})},Np.apply(this,arguments)}function Rp(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return Dp(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(Dp(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Dp(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,Dp(h,"constructor",u),Dp(u,"constructor",c),c.displayName="GeneratorFunction",Dp(u,r,"GeneratorFunction"),Dp(h),Dp(h,r,"Generator"),Dp(h,i,function(){return this}),Dp(h,"toString",function(){return"[object Generator]"}),(Rp=function(){return{w:o,m:d}})()}function Dp(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Dp=function(t,e,n,i){function o(e,n){Dp(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},Dp(t,e,n,i)}function jp(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function Fp(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){jp(o,i,r,s,a,"next",t)}function a(t){jp(o,i,r,s,a,"throw",t)}s(void 0)})}}function Up(t){var e=document.createElement("div");function n(){return i.apply(this,arguments)}function i(){return i=Fp(Rp().m(function t(){var e,n,i,r,o,s,a,c,u;return Rp().w(function(t){for(;;)switch(t.p=t.n){case 0:if(f.isAuthenticated&&f.user){t.n=1;break}return alert("You must be logged in to view your friends."),t.a(2);case 1:if(e=document.getElementById("friendsModal"),n=e.querySelector("#friendsModalBody"),i=bootstrap.Modal.getInstance(e)||new bootstrap.Modal(e),n.innerHTML='<div class="text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>',i.show(),t.p=2,r=f.user,(o=r.getFollowing?Array.from(r.getFollowing()):r.following||[])&&0!==o.length){t.n=3;break}return n.innerHTML='<p class="text-muted text-center">You are not following anyone yet.</p>',t.a(2);case 3:return s=o.map(function(t){return sp.getUserById(t).catch(function(){return{id:t,username:"Unknown User (error)"}})}),t.n=4,Promise.all(s);case 4:a=t.v,(c=document.createElement("ul")).className="list-group list-group-flush",a.forEach(function(t){if(t){var e=document.createElement("li");e.className="list-group-item d-flex justify-content-between align-items-center";var i=t.getUsername?t.getUsername():t.username||"Unknown",r=t.getEmail?t.getEmail():t.email||t.id||"",o=document.createElement("div");o.innerHTML="<strong>".concat(i,'</strong><div class="text-muted" style="font-size: 0.85rem;">').concat(r,"</div>");var s=document.createElement("button");s.className="btn btn-outline-danger btn-sm",s.innerHTML='<i class="bi bi-person-dash-fill"></i> Unfollow',s.dataset.userId=t.getId?t.getId():t.id,s.addEventListener("click",function(){var t=Fp(Rp().m(function t(i){var r,o,a;return Rp().w(function(t){for(;;)switch(t.p=t.n){case 0:if(r=i.currentTarget.dataset.userId){t.n=1;break}return t.a(2);case 1:if(t.p=1,o=f.user){t.n=2;break}return t.a(2);case 2:return s.disabled=!0,s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>',t.n=3,sp.unfollowUser(o.getId?o.getId():o.id,r);case 3:o.unfollow?o.unfollow(r):Array.isArray(o.following)&&(o.following=o.following.filter(function(t){return t!==r})),e.remove(),0===c.children.length&&(n.innerHTML='<p class="text-muted text-center">You are not following anyone anymore.</p>'),t.n=5;break;case 4:t.p=4,a=t.v,console.error("Failed to unfollow",a),alert("Could not unfollow user."),s.disabled=!1,s.innerHTML='<i class="bi bi-person-dash-fill"></i> Unfollow';case 5:return t.a(2)}},t,null,[[1,4]])}));return function(e){return t.apply(this,arguments)}}()),e.appendChild(o),e.appendChild(s),c.appendChild(e)}}),n.innerHTML="",n.appendChild(c),t.n=6;break;case 5:t.p=5,u=t.v,console.error("Error loading friends",u),n.innerHTML='<div class="alert alert-danger">Error loading friends list.</div>';case 6:return t.a(2)}},t,null,[[2,5]])})),i.apply(this,arguments)}e.id="sessionComponent";var r=function(){if(e.innerHTML="",f.isAuthenticated&&f.user){var t=f.user,i=t.username||t.email||"User",r=document.createElement("div");r.className="d-flex align-items-center p-1 rounded";var o=document.createElement("div");o.className="rounded-circle d-flex align-items-center justify-content-center me-2 flex-shrink-0",o.style.width="38px",o.style.height="38px",o.style.background="linear-gradient(135deg,var(--accent),var(--accent-2))",o.style.color="#021012",o.style.fontWeight="bold",o.style.fontSize="1rem",o.textContent=i.charAt(0).toUpperCase();var s=document.createElement("div");s.className="session-info me-auto";var a=document.createElement("div");a.className="session-label d-none d-md-block",a.textContent="Logged in as:";var c=document.createElement("div");c.className="session-name text-truncate",c.textContent=i,c.title=i,s.appendChild(a),s.appendChild(c);var u=document.createElement("button");u.className="btn btn-outline-light btn-sm me-2",u.innerHTML='<i class="bi bi-people-fill"></i><span class="d-none d-md-inline ms-1">Friends</span>',u.title="Show followed users",u.setAttribute("data-bs-toggle","modal"),u.setAttribute("data-bs-target","#friendsModal"),u.addEventListener("click",n);var l=document.createElement("button");l.className="btn btn-outline-light btn-sm",l.innerHTML='<i class="bi bi-box-arrow-right"></i><span class="d-none d-md-inline ms-1">Logout</span>',l.title="Logout",l.addEventListener("click",Fp(Rp().m(function t(){var e;return Rp().w(function(t){for(;;)switch(t.p=t.n){case 0:return l.disabled=!0,l.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>',t.p=1,t.n=2,Mp();case 2:t.n=4;break;case 3:t.p=3,e=t.v,console.error("Logout error:",e),alert("Error during logout: ".concat(e.message)),l.disabled=!1,l.innerHTML='<i class="bi bi-box-arrow-right"></i><span class="d-none d-md-inline ms-1">Logout</span>';case 4:return t.a(2)}},t,null,[[1,3]])}))),r.appendChild(o),r.appendChild(s),r.appendChild(u),r.appendChild(l),e.appendChild(r)}};return f.subscribe(r),r(),t.appendChild(e),e}function Vp(t){return Vp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vp(t)}function Bp(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,zp(i.key),i)}}function zp(t){var e=function(t){if("object"!=Vp(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Vp(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Vp(e)?e:e+""}var Gp=function(){return t=function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Date;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e,this.userId=n,this.rounds=i,this.totalScore=r,this.date=o},(e=[{key:"getId",value:function(){return this.id}},{key:"getUserId",value:function(){return this.userId}},{key:"getRounds",value:function(){return this.rounds}},{key:"getTotalScore",value:function(){return this.totalScore}},{key:"getDate",value:function(){return this.date}},{key:"addRound",value:function(t){this.rounds.push(t),this.totalScore+=t.getScore()}}])&&Bp(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function qp(t){return qp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qp(t)}function Hp(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Zp(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Zp(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function Zp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function Wp(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function $p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Wp(Object(n),!0).forEach(function(e){tm(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Wp(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Kp(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return Qp(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(Qp(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Qp(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,Qp(h,"constructor",u),Qp(u,"constructor",c),c.displayName="GeneratorFunction",Qp(u,r,"GeneratorFunction"),Qp(h),Qp(h,r,"Generator"),Qp(h,i,function(){return this}),Qp(h,"toString",function(){return"[object Generator]"}),(Kp=function(){return{w:o,m:d}})()}function Qp(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Qp=function(t,e,n,i){function o(e,n){Qp(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},Qp(t,e,n,i)}function Yp(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function Xp(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){Yp(o,i,r,s,a,"next",t)}function a(t){Yp(o,i,r,s,a,"throw",t)}s(void 0)})}}function Jp(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,em(i.key),i)}}function tm(t,e,n){return(e=em(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function em(t){var e=function(t){if("object"!=qp(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=qp(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==qp(e)?e:e+""}var nm=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"saveGame",value:(o=Xp(Kp().m(function t(e){var n,i,r;return Kp().w(function(t){for(;;)switch(t.p=t.n){case 0:return n=Ro.now(),t.p=1,t.n=2,zf(this.collectionref,{userId:e.getUserId(),totalScore:e.getTotalScore(),date:n});case 2:return i=t.v,t.a(2,i.id);case 3:throw t.p=3,r=t.v,console.error("Error saving game: ",r),r;case 4:return t.a(2)}},t,this,[[1,3]])})),function(t){return o.apply(this,arguments)})},{key:"getGamesByUserId",value:(r=Xp(Kp().m(function t(e){var n,i,r;return Kp().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,n=pf(this.collectionref,gf("userId","==",e),_f("date","desc")),t.n=1,Uf(n);case 1:return i=t.v,t.a(2,i.docs.map(function(t){var e=t.data();return new Gp(t.id,e.userId,[],e.totalScore,e.date&&e.date.toDate?e.date.toDate():new Date(e.date))}));case 2:throw t.p=2,r=t.v,console.error("Error fetching games: ",r),r;case 3:return t.a(2)}},t,this,[[0,2]])})),function(t){return r.apply(this,arguments)})},{key:"getTopGamesSince",value:(i=Xp(Kp().m(function t(e){var n,i,r,o,s=arguments;return Kp().w(function(t){for(;;)switch(t.n){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:10,i=Ro.fromDate(e),r=pf(this.collectionref,gf("date",">=",i),_f("totalScore","desc"),bf(n)),t.n=1,Uf(r);case 1:return o=t.v,t.a(2,o.docs.map(function(t){return $p({id:t.id},t.data())}))}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"getTopGamesByUsersSince",value:(n=Xp(Kp().m(function t(){var e,n,i,r,o,s,a,c,u,l,h,d=arguments;return Kp().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e=d.length>0&&void 0!==d[0]?d[0]:[],n=d.length>1?d[1]:void 0,Array.isArray(e)&&0!==e.length){t.n=1;break}return t.a(2,[]);case 1:i=Ro.fromDate(n),r=[],o=Hp(e),t.p=2,o.s();case 3:if((s=o.n()).done){t.n=6;break}return a=s.value,c=pf(this.collectionref,gf("userId","==",a),gf("date",">=",i),_f("totalScore","desc"),bf(1)),t.n=4,Uf(c);case 4:(u=t.v).empty||(l=u.docs[0],r.push($p({id:l.id},l.data())));case 5:t.n=3;break;case 6:t.n=8;break;case 7:t.p=7,h=t.v,o.e(h);case 8:return t.p=8,o.f(),t.f(8);case 9:return r.sort(function(t,e){return e.totalScore-t.totalScore}),t.a(2,r)}},t,this,[[2,7,8,9]])})),function(){return n.apply(this,arguments)})}],e&&Jp(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i,r,o}();function im(t){return im="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},im(t)}function rm(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return om(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(om(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,om(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,om(h,"constructor",u),om(u,"constructor",c),c.displayName="GeneratorFunction",om(u,r,"GeneratorFunction"),om(h),om(h,r,"Generator"),om(h,i,function(){return this}),om(h,"toString",function(){return"[object Generator]"}),(rm=function(){return{w:o,m:d}})()}function om(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}om=function(t,e,n,i){function o(e,n){om(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},om(t,e,n,i)}function sm(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function am(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,cm(i.key),i)}}function cm(t){var e=function(t){if("object"!=im(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=im(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==im(e)?e:e+""}tm(nm,"collectionref",Pd($f,"games"));var um=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"execute",value:(n=rm().m(function t(e,n){var i,r,o;return rm().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e){t.n=1;break}throw new Error("User ID is required to save a game.");case 1:return i=new Gp(null,e,[],n,new Date),t.p=2,t.n=3,nm.saveGame(i);case 3:return r=t.v,t.a(2,r);case 4:throw t.p=4,o=t.v,console.error("Failed to save game:",o),o;case 5:return t.a(2)}},t,null,[[2,4]])}),i=function(){var t=this,e=arguments;return new Promise(function(i,r){var o=n.apply(t,e);function s(t){sm(o,i,r,s,a,"next",t)}function a(t){sm(o,i,r,s,a,"throw",t)}s(void 0)})},function(t,e){return i.apply(this,arguments)})}],e&&am(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i}();function lm(t){return lm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lm(t)}function hm(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return dm(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(dm(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,dm(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,dm(h,"constructor",u),dm(u,"constructor",c),c.displayName="GeneratorFunction",dm(u,r,"GeneratorFunction"),dm(h),dm(h,r,"Generator"),dm(h,i,function(){return this}),dm(h,"toString",function(){return"[object Generator]"}),(hm=function(){return{w:o,m:d}})()}function dm(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}dm=function(t,e,n,i){function o(e,n){dm(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},dm(t,e,n,i)}function fm(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function pm(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){fm(o,i,r,s,a,"next",t)}function a(t){fm(o,i,r,s,a,"throw",t)}s(void 0)})}}function mm(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,gm(i.key),i)}}function gm(t){var e=function(t){if("object"!=lm(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=lm(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==lm(e)?e:e+""}r(481);var ym=function(){return t=function t(e){var n=e.gameController,i=e.gameMapController,r=e.uiView;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gameController=n,this.gameMapController=i,this.uiView=r,this.tempGuess=null},e=[{key:"setTempGuess",value:function(t){this.gameController.isGameOver()||(this.tempGuess={lat:t.lat,lng:t.lng},this.uiView.setConfirmEnabled(!0))}},{key:"startNewGame",value:(r=pm(hm().m(function t(){var e,n=this;return hm().w(function(t){for(;;)switch(t.p=t.n){case 0:return this._resetAllUI(),this.uiView.setStatus("Recupero foto... potrebbe volerci qualche istante."),this.uiView.showLoader(),t.p=1,t.n=2,this.gameController.startNewGame();case 2:this._updatePhotoUI(),this.uiView.setStatus("Foto caricate. Inizio partita."),t.n=4;break;case 3:t.p=3,e=t.v,console.error("Errore startNewGame:",e),this.uiView.setStatus("Errore nel recupero delle foto. Riprova.");case 4:return t.p=4,this.uiView.hideLoader(),setTimeout(function(){return n.uiView.clearStatus()},2e3),t.f(4);case 5:return t.a(2)}},t,this,[[1,3,4,5]])})),function(){return r.apply(this,arguments)})},{key:"handleMapClick",value:function(t){console.warn("handleMapClick called, might be redundant if map click is directly linked to setTempGuess")}},{key:"confirmGuess",value:function(){if(this.tempGuess&&!this.gameController.isGameOver()){var t=this.gameController.confirmGuess(this.tempGuess),e=this.gameController.getCurrentPhoto();e&&(this.gameMapController.showSolution({lat:e.lat,lng:e.lng}),this.gameMapController.showLineBetween()),this.uiView.addRoundScore(this.gameController.getCurrentRound(),t.score,t.distance),this.uiView.setConfirmEnabled(!1),this.uiView.showNextButton(!0),this.gameMapController&&"function"==typeof this.gameMapController.disableInteraction&&this.gameMapController.disableInteraction(),this.tempGuess=null}}},{key:"nextRound",value:(i=pm(hm().m(function t(){return hm().w(function(t){for(;;)switch(t.n){case 0:if(this.gameController.nextRound()){t.n=2;break}return t.n=1,this._endGame();case 1:return t.a(2);case 2:this._resetRoundUI(),this._updatePhotoUI();case 3:return t.a(2)}},t,this)})),function(){return i.apply(this,arguments)})},{key:"_endGame",value:(n=pm(hm().m(function t(){var e,n,i,r;return hm().w(function(t){for(;;)switch(t.p=t.n){case 0:if(console.log("Game Ended. Showing final score and hero buttons."),e=this.gameController.getTotalScore(),!(n=f.user)||!n.id){t.n=5;break}return t.p=1,t.n=2,um.execute(n.id,e);case 2:console.log("Game saved successfully for user:",n.id),t.n=4;break;case 3:t.p=3,r=t.v,console.error("Errore salvataggio partita:",r);case 4:t.n=6;break;case 5:console.log("User not logged in, game score not saved.");case 6:this.uiView.showGameOver(e),this.uiView.showNextButton(!1),this.uiView.setConfirmEnabled(!1),this.gameMapController&&"function"==typeof this.gameMapController.disableInteraction&&this.gameMapController.disableInteraction();try{(i=document.querySelector(".hero-viewport"))?(console.log("Making hero viewport visible"),i.classList.remove("d-none"),i.classList.add("fade-in")):console.warn("Hero viewport element not found.")}catch(t){console.error("Error trying to show hero actions:",t)}case 7:return t.a(2)}},t,this,[[1,3]])})),function(){return n.apply(this,arguments)})},{key:"_updatePhotoUI",value:function(){var t=this.gameController.getCurrentPhoto();t&&t.url?this.uiView.setPhoto(t.url):(console.warn("Could not get current photo or photo URL is missing."),this.uiView.setPhoto(null))}},{key:"_resetRoundUI",value:function(){this.tempGuess=null,this.gameMapController.reset(),this.gameMapController&&"function"==typeof this.gameMapController.enableInteraction&&this.gameMapController.enableInteraction(),this.uiView.setConfirmEnabled(!1),this.uiView.showNextButton(!1)}},{key:"_resetAllUI",value:function(){this.tempGuess=null,this.gameMapController.reset(),this.gameMapController&&"function"==typeof this.gameMapController.enableInteraction&&this.gameMapController.enableInteraction(),this.uiView.reset(),this.uiView.setConfirmEnabled(!1),this.uiView.showNextButton(!1);var t=document.querySelector(".hero-viewport");t&&t.classList.add("d-none")}}],e&&mm(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i,r}();function vm(t){return vm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vm(t)}function _m(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,bm(i.key),i)}}function wm(t,e,n){return e&&_m(t.prototype,e),n&&_m(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function bm(t){var e=function(t){if("object"!=vm(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=vm(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vm(e)?e:e+""}var Tm=wm(function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.url=e,this.lat=n,this.lng=i});function Em(t){return Em="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Em(t)}function Sm(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Em(t)+" is not iterable")}function Im(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Lm(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function km(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return Cm(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(Cm(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Cm(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,Cm(h,"constructor",u),Cm(u,"constructor",c),c.displayName="GeneratorFunction",Cm(u,r,"GeneratorFunction"),Cm(h),Cm(h,r,"Generator"),Cm(h,i,function(){return this}),Cm(h,"toString",function(){return"[object Generator]"}),(km=function(){return{w:o,m:d}})()}function Cm(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Cm=function(t,e,n,i){function o(e,n){Cm(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},Cm(t,e,n,i)}function Pm(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function xm(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){Pm(o,i,r,s,a,"next",t)}function a(t){Pm(o,i,r,s,a,"throw",t)}s(void 0)})}}function Am(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,o,s,a=[],c=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=o.call(n)).done)&&(a.push(i.value),a.length!==e);c=!0);}catch(t){u=!0,r=t}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw r}}return a}}(t,e)||Lm(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Lm(t,e){if(t){if("string"==typeof t)return Om(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Om(t,e):void 0}}function Om(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}var Mm=[{name:"North America (Est)",bbox:[-90,25,-65,50]},{name:"North America (Ovest)",bbox:[-125,30,-100,50]},{name:"Europe Centrale",bbox:[0,45,20,55]},{name:"Europe Occidentale",bbox:[-10,40,5,55]},{name:"Asia Orientale (Giappone/Corea)",bbox:[120,30,145,45]},{name:"Asia Meridionale (India)",bbox:[70,15,90,30]},{name:"South America (Brasile/Argentina)",bbox:[-60,-40,-40,-15]},{name:"Oceania (Australia/Nuova Zelanda)",bbox:[140,-40,180,-20]}];function Nm(t){for(var e=[],n=.01,i=0;i<t;i++){var r=Am(Mm[Math.floor(Math.random()*Mm.length)].bbox,4),o=r[0],s=r[1],a=r[2],c=r[3],u=o+Math.random()*(a-o),l=s+Math.random()*(c-s);e.push([u-n,l-n,u+n,l+n])}return e}function Rm(t){return Dm.apply(this,arguments)}function Dm(){return Dm=xm(km().m(function t(e){var n,i,r,o,s,a=arguments;return km().w(function(t){for(;;)switch(t.p=t.n){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:10,i=e.join(","),r="".concat("https://graph.mapillary.com","/images?access_token=").concat("MLY|24471568689210680|a71d8529e468cdfe6474f2cc950bad3b","&fields=").concat("id,thumb_1024_url,geometry","&bbox=").concat(i,"&limit=").concat(n),t.p=1,t.n=2,fetch(r);case 2:if((o=t.v).ok){t.n=3;break}return t.a(2,[]);case 3:return t.n=4,o.json();case 4:return s=t.v,t.a(2,s.data?s.data.map(function(t){return{url:t.thumb_1024_url,coordinates:t.geometry.coordinates}}):[]);case 5:return t.p=5,t.v,t.a(2,[])}},t,null,[[1,5]])})),Dm.apply(this,arguments)}function jm(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.05,i=Am(t,2),r=i[0],o=i[1],s=Am(e,2),a=r-s[0],c=o-s[1];return Math.sqrt(a*a+c*c)<n}function Fm(){return Um.apply(this,arguments)}function Um(){return Um=xm(km().m(function t(){var e,n,i,r,o,s,a,c,u,l,h,d,f=arguments;return km().w(function(t){for(;;)switch(t.p=t.n){case 0:return e=f.length>0&&void 0!==f[0]?f[0]:5,i=f.length>2&&void 0!==f[2]?f[2]:20,r=[],o=Nm(n=f.length>1&&void 0!==f[1]?f[1]:200),t.n=1,Promise.all(o.map(function(t){return Rm(t,i)}));case 1:s=t.v,a=s.flat().filter(Boolean),c=Im(a),t.p=2,l=km().m(function t(){var n;return km().w(function(t){for(;;)switch(t.n){case 0:if(null!=(n=u.value)&&n.coordinates){t.n=1;break}return t.a(2,0);case 1:if(r.some(function(t){return jm(n.coordinates,t.coordinates)})){t.n=2;break}if(r.push(n),!(r.length>=e)){t.n=2;break}return t.a(2,1);case 2:return t.a(2)}},t)}),c.s();case 3:if((u=c.n()).done){t.n=7;break}return t.d(Sm(l()),4);case 4:if(0!==(h=t.v)){t.n=5;break}return t.a(3,6);case 5:if(1!==h){t.n=6;break}return t.a(3,7);case 6:t.n=3;break;case 7:t.n=9;break;case 8:t.p=8,d=t.v,c.e(d);case 9:return t.p=9,c.f(),t.f(9);case 10:if(!(r.length<e)){t.n=11;break}return console.warn("Solo ".concat(r.length," immagini trovate, nuovo tentativo...")),t.a(2,Fm(e,2*n,i));case 11:return t.a(2,r.slice(0,e))}},t,null,[[2,8,9,10]])})),Um.apply(this,arguments)}function Vm(){return Bm.apply(this,arguments)}function Bm(){return Bm=xm(km().m(function t(){var e,n,i=arguments;return km().w(function(t){for(;;)switch(t.n){case 0:return e=i.length>0&&void 0!==i[0]?i[0]:5,t.n=1,Fm(e);case 1:return n=t.v,t.a(2,n.map(function(t){var e=Am(t.coordinates,2),n=e[0],i=e[1];return new Tm(t.url,i,n)}))}},t)})),Bm.apply(this,arguments)}function zm(t){return zm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zm(t)}function Gm(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Hm(i.key),i)}}function qm(t,e,n){return e&&Gm(t.prototype,e),n&&Gm(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Hm(t){var e=function(t){if("object"!=zm(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=zm(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==zm(e)?e:e+""}var Zm=qm(function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.lat=e,this.lng=n,this.roundNumber=i});function Wm(t){return Wm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wm(t)}function $m(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return Km(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(Km(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Km(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,Km(h,"constructor",u),Km(u,"constructor",c),c.displayName="GeneratorFunction",Km(u,r,"GeneratorFunction"),Km(h),Km(h,r,"Generator"),Km(h,i,function(){return this}),Km(h,"toString",function(){return"[object Generator]"}),($m=function(){return{w:o,m:d}})()}function Km(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Km=function(t,e,n,i){function o(e,n){Km(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},Km(t,e,n,i)}function Qm(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function Ym(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Xm(i.key),i)}}function Xm(t){var e=function(t){if("object"!=Wm(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Wm(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Wm(e)?e:e+""}var Jm=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.state=f},e=[{key:"startNewGame",value:(n=$m().m(function t(){var e,n,i=arguments;return $m().w(function(t){for(;;)switch(t.n){case 0:return e=i.length>0&&void 0!==i[0]?i[0]:5,t.n=1,Vm(e);case 1:n=t.v,this.state.startNewGame(n);case 2:return t.a(2)}},t,this)}),i=function(){var t=this,e=arguments;return new Promise(function(i,r){var o=n.apply(t,e);function s(t){Qm(o,i,r,s,a,"next",t)}function a(t){Qm(o,i,r,s,a,"throw",t)}s(void 0)})},function(){return i.apply(this,arguments)})},{key:"getCurrentPhoto",value:function(){return this.state.getCurrentPhoto()?this.state.getCurrentPhoto():null}},{key:"isGameOver",value:function(){return this.state.isGameOver()}},{key:"confirmGuess",value:function(t){var e,n=t.lat,i=t.lng,r=new Zm(n,i,this.state.getCurrentRoundNumber()),o=function(t,e){var n=function(t){return t*Math.PI/180},i=n(e.lat-t.lat),r=n(e.lng-t.lng),o=n(t.lat),s=n(e.lat),a=Math.sin(i/2)*Math.sin(i/2)+Math.sin(r/2)*Math.sin(r/2)*Math.cos(o)*Math.cos(s);return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6371}(r,this.state.getCurrentPhoto()),s=(e=o)>=1e4?0:Math.round(500*(1-e/1e4));return this.state.recordGuess(r),this.state.recordScore(s,o),{score:s,distance:o}}},{key:"nextRound",value:function(){return this.state.nextRound()}},{key:"getTotalScore",value:function(){return this.state.getTotalScore()}},{key:"getCurrentRound",value:function(){return this.state.currentRound}}],e&&Ym(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i}();function tg(t){return tg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tg(t)}function eg(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,ng(i.key),i)}}function ng(t){var e=function(t){if("object"!=tg(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=tg(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==tg(e)?e:e+""}var ig=function(){return t=function t(e){var n=this;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!(e instanceof HTMLElement))throw new Error("GameMap expects a DOM element, not an ID string");this.map=L.map(e,{worldCopyJump:!1,maxBounds:[[-85,-180],[85,180]],maxBoundsViscosity:1,minZoom:2,maxZoom:5}).setView([20,0],2),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,bounds:[[-85,-180],[85,180]],attribution:"© OpenStreetMap contributors",noWrap:!0}).addTo(this.map),this.guessMarker=null,this.solutionMarker=null,this.line=null,this.interactive=!0,this.map.on("click",function(t){n.interactive&&(n.setGuessMarker(t.latlng),n.onMapClickCallback&&n.onMapClickCallback(t.latlng))})},(e=[{key:"setOnMapClick",value:function(t){this.onMapClickCallback=t}},{key:"setInteractive",value:function(t){this.interactive=!!t}},{key:"enableInteraction",value:function(){this.setInteractive(!0)}},{key:"disableInteraction",value:function(){this.setInteractive(!1)}},{key:"reset",value:function(){this.guessMarker&&(this.map.removeLayer(this.guessMarker),this.guessMarker=null),this.solutionMarker&&(this.map.removeLayer(this.solutionMarker),this.solutionMarker=null),this.line&&(this.map.removeLayer(this.line),this.line=null)}},{key:"setGuessMarker",value:function(t){this.guessMarker?this.guessMarker.setLatLng(t):this.guessMarker=L.marker(t,{draggable:!1}).addTo(this.map)}},{key:"showSolutionMarker",value:function(t){this.solutionMarker?this.solutionMarker.setLatLng(t):this.solutionMarker=L.marker(t).addTo(this.map)}},{key:"showLineBetweenMarkers",value:function(){if(this.guessMarker&&this.solutionMarker){var t=[this.guessMarker.getLatLng(),this.solutionMarker.getLatLng()];this.line?this.line.setLatLngs(t):this.line=L.polyline(t,{color:"red",weight:3}).addTo(this.map)}}}])&&eg(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function rg(t){return rg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rg(t)}function og(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,sg(i.key),i)}}function sg(t){var e=function(t){if("object"!=rg(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=rg(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==rg(e)?e:e+""}var ag=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.mapContainerId=e;var n=document.getElementById(e);if(!n)throw new Error("Map container not found");this.gameMap=new ig(n)},(e=[{key:"onMapClick",value:function(t){this.gameMap.setOnMapClick(t)}},{key:"setInteractive",value:function(t){this.gameMap&&"function"==typeof this.gameMap.setInteractive&&this.gameMap.setInteractive(t)}},{key:"disableInteraction",value:function(){this.setInteractive(!1)}},{key:"enableInteraction",value:function(){this.setInteractive(!0)}},{key:"reset",value:function(){this.gameMap.reset()}},{key:"showSolution",value:function(t){this.gameMap.showSolutionMarker(t)}},{key:"showLineBetween",value:function(){this.gameMap.showLineBetweenMarkers()}},{key:"invalidateSize",value:function(){this.gameMap&&this.gameMap.map&&this.gameMap.map.invalidateSize()}}])&&og(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function cg(t){return cg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cg(t)}function ug(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,lg(i.key),i)}}function lg(t){var e=function(t){if("object"!=cg(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=cg(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==cg(e)?e:e+""}var hg=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.root=e,this.container=null,this.mapContainer=null,this.photoElement=null,this.confirmButton=null,this.nextButton=null,this.statusElement=null,this.playArea=null,this.scoreListEl=null,this.gameMessageEl=null,this.photoContainer=null,this.handlers={},this._loaderEl=null,this._loaderShownAt=0,this._loaderMinMs=250},e=[{key:"renderGameUI",value:function(){var t=this;this.root.innerHTML='\n      <div class="container-fluid play-area mt-3">\n        <div id="gameMessage" class="col-12 mb-3 top-message d-none text-center"></div>\n\n        <div class="row g-3 mb-3"> \n            <div class="col-lg-7">\n                 <div id="status" class="game-status mb-2 text-center" style="color: var(--text);"></div>\n                <div class="photo-container mb-3 position-relative shadow" style="aspect-ratio: 16 / 9; border-radius: 10px; overflow: hidden; background-color: var(--card);">\n                    <img id="photoElement" alt="Guess the location" class="game-photo d-none w-100 h-100" style="object-fit: cover; border-radius: 10px;" />\n                </div>\n                <div class="controls text-center text-lg-start">\n                    <button id="confirmGuessBtn" class="btn btn-primary me-2" disabled>\n                        <i class="bi bi-check-circle-fill me-1"></i>Confirm Guess\n                    </button>\n                    <button id="nextRoundBtn" class="btn btn-secondary" disabled>\n                        <i class="bi bi-arrow-right-circle-fill me-1"></i>Next Round\n                    </button>\n                </div>\n            </div>\n\n            <div class="col-lg-5">\n                <div class="scoreboard card h-100 shadow" style="background-color: var(--card); color: var(--text);">\n                    <div class="card-body d-flex flex-column">\n                        <h3 class="card-title text-center mb-3">Round scores</h3>\n                        <ul id="scoreList" class="score-list list-unstyled flex-grow-1 overflow-auto mb-0">\n                        </ul>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class="row">\n            <div class="col-12 map-row">\n                <div id="map" class="map-panel w-100 shadow" style="height: min(60vh, 620px); min-height: 400px; border-radius: 10px; overflow: hidden;"></div>\n            </div>\n        </div>\n      </div>\n    ',this.playArea=this.root.querySelector(".play-area"),this.mapContainer=this.root.querySelector("#map"),this.photoContainer=this.root.querySelector(".photo-container"),this.photoElement=this.root.querySelector("#photoElement"),this.confirmButton=this.root.querySelector("#confirmGuessBtn"),this.nextButton=this.root.querySelector("#nextRoundBtn"),this.scoreListEl=this.root.querySelector("#scoreList"),this.statusElement=this.root.querySelector("#status"),this.gameMessageEl=this.root.querySelector("#gameMessage"),this.confirmButton.addEventListener("click",function(){var e,n;null===(e=(n=t.handlers).onConfirmGuess)||void 0===e||e.call(n)}),this.nextButton.addEventListener("click",function(){var e,n;null===(e=(n=t.handlers).onNextRound)||void 0===e||e.call(n)})}},{key:"on",value:function(t,e){this.handlers[t]=e}},{key:"setPhoto",value:function(t){this.photoElement&&(t?(this.photoElement.src=t,this.photoElement.classList.remove("d-none")):(this.photoElement.classList.add("d-none"),this.photoElement.removeAttribute("src")))}},{key:"showLoader",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).minMs,e=void 0===t?250:t;if(this.photoContainer&&!this._loaderEl){var n=document.createElement("div");n.className="js-loader",n.innerHTML='<div class="spinner-border text-light" role="status"><span class="visually-hidden">Loading...</span></div>',this.photoContainer.appendChild(n),this._loaderEl=n,this._loaderShownAt=Date.now(),this._loaderMinMs=Number(e)||250}}},{key:"hideLoader",value:function(){var t=this;if(this._loaderEl){var e=Date.now()-(this._loaderShownAt||0),n=Math.max(0,(this._loaderMinMs||0)-e),i=function(){try{t._loaderEl&&t._loaderEl.parentNode&&t._loaderEl.parentNode.removeChild(t._loaderEl)}catch(t){}t._loaderEl=null,t._loaderShownAt=0,t._loaderMinMs=0};n>0?setTimeout(i,n):i()}}},{key:"setStatus",value:function(t){this.statusElement&&(this.statusElement.textContent=t)}},{key:"clearStatus",value:function(){this.statusElement&&(this.statusElement.textContent="")}},{key:"setConfirmEnabled",value:function(t){this.confirmButton&&(this.confirmButton.disabled=!t)}},{key:"showNextButton",value:function(t){this.nextButton&&(this.nextButton.disabled=!t)}},{key:"addRoundScore",value:function(t,e,n){if(this.scoreListEl){var i=document.createElement("li");i.className="d-flex justify-content-between align-items-center py-1",i.innerHTML="\n        <span>Round ".concat(t,': <strong class="text-primary">').concat(e,' pts</strong></span>\n        <small class="text-muted">(').concat(n.toFixed(1)," km)</small>\n      "),this.scoreListEl.appendChild(i),this.scoreListEl.scrollTop=this.scoreListEl.scrollHeight}}},{key:"scrollToTop",value:function(){window.scrollTo({top:0,behavior:"smooth"})}},{key:"showGameOver",value:function(t){this.scrollToTop(),this.gameMessageEl&&(this.gameMessageEl.textContent="Game over! Final score: ".concat(t),this.gameMessageEl.classList.remove("d-none"),this.gameMessageEl.classList.add("game-over")),this.nextButton&&(this.nextButton.disabled=!0),this.confirmButton&&(this.confirmButton.disabled=!0)}},{key:"reset",value:function(){this.playArea&&this.playArea.classList.remove("d-none"),this.photoElement&&(this.photoElement.classList.add("d-none"),this.photoElement.removeAttribute("src")),this.nextButton&&(this.nextButton.disabled=!0),this.confirmButton&&(this.confirmButton.disabled=!0),this.scoreListEl&&(this.scoreListEl.innerHTML=""),this.gameMessageEl&&(this.gameMessageEl.classList.add("d-none"),this.gameMessageEl.classList.remove("game-over"),this.gameMessageEl.textContent=""),this.clearStatus(),this.hideLoader()}},{key:"getMapContainerId",value:function(){return"map"}}],e&&ug(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function dg(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return fg(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(fg(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,fg(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,fg(h,"constructor",u),fg(u,"constructor",c),c.displayName="GeneratorFunction",fg(u,r,"GeneratorFunction"),fg(h),fg(h,r,"Generator"),fg(h,i,function(){return this}),fg(h,"toString",function(){return"[object Generator]"}),(dg=function(){return{w:o,m:d}})()}function fg(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}fg=function(t,e,n,i){function o(e,n){fg(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},fg(t,e,n,i)}function pg(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function mg(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){pg(o,i,r,s,a,"next",t)}function a(t){pg(o,i,r,s,a,"throw",t)}s(void 0)})}}var gg=function(t){return mg(dg().m(function e(){return dg().w(function(e){for(;;)switch(e.n){case 0:if(t&&"string"==typeof t){e.n=1;break}return e.a(2,[]);case 1:return e.n=2,sp.getUserByUsername(t.toLowerCase());case 2:return e.a(2,e.v)}},e)}))()},yg=function(t){var e=arguments;return mg(dg().m(function n(){var i;return dg().w(function(n){for(;;)switch(n.n){case 0:if(i=e.length>1&&void 0!==e[1]?e[1]:10,t&&"string"==typeof t){n.n=1;break}return n.a(2,[]);case 1:return n.n=2,sp.findByUsernamePrefix(t.toLowerCase(),i);case 2:return n.a(2,n.v)}},n)}))()},vg=function(t){return mg(dg().m(function e(){return dg().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,sp.getUserById(t);case 1:return e.a(2,e.v)}},e)}))()},_g=function(t){return mg(dg().m(function e(){return dg().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,nm.getGamesByUserId(t);case 1:return e.a(2,e.v)}},e)}))()},wg=function(t,e){return mg(dg().m(function n(){return dg().w(function(n){for(;;)switch(n.n){case 0:if(!t.isFollowing(e)){n.n=2;break}return n.n=1,sp.unfollowUser(t.id,e);case 1:return n.a(2,{status:"unfollowed"});case 2:return n.n=3,sp.followUser(t.id,e);case 3:return n.a(2,{status:"followed"});case 4:return n.a(2)}},n)}))()},bg=function(t,e){return mg(dg().m(function n(){return dg().w(function(n){for(;;)if(0===n.n)return n.a(2,t.isFollowing(e))},n)}))()};function Tg(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return Eg(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(Eg(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Eg(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,Eg(h,"constructor",u),Eg(u,"constructor",c),c.displayName="GeneratorFunction",Eg(u,r,"GeneratorFunction"),Eg(h),Eg(h,r,"Generator"),Eg(h,i,function(){return this}),Eg(h,"toString",function(){return"[object Generator]"}),(Tg=function(){return{w:o,m:d}})()}function Eg(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Eg=function(t,e,n,i){function o(e,n){Eg(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},Eg(t,e,n,i)}function Sg(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function Ig(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){Sg(o,i,r,s,a,"next",t)}function a(t){Sg(o,i,r,s,a,"throw",t)}s(void 0)})}}var kg={searchExtract:function(t){return Ig(Tg().m(function e(){return Tg().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,gg(t);case 1:return e.a(2,e.v)}},e)}))()},searchPrefix:function(t,e){return Ig(Tg().m(function n(){return Tg().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,yg(t,e);case 1:return n.a(2,n.v)}},n)}))()},getUserById:function(t){return Ig(Tg().m(function e(){return Tg().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,vg(t);case 1:return e.a(2,e.v)}},e)}))()},getUserGamesHistory:function(t){return Ig(Tg().m(function e(){return Tg().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,_g(t);case 1:return e.a(2,e.v)}},e)}))()},toggleFollow:function(t){return Ig(Tg().m(function e(){var n;return Tg().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,wg(f.getUser(),t);case 1:return"followed"===(n=e.v).status?f.getUser().follow(t):"unfollowed"===n.status&&f.getUser().unfollow(t),e.a(2,n)}},e)}))()},isFollowing:function(t){return Ig(Tg().m(function e(){return Tg().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,bg(f.getUser(),t);case 1:return e.a(2,e.v)}},e)}))()}};function Cg(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.title,i=void 0===n?"Leaderboard":n,r=e.entries,o=void 0===r?[]:r;t.innerHTML='\n      <div class="leaderboard">\n        <h3 class="leaderboard-title">'.concat(i,'</h3>\n        <ul class="leaderboard-list list-group list-group-flush"></ul>\n      </div>\n    ');var s=t.querySelector(".leaderboard-list");function a(t){s.innerHTML="",t&&0!==t.length?(t.sort(function(t,e){return e.getScore()-t.getScore()}),t.forEach(function(t,e){var n=document.createElement("li");n.className="leaderboard-item list-group-item";var i=t.getDate()?t.getDate().toLocaleDateString("it-IT",{day:"2-digit",month:"short"}):"N/A";n.innerHTML='\n              <div class="lb-body">\n                  <span class="lb-user" title="'.concat(t.getUsername(),'">').concat(t.getUsername()||"Unknown",'</span>\n                  <span class="lb-score">').concat(t.getScore(),' pts</span>\n                  <span class="lb-date">').concat(i,"</span>\n              </div>\n            "),s.appendChild(n)})):s.innerHTML="<li class='list-group-item text-muted text-center empty'>No results yet</li>"}return a(o),{update:function(t){a(t)}}}function Pg(t){return Pg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pg(t)}function xg(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Ag(i.key),i)}}function Ag(t){var e=function(t){if("object"!=Pg(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Pg(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Pg(e)?e:e+""}var Lg=function(){return t=function t(e){var n=e.userId,i=e.username,r=void 0===i?null:i,o=e.score,s=e.date;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.userId=n,this.username=r,this.score=o,this.date=s instanceof Date?s:new Date(s)},(e=[{key:"getUserId",value:function(){return this.userId}},{key:"getUsername",value:function(){return this.username}},{key:"getScore",value:function(){return this.score}},{key:"getDate",value:function(){return this.date}}])&&xg(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Og(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return Mg(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(Mg(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Mg(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,Mg(h,"constructor",u),Mg(u,"constructor",c),c.displayName="GeneratorFunction",Mg(u,r,"GeneratorFunction"),Mg(h),Mg(h,r,"Generator"),Mg(h,i,function(){return this}),Mg(h,"toString",function(){return"[object Generator]"}),(Og=function(){return{w:o,m:d}})()}function Mg(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Mg=function(t,e,n,i){function o(e,n){Mg(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},Mg(t,e,n,i)}function Ng(t){return function(t){if(Array.isArray(t))return Rg(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Rg(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rg(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rg(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function Dg(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}var jg=function(t){return(e=Og().m(function e(){var n,i,r,o,s,a,c,u;return Og().w(function(e){for(;;)switch(e.n){case 0:return n=t.sinceDate,i=t.limit,r=void 0===i?10:i,e.n=1,nm.getTopGamesSince(n,r);case 1:if((o=e.v)&&0!==o.length){e.n=2;break}return e.a(2,[]);case 2:return s=Ng(new Set(o.map(function(t){return t.userId}))),e.n=3,sp.getUsersByIds(s);case 3:return a=e.v,c=new Map(a.map(function(t){return[t.id,t.username||t.displayName||t.email||""]})),u=o.map(function(t){return new Lg({userId:t.userId,username:c.get(t.userId)||"Unknown",score:t.totalScore||t.score||0,date:t.date&&t.date.toDate?t.date.toDate():new Date(t.date)})}),e.a(2,u)}},e)}),function(){var t=this,n=arguments;return new Promise(function(i,r){var o=e.apply(t,n);function s(t){Dg(o,i,r,s,a,"next",t)}function a(t){Dg(o,i,r,s,a,"throw",t)}s(void 0)})})();var e};function Fg(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return Ug(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(Ug(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Ug(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,Ug(h,"constructor",u),Ug(u,"constructor",c),c.displayName="GeneratorFunction",Ug(u,r,"GeneratorFunction"),Ug(h),Ug(h,r,"Generator"),Ug(h,i,function(){return this}),Ug(h,"toString",function(){return"[object Generator]"}),(Fg=function(){return{w:o,m:d}})()}function Ug(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Ug=function(t,e,n,i){function o(e,n){Ug(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},Ug(t,e,n,i)}function Vg(t){return function(t){if(Array.isArray(t))return Bg(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Bg(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bg(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bg(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function zg(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}var Gg=function(t){return(e=Fg().m(function e(){var n,i,r,o,s,a,c,u;return Fg().w(function(e){for(;;)switch(e.n){case 0:if(n=t.currentUser,i=t.sinceDate,t.limit,n){e.n=1;break}return e.a(2,[]);case 1:if((r=Array.from(n.getFollowing?n.getFollowing():n.following||[]))&&0!==r.length){e.n=2;break}return e.a(2,[]);case 2:return e.n=3,nm.getTopGamesByUsersSince(r,i);case 3:if((o=e.v)&&0!==o.length){e.n=4;break}return e.a(2,[]);case 4:return s=Vg(new Set(o.map(function(t){return t.userId}))),e.n=5,sp.getUsersByIds(s);case 5:return a=e.v,c=new Map(a.map(function(t){return[t.id,t.username||t.displayName||t.email||""]})),u=o.map(function(t){return new Lg({userId:t.userId,username:c.get(t.userId)||"Unknown",score:t.totalScore||t.score||0,date:t.date&&t.date.toDate?t.date.toDate():new Date(t.date)})}),e.a(2,u)}},e)}),function(){var t=this,n=arguments;return new Promise(function(i,r){var o=e.apply(t,n);function s(t){zg(o,i,r,s,a,"next",t)}function a(t){zg(o,i,r,s,a,"throw",t)}s(void 0)})})();var e};function qg(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return Hg(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(Hg(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Hg(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,Hg(h,"constructor",u),Hg(u,"constructor",c),c.displayName="GeneratorFunction",Hg(u,r,"GeneratorFunction"),Hg(h),Hg(h,r,"Generator"),Hg(h,i,function(){return this}),Hg(h,"toString",function(){return"[object Generator]"}),(qg=function(){return{w:o,m:d}})()}function Hg(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Hg=function(t,e,n,i){function o(e,n){Hg(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},Hg(t,e,n,i)}function Zg(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function Wg(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){Zg(o,i,r,s,a,"next",t)}function a(t){Zg(o,i,r,s,a,"throw",t)}s(void 0)})}}var $g=function(t){var e=arguments;return Wg(qg().m(function n(){var i;return qg().w(function(n){for(;;)switch(n.n){case 0:return i=e.length>1&&void 0!==e[1]?e[1]:10,n.n=1,jg({sinceDate:t,limit:i});case 1:return n.a(2,n.v)}},n)}))()},Kg=function(t){var e=arguments;return Wg(qg().m(function n(){var i,r;return qg().w(function(n){for(;;)switch(n.n){case 0:return i=e.length>1&&void 0!==e[1]?e[1]:10,r=f.getUser(),n.n=1,Gg({currentUser:r,sinceDate:t,limit:i});case 1:return n.a(2,n.v)}},n)}))()};function Qg(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,o,s,a=[],c=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=o.call(n)).done)&&(a.push(i.value),a.length!==e);c=!0);}catch(t){u=!0,r=t}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw r}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Yg(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yg(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yg(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function Xg(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return Jg(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(Jg(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Jg(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,Jg(h,"constructor",u),Jg(u,"constructor",c),c.displayName="GeneratorFunction",Jg(u,r,"GeneratorFunction"),Jg(h),Jg(h,r,"Generator"),Jg(h,i,function(){return this}),Jg(h,"toString",function(){return"[object Generator]"}),(Xg=function(){return{w:o,m:d}})()}function Jg(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Jg=function(t,e,n,i){function o(e,n){Jg(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},Jg(t,e,n,i)}function ty(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function ey(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){ty(o,i,r,s,a,"next",t)}function a(t){ty(o,i,r,s,a,"throw",t)}s(void 0)})}}function ny(t,e){return iy.apply(this,arguments)}function iy(){return iy=ey(Xg().m(function t(e,n){var i,r,o,s,a,c,u,l;return Xg().w(function(t){for(;;)switch(t.n){case 0:return c=function(){return c=ey(Xg().m(function t(){var e,n,a,c,u,l;return Xg().w(function(t){for(;;)switch(t.p=t.n){case 0:return o.update([]),s.update([]),i.querySelector(".leaderboard-list").innerHTML='<li class="list-group-item text-muted text-center">Loading...</li>',r.querySelector(".leaderboard-list").innerHTML='<li class="list-group-item text-muted text-center">Loading...</li>',(e=new Date).setDate(e.getDate()-7),t.p=1,t.n=2,Promise.all([$g(e,10),Kg(e,10)]);case 2:n=t.v,a=Qg(n,2),c=a[0],u=a[1],o.update(c),s.update(u),t.n=4;break;case 3:t.p=3,l=t.v,console.error("Error loading leaderboards:",l),i.querySelector(".leaderboard-list").innerHTML="<li class='list-group-item text-danger text-center'>Error loading global data</li>",r.querySelector(".leaderboard-list").innerHTML="<li class='list-group-item text-danger text-center'>Error loading friends data</li>";case 4:return t.a(2)}},t,null,[[1,3]])})),c.apply(this,arguments)},a=function(){return c.apply(this,arguments)},e.innerHTML='\n    <div class="leaderboard-page">\n      <div class="row gy-3"> \n        <div class="col-md-6">\n          <div id="globalLeaderboard" class="leaderboard-slot"></div>\n        </div>\n        <div class="col-md-6">\n          <div id="friendsLeaderboard" class="leaderboard-slot"></div>\n        </div>\n      </div>\n    </div>\n  ',i=e.querySelector("#globalLeaderboard"),r=e.querySelector("#friendsLeaderboard"),o=Cg(i,{title:"Global Top 10 (Last 7 Days)"}),s=Cg(r,{title:"Friends' Best (Last 7 Days)"}),(u=n.querySelector("#leaderboardRefreshBtn"))||((u=document.createElement("button")).id="leaderboardRefreshBtn",u.textContent="Refresh",u.className="btn btn-primary",u.addEventListener("click",ey(Xg().m(function t(){return Xg().w(function(t){for(;;)switch(t.n){case 0:return u.disabled=!0,u.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Refreshing...',t.n=1,a();case 1:u.disabled=!1,u.textContent="Refresh";case 2:return t.a(2)}},t)}))),(l=n.querySelector('[data-bs-dismiss="modal"]'))?n.insertBefore(u,l):n.appendChild(u)),t.n=1,a();case 1:return t.a(2)}},t)})),iy.apply(this,arguments)}function ry(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return oy(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(oy(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,oy(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,oy(h,"constructor",u),oy(u,"constructor",c),c.displayName="GeneratorFunction",oy(u,r,"GeneratorFunction"),oy(h),oy(h,r,"Generator"),oy(h,i,function(){return this}),oy(h,"toString",function(){return"[object Generator]"}),(ry=function(){return{w:o,m:d}})()}function oy(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}oy=function(t,e,n,i){function o(e,n){oy(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},oy(t,e,n,i)}function sy(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function ay(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){sy(o,i,r,s,a,"next",t)}function a(t){sy(o,i,r,s,a,"throw",t)}s(void 0)})}}function cy(t,e){return uy.apply(this,arguments)}function uy(){return uy=ay(ry().m(function t(e,n){var i,o,s,a,c,u,l,h,d,f,p,m,g,y,v,_,w,b,T=arguments;return ry().w(function(t){for(;;)switch(t.n){case 0:if(v=function(){return v=ay(ry().m(function t(){var e,n,i,r,o;return ry().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e=document.getElementById("leaderboardModal")){t.n=1;break}return t.a(2);case 1:return n=e.querySelector("#leaderboardModalBody"),i=e.querySelector(".modal-footer"),n.innerHTML='<div class="text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>',(r=i.querySelector("#leaderboardRefreshBtn"))&&i.removeChild(r),t.p=2,t.n=3,ny(n,i);case 3:t.n=5;break;case 4:t.p=4,o=t.v,console.error("Error rendering leaderboard view:",o),n.innerHTML='<div class="alert alert-danger">Unable to load leaderboard.</div>';case 5:return t.a(2)}},t,null,[[2,4]])})),v.apply(this,arguments)},y=function(){return v.apply(this,arguments)},g=function(){p.classList.remove("d-none"),m.classList.add("d-none");var t=new hg(p);t.renderGameUI();var e=new Jm,n=new ag(t.getMapContainerId()),i=new ym({gameController:e,gameMapController:n,uiView:t});t.on("onConfirmGuess",function(){return i.confirmGuess()}),t.on("onNextRound",function(){return i.nextRound()}),n.onMapClick(function(t){return i.setTempGuess(t)}),i.startNewGame(),setTimeout(function(){return n.invalidateSize()},100),window.addEventListener("resize",function(){return n.invalidateSize()})},h=function(){return(h=ay(ry().m(function t(e){var n,i;return ry().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e&&!(e.length<1)){t.n=1;break}return s.innerHTML='<li><p class="dropdown-header px-3 pt-1 pb-0">Start typing to search...</p></li>',t.a(2);case 1:return s.innerHTML='<li><p class="dropdown-item text-muted disabled">Searching...</p></li>',t.p=2,t.n=3,c.searchPrefix(e,10);case 3:n=t.v,u(n),t.n=5;break;case 4:t.p=4,i=t.v,console.error("Error during user search:",i),s.innerHTML='<li><p class="dropdown-item text-danger disabled">Error: '.concat(i.message,"</p></li>");case 5:return t.a(2)}},t,null,[[2,4]])}))).apply(this,arguments)},l=function(t){return h.apply(this,arguments)},u=function(t){t&&0!==t.length?(s.innerHTML="",t.forEach(function(t){var e=t.getId?t.getId():t.id,n=t.getUsername?t.getUsername():t.username,i=document.createElement("li"),r=document.createElement("a");r.className="dropdown-item search-result-item",r.href="#",r.dataset.userId=e,r.dataset.username=n,r.textContent=n,i.appendChild(r),s.appendChild(i)})):s.innerHTML='<li><p class="dropdown-item text-muted disabled">No users found.</p></li>'},i=(T.length>2&&void 0!==T[2]?T[2]:{}).mode||"home",document.body.className="body d-flex flex-column min-vh-100",e.innerHTML='\n    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="background-color: var(--card);">\n      <div class="container-fluid">\n        <a class="navbar-brand" href="/game">Guess The Place</a>\n        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavGame" aria-controls="navbarNavGame" aria-expanded="false" aria-label="Toggle navigation">\n          <span class="navbar-toggler-icon"></span>\n        </button>\n        <div class="collapse navbar-collapse justify-content-end" id="navbarNavGame">\n            <div class="navbar-nav align-items-center">\n                 <div class="nav-item dropdown me-3 search-wrapper">\n                    <input type="text" id="userSearchInput" class="form-control form-control-sm dropdown-toggle" placeholder="Search user..."\n                           autocomplete="off" data-bs-toggle="dropdown" aria-expanded="false">\n                    <ul id="searchResults" class="dropdown-menu dropdown-menu-end mt-2" aria-labelledby="userSearchInput">\n                         <li><p class="dropdown-header px-3 pt-1 pb-0">Start typing to search...</p></li>\n                    </ul>\n                 </div>\n                 <div class="nav-item">\n                    <div id="sessionContainer"></div>\n                 </div>\n            </div>\n        </div>\n      </div>\n    </nav>\n\n    <div class="container-fluid mt-5 pt-3 flex-grow-1">\n        <main class="game-main h-100">\n            <div class="hero-viewport text-center my-5 py-5 '.concat("home"!==i?"d-none":"",'">\n                <div class="hero-actions">\n                    <button id="startGameButton" class="btn btn-success btn-lg mx-2">\n                        <i class="bi bi-play-circle-fill me-2"></i>Start new game\n                    </button>\n                    <button id="leaderboardButton" class="btn btn-warning btn-lg mx-2" data-bs-toggle="modal" data-bs-target="#leaderboardModal">\n                        <i class="bi bi-trophy-fill me-2"></i>Scoreboard\n                    </button>\n                </div>\n            </div>\n\n            <div id="gameContainer" class="').concat("play"!==i?"d-none":"",'"></div>\n        </main>\n    </div>\n    '),Up(e.querySelector("#sessionContainer")),o=e.querySelector("#userSearchInput"),s=e.querySelector("#searchResults"),c=kg,o.addEventListener("input",function(){var t=o.value.trim();clearTimeout(a),(bootstrap.Dropdown.getInstance(o)||new bootstrap.Dropdown(o)).show(),a=setTimeout(function(){return l(t)},300)}),s.addEventListener("click",function(){var t=ay(ry().m(function t(e){var n,i,o,a,u,l,h,d;return ry().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e.preventDefault(),n=e.target.closest(".search-result-item")){t.n=1;break}return t.a(2);case 1:return e.stopPropagation(),i=n.dataset.userId,(o=s.querySelector(".search-profile-slot"))||((a=document.createElement("li")).innerHTML='<hr class="dropdown-divider">',s.appendChild(a),(o=document.createElement("li")).className="search-profile-slot p-2",s.appendChild(o)),o.innerHTML='<div class="text-center text-muted">Loading profile...</div>',t.p=2,t.n=3,r.e(906).then(r.bind(r,906));case 3:return u=t.v,l=u.UserView,h=new l(o,c),t.n=4,h.render(i);case 4:t.n=6;break;case 5:t.p=5,d=t.v,console.error("Error rendering user profile:",d),o.innerHTML='<div class="alert alert-danger alert-sm m-0">Error loading profile.</div>';case 6:e.stopPropagation();case 7:return t.a(2)}},t,null,[[2,5]])}));return function(e){return t.apply(this,arguments)}}()),document.addEventListener("click",function(t){var e=t.target.closest(".search-wrapper"),n=t.target===o;if(!e&&!n){var i=bootstrap.Dropdown.getInstance(o);i&&s.classList.contains("show")&&(i.hide(),s.innerHTML='<li><p class="dropdown-header px-3 pt-1 pb-0">Start typing to search...</p></li>')}}),d=e.querySelector("#startGameButton"),f=e.querySelector("#leaderboardButton"),p=e.querySelector("#gameContainer"),m=e.querySelector(".hero-viewport"),(_=document.getElementById("leaderboardModal"))&&!_.dataset.listenerAttached&&(_.addEventListener("hidden.bs.modal",function(){n&&"/game/scoreboard"===window.location.pathname&&n.navigate("/game",{replace:!0});var t=document.querySelector(".modal-backdrop");t&&(t.parentNode.removeChild(t),document.body.style.overflow="",document.body.style.paddingRight="",document.body.classList.remove("modal-open"))}),_.dataset.listenerAttached="true"),d.addEventListener("click",function(){n?n.navigate("/game/play"):g()}),f.addEventListener("click",ay(ry().m(function t(){return ry().w(function(t){for(;;)switch(t.n){case 0:n&&"/game/scoreboard"!==window.location.pathname&&n.navigate("/game/scoreboard");case 1:return t.a(2)}},t)}))),_&&_.addEventListener("show.bs.modal",ay(ry().m(function t(){return ry().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,y();case 1:return t.a(2)}},t)}))),"play"!==i){t.n=1;break}g(),t.n=3;break;case 1:if("scoreboard"!==i){t.n=3;break}if(!(w=document.getElementById("leaderboardModal"))){t.n=3;break}if(b=bootstrap.Modal.getInstance(w)||new bootstrap.Modal(w),w.classList.contains("show")){t.n=2;break}b.show(),t.n=3;break;case 2:return t.n=3,y();case 3:return t.a(2)}},t)})),uy.apply(this,arguments)}function ly(t){return ly="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ly(t)}function hy(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function dy(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return fy(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(fy(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,fy(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,fy(h,"constructor",u),fy(u,"constructor",c),c.displayName="GeneratorFunction",fy(u,r,"GeneratorFunction"),fy(h),fy(h,r,"Generator"),fy(h,i,function(){return this}),fy(h,"toString",function(){return"[object Generator]"}),(dy=function(){return{w:o,m:d}})()}function fy(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}fy=function(t,e,n,i){function o(e,n){fy(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},fy(t,e,n,i)}function py(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function my(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){py(o,i,r,s,a,"next",t)}function a(t){py(o,i,r,s,a,"throw",t)}s(void 0)})}}function gy(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,yy(i.key),i)}}function yy(t){var e=function(t){if("object"!=ly(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ly(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ly(e)?e:e+""}var vy=function(){return t=function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.root="string"==typeof e?document.getElementById(e):e,!this.root)throw new Error("Router: root element not found for id ".concat(e));this.routes={},this.currentCss=[],this._registerPopState()},e=[{key:"addRoute",value:function(t,e){this.routes[t]=e}},{key:"navigate",value:(i=my(dy().m(function t(e){var n,i=arguments;return dy().w(function(t){for(;;)switch(t.n){case 0:return void 0!==(n=(i.length>1&&void 0!==i[1]?i[1]:{}).replace)&&n?history.replaceState({},"",e):history.pushState({},"",e),t.n=1,this._loadRoute(e);case 1:return t.a(2)}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"init",value:function(){var t=my(dy().m(function t(){return dy().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this._loadRoute(window.location.pathname);case 1:return t.a(2)}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"_loadRoute",value:(n=my(dy().m(function t(e){var n,i=this;return dy().w(function(t){for(;;)switch(t.n){case 0:if(n=this.routes[e]){t.n=2;break}if(!this.routes["/login"]){t.n=1;break}return t.a(2,this.navigate("/login",{replace:!0}));case 1:return this.root.innerHTML="<h2>404 - Page not found</h2>",t.a(2);case 2:if(this._unloadCurrentCss(),!Array.isArray(n.css)||!n.css.length){t.n=3;break}return t.n=3,Promise.all(n.css.map(function(t){return i._loadCss(t)}));case 3:if("function"!=typeof n.render){t.n=4;break}return this.root.innerHTML="",t.n=4,n.render(this.root,this);case 4:return t.a(2)}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"_registerPopState",value:function(){var t=this;window.addEventListener("popstate",function(){t._loadRoute(window.location.pathname)})}},{key:"_loadCss",value:function(t){var e=this;return new Promise(function(n,i){if(document.querySelector('link[data-router-css="'.concat(t,'"]')))return e.currentCss.push(t),n();var r=document.createElement("link");r.rel="stylesheet",r.href=t,r.setAttribute("data-router-css",t),r.onload=function(){e.currentCss.push(t),n()},r.onerror=function(t){return i(t)},document.head.appendChild(r)})}},{key:"_unloadCurrentCss",value:function(){var t,e=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return hy(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?hy(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}(this.currentCss);try{for(e.s();!(t=e.n()).done;){var n=t.value,i=document.querySelector('link[data-router-css="'.concat(n,'"]'));i&&i.remove()}}catch(t){e.e(t)}finally{e.f()}this.currentCss=[]}}],e&&gy(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i}();function _y(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var c=i&&i.prototype instanceof a?i:a,u=Object.create(c.prototype);return wy(u,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,a=0,c=t,d.n=n,s}};function f(n,i){for(a=n,c=i,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],f=d.p,p=o[2];n>3?(r=p===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(a=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,a=0))}if(r||n>1)return s;throw h=!0,i}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(e=a<2?t:c)||!h;){o||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=d.n<0)?c:n.call(i,d))!==s)break}catch(e){o=t,a=1,c=e}finally{u=1}}return{value:e,done:h}}}(n,r,o),!0),u}var s={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][i]?e(e([][i]())):(wy(e={},i,function(){return this}),e),h=u.prototype=a.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,wy(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=u,wy(h,"constructor",u),wy(u,"constructor",c),c.displayName="GeneratorFunction",wy(u,r,"GeneratorFunction"),wy(h),wy(h,r,"Generator"),wy(h,i,function(){return this}),wy(h,"toString",function(){return"[object Generator]"}),(_y=function(){return{w:o,m:d}})()}function wy(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}wy=function(t,e,n,i){function o(e,n){wy(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},wy(t,e,n,i)}function by(t,e,n,i,r,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function Ty(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){by(o,i,r,s,a,"next",t)}function a(t){by(o,i,r,s,a,"throw",t)}s(void 0)})}}var Ey,Sy,Iy,ky,Cy,Py,xy=document.getElementById("app"),Ay=new vy("app");function Ly(){return Ly=Ty(_y().m(function t(){return _y().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,hp();case 1:return f.subscribe(function(){var t=Ty(_y().m(function t(e){var n;return _y().w(function(t){for(;;)switch(t.n){case 0:if(e.authReady){t.n=1;break}return t.a(2);case 1:if(n=window.location.pathname,!e.isAuthenticated||!e.user){t.n=4;break}if("/login"!==n&&"/register"!==n&&"/"!==n){t.n=3;break}return t.n=2,Ay.navigate("/game",{replace:!0});case 2:case 5:case 7:return t.a(2);case 3:t.n=6;break;case 4:if("/login"===n||"/register"===n){t.n=6;break}return t.n=5,Ay.navigate("/login",{replace:!0});case 6:return t.n=7,Ay.init()}},t)}));return function(e){return t.apply(this,arguments)}}()),t.n=2,Ay.init();case 2:return t.a(2)}},t)})),Ly.apply(this,arguments)}Ay.addRoute("/",{render:(Ey=Ty(_y().m(function t(e){return _y().w(function(t){for(;;)switch(t.n){case 0:if(f.authReady){t.n=1;break}return xy.innerHTML="",t.a(2);case 1:if(!f.isAuthenticated||!f.user){t.n=3;break}return t.n=2,cy(xy);case 2:t.n=4;break;case 3:return t.n=4,xp(xy,"login",Ay);case 4:return t.a(2)}},t)})),function(t){return Ey.apply(this,arguments)})}),Ay.addRoute("/login",{render:(Sy=Ty(_y().m(function t(){return _y().w(function(t){for(;;)if(0===t.n)return t.a(2,xp(xy,"login",Ay))},t)})),function(){return Sy.apply(this,arguments)})}),Ay.addRoute("/register",{render:(Iy=Ty(_y().m(function t(){return _y().w(function(t){for(;;)if(0===t.n)return t.a(2,xp(xy,"register",Ay))},t)})),function(){return Iy.apply(this,arguments)})}),Ay.addRoute("/game",{render:(ky=Ty(_y().m(function t(){return _y().w(function(t){for(;;)if(0===t.n)return t.a(2,cy(xy,Ay,{mode:"home"}))},t)})),function(){return ky.apply(this,arguments)})}),Ay.addRoute("/game/play",{render:(Cy=Ty(_y().m(function t(){return _y().w(function(t){for(;;)if(0===t.n)return t.a(2,cy(xy,Ay,{mode:"play"}))},t)})),function(){return Cy.apply(this,arguments)})}),Ay.addRoute("/game/scoreboard",{render:(Py=Ty(_y().m(function t(){return _y().w(function(t){for(;;)if(0===t.n)return t.a(2,cy(xy,Ay,{mode:"scoreboard"}))},t)})),function(){return Py.apply(this,arguments)})}),function(){Ly.apply(this,arguments)}()})()})();